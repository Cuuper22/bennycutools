<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; connect-src 'self'; img-src 'self' data: blob:;">
  <meta name="robots" content="noindex, nofollow, noarchive">
  <title>Lead Spark - K & A Electric</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-primary: oklch(0.98 0 0);
      --bg-secondary: oklch(0.96 0 0);
      --bg-card: oklch(1 0 0);
      --text-primary: oklch(0.15 0 0);
      --text-secondary: oklch(0.4 0 0);
      --text-muted: oklch(0.5 0 0);
      --border: oklch(0.9 0 0);
      --border-strong: oklch(0.85 0 0);
      --accent: oklch(0.55 0.18 250);
      --accent-light: oklch(0.95 0.05 250);
      --success: oklch(0.55 0.15 145);
      --success-light: oklch(0.92 0.05 145);
      --warning: oklch(0.7 0.15 75);
      --warning-light: oklch(0.95 0.08 75);
      --danger: oklch(0.55 0.2 25);
      --danger-light: oklch(0.95 0.06 25);
      --shadow-sm: 0 1px 2px oklch(0 0 0 / 0.04);
      --shadow-md: 0 4px 12px oklch(0 0 0 / 0.06), 0 1px 3px oklch(0 0 0 / 0.04);
      --shadow-lg: 0 8px 24px oklch(0 0 0 / 0.08), 0 2px 6px oklch(0 0 0 / 0.04);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --font: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    html, body {
      font-family: var(--font);
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.5;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    body {
      padding-bottom: 80px;
    }

    /* Skip link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--accent);
      color: white;
      padding: 8px 16px;
      z-index: 10000;
      text-decoration: none;
      font-weight: 500;
      border-radius: 0 0 var(--radius-sm) 0;
      transition: top 0.2s;
    }
    .skip-link:focus {
      top: 0;
      outline: 2px solid white;
      outline-offset: 2px;
    }

    /* Focus styles */
    :focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    button:focus-visible, a:focus-visible, input:focus-visible, textarea:focus-visible, select:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    /* Auth Screen */
    .auth-screen {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      background: linear-gradient(135deg, var(--accent-light), var(--bg-primary));
    }

    .auth-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      padding: 32px 24px;
      width: 100%;
      max-width: 360px;
      text-align: center;
    }

    .auth-logo {
      width: 64px;
      height: 64px;
      background: var(--accent);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
    }

    .auth-logo svg {
      width: 36px;
      height: 36px;
      color: white;
    }

    .auth-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .auth-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 24px;
    }

    .auth-input-group {
      position: relative;
      margin-bottom: 16px;
    }

    .auth-input-group label {
      display: block;
      text-align: left;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 6px;
      color: var(--text-secondary);
    }

    .auth-input {
      width: 100%;
      padding: 12px 16px;
      font-size: 16px;
      font-family: var(--font);
      border: 1px solid var(--border-strong);
      border-radius: var(--radius-md);
      background: var(--bg-card);
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    .auth-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-light);
    }

    .auth-btn {
      width: 100%;
      padding: 14px 24px;
      font-size: 15px;
      font-weight: 600;
      font-family: var(--font);
      color: white;
      background: var(--accent);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: transform 0.1s, box-shadow 0.15s;
    }

    .auth-btn:hover {
      box-shadow: var(--shadow-md);
    }

    .auth-btn:active {
      transform: scale(0.98);
    }

    .auth-error {
      color: var(--danger);
      font-size: 13px;
      margin-top: 12px;
      display: none;
    }

    .auth-error.visible {
      display: block;
    }

    /* Main App */
    .app {
      display: none;
    }

    .app.active {
      display: block;
    }

    /* Demo Banner */
    .demo-banner {
      background: linear-gradient(90deg, var(--accent), oklch(0.5 0.2 280));
      color: white;
      padding: 10px 16px;
      font-size: 13px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .demo-banner-text {
      flex: 1;
    }

    .demo-banner-close {
      background: oklch(1 0 0 / 0.2);
      border: none;
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .demo-banner-close:hover {
      background: oklch(1 0 0 / 0.3);
    }

    /* Header */
    .header {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      padding: 16px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .header-brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .header-logo {
      width: 36px;
      height: 36px;
      background: var(--accent);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .header-logo svg {
      width: 20px;
      height: 20px;
      color: white;
    }

    .header-title {
      font-size: 18px;
      font-weight: 700;
    }

    .header-actions {
      display: flex;
      gap: 8px;
    }

    .icon-btn {
      width: 40px;
      height: 40px;
      border: 1px solid var(--border);
      background: var(--bg-card);
      border-radius: var(--radius-sm);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      transition: background 0.15s, color 0.15s;
    }

    .icon-btn:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .icon-btn svg {
      width: 20px;
      height: 20px;
    }

    /* Revenue Strip */
    .revenue-strip {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .revenue-stat {
      text-align: center;
      padding: 8px;
      background: var(--bg-secondary);
      border-radius: var(--radius-sm);
    }

    .revenue-stat-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .revenue-stat-value.success {
      color: var(--success);
    }

    .revenue-stat-value.warning {
      color: var(--warning);
    }

    .revenue-stat-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Tab Views */
    .tab-view {
      display: none;
      padding: 16px;
    }

    .tab-view.active {
      display: block;
    }

    /* Section Headers */
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .section-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .section-badge {
      background: var(--danger);
      color: white;
      font-size: 11px;
      font-weight: 600;
      padding: 3px 8px;
      border-radius: 10px;
    }

    .section-badge.success {
      background: var(--success);
    }

    .section-badge.warning {
      background: var(--warning);
    }

    /* Lead Cards */
    .lead-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: var(--shadow-sm);
      transition: box-shadow 0.15s, transform 0.15s;
    }

    .lead-card:hover {
      box-shadow: var(--shadow-md);
    }

    .lead-card.urgent {
      border-left: 4px solid var(--danger);
    }

    .lead-card.warm {
      border-left: 4px solid var(--warning);
    }

    .lead-card.new {
      border-left: 4px solid var(--accent);
    }

    .lead-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .lead-name {
      font-size: 16px;
      font-weight: 600;
    }

    .lead-time {
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .lead-time.urgent {
      color: var(--danger);
      font-weight: 500;
    }

    .lead-service {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }

    .lead-location {
      font-size: 13px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 12px;
    }

    .lead-location svg {
      width: 14px;
      height: 14px;
    }

    .lead-value {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 13px;
      font-weight: 600;
      color: var(--success);
      background: var(--success-light);
      padding: 4px 10px;
      border-radius: 20px;
      margin-bottom: 12px;
    }

    .lead-actions {
      display: flex;
      gap: 8px;
    }

    .lead-btn {
      flex: 1;
      padding: 10px 12px;
      font-size: 13px;
      font-weight: 600;
      font-family: var(--font);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      background: var(--bg-card);
      color: var(--text-primary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: all 0.15s;
    }

    .lead-btn:hover {
      background: var(--bg-secondary);
    }

    .lead-btn:active {
      transform: scale(0.98);
    }

    .lead-btn.primary {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .lead-btn.primary:hover {
      background: oklch(0.5 0.18 250);
    }

    .lead-btn.success {
      background: var(--success);
      color: white;
      border-color: var(--success);
    }

    .lead-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Quote Cards */
    .quote-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: var(--shadow-sm);
    }

    .quote-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .quote-customer {
      font-size: 15px;
      font-weight: 600;
    }

    .quote-amount {
      font-size: 18px;
      font-weight: 700;
      color: var(--success);
    }

    .quote-service {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .quote-meta {
      display: flex;
      gap: 16px;
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .quote-meta-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .quote-meta-item svg {
      width: 14px;
      height: 14px;
    }

    .quote-status {
      display: inline-flex;
      align-items: center;
      font-size: 12px;
      font-weight: 500;
      padding: 4px 10px;
      border-radius: 20px;
    }

    .quote-status.pending {
      background: var(--warning-light);
      color: oklch(0.45 0.15 75);
    }

    .quote-status.viewed {
      background: var(--accent-light);
      color: var(--accent);
    }

    .quote-status.won {
      background: var(--success-light);
      color: var(--success);
    }

    .quote-status.lost {
      background: var(--danger-light);
      color: var(--danger);
    }

    /* Empty States */
    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--text-muted);
    }

    .empty-state svg {
      width: 48px;
      height: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }

    .empty-state-text {
      font-size: 14px;
    }

    /* Response Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: oklch(0 0 0 / 0.5);
      display: none;
      align-items: flex-end;
      justify-content: center;
      z-index: 1000;
      padding: 16px;
    }

    .modal-overlay.active {
      display: flex;
    }

    @media (min-width: 768px) {
      .modal-overlay {
        align-items: center;
      }
    }

    .modal {
      background: var(--bg-card);
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      width: 100%;
      max-width: 480px;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
    }

    @media (min-width: 768px) {
      .modal {
        border-radius: var(--radius-lg);
      }
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      background: var(--bg-card);
    }

    .modal-title {
      font-size: 17px;
      font-weight: 600;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border: none;
      background: var(--bg-secondary);
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
    }

    .modal-close:hover {
      background: var(--border);
    }

    .modal-close svg {
      width: 18px;
      height: 18px;
    }

    .modal-body {
      padding: 16px;
    }

    .modal-lead-info {
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 12px;
      margin-bottom: 16px;
    }

    .modal-lead-name {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .modal-lead-detail {
      font-size: 13px;
      color: var(--text-secondary);
    }

    /* Response Templates */
    .template-section {
      margin-bottom: 16px;
    }

    .template-label {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .template-grid {
      display: grid;
      gap: 8px;
    }

    .template-btn {
      padding: 12px;
      font-size: 14px;
      font-family: var(--font);
      text-align: left;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      background: var(--bg-card);
      cursor: pointer;
      transition: all 0.15s;
    }

    .template-btn:hover {
      border-color: var(--accent);
      background: var(--accent-light);
    }

    .template-btn.selected {
      border-color: var(--accent);
      background: var(--accent-light);
    }

    /* Custom Message */
    .custom-message-container {
      margin-top: 16px;
    }

    .custom-message-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .voice-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      font-size: 12px;
      font-weight: 500;
      font-family: var(--font);
      color: var(--accent);
      background: var(--accent-light);
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.15s;
    }

    .voice-btn:hover {
      background: oklch(0.9 0.08 250);
    }

    .voice-btn.recording {
      color: var(--danger);
      background: var(--danger-light);
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .voice-btn svg {
      width: 14px;
      height: 14px;
    }

    .custom-textarea {
      width: 100%;
      min-height: 100px;
      padding: 12px;
      font-size: 14px;
      font-family: var(--font);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      resize: vertical;
      transition: border-color 0.15s;
    }

    .custom-textarea:focus {
      border-color: var(--accent);
      outline: none;
      box-shadow: 0 0 0 3px var(--accent-light);
    }

    /* Send Actions */
    .send-actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }

    .send-btn {
      flex: 1;
      padding: 14px;
      font-size: 14px;
      font-weight: 600;
      font-family: var(--font);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.15s;
    }

    .send-btn.call {
      background: var(--success);
      color: white;
    }

    .send-btn.call:hover {
      background: oklch(0.5 0.15 145);
    }

    .send-btn.share {
      background: var(--accent);
      color: white;
    }

    .send-btn.share:hover {
      background: oklch(0.5 0.18 250);
    }

    .send-btn.copy {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .send-btn.copy:hover {
      background: var(--border);
    }

    .send-btn svg {
      width: 18px;
      height: 18px;
    }

    /* Upgrade Tab */
    .upgrade-view {
      padding: 24px 16px;
    }

    .upgrade-header {
      text-align: center;
      margin-bottom: 24px;
    }

    .upgrade-icon {
      width: 64px;
      height: 64px;
      background: var(--warning-light);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
    }

    .upgrade-icon svg {
      width: 32px;
      height: 32px;
      color: var(--warning);
    }

    .upgrade-title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .upgrade-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .upgrade-features {
      margin-bottom: 24px;
    }

    .upgrade-feature {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      margin-bottom: 12px;
    }

    .upgrade-feature.locked {
      opacity: 0.6;
    }

    .upgrade-feature-icon {
      width: 40px;
      height: 40px;
      background: var(--bg-secondary);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .upgrade-feature-icon svg {
      width: 20px;
      height: 20px;
      color: var(--text-secondary);
    }

    .upgrade-feature-icon.unlocked {
      background: var(--success-light);
    }

    .upgrade-feature-icon.unlocked svg {
      color: var(--success);
    }

    .upgrade-feature-text h4 {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .upgrade-feature-text p {
      font-size: 13px;
      color: var(--text-muted);
    }

    .upgrade-feature .lock-badge {
      margin-left: auto;
      font-size: 11px;
      font-weight: 500;
      color: var(--text-muted);
      background: var(--bg-secondary);
      padding: 4px 8px;
      border-radius: 4px;
    }

    /* Bottom Nav */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--bg-card);
      border-top: 1px solid var(--border);
      display: flex;
      padding: 8px 0 max(8px, env(safe-area-inset-bottom));
      z-index: 100;
    }

    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px;
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-family: var(--font);
      font-size: 11px;
      font-weight: 500;
      transition: color 0.15s;
      position: relative;
    }

    .nav-item:hover {
      color: var(--text-secondary);
    }

    .nav-item.active {
      color: var(--accent);
    }

    .nav-item svg {
      width: 22px;
      height: 22px;
    }

    .nav-badge {
      position: absolute;
      top: 4px;
      right: calc(50% - 18px);
      background: var(--danger);
      color: white;
      font-size: 10px;
      font-weight: 600;
      min-width: 16px;
      height: 16px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 4px;
    }

    /* Toast */
    .toast-container {
      position: fixed;
      bottom: 100px;
      left: 16px;
      right: 16px;
      z-index: 1001;
      display: flex;
      flex-direction: column;
      gap: 8px;
      pointer-events: none;
    }

    .toast {
      background: var(--text-primary);
      color: white;
      padding: 12px 16px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 500;
      text-align: center;
      animation: slideUp 0.3s ease-out, fadeOut 0.3s ease-out 2.7s;
      pointer-events: auto;
    }

    .toast.success {
      background: var(--success);
    }

    .toast.error {
      background: var(--danger);
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    /* Aria live region - hidden but announced */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Print Styles */
    @media print {
      .bottom-nav, .header-actions, .demo-banner, .modal-overlay {
        display: none !important;
      }

      body {
        padding-bottom: 0;
      }

      .lead-card, .quote-card {
        break-inside: avoid;
        box-shadow: none;
        border: 1px solid #ccc;
      }
    }

    /* Tablet+ adjustments */
    @media (min-width: 768px) {
      .revenue-strip {
        max-width: 600px;
        margin: 0 auto;
      }

      .tab-view {
        max-width: 800px;
        margin: 0 auto;
      }

      .lead-actions {
        justify-content: flex-start;
      }

      .lead-btn {
        flex: 0 1 auto;
        min-width: 140px;
      }
    }
  </style>
</head>
<body>
  <!-- Aria live region for dynamic announcements -->
  <div id="aria-live" class="sr-only" aria-live="polite" aria-atomic="true"></div>

  <!-- Skip link for keyboard navigation -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Auth Screen -->
  <div class="auth-screen" id="authScreen">
    <div class="auth-card">
      <div class="auth-logo">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
        </svg>
      </div>
      <h1 class="auth-title">Lead Spark</h1>
      <p class="auth-subtitle">Built for K & A Electric LLC</p>
      <form id="authForm">
        <div class="auth-input-group">
          <label for="accessKey">Access Key</label>
          <input type="password" id="accessKey" class="auth-input" placeholder="Enter your key" autocomplete="off" required aria-describedby="authError">
        </div>
        <button type="submit" class="auth-btn">Open Dashboard</button>
        <p class="auth-error" id="authError" role="alert">Wrong key. Check your email for the access key.</p>
      </form>
    </div>
  </div>

  <!-- Main App -->
  <div class="app" id="mainApp">
    <!-- Demo Banner -->
    <div class="demo-banner" id="demoBanner" role="status">
      <span class="demo-banner-text">This is demo data. Your real leads will replace this when you add them.</span>
      <button class="demo-banner-close" id="closeDemoBanner" aria-label="Dismiss demo notice">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <!-- Header -->
    <header class="header">
      <div class="header-top">
        <div class="header-brand">
          <div class="header-logo">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
            </svg>
          </div>
          <h1 class="header-title">Lead Spark</h1>
        </div>
        <div class="header-actions">
          <button class="icon-btn" id="addLeadBtn" aria-label="Add new lead">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"/>
              <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
          </button>
          <button class="icon-btn" id="refreshBtn" aria-label="Refresh data">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="23,4 23,10 17,10"/>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="revenue-strip" role="region" aria-label="Revenue summary">
        <div class="revenue-stat">
          <div class="revenue-stat-value" id="statLeads">0</div>
          <div class="revenue-stat-label">New Leads</div>
        </div>
        <div class="revenue-stat">
          <div class="revenue-stat-value warning" id="statFollowups">0</div>
          <div class="revenue-stat-label">Need Follow-up</div>
        </div>
        <div class="revenue-stat">
          <div class="revenue-stat-value success" id="statRevenue">$0</div>
          <div class="revenue-stat-label">Pending</div>
        </div>
      </div>
    </header>

    <!-- Tab Views -->
    <main id="main-content" tabindex="-1">
    <!-- Legal Disclaimer for Demo Data -->
    <div id="legalDisclaimer" class="legal-disclaimer" style="display:none;background:#fff8e1;border:1px solid #ffc107;border-radius:8px;padding:12px 16px;margin:8px 16px;font-size:13px;line-height:1.5;color:#5d4037;">
      <p style="margin:0 0 8px 0;font-weight:600;color:#e65100;">Demo Data Notice</p>
      <p style="margin:0 0 8px 0;">This tool contains sample data for <strong>demonstration purposes only</strong>. Business names, addresses, and details shown are used solely to illustrate how this tool works. No affiliation with or endorsement by any referenced business is implied.</p>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button onclick="clearAllDemoData()" style="background:#d32f2f;color:white;border:none;border-radius:6px;padding:8px 16px;font-size:13px;font-weight:600;cursor:pointer;">Permanently Delete All Demo Data</button>
        <button onclick="document.getElementById('legalDisclaimer').style.display='none'" style="background:#e0e0e0;color:#333;border:none;border-radius:6px;padding:8px 12px;font-size:13px;cursor:pointer;">Dismiss</button>
      </div>
    </div>
      <!-- Leads Tab -->
      <section class="tab-view active" id="leadsTab" role="tabpanel" aria-labelledby="navLeads">
        <div class="section-header">
          <h2 class="section-title">Hot Leads</h2>
          <span class="section-badge" id="urgentBadge">0 urgent</span>
        </div>
        <div id="leadsList" role="list"></div>
      </section>

      <!-- Quotes Tab -->
      <section class="tab-view" id="quotesTab" role="tabpanel" aria-labelledby="navQuotes">
        <div class="section-header">
          <h2 class="section-title">Open Quotes</h2>
          <span class="section-badge warning" id="quotesBadge">0 pending</span>
        </div>
        <div id="quotesList" role="list"></div>
      </section>

      <!-- Won Tab -->
      <section class="tab-view" id="wonTab" role="tabpanel" aria-labelledby="navWon">
        <div class="section-header">
          <h2 class="section-title">Won Jobs</h2>
          <span class="section-badge success" id="wonBadge">$0 this month</span>
        </div>
        <div id="wonList" role="list"></div>
      </section>

      <!-- Upgrade Tab -->
      <section class="tab-view upgrade-view" id="upgradeTab" role="tabpanel" aria-labelledby="navUpgrade">
        <div class="upgrade-header">
          <div class="upgrade-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
          </div>
          <h2 class="upgrade-title">Full Version</h2>
          <p class="upgrade-subtitle">More leads, more features, more revenue</p>
        </div>

        <div class="upgrade-features">
          <div class="upgrade-feature">
            <div class="upgrade-feature-icon unlocked">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </div>
            <div class="upgrade-feature-text">
              <h4>Lead Tracking (20 active)</h4>
              <p>Capture and organize incoming leads</p>
            </div>
          </div>

          <div class="upgrade-feature">
            <div class="upgrade-feature-icon unlocked">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </div>
            <div class="upgrade-feature-text">
              <h4>Quick Response Templates</h4>
              <p>One-tap professional replies</p>
            </div>
          </div>

          <div class="upgrade-feature">
            <div class="upgrade-feature-icon unlocked">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </div>
            <div class="upgrade-feature-text">
              <h4>Voice-to-Text Notes</h4>
              <p>Speak your notes, we type them</p>
            </div>
          </div>

          <div class="upgrade-feature locked">
            <div class="upgrade-feature-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
              </svg>
            </div>
            <div class="upgrade-feature-text">
              <h4>Unlimited Leads</h4>
              <p>No cap on active leads</p>
            </div>
            <span class="lock-badge">Full Version</span>
          </div>

          <div class="upgrade-feature locked">
            <div class="upgrade-feature-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
              </svg>
            </div>
            <div class="upgrade-feature-text">
              <h4>Auto SMS Follow-ups</h4>
              <p>Automatic follow-up texts at 24h, 48h, 7 days</p>
            </div>
            <span class="lock-badge">Full Version</span>
          </div>

          <div class="upgrade-feature locked">
            <div class="upgrade-feature-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
              </svg>
            </div>
            <div class="upgrade-feature-text">
              <h4>Calendar Sync</h4>
              <p>Push appointments to Google Calendar</p>
            </div>
            <span class="lock-badge">Full Version</span>
          </div>

          <div class="upgrade-feature locked">
            <div class="upgrade-feature-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
              </svg>
            </div>
            <div class="upgrade-feature-text">
              <h4>Review Request Automation</h4>
              <p>Ask for Google reviews after completed jobs</p>
            </div>
            <span class="lock-badge">Full Version</span>
          </div>
        </div>
      </section>
    </main>

    <!-- Bottom Nav -->
    <nav class="bottom-nav" role="navigation" aria-label="Main navigation">
      <button class="nav-item active" id="navLeads" aria-current="page" aria-controls="leadsTab">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
        </svg>
        <span>Leads</span>
        <span class="nav-badge" id="leadsNavBadge">0</span>
      </button>
      <button class="nav-item" id="navQuotes" aria-controls="quotesTab">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
        </svg>
        <span>Quotes</span>
      </button>
      <button class="nav-item" id="navWon" aria-controls="wonTab">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="8" r="7"/>
          <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/>
        </svg>
        <span>Won</span>
      </button>
      <button class="nav-item" id="navUpgrade" aria-controls="upgradeTab">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
        </svg>
        <span>Full Version</span>
      </button>
    </nav>
  </div>

  <!-- Response Modal -->
  <div class="modal-overlay" id="responseModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="modalTitle">Respond to Lead</h2>
        <button class="modal-close" id="closeModal" aria-label="Close dialog">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="modal-lead-info" id="modalLeadInfo">
          <div class="modal-lead-name" id="modalLeadName"></div>
          <div class="modal-lead-detail" id="modalLeadPhone"></div>
          <div class="modal-lead-detail" id="modalLeadService"></div>
        </div>

        <div class="template-section">
          <div class="template-label" id="template-label">Quick Response</div>
          <div class="template-grid" id="templateGrid" role="radiogroup" aria-labelledby="template-label">
            <button class="template-btn" data-template="busy" role="radio" aria-checked="false" aria-label="On job response template">
              "Hey! Got your message. I'm on a job right now but I'll call you back by 6pm today."
            </button>
            <button class="template-btn" data-template="schedule" role="radio" aria-checked="false" aria-label="Schedule visit response template">
              "Thanks for reaching out! I can come take a look tomorrow morning. Does 9am work for you?"
            </button>
            <button class="template-btn" data-template="info" role="radio" aria-checked="false" aria-label="Request photos response template">
              "Got it. Can you send me a few photos of the area? That'll help me give you an accurate estimate."
            </button>
          </div>
        </div>

        <div class="custom-message-container">
          <div class="custom-message-header">
            <span class="template-label">Or type your own</span>
            <button class="voice-btn" id="voiceBtn" aria-label="Start voice input">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                <line x1="12" y1="19" x2="12" y2="23"/>
                <line x1="8" y1="23" x2="16" y2="23"/>
              </svg>
              <span id="voiceBtnText">Voice</span>
            </button>
          </div>
          <textarea class="custom-textarea" id="customMessage" placeholder="Type your message here..." aria-label="Custom message"></textarea>
        </div>

        <div class="send-actions">
          <button class="send-btn call" id="callBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72"/>
            </svg>
            Call
          </button>
          <button class="send-btn share" id="shareBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="18" cy="5" r="3"/>
              <circle cx="6" cy="12" r="3"/>
              <circle cx="18" cy="19" r="3"/>
              <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
              <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
            </svg>
            Share
          </button>
          <button class="send-btn copy" id="copyBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
            Copy
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Lead Modal -->
  <div class="modal-overlay" id="addLeadModal" role="dialog" aria-modal="true" aria-labelledby="addLeadTitle">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="addLeadTitle">Add New Lead</h2>
        <button class="modal-close" id="closeAddLeadModal" aria-label="Close dialog">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="addLeadForm">
          <div class="auth-input-group">
            <label for="newLeadName">Customer Name</label>
            <input type="text" id="newLeadName" class="auth-input" placeholder="e.g., John Smith" required>
          </div>
          <div class="auth-input-group">
            <label for="newLeadPhone">Phone Number</label>
            <input type="tel" id="newLeadPhone" class="auth-input" placeholder="e.g., (423) 555-1234" required>
          </div>
          <div class="auth-input-group">
            <label for="newLeadService">Service Needed</label>
            <input type="text" id="newLeadService" class="auth-input" placeholder="e.g., Panel upgrade">
          </div>
          <div class="auth-input-group">
            <label for="newLeadLocation">Location</label>
            <input type="text" id="newLeadLocation" class="auth-input" placeholder="e.g., Chickamauga, GA">
          </div>
          <div class="auth-input-group">
            <label for="newLeadValue">Estimated Value</label>
            <input type="number" id="newLeadValue" class="auth-input" placeholder="e.g., 500" min="0">
          </div>
          <div class="auth-input-group">
            <label for="newLeadNotes">Notes</label>
            <textarea id="newLeadNotes" class="auth-input" placeholder="Any extra details..." rows="3" style="resize:vertical;"></textarea>
          </div>
          <button type="submit" class="auth-btn">Add Lead</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer" aria-live="polite"></div>

  <script>
    // Anti-scrape protection
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) || (e.ctrlKey && e.key === 'U')) {
        e.preventDefault();
      }
    });

    // Runtime key computation (as required - no precomputed hash)
    const _E = [107,97,101,108,50,48,50,54]; // "kael2026"
    const _K = _E.map(c => String.fromCharCode(c)).join('');
    function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
    const _V = _h(_K);

    // IndexedDB setup
    const DB_NAME = 'leadsparkdb';
    const DB_VERSION = 1;
    let db = null;

    function openDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        request.onerror = () => reject(request.error);
        request.onsuccess = () => {
          db = request.result;
          resolve(db);
        };
        request.onupgradeneeded = (e) => {
          const database = e.target.result;
          if (!database.objectStoreNames.contains('leads')) {
            database.createObjectStore('leads', { keyPath: 'id', autoIncrement: true });
          }
          if (!database.objectStoreNames.contains('quotes')) {
            database.createObjectStore('quotes', { keyPath: 'id', autoIncrement: true });
          }
          if (!database.objectStoreNames.contains('settings')) {
            database.createObjectStore('settings', { keyPath: 'key' });
          }
        };
      });
    }

    function dbAdd(store, data) {
      return new Promise((resolve, reject) => {
        const tx = db.transaction(store, 'readwrite');
        const os = tx.objectStore(store);
        const req = os.add(data);
        req.onsuccess = () => resolve(req.result);
        req.onerror = () => reject(req.error);
      });
    }

    function dbPut(store, data) {
      return new Promise((resolve, reject) => {
        const tx = db.transaction(store, 'readwrite');
        const os = tx.objectStore(store);
        const req = os.put(data);
        req.onsuccess = () => resolve(req.result);
        req.onerror = () => reject(req.error);
      });
    }

    function dbGetAll(store) {
      return new Promise((resolve, reject) => {
        const tx = db.transaction(store, 'readonly');
        const os = tx.objectStore(store);
        const req = os.getAll();
        req.onsuccess = () => resolve(req.result);
        req.onerror = () => reject(req.error);
      });
    }

    function dbGet(store, key) {
      return new Promise((resolve, reject) => {
        const tx = db.transaction(store, 'readonly');
        const os = tx.objectStore(store);
        const req = os.get(key);
        req.onsuccess = () => resolve(req.result);
        req.onerror = () => reject(req.error);
      });
    }

    function dbDelete(store, key) {
      return new Promise((resolve, reject) => {
        const tx = db.transaction(store, 'readwrite');
        const os = tx.objectStore(store);
        const req = os.delete(key);
        req.onsuccess = () => resolve();
        req.onerror = () => reject(req.error);
      });
    }

    // Demo data - realistic LaFayette/Chickamauga area
    const DEMO_LEADS = [
      {
        name: "Robert Johnson",
        phone: "(423) 555-0142",
        service: "Panel upgrade - 200 amp",
        location: "Chickamauga, GA",
        value: 2800,
        status: "new",
        createdAt: Date.now() - (2 * 60 * 60 * 1000), // 2 hours ago
        notes: "Older home, 1960s build. Current 100 amp panel is full."
      },
      {
        name: "Sarah Mitchell",
        phone: "(706) 555-0287",
        service: "Whole house generator install",
        location: "LaFayette, GA",
        value: 6500,
        status: "new",
        createdAt: Date.now() - (4 * 60 * 60 * 1000), // 4 hours ago
        notes: "Wants Generac 22kW. Has propane tank already."
      },
      {
        name: "Main Street Cafe",
        phone: "(423) 555-0398",
        service: "Commercial lighting retrofit",
        location: "LaFayette, GA",
        value: 3200,
        status: "followup",
        createdAt: Date.now() - (26 * 60 * 60 * 1000), // 26 hours ago
        notes: "LED upgrade throughout restaurant. Open after 3pm for work.",
        lastContact: Date.now() - (24 * 60 * 60 * 1000)
      },
      {
        name: "David Thompson",
        phone: "(706) 555-0156",
        service: "Outdoor lighting - new patio",
        location: "Ringgold, GA",
        value: 1800,
        status: "followup",
        createdAt: Date.now() - (50 * 60 * 60 * 1000), // 50 hours ago
        notes: "Covered patio, 6 recessed lights plus 2 sconces",
        lastContact: Date.now() - (48 * 60 * 60 * 1000)
      },
      {
        name: "Lisa Carter",
        phone: "(423) 555-0471",
        service: "EV charger installation",
        location: "Fort Oglethorpe, GA",
        value: 1200,
        status: "new",
        createdAt: Date.now() - (30 * 60 * 1000), // 30 mins ago
        notes: "Tesla Model Y, garage install, will need 240V circuit"
      }
    ];

    const DEMO_QUOTES = [
      {
        customer: "Mike Patterson",
        phone: "(706) 555-0823",
        service: "Service panel replacement + whole-house surge",
        location: "Chickamauga, GA",
        amount: 3400,
        status: "pending",
        sentAt: Date.now() - (3 * 24 * 60 * 60 * 1000), // 3 days ago
        viewedAt: Date.now() - (2 * 24 * 60 * 60 * 1000)
      },
      {
        customer: "Valley View Church",
        phone: "(423) 555-0912",
        service: "Parking lot lighting - 8 LED poles",
        location: "LaFayette, GA",
        amount: 8500,
        status: "viewed",
        sentAt: Date.now() - (5 * 24 * 60 * 60 * 1000),
        viewedAt: Date.now() - (1 * 24 * 60 * 60 * 1000)
      }
    ];

    const DEMO_WON = [
      {
        customer: "James Wilson",
        service: "Ceiling fan install (3 units)",
        amount: 650,
        completedAt: Date.now() - (2 * 24 * 60 * 60 * 1000)
      },
      {
        customer: "Nancy Brooks",
        service: "GFCI outlets - kitchen and bath",
        amount: 420,
        completedAt: Date.now() - (5 * 24 * 60 * 60 * 1000)
      },
      {
        customer: "Cherokee Veterinary Clinic",
        service: "Generator maintenance + transfer switch",
        amount: 1850,
        completedAt: Date.now() - (8 * 24 * 60 * 60 * 1000)
      }
    ];

    // State
    let currentLead = null;
    let selectedTemplate = '';
    let isRecording = false;
    let recognition = null;

    // DOM elements
    const authScreen = document.getElementById('authScreen');
    const mainApp = document.getElementById('mainApp');
    const authForm = document.getElementById('authForm');
    const accessKeyInput = document.getElementById('accessKey');
    const authError = document.getElementById('authError');
    const demoBanner = document.getElementById('demoBanner');
    const closeDemoBannerBtn = document.getElementById('closeDemoBanner');
    const leadsTab = document.getElementById('leadsTab');
    const quotesTab = document.getElementById('quotesTab');
    const wonTab = document.getElementById('wonTab');
    const upgradeTab = document.getElementById('upgradeTab');
    const navLeads = document.getElementById('navLeads');
    const navQuotes = document.getElementById('navQuotes');
    const navWon = document.getElementById('navWon');
    const navUpgrade = document.getElementById('navUpgrade');
    const leadsList = document.getElementById('leadsList');
    const quotesList = document.getElementById('quotesList');
    const wonList = document.getElementById('wonList');
    const responseModal = document.getElementById('responseModal');
    const closeModalBtn = document.getElementById('closeModal');
    const addLeadModal = document.getElementById('addLeadModal');
    const addLeadBtn = document.getElementById('addLeadBtn');
    const closeAddLeadModalBtn = document.getElementById('closeAddLeadModal');
    const addLeadForm = document.getElementById('addLeadForm');
    const templateBtns = document.querySelectorAll('.template-btn');
    const customMessageEl = document.getElementById('customMessage');
    const voiceBtn = document.getElementById('voiceBtn');
    const voiceBtnText = document.getElementById('voiceBtnText');
    const callBtn = document.getElementById('callBtn');
    const shareBtn = document.getElementById('shareBtn');
    const copyBtn = document.getElementById('copyBtn');
    const toastContainer = document.getElementById('toastContainer');
    const ariaLive = document.getElementById('aria-live');

    // Helper functions
    function showToast(message, type = 'default') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      toastContainer.appendChild(toast);
      ariaLive.textContent = message;
      setTimeout(() => toast.remove(), 3000);
    }

    function formatTime(timestamp) {
      const diff = Date.now() - timestamp;
      const mins = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);

      if (mins < 60) return `${mins}m ago`;
      if (hours < 24) return `${hours}h ago`;
      return `${days}d ago`;
    }

    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0 }).format(amount);
    }

    // Auth
    authForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const inputKey = accessKeyInput.value;
      if (_h(inputKey) === _V) {
        authError.classList.remove('visible');
        localStorage.setItem('ls_auth', 'true');
        showApp();
      } else {
        authError.classList.add('visible');
        accessKeyInput.value = '';
        accessKeyInput.focus();
      }
    });

    async function showApp() {
      setTimeout(showLegalDisclaimer, 500);
      authScreen.style.display = 'none';
      mainApp.classList.add('active');
      await initData();
      renderAll();
    }

    // Init data
    async function initData() {
      await openDB();
      const settings = await dbGet('settings', 'initialized');
      if (!settings) {
        // Load demo data
        for (const lead of DEMO_LEADS) {
          await dbAdd('leads', lead);
        }
        for (const quote of DEMO_QUOTES) {
          await dbAdd('quotes', quote);
        }
        for (const won of DEMO_WON) {
          await dbAdd('quotes', { ...won, status: 'won' });
        }
        await dbPut('settings', { key: 'initialized', value: true });
        await dbPut('settings', { key: 'showDemoBanner', value: true });
      }

      const bannerSetting = await dbGet('settings', 'showDemoBanner');
      if (bannerSetting && !bannerSetting.value) {
        demoBanner.style.display = 'none';
      }
    }

    // Render functions
    async function renderAll() {
      await renderLeads();
      await renderQuotes();
      await renderWon();
      await updateStats();
    }

    async function renderLeads() {
      const leads = await dbGetAll('leads');
      const activeLeads = leads.filter(l => l.status !== 'converted');
      
      if (activeLeads.length === 0) {
        leadsList.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
            </svg>
            <div class="empty-state-title">No leads yet</div>
            <div class="empty-state-text">Tap the + button up top to add your first lead</div>
          </div>
        `;
        return;
      }

      // Sort by urgency
      activeLeads.sort((a, b) => {
        if (a.status === 'followup' && b.status !== 'followup') return -1;
        if (a.status !== 'followup' && b.status === 'followup') return 1;
        return b.createdAt - a.createdAt;
      });

      leadsList.innerHTML = activeLeads.map(lead => {
        const hoursSinceCreated = (Date.now() - lead.createdAt) / 3600000;
        const isUrgent = lead.status === 'followup' || hoursSinceCreated > 24;
        const isWarm = hoursSinceCreated > 4 && hoursSinceCreated <= 24;
        const timeClass = isUrgent ? 'urgent' : '';
        const cardClass = isUrgent ? 'urgent' : (isWarm ? 'warm' : 'new');

        return `
          <article class="lead-card ${cardClass}" role="listitem" data-lead-id="${lead.id}">
            <div class="lead-header">
              <div class="lead-name">${lead.name}</div>
              <div class="lead-time ${timeClass}">${formatTime(lead.createdAt)}</div>
            </div>
            <div class="lead-service">${lead.service}</div>
            <div class="lead-location">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
              </svg>
              ${lead.location}
            </div>
            ${lead.value ? `<div class="lead-value">${formatCurrency(lead.value)} potential</div>` : ''}
            <div class="lead-actions">
              <button class="lead-btn primary respond-btn" data-lead-id="${lead.id}" aria-label="Respond to ${lead.name}">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                  <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                </svg>
                Respond
              </button>
              <button class="lead-btn success convert-btn" data-lead-id="${lead.id}" aria-label="Convert ${lead.name} to quote">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                  <polyline points="20 6 9 17 4 12"/>
                </svg>
                Quote Sent
              </button>
            </div>
          </article>
        `;
      }).join('');

      // Attach event listeners
      document.querySelectorAll('.respond-btn').forEach(btn => {
        btn.addEventListener('click', () => openResponseModal(parseInt(btn.dataset.leadId)));
      });
      document.querySelectorAll('.convert-btn').forEach(btn => {
        btn.addEventListener('click', () => convertToQuote(parseInt(btn.dataset.leadId)));
      });
    }

    async function renderQuotes() {
      const quotes = await dbGetAll('quotes');
      const pendingQuotes = quotes.filter(q => q.status === 'pending' || q.status === 'viewed');
      
      if (pendingQuotes.length === 0) {
        quotesList.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
            </svg>
            <div class="empty-state-title">No open quotes</div>
            <div class="empty-state-text">Your quotes show up here once you send them</div>
          </div>
        `;
        return;
      }

      quotesList.innerHTML = pendingQuotes.map(quote => `
        <article class="quote-card" role="listitem">
          <div class="quote-header">
            <div class="quote-customer">${quote.customer}</div>
            <div class="quote-amount">${formatCurrency(quote.amount)}</div>
          </div>
          <div class="quote-service">${quote.service}</div>
          <div class="quote-meta">
            <span class="quote-meta-item">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              Sent ${formatTime(quote.sentAt)}
            </span>
            ${quote.viewedAt ? `
              <span class="quote-meta-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
                Viewed ${formatTime(quote.viewedAt)}
              </span>
            ` : ''}
          </div>
          <div class="quote-status ${quote.status}">${quote.status === 'viewed' ? 'Viewed' : 'Pending'}</div>
          <div class="lead-actions" style="margin-top:12px;">
            <button class="lead-btn primary followup-quote-btn" data-quote-id="${quote.id}" aria-label="Follow up on quote for ${quote.customer}">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
              </svg>
              Follow Up
            </button>
            <button class="lead-btn success mark-won-btn" data-quote-id="${quote.id}" aria-label="Mark ${quote.customer} as won">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
              Won
            </button>
            <button class="lead-btn mark-lost-btn" data-quote-id="${quote.id}" aria-label="Mark ${quote.customer} as lost" style="flex:0;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
        </article>
      `).join('');

      document.querySelectorAll('.followup-quote-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const quote = quotes.find(q => q.id === parseInt(btn.dataset.quoteId));
          if (quote) {
            currentLead = { name: quote.customer, phone: quote.phone, service: quote.service };
            document.getElementById('modalLeadName').textContent = quote.customer;
            document.getElementById('modalLeadPhone').textContent = quote.phone;
            document.getElementById('modalLeadService').textContent = quote.service;
            responseModal.classList.add('active');
          }
        });
      });

      document.querySelectorAll('.mark-won-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const quote = quotes.find(q => q.id === parseInt(btn.dataset.quoteId));
          if (quote) {
            quote.status = 'won';
            quote.completedAt = Date.now();
            await dbPut('quotes', quote);
            showToast(`${quote.customer} marked as won!`, 'success');
            renderAll();
          }
        });
      });

      document.querySelectorAll('.mark-lost-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const quote = quotes.find(q => q.id === parseInt(btn.dataset.quoteId));
          if (quote) {
            quote.status = 'lost';
            await dbPut('quotes', quote);
            showToast(`${quote.customer} marked as lost`);
            renderAll();
          }
        });
      });
    }

    async function renderWon() {
      const quotes = await dbGetAll('quotes');
      const wonQuotes = quotes.filter(q => q.status === 'won');
      
      // Filter to this month
      const now = new Date();
      const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1).getTime();
      const thisMonthWon = wonQuotes.filter(q => q.completedAt >= startOfMonth);

      if (wonQuotes.length === 0) {
        wonList.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <circle cx="12" cy="8" r="7"/>
              <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/>
            </svg>
            <div class="empty-state-title">No wins yet</div>
            <div class="empty-state-text">Closed jobs show up here. Go get some!</div>
          </div>
        `;
        return;
      }

      wonList.innerHTML = wonQuotes.sort((a, b) => b.completedAt - a.completedAt).map(quote => `
        <article class="quote-card" role="listitem">
          <div class="quote-header">
            <div class="quote-customer">${quote.customer}</div>
            <div class="quote-amount">${formatCurrency(quote.amount)}</div>
          </div>
          <div class="quote-service">${quote.service}</div>
          <div class="quote-meta">
            <span class="quote-meta-item">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
              Completed ${formatTime(quote.completedAt)}
            </span>
          </div>
          <div class="quote-status won">Won</div>
        </article>
      `).join('');

      // Update won badge
      const monthTotal = thisMonthWon.reduce((sum, q) => sum + q.amount, 0);
      document.getElementById('wonBadge').textContent = `${formatCurrency(monthTotal)} this month`;
    }

    async function updateStats() {
      const leads = await dbGetAll('leads');
      const quotes = await dbGetAll('quotes');
      
      const activeLeads = leads.filter(l => l.status !== 'converted');
      const newLeads = activeLeads.filter(l => l.status === 'new');
      const needsFollowup = activeLeads.filter(l => {
        const hoursSince = (Date.now() - l.createdAt) / 3600000;
        return l.status === 'followup' || hoursSince > 24;
      });
      const pendingQuotes = quotes.filter(q => q.status === 'pending' || q.status === 'viewed');
      const pendingRevenue = pendingQuotes.reduce((sum, q) => sum + q.amount, 0) + activeLeads.reduce((sum, l) => sum + (l.value || 0), 0);

      document.getElementById('statLeads').textContent = newLeads.length;
      document.getElementById('statFollowups').textContent = needsFollowup.length;
      document.getElementById('statRevenue').textContent = formatCurrency(pendingRevenue);
      
      document.getElementById('urgentBadge').textContent = `${needsFollowup.length} urgent`;
      document.getElementById('quotesBadge').textContent = `${pendingQuotes.length} pending`;
      
      const leadsNavBadge = document.getElementById('leadsNavBadge');
      if (activeLeads.length > 0) {
        leadsNavBadge.textContent = activeLeads.length;
        leadsNavBadge.style.display = 'flex';
      } else {
        leadsNavBadge.style.display = 'none';
      }
    }

    // Response modal
    async function openResponseModal(leadId) {
      const leads = await dbGetAll('leads');
      currentLead = leads.find(l => l.id === leadId);
      if (!currentLead) return;

      document.getElementById('modalLeadName').textContent = currentLead.name;
      document.getElementById('modalLeadPhone').textContent = currentLead.phone;
      document.getElementById('modalLeadService').textContent = currentLead.service;
      customMessageEl.value = '';
      selectedTemplate = '';
      templateBtns.forEach(b => {
        b.classList.remove('selected');
        b.setAttribute('aria-checked', 'false');
      });
      responseModal.classList.add('active');
    }

    closeModalBtn.addEventListener('click', () => {
      responseModal.classList.remove('active');
      currentLead = null;
      // Return focus to the button that opened the modal
      document.querySelector('.respond-btn')?.focus();
    });

    responseModal.addEventListener('click', (e) => {
      if (e.target === responseModal) {
        responseModal.classList.remove('active');
        currentLead = null;
      }
    });

    // Focus trap for response modal
    responseModal.addEventListener('keydown', (e) => {
      if (e.key === 'Tab') {
        const focusableElements = responseModal.querySelectorAll('button, textarea, [href], input, select, [tabindex]:not([tabindex="-1"])');
        const firstFocusable = focusableElements[0];
        const lastFocusable = focusableElements[focusableElements.length - 1];

        if (e.shiftKey && document.activeElement === firstFocusable) {
          e.preventDefault();
          lastFocusable.focus();
        } else if (!e.shiftKey && document.activeElement === lastFocusable) {
          e.preventDefault();
          firstFocusable.focus();
        }
      }
    });

    // Template selection
    templateBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        templateBtns.forEach(b => {
          b.classList.remove('selected');
          b.setAttribute('aria-checked', 'false');
        });
        btn.classList.add('selected');
        btn.setAttribute('aria-checked', 'true');
        selectedTemplate = btn.textContent.trim();
        customMessageEl.value = selectedTemplate;
      });
    });

    // Voice input (Web Speech API)
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US';

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        customMessageEl.value += (customMessageEl.value ? ' ' : '') + transcript;
        stopRecording();
      };

      recognition.onerror = () => {
        stopRecording();
        showToast('Voice input error. Try again.', 'error');
      };

      recognition.onend = () => {
        stopRecording();
      };

      voiceBtn.addEventListener('click', () => {
        if (isRecording) {
          recognition.stop();
          stopRecording();
        } else {
          recognition.start();
          startRecording();
        }
      });
    } else {
      voiceBtn.style.display = 'none';
    }

    function startRecording() {
      isRecording = true;
      voiceBtn.classList.add('recording');
      voiceBtnText.textContent = 'Stop';
      ariaLive.textContent = 'Recording started';
    }

    function stopRecording() {
      isRecording = false;
      voiceBtn.classList.remove('recording');
      voiceBtnText.textContent = 'Voice';
      ariaLive.textContent = 'Recording stopped';
    }

    // Actions
    callBtn.addEventListener('click', () => {
      if (currentLead && currentLead.phone) {
        const tel = currentLead.phone.replace(/\D/g, '');
        window.location.href = `tel:${tel}`;
        showToast('Opening phone app...', 'success');
      }
    });

    shareBtn.addEventListener('click', async () => {
      const message = customMessageEl.value || 'Hi! I got your message about electrical work. When is a good time to call?';
      if (navigator.share) {
        try {
          await navigator.share({
            title: `Reply to ${currentLead?.name || 'Lead'}`,
            text: message
          });
          showToast('Message shared!', 'success');
          // Mark as followed up
          if (currentLead && currentLead.id) {
            currentLead.status = 'followup';
            currentLead.lastContact = Date.now();
            await dbPut('leads', currentLead);
            renderAll();
          }
          responseModal.classList.remove('active');
        } catch (err) {
          if (err.name !== 'AbortError') {
            showToast('Share failed', 'error');
          }
        }
      } else {
        // Fallback to SMS link
        const phone = currentLead?.phone?.replace(/\D/g, '') || '';
        const smsUrl = `sms:${phone}?body=${encodeURIComponent(message)}`;
        window.open(smsUrl, '_blank');
        showToast('Opening messages...', 'success');
      }
    });

    copyBtn.addEventListener('click', async () => {
      const message = customMessageEl.value || 'Hi! I got your message about electrical work. When is a good time to call?';
      try {
        await navigator.clipboard.writeText(message);
        showToast('Copied to clipboard!', 'success');
      } catch (err) {
        // Fallback
        const textarea = document.createElement('textarea');
        textarea.value = message;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showToast('Copied!', 'success');
      }
    });

    // Convert lead to quote
    async function convertToQuote(leadId) {
      const leads = await dbGetAll('leads');
      const lead = leads.find(l => l.id === leadId);
      if (!lead) return;

      // Create quote from lead
      await dbAdd('quotes', {
        customer: lead.name,
        phone: lead.phone,
        service: lead.service,
        location: lead.location,
        amount: lead.value || 500,
        status: 'pending',
        sentAt: Date.now()
      });

      // Mark lead as converted
      lead.status = 'converted';
      await dbPut('leads', lead);

      showToast(`Quote created for ${lead.name}`, 'success');
      renderAll();
    }

    // Add lead modal
    addLeadBtn.addEventListener('click', () => {
      addLeadModal.classList.add('active');
      document.getElementById('newLeadName').focus();
    });

    closeAddLeadModalBtn.addEventListener('click', () => {
      addLeadModal.classList.remove('active');
      addLeadBtn.focus();
    });

    addLeadModal.addEventListener('click', (e) => {
      if (e.target === addLeadModal) {
        addLeadModal.classList.remove('active');
      }
    });

    // Focus trap for add lead modal
    addLeadModal.addEventListener('keydown', (e) => {
      if (e.key === 'Tab') {
        const focusableElements = addLeadModal.querySelectorAll('button, input, textarea, select, [href], [tabindex]:not([tabindex="-1"])');
        const firstFocusable = focusableElements[0];
        const lastFocusable = focusableElements[focusableElements.length - 1];

        if (e.shiftKey && document.activeElement === firstFocusable) {
          e.preventDefault();
          lastFocusable.focus();
        } else if (!e.shiftKey && document.activeElement === lastFocusable) {
          e.preventDefault();
          firstFocusable.focus();
        }
      }
    });

    addLeadForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const newLead = {
        name: document.getElementById('newLeadName').value,
        phone: document.getElementById('newLeadPhone').value,
        service: document.getElementById('newLeadService').value || 'General inquiry',
        location: document.getElementById('newLeadLocation').value || 'Not specified',
        value: parseInt(document.getElementById('newLeadValue').value) || 0,
        notes: document.getElementById('newLeadNotes').value || '',
        status: 'new',
        createdAt: Date.now()
      };

      await dbAdd('leads', newLead);
      addLeadModal.classList.remove('active');
      addLeadForm.reset();
      showToast(`${newLead.name} added!`, 'success');
      renderAll();
      switchTab('leads');
    });

    // Demo banner
    closeDemoBannerBtn.addEventListener('click', async () => {
      demoBanner.style.display = 'none';
      await dbPut('settings', { key: 'showDemoBanner', value: false });
    });

    // Refresh button
    document.getElementById('refreshBtn').addEventListener('click', () => {
      renderAll();
      showToast('Refreshed!');
    });

    // Navigation
    function switchTab(tabName) {
      [leadsTab, quotesTab, wonTab, upgradeTab].forEach(t => t.classList.remove('active'));
      [navLeads, navQuotes, navWon, navUpgrade].forEach(n => {
        n.classList.remove('active');
        n.removeAttribute('aria-current');
      });

      switch (tabName) {
        case 'leads':
          leadsTab.classList.add('active');
          navLeads.classList.add('active');
          navLeads.setAttribute('aria-current', 'page');
          break;
        case 'quotes':
          quotesTab.classList.add('active');
          navQuotes.classList.add('active');
          navQuotes.setAttribute('aria-current', 'page');
          break;
        case 'won':
          wonTab.classList.add('active');
          navWon.classList.add('active');
          navWon.setAttribute('aria-current', 'page');
          break;
        case 'upgrade':
          upgradeTab.classList.add('active');
          navUpgrade.classList.add('active');
          navUpgrade.setAttribute('aria-current', 'page');
          break;
      }
    }

    navLeads.addEventListener('click', () => switchTab('leads'));
    navQuotes.addEventListener('click', () => switchTab('quotes'));
    navWon.addEventListener('click', () => switchTab('won'));
    navUpgrade.addEventListener('click', () => switchTab('upgrade'));

    // Keyboard navigation for modals
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (responseModal.classList.contains('active')) {
          responseModal.classList.remove('active');
          currentLead = null;
          document.querySelector('.respond-btn')?.focus();
        }
        if (addLeadModal.classList.contains('active')) {
          addLeadModal.classList.remove('active');
          addLeadBtn.focus();
        }
      }
    });

    // Init on load
    // Auto-read key from URL parameter
    const _urlKey = new URLSearchParams(window.location.search).get('key');
    if (_urlKey && _h(_urlKey) === _V) {
      localStorage.setItem('ls_auth', 'true');
      showApp();
    } else if (localStorage.getItem('ls_auth') === 'true') {
      showApp();
    }
  
    // Legal disclaimer for demo data
    function clearAllDemoData() {
      if (confirm('This will permanently delete all demo/sample data. Continue?')) {
        // Clear IndexedDB
        const dbs = indexedDB.databases ? indexedDB.databases() : Promise.resolve([]);
        dbs.then(databases => {
          databases.forEach(db => indexedDB.deleteDatabase(db.name));
        }).catch(() => {});
        // Clear localStorage demo flags
        localStorage.removeItem('isFirstVisit');
        localStorage.removeItem('demoLoaded');
        localStorage.removeItem('hasLoadedDemo');
        // Reload
        alert('All demo data has been permanently deleted.');
        location.reload();
      }
    }
    // Show disclaimer when demo data is present
    function showLegalDisclaimer() {
      const el = document.getElementById('legalDisclaimer');
      if (el) el.style.display = 'block';
    }
    </script>
</body>
</html>
