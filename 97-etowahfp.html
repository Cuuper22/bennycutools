<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>HearthQuote - Etowah Fireplace & Patio</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bitter:wght@400;600;700&family=Work+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
--primary:#D4872C;--primary-light:#E8A84E;--primary-dark:#B06B1A;
--secondary:#2C2C2C;--surface:#F5F0EB;--white:#FFFFFF;
--success:#4A7C59;--error:#C14B4B;--warning:#D4872C;
--text:#2C2C2C;--text-muted:#7A7068;--border:#DDD5CC;
--shadow-1:0 1px 3px rgba(44,44,44,.08);
--shadow-2:0 4px 12px rgba(44,44,44,.1),0 1px 3px rgba(44,44,44,.06);
--shadow-3:0 8px 24px rgba(44,44,44,.12),0 2px 8px rgba(44,44,44,.08),0 1px 2px rgba(44,44,44,.06);
--radius:12px;--radius-sm:8px;--radius-lg:16px;
--ease-out:cubic-bezier(0.16,1,0.3,1);
--ease-in-out:cubic-bezier(0.65,0,0.35,1);
}
html{font-size:16px;-webkit-tap-highlight-color:transparent}
body{font-family:'Work Sans',sans-serif;background:var(--surface);color:var(--text);min-height:100dvh;padding-bottom:120px;overflow-x:hidden;-webkit-font-smoothing:antialiased}
h1,h2,h3{font-family:'Bitter',serif;font-weight:600;line-height:1.2}
a{color:var(--primary);text-decoration:none}
button{font-family:'Work Sans',sans-serif;cursor:pointer;border:none;background:none}
input,select,textarea{font-family:'Work Sans',sans-serif;font-size:16px}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}

/* Skip link */
.skip-link{position:absolute;top:-100%;left:16px;background:var(--primary);color:#fff;padding:8px 16px;border-radius:var(--radius-sm);z-index:10000;font-size:14px;font-weight:500;transition:top 0.2s var(--ease-out)}
.skip-link:focus{top:8px}

/* App shell */
#app{display:none;position:relative}
#gate{display:flex;align-items:center;justify-content:center;height:100dvh;background:var(--secondary);color:#fff;text-align:center;padding:24px}
#gate h1{font-size:1.75rem;margin-bottom:16px}
#gate p{color:#999;margin-bottom:24px;font-size:0.95rem}

/* Header */
.app-header{background:var(--secondary);color:#fff;padding:16px 20px;position:sticky;top:0;z-index:100;box-shadow:var(--shadow-1)}
.app-header h1{font-size:1.1rem;font-weight:600;letter-spacing:-.02em}
.app-header p{font-size:.75rem;color:rgba(255,255,255,.6);margin-top:2px}

/* Demo banner */
.demo-banner{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;padding:12px 16px;font-size:.8rem;display:flex;align-items:center;justify-content:space-between;gap:8px;position:relative;overflow:hidden}
.demo-banner::before{content:'';position:absolute;inset:0;background:linear-gradient(45deg,transparent 30%,rgba(255,255,255,0.1) 50%,transparent 70%);animation:shimmer 3s infinite}
@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.demo-banner button{background:rgba(255,255,255,.2);color:#fff;padding:6px 14px;border-radius:var(--radius-sm);font-size:.75rem;font-weight:500;backdrop-filter:blur(4px);transition:all 0.15s var(--ease-out);position:relative;z-index:1}
.demo-banner button:hover{background:rgba(255,255,255,.3);transform:translateY(-1px)}
.demo-banner button:active{transform:scale(0.97)}

/* Content */
.content{padding:16px;max-width:600px;margin:0 auto}

/* Cards */
.card{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow-2);padding:20px;margin-bottom:16px;animation:fadeUp 0.4s var(--ease-out) both;position:relative;overflow:hidden;transition:transform 0.2s var(--ease-out),box-shadow 0.2s var(--ease-out)}
.card:hover{box-shadow:var(--shadow-3);transform:translateY(-2px)}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

/* Quote cards */
.quote-card{cursor:pointer;position:relative}
.quote-card::after{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--primary);transform:scaleY(0);transition:transform 0.2s var(--ease-out)}
.quote-card:hover::after{transform:scaleY(1)}
.quote-card .status-badge{display:inline-block;padding:4px 12px;border-radius:20px;font-size:.7rem;font-weight:600;text-transform:uppercase;letter-spacing:.04em}
.status-pending{background:#FEF3C7;color:#92400E}
.status-sent{background:#DBEAFE;color:#1E40AF}
.status-accepted{background:#D1FAE5;color:#065F46}
.status-declined{background:#FEE2E2;color:#991B1B}
.quote-card h3{font-size:1.05rem;margin:10px 0 6px}
.quote-card .meta{font-size:.8rem;color:var(--text-muted);display:flex;gap:12px;flex-wrap:wrap;align-items:center}
.quote-card .meta span{display:flex;align-items:center;gap:4px}
.quote-card .total{font-family:'Bitter',serif;font-size:1.25rem;font-weight:700;color:var(--primary);margin-top:10px}

/* Floating action button */
.fab{position:fixed;bottom:80px;right:20px;width:56px;height:56px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow-3);z-index:90;transition:transform 0.15s var(--ease-out),box-shadow 0.15s var(--ease-out),background 0.15s}
.fab:hover{background:var(--primary-dark);box-shadow:0 6px 20px rgba(212,135,44,0.4);transform:scale(1.05)}
.fab:active{transform:scale(0.95)}
.fab svg{width:28px;height:28px}

/* Bottom nav */
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:1px solid var(--border);display:flex;z-index:99;padding-bottom:env(safe-area-inset-bottom,0);box-shadow:0 -2px 10px rgba(0,0,0,0.05)}
.bottom-nav button{flex:1;display:flex;flex-direction:column;align-items:center;padding:10px 0 8px;font-size:.65rem;color:var(--text-muted);transition:color 0.15s,transform 0.1s;position:relative}
.bottom-nav button::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%) scaleX(0);width:40px;height:2px;background:var(--primary);border-radius:0 0 2px 2px;transition:transform 0.2s var(--ease-out)}
.bottom-nav button.active{color:var(--primary)}
.bottom-nav button.active::before{transform:translateX(-50%) scaleX(1)}
.bottom-nav button:active{transform:scale(0.95)}
.bottom-nav button svg{width:22px;height:22px;margin-bottom:3px;transition:transform 0.15s}
.bottom-nav button:hover svg{transform:translateY(-2px)}

/* Views */
.view{display:none;opacity:0;transition:opacity 0.2s}
.view.active{display:block;animation:fadeIn 0.25s var(--ease-out) forwards}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

/* Forms */
.form-group{margin-bottom:20px}
.form-group label{display:block;font-size:.8rem;font-weight:600;color:var(--text);margin-bottom:8px;letter-spacing:0.02em}
.form-group label span.optional{font-weight:400;color:var(--text-muted);font-size:0.75rem;margin-left:4px}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:14px 16px;border:2px solid var(--border);border-radius:var(--radius-sm);background:#fff;font-size:1rem;transition:border-color 0.2s,box-shadow 0.2s,transform 0.15s}
.form-group input:hover,.form-group select:hover,.form-group textarea:hover{border-color:#C4B8AC}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(212,135,44,0.12);transform:translateY(-1px)}
.form-group input::placeholder,.form-group textarea::placeholder{color:#AAA}
*:focus-visible{outline:2px solid var(--primary);outline-offset:3px;outline-width:3px}

/* Buttons */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 28px;border-radius:var(--radius-sm);font-size:.9rem;font-weight:600;transition:transform 0.12s var(--ease-out),box-shadow 0.15s,background 0.15s;border:2px solid transparent}
.btn:active{transform:scale(0.97)}
.btn-primary{background:var(--primary);color:#fff;box-shadow:var(--shadow-2)}
.btn-primary:hover{background:var(--primary-dark);box-shadow:0 4px 12px rgba(176,107,26,0.35)}
.btn-outline{border:2px solid var(--border);color:var(--text);background:#fff}
.btn-outline:hover{border-color:var(--primary);color:var(--primary);background:#FFF9F0}
.btn-danger{background:var(--error);color:#fff;box-shadow:var(--shadow-1)}
.btn-danger:hover{background:#B73A3A}
.btn-success{background:var(--success);color:#fff}
.btn-success:hover{background:#3D6B4A}
.btn-block{width:100%}
.btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}

/* Line items */
.line-item{display:flex;align-items:center;gap:8px;padding:12px 0;border-bottom:1px solid var(--border);transition:background 0.15s}
.line-item:hover{background:rgba(245,240,235,0.5)}
.line-item:last-child{border-bottom:none}
.line-item .item-name{flex:1;font-size:.88rem}
.line-item .item-price{font-weight:600;font-size:.9rem;min-width:70px;text-align:right;color:var(--text)}
.line-item button{color:var(--error);padding:6px;border-radius:6px;transition:background 0.15s}
.line-item button:hover{background:#FEE2E2}

/* Photo grid */
.photo-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:16px 0}
.photo-grid .photo-cell{aspect-ratio:1;border-radius:var(--radius-sm);overflow:hidden;position:relative;background:var(--surface)}
.photo-grid .photo-cell img{width:100%;height:100%;object-fit:cover;transition:transform 0.3s var(--ease-out)}
.photo-grid .photo-cell:hover img{transform:scale(1.05)}
.photo-grid .add-photo{display:flex;align-items:center;justify-content:center;border:2px dashed var(--border);cursor:pointer;transition:all 0.2s var(--ease-out);background:#FAFAF8}
.photo-grid .add-photo:hover{border-color:var(--primary);background:#FFF9F0;transform:scale(1.02)}
.photo-grid .add-photo:active{transform:scale(0.98)}

/* Quote totals */
.quote-totals{background:linear-gradient(135deg,var(--surface),#EDE8E2);border-radius:var(--radius-sm);padding:20px;margin-top:20px;border:1px solid var(--border)}
.quote-totals .row{display:flex;justify-content:space-between;padding:6px 0;font-size:.9rem;color:var(--text-muted)}
.quote-totals .row.total{font-family:'Bitter',serif;font-size:1.35rem;font-weight:700;border-top:2px solid var(--border);padding-top:12px;margin-top:12px;color:var(--primary)}

/* Toast */
.toast-container{position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:10000}
.toast{background:var(--secondary);color:#fff;padding:14px 24px;border-radius:var(--radius);font-size:.9rem;box-shadow:var(--shadow-3);animation:toastIn 0.35s var(--ease-out);margin-bottom:10px;display:flex;align-items:center;gap:10px;min-width:280px;max-width:400px}
.toast.toast-success{background:var(--success)}
.toast.toast-error{background:var(--error)}
.toast svg{flex-shrink:0}
@keyframes toastIn{from{opacity:0;transform:translate(-50%,-20px)}to{opacity:1;transform:translate(-50%,0)}}

/* Detail view */
.detail-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;gap:12px}
.detail-header h2{font-size:1.2rem;line-height:1.3}
.back-btn{display:inline-flex;align-items:center;gap:6px;color:var(--text-muted);font-size:.85rem;margin-bottom:16px;cursor:pointer;padding:8px 12px;margin-left:-12px;border-radius:var(--radius-sm);transition:color 0.15s,background 0.15s}
.back-btn:hover{color:var(--primary);background:rgba(212,135,44,0.08)}
.back-btn svg{transition:transform 0.15s}
.back-btn:hover svg{transform:translateX(-3px)}

/* Status selector */
.status-select{display:flex;gap:10px;flex-wrap:wrap;margin:16px 0}
.status-select button{padding:8px 16px;border-radius:20px;font-size:.75rem;font-weight:600;border:2px solid var(--border);background:#fff;transition:all 0.15s var(--ease-out);white-space:nowrap}
.status-select button:hover{border-color:#C4B8AC}
.status-select button.active{border-color:var(--primary);background:var(--primary);color:#fff;box-shadow:0 2px 8px rgba(212,135,44,0.3)}
.status-select button:focus-visible{outline-offset:2px}

/* Upsell */
.upsell-card{background:linear-gradient(135deg,#F8F5F1,#F0EBE4);border:2px dashed #D4C8BC;opacity:0.9;position:relative}
.upsell-card::before{content:'★';position:absolute;top:12px;right:16px;font-size:1.2rem;color:var(--primary);opacity:0.5}
.upsell-card h3{color:var(--text-muted);font-size:1rem}
.upsell-badge{display:inline-block;background:var(--primary);color:#fff;font-size:.65rem;padding:3px 10px;border-radius:12px;font-weight:600;margin-left:8px;text-transform:uppercase;letter-spacing:0.03em}

/* Empty state */
.empty-state{text-align:center;padding:56px 24px}
.empty-state svg{margin-bottom:20px;opacity:0.4;transition:opacity 0.3s}
.empty-state:hover svg{opacity:0.6}
.empty-state h2{font-family:'Bitter',serif;font-size:1.25rem;margin-bottom:10px;color:var(--text)}
.empty-state p{color:var(--text-muted);font-size:.9rem;max-width:280px;margin:0 auto;line-height:1.6}
.empty-state .btn-primary{margin-top:24px;padding:12px 28px}

/* Location button */
.location-btn{font-size:.8rem;color:var(--primary);padding:8px 0;margin-top:6px;display:inline-flex;align-items:center;gap:6px;transition:gap 0.15s}
.location-btn:hover{gap:10px}
.location-btn svg{transition:transform 0.2s}
.location-btn:hover svg{transform:rotate(15deg)}

/* Camera overlay */
.camera-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:#000;z-index:10001;display:none}
.camera-overlay video{width:100%;height:100%;object-fit:cover}
.camera-overlay .controls{position:absolute;bottom:48px;left:0;right:0;display:flex;justify-content:center;gap:24px}
.camera-overlay .shutter{width:72px;height:72px;border-radius:50%;background:#fff;border:4px solid rgba(255,255,255,0.4);box-shadow:0 4px 20px rgba(0,0,0,0.3);transition:transform 0.1s,box-shadow 0.2s;cursor:pointer}
.camera-overlay .shutter:hover{transform:scale(1.05);box-shadow:0 6px 24px rgba(0,0,0,0.4)}
.camera-overlay .shutter:active{transform:scale(0.95)}
.camera-overlay .close-cam{position:absolute;top:20px;right:20px;color:#fff;background:rgba(0,0,0,0.5);width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(8px);transition:background 0.15s,transform 0.15s;border:1px solid rgba(255,255,255,0.1)}
.camera-overlay .close-cam:hover{background:rgba(0,0,0,0.7);transform:rotate(90deg)}

/* Animations */
.card{animation-delay:calc(var(--i,0) * 60ms)}
@media(prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:.01ms !important;transition-duration:.01ms !important}}

/* Print */
@media print{.bottom-nav,.fab,.demo-banner,.app-header,#bct-demo-disclaimer{display:none !important}body{background:#fff;padding:0}.card{box-shadow:none;border:1px solid #ddd}.card:hover{transform:none}}

/* Desktop */
@media(min-width:768px){.content{max-width:640px}.fab{bottom:100px;right:32px}}

/* Loading spinner */
.spinner{width:20px;height:20px;border:2px solid rgba(255,255,255,0.3);border-top-color:#fff;border-radius:50%;animation:spin 0.8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* Photo delete button */
.photo-delete-btn{position:absolute;top:6px;right:6px;background:rgba(0,0,0,0.6);color:#fff;border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.15s,background 0.15s,transform 0.15s;backdrop-filter:blur(4px)}
.photo-cell:hover .photo-delete-btn{opacity:1}
.photo-delete-btn:hover{background:rgba(193,75,75,0.9);transform:scale(1.1)}
.photo-delete-btn:active{transform:scale(0.9)}
</style>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>

<div id="gate">
<div>
<h1>HearthQuote</h1>
<p>This tool requires a valid access key.</p>
<p><a href="mailto:ben@bennycutools.com" style="color:#D4872C">ben@bennycutools.com</a></p>
</div>
</div>

<div id="app">
<header class="app-header">
<h1>HearthQuote</h1>
<p>Etowah Fireplace & Patio</p>
</header>

<div class="demo-banner" id="demoBanner" style="display:none" role="status" aria-live="polite">
<span>Sample data loaded. Tap to clear and add your own quotes.</span>
<button onclick="clearDemo()" aria-label="Clear demo data">Clear</button>
</div>

<main id="main-content">
<!-- Quotes List View -->
<div class="view active" id="viewQuotes">
<div class="content">
<div id="quotesList"></div>
<div class="card upsell-card" style="--i:5;text-align:center;padding:28px">
<h3>Branded PDF Reports <span class="upsell-badge">Full Version</span></h3>
<p style="font-size:.85rem;color:var(--text-muted);margin-top:12px;line-height:1.6">Generate multi-page proposals with your logo, before/after photos, product specs, and warranty details.</p>
</div>
</div>
</div>

<!-- New/Edit Quote View -->
<div class="view" id="viewEdit">
<div class="content">
<button class="back-btn" onclick="showView('viewQuotes')" aria-label="Go back to quotes list">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><polyline points="12 19 5 12 12 5"/></svg>
Back
</button>
<h2 id="editTitle" style="font-family:'Bitter',serif;font-size:1.3rem;margin-bottom:20px">New Quote</h2>

<div class="card">
<h3 style="font-size:.9rem;margin-bottom:16px;color:var(--text);font-weight:600">Customer Info</h3>
<div class="form-group">
<label for="custName">Customer Name <span class="optional">required</span></label>
<input type="text" id="custName" placeholder="John & Mary Smith" autocomplete="name">
</div>
<div class="form-group">
<label for="custPhone">Phone <span class="optional">optional</span></label>
<input type="tel" id="custPhone" placeholder="(828) 555-0123" autocomplete="tel">
</div>
<div class="form-group">
<label for="custEmail">Email <span class="optional">optional</span></label>
<input type="email" id="custEmail" placeholder="customer@email.com" autocomplete="email">
</div>
<div class="form-group">
<label for="custAddr">Job Site Address <span class="optional">optional</span></label>
<input type="text" id="custAddr" placeholder="123 Mountain View Dr, Hendersonville NC" autocomplete="street-address">
<button class="location-btn" onclick="autoFillLocation()" aria-label="Use current GPS location">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/></svg>
Use my location
</button>
</div>
</div>

<div class="card">
<h3 style="font-size:.9rem;margin-bottom:16px;color:var(--text);font-weight:600">Product</h3>
<div class="form-group">
<label for="prodType">Product Type</label>
<select id="prodType">
<option value="">Select type...</option>
<option value="gas-insert">Gas Insert</option>
<option value="wood-insert">Wood Insert</option>
<option value="pellet-stove">Pellet Stove</option>
<option value="gas-stove">Gas Stove (Freestanding)</option>
<option value="wood-stove">Wood Stove</option>
<option value="gas-fireplace">Gas Fireplace (New)</option>
<option value="electric-fireplace">Electric Fireplace</option>
<option value="outdoor-fireplace">Outdoor Fireplace</option>
<option value="service-repair">Service / Repair</option>
</select>
</div>
<div class="form-group">
<label for="prodModel">Model / Notes <span class="optional">optional</span></label>
<input type="text" id="prodModel" placeholder="e.g., Napoleon GDI-30 Direct Vent Insert">
</div>
</div>

<div class="card">
<h3 style="font-size:.9rem;margin-bottom:16px;color:var(--text);font-weight:600">Line Items</h3>
<div id="lineItems"></div>
<div style="display:flex;gap:10px;margin-top:12px">
<input type="text" id="newItemName" placeholder="Item description" style="flex:1;padding:12px 14px;border:2px solid var(--border);border-radius:var(--radius-sm);font-size:0.95rem" aria-label="New item description">
<input type="number" id="newItemPrice" placeholder="Price" style="width:100px;padding:12px 14px;border:2px solid var(--border);border-radius:var(--radius-sm);font-size:0.95rem" aria-label="New item price">
<button class="btn btn-outline" onclick="addLineItem()" style="padding:12px 18px" aria-label="Add line item">Add</button>
</div>
</div>

<div class="card">
<h3 style="font-size:.9rem;margin-bottom:12px;color:var(--text);font-weight:600">Photos</h3>
<p style="font-size:.8rem;color:var(--text-muted);margin-bottom:12px">Snap photos of the existing fireplace, chimney, and clearances.</p>
<div class="photo-grid" id="photoGrid">
<div class="photo-cell add-photo" onclick="openCamera()" role="button" tabindex="0" aria-label="Take a photo">
<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
</div>
</div>
</div>

<div class="card">
<h3 style="font-size:.9rem;margin-bottom:12px;color:var(--text);font-weight:600">Notes</h3>
<div class="form-group" style="margin:0">
<label for="quoteNotes" class="sr-only">Additional notes</label>
<textarea id="quoteNotes" rows="3" placeholder="Chimney condition, venting requirements, special instructions..."></textarea>
</div>
</div>

<div class="quote-totals" id="editTotals"></div>

<div style="display:flex;gap:10px;margin-top:20px">
<button class="btn btn-primary btn-block" onclick="saveQuote()" id="saveBtn">Save Quote</button>
</div>
<div style="display:flex;gap:10px;margin-top:10px">
<button class="btn btn-outline btn-block" onclick="shareQuote()" aria-label="Share quote with customer">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
Share with Customer
</button>
</div>
</div>
</div>

<!-- Quote Detail View -->
<div class="view" id="viewDetail">
<div class="content" id="detailContent"></div>
</div>

<!-- Settings View -->
<div class="view" id="viewSettings">
<div class="content">
<h2 style="font-family:'Bitter',serif;font-size:1.3rem;margin-bottom:20px">Settings</h2>
<div class="card">
<h3 style="font-size:.9rem;margin-bottom:16px;color:var(--text);font-weight:600">Your Business</h3>
<div class="form-group">
<label for="bizName">Business Name</label>
<input type="text" id="bizName" value="Etowah Fireplace & Patio">
</div>
<div class="form-group">
<label for="bizPhone">Phone</label>
<input type="tel" id="bizPhone" value="(828) 891-5661" autocomplete="tel">
</div>
</div>
<div class="card">
<h3 style="font-size:.9rem;margin-bottom:16px;color:var(--text);font-weight:600">Data</h3>
<button class="btn btn-outline btn-block" onclick="exportData()" style="margin-bottom:10px">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:6px"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
Export All Data (JSON)
</button>
<button class="btn btn-outline btn-block" onclick="document.getElementById('importFile').click()">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:6px"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
Import Data (JSON)
</button>
<input type="file" id="importFile" accept=".json" onchange="importData(event)" style="display:none" aria-label="Import data file">
</div>
<div class="card">
<button class="btn btn-danger btn-block" onclick="if(confirm('Delete all quotes? This cannot be undone.')){clearAllData()}">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:6px"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
Delete All Data
</button>
</div>
</div>
</div>
</main>

<!-- FAB -->
<button class="fab" onclick="newQuote()" aria-label="Create new quote" id="fabBtn">
<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
</button>

<!-- Bottom Nav -->
<nav class="bottom-nav" role="navigation" aria-label="Main navigation">
<button onclick="showView('viewQuotes')" class="active" id="navQuotes" aria-label="Quotes list">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
Quotes
</button>
<button onclick="showView('viewSettings')" id="navSettings" aria-label="Settings">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
Settings
</button>
</nav>

<!-- Camera overlay -->
<div class="camera-overlay" id="cameraOverlay" role="dialog" aria-modal="true" aria-label="Camera">
<video id="cameraVideo" autoplay playsinline></video>
<button class="close-cam" onclick="closeCamera()" aria-label="Close camera">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
</button>
<div class="controls">
<button class="shutter" onclick="capturePhoto()" aria-label="Take photo"></button>
</div>
</div>
<canvas id="cameraCanvas" style="display:none"></canvas>

<!-- Toast container -->
<div class="toast-container" id="toastContainer" aria-live="polite" role="status"></div>
</div>

<!-- DEMO DISCLAIMER - Legal Notice -->
<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer" style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:12px 16px;font-size:12px;line-height:1.5;color:#666;z-index:99999;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:10px 20px;text-align:center;">
<p style="margin:0;max-width:720px;"><strong style="color:#333;">DEMO NOTICE:</strong> This tool was created by BennyCuTools as a free demonstration only. It is not affiliated with, endorsed by, or authorized by Etowah Fireplace & Patio, Inc. All brand references are used solely for demonstration purposes.</p>
<a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20Etowah%20Fireplace&body=I%20am%20the%20owner%20and%20I%20request%20permanent%20deletion%20of%20this%20demo." style="display:inline-flex;align-items:center;gap:6px;background:#dc3545;color:#fff;padding:6px 14px;border-radius:4px;text-decoration:none;font-size:11px;font-weight:500;white-space:nowrap;transition:background 0.15s">
<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
Request Permanent Deletion
</a>
</div>

<script>
// Access key validation
function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
const _V=-427228278;
const _k=new URLSearchParams(window.location.search).get('key');
if(_k&&_h(_k)===_V){initApp();}else{document.getElementById('gate').style.display='flex';document.getElementById('app').style.display='none';}

// Anti-scrape
let devtoolsOpen=false;const threshold=160;
setInterval(()=>{const widthThreshold=window.outerWidth-window.innerWidth>threshold;const heightThreshold=window.outerHeight-window.innerHeight>threshold;if(widthThreshold||heightThreshold){devtoolsOpen=true;document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif"><h1>Access Denied</h1></div>';}},1000);
document.addEventListener('contextmenu',e=>e.preventDefault());
document.addEventListener('keydown',e=>{if((e.ctrlKey||e.metaKey)&&(e.key==='s'||e.key==='u'||e.key==='p')){e.preventDefault();}});

// App state
let db;
let currentQuoteId=null;
let currentLineItems=[];
let currentPhotos=[];
let cameraStream=null;

function initApp(){
document.getElementById('gate').style.display='none';
document.getElementById('app').style.display='block';
openDB().then(()=>{
checkFirstVisit();
renderQuotes();
}).catch(err=>{
console.error('Database error:',err);
toast('Error loading app. Please refresh.');
});
}

// IndexedDB
function openDB(){
return new Promise((resolve,reject)=>{
const req=indexedDB.open('HearthQuoteDB',1);
req.onupgradeneeded=e=>{
const d=e.target.result;
if(!d.objectStoreNames.contains('quotes')){
d.createObjectStore('quotes',{keyPath:'id'});
}
};
req.onsuccess=e=>{db=e.target.result;resolve();};
req.onerror=e=>reject(e);
});
}

function dbPut(store,data){
return new Promise((resolve,reject)=>{
const tx=db.transaction(store,'readwrite');
tx.objectStore(store).put(data);
tx.oncomplete=()=>resolve();
tx.onerror=e=>reject(e);
});
}

function dbGetAll(store){
return new Promise((resolve,reject)=>{
const tx=db.transaction(store,'readonly');
const req=tx.objectStore(store).getAll();
req.onsuccess=()=>resolve(req.result);
req.onerror=e=>reject(e);
});
}

function dbGet(store,id){
return new Promise((resolve,reject)=>{
const tx=db.transaction(store,'readonly');
const req=tx.objectStore(store).get(id);
req.onsuccess=()=>resolve(req.result);
req.onerror=e=>reject(e);
});
}

function dbDelete(store,id){
return new Promise((resolve,reject)=>{
const tx=db.transaction(store,'readwrite');
tx.objectStore(store).delete(id);
tx.oncomplete=()=>resolve();
tx.onerror=e=>reject(e);
});
}

// Demo data
function checkFirstVisit(){
if(!localStorage.getItem('hq_visited')){
localStorage.setItem('hq_visited','1');
loadDemoData();
}
}

function loadDemoData(){
const demos=[
{id:'demo-1',isDemo:true,customer:{name:'Robert & Linda Chambers',phone:'(828) 555-0147',email:'rchambers@email.com',address:'42 Pisgah View Rd, Hendersonville NC'},product:{type:'gas-insert',model:'Napoleon GDI-30 Direct Vent Insert'},lineItems:[{name:'Napoleon GDI-30 Insert',price:3800},{name:'Chimney liner (25ft aluminum flex)',price:850},{name:'Installation labor',price:1600},{name:'Decorative surround kit',price:450},{name:'Gas line extension',price:350}],photos:[],notes:'Existing masonry fireplace, good condition. Chimney needs new liner. Customer wants remote control option.',status:'pending',total:7050,date:Date.now()-86400000*2},
{id:'demo-2',isDemo:true,customer:{name:'Patricia Morrison',phone:'(828) 555-0298',email:'patmorrison@email.com',address:'118 Mountain Laurel Ln, Brevard NC'},product:{type:'wood-stove',model:'Jotul F 500 Oslo'},lineItems:[{name:'Jotul F 500 Oslo Wood Stove',price:3200},{name:'Class A chimney pipe (15ft)',price:1100},{name:'Hearth pad (natural stone)',price:480},{name:'Installation labor',price:1400},{name:'Fire extinguisher & CO detector',price:85}],photos:[],notes:'New install in renovated cottage. No existing chimney — full Class A pipe run through roof. Customer chose soapstone finish.',status:'accepted',total:6265,date:Date.now()-86400000*5},
{id:'demo-3',isDemo:true,customer:{name:'James & Deborah Whitaker',phone:'(828) 555-0412',email:'',address:'7 Kanuga Forest Dr, Flat Rock NC'},product:{type:'pellet-stove',model:'Harman Absolute 63'},lineItems:[{name:'Harman Absolute 63 Pellet Stove',price:4100},{name:'Pellet vent pipe kit',price:420},{name:'Wall thimble and termination cap',price:180},{name:'Installation labor',price:950}],photos:[],notes:'Replacing old wood stove in basement. Good access for vent pipe through foundation wall. Customers want programmable thermostat control.',status:'sent',total:5650,date:Date.now()-86400000*1},
{id:'demo-4',isDemo:true,customer:{name:'Mark Spencer',phone:'(828) 555-0573',email:'mark.spencer@email.com',address:'225 Crab Creek Rd, Mills River NC'},product:{type:'service-repair',model:'Gas log set pilot ignition repair'},lineItems:[{name:'Diagnostic / service call',price:125},{name:'Thermocouple replacement',price:45},{name:'Pilot assembly cleaning',price:0}],photos:[],notes:'Pilot will not stay lit on existing vented gas log set. Likely thermocouple. Check millivolt output.',status:'accepted',total:170,date:Date.now()-86400000*8}
];
demos.forEach(d=>dbPut('quotes',d));
setTimeout(()=>{
document.getElementById('demoBanner').style.display='flex';
renderQuotes();
},400);
}

function clearDemo(){
dbGetAll('quotes').then(quotes=>{
const ops=quotes.filter(q=>q.isDemo).map(q=>dbDelete('quotes',q.id));
return Promise.all(ops);
}).then(()=>{
document.getElementById('demoBanner').style.display='none';
renderQuotes();
toast('Demo data cleared','success');
}).catch(err=>{
console.error('Error clearing demo:',err);
toast('Error clearing demo data');
});
}

// Render quotes list
function renderQuotes(){
dbGetAll('quotes').then(quotes=>{
quotes.sort((a,b)=>b.date-a.date);
const container=document.getElementById('quotesList');
if(quotes.length===0){
container.innerHTML=`
<div class="empty-state">
<svg width="72" height="72" viewBox="0 0 24 24" fill="none" stroke="var(--border)" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
<h2>No quotes yet</h2>
<p>Tap the + button to create your first fireplace quote. Your quotes will appear here.</p>
<button class="btn btn-primary" onclick="newQuote()">Create First Quote</button>
</div>`;
return;
}
container.innerHTML=quotes.map((q,i)=>{
const statusClass={'pending':'status-pending','sent':'status-sent','accepted':'status-accepted','declined':'status-declined'}[q.status]||'status-pending';
const statusLabel={'pending':'Pending','sent':'Sent','accepted':'Accepted','declined':'Declined'}[q.status]||'Pending';
const typeLabel={'gas-insert':'Gas Insert','wood-insert':'Wood Insert','pellet-stove':'Pellet Stove','gas-stove':'Gas Stove','wood-stove':'Wood Stove','gas-fireplace':'Gas Fireplace','electric-fireplace':'Electric','outdoor-fireplace':'Outdoor','service-repair':'Service/Repair'}[q.product?.type]||'Quote';
const dateStr=new Date(q.date).toLocaleDateString('en-US',{month:'short',day:'numeric'});
return `<div class="card quote-card" style="--i:${i}" onclick="viewQuote('${q.id}')" tabindex="0" role="button" aria-label="View quote for ${q.customer?.name||'Unknown'}: ${statusLabel}, $${(q.total||0).toLocaleString()}">
<span class="status-badge ${statusClass}">${statusLabel}</span>
<h3>${q.customer?.name||'Unnamed'}</h3>
<div class="meta"><span>${typeLabel}</span><span>${q.customer?.address?.split(',')[0]||''}</span><span>${dateStr}</span></div>
<div class="total">$${(q.total||0).toLocaleString()}</div>
</div>`;
}).join('');
// Check for demo banner
const hasDemo=quotes.some(q=>q.isDemo);
document.getElementById('demoBanner').style.display=hasDemo?'flex':'none';
}).catch(err=>{
console.error('Error rendering quotes:',err);
toast('Error loading quotes');
});
}

// View navigation
function showView(viewId){
document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
document.getElementById(viewId).classList.add('active');
document.querySelectorAll('.bottom-nav button').forEach(b=>b.classList.remove('active'));
if(viewId==='viewQuotes')document.getElementById('navQuotes').classList.add('active');
if(viewId==='viewSettings')document.getElementById('navSettings').classList.add('active');
document.getElementById('fabBtn').style.display=(viewId==='viewQuotes')?'flex':'none';
window.scrollTo({top:0,behavior:'smooth'});
}

// New quote
function newQuote(){
currentQuoteId=null;
currentLineItems=[];
currentPhotos=[];
document.getElementById('editTitle').textContent='New Quote';
document.getElementById('custName').value='';
document.getElementById('custPhone').value='';
document.getElementById('custEmail').value='';
document.getElementById('custAddr').value='';
document.getElementById('prodType').value='';
document.getElementById('prodModel').value='';
document.getElementById('quoteNotes').value='';
renderLineItems();
renderPhotos();
updateTotals();
showView('viewEdit');
setTimeout(()=>document.getElementById('custName').focus(),100);
}

// Line items
function addLineItem(){
const name=document.getElementById('newItemName').value.trim();
const price=parseFloat(document.getElementById('newItemPrice').value)||0;
if(!name){toast('Enter an item description');return;}
if(price<0){toast('Price cannot be negative');return;}
currentLineItems.push({name,price});
document.getElementById('newItemName').value='';
document.getElementById('newItemPrice').value='';
document.getElementById('newItemName').focus();
renderLineItems();
updateTotals();
}

function removeLineItem(idx){
currentLineItems.splice(idx,1);
renderLineItems();
updateTotals();
}

function renderLineItems(){
const el=document.getElementById('lineItems');
if(currentLineItems.length===0){
el.innerHTML='<p style="color:var(--text-muted);font-size:.85rem;padding:12px 0;font-style:italic">No items added yet. Add your first line item below.</p>';
return;
}
el.innerHTML=currentLineItems.map((item,i)=>`
<div class="line-item">
<span class="item-name">${item.name}</span>
<span class="item-price">$${item.price.toLocaleString()}</span>
<button onclick="removeLineItem(${i})" aria-label="Remove ${item.name}">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
</button>
</div>
`).join('');
}

function updateTotals(){
const total=currentLineItems.reduce((s,i)=>s+i.price,0);
document.getElementById('editTotals').innerHTML=`
<div class="row"><span>Subtotal</span><span>$${total.toLocaleString()}</span></div>
<div class="row total"><span>Total</span><span>$${total.toLocaleString()}</span></div>
`;
}

// Camera
function openCamera(){
const overlay=document.getElementById('cameraOverlay');
if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){
toast('Camera not supported on this device');
fileUploadFallback();
return;
}
navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}}).then(stream=>{
cameraStream=stream;
document.getElementById('cameraVideo').srcObject=stream;
overlay.style.display='block';
// Focus management for modal
document.getElementById('cameraOverlay').querySelector('.close-cam').focus();
}).catch(()=>{
toast('Camera access denied. Use file upload instead.');
fileUploadFallback();
});
}

function fileUploadFallback(){
const input=document.createElement('input');
input.type='file';input.accept='image/*';input.capture='environment';
input.onchange=e=>{
const file=e.target.files[0];if(!file)return;
const reader=new FileReader();
reader.onload=ev=>{currentPhotos.push(ev.target.result);renderPhotos();};
reader.readAsDataURL(file);
};
input.click();
}

function capturePhoto(){
const video=document.getElementById('cameraVideo');
const canvas=document.getElementById('cameraCanvas');
if(!video.videoWidth){toast('Camera not ready');return;}
canvas.width=video.videoWidth;canvas.height=video.videoHeight;
canvas.getContext('2d').drawImage(video,0,0);
currentPhotos.push(canvas.toDataURL('image/jpeg',0.85));
renderPhotos();
closeCamera();
toast('Photo captured','success');
}

function closeCamera(){
if(cameraStream){cameraStream.getTracks().forEach(t=>t.stop());cameraStream=null;}
document.getElementById('cameraOverlay').style.display='none';
}

function renderPhotos(){
const grid=document.getElementById('photoGrid');
grid.innerHTML=currentPhotos.map((p,i)=>`
<div class="photo-cell">
<img src="${p}" alt="Job site photo ${i+1}">
<button class="photo-delete-btn" onclick="currentPhotos.splice(${i},1);renderPhotos()" aria-label="Remove photo ${i+1}">
<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
</button>
</div>
`).join('')+`
<div class="photo-cell add-photo" onclick="openCamera()" role="button" tabindex="0" aria-label="Take another photo">
<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
</div>`;
}

// Geolocation
function autoFillLocation(){
if(!navigator.geolocation){toast('Location not available on this device');return;}
toast('Getting location...');
navigator.geolocation.getCurrentPosition(pos=>{
const{latitude:lat,longitude:lng}=pos.coords;
document.getElementById('custAddr').value=`${lat.toFixed(5)}, ${lng.toFixed(5)} (GPS)`;
toast('Location captured','success');
},()=>{
toast('Could not get location. Check permissions.');
},{enableHighAccuracy:true,timeout:10000});
}

// Save quote
function saveQuote(){
const quote={
id:currentQuoteId||'q-'+Date.now(),
customer:{
name:document.getElementById('custName').value.trim(),
phone:document.getElementById('custPhone').value.trim(),
email:document.getElementById('custEmail').value.trim(),
address:document.getElementById('custAddr').value.trim()
},
product:{
type:document.getElementById('prodType').value,
model:document.getElementById('prodModel').value.trim()
},
lineItems:[...currentLineItems],
photos:[...currentPhotos],
notes:document.getElementById('quoteNotes').value.trim(),
status:currentQuoteId?undefined:'pending',
total:currentLineItems.reduce((s,i)=>s+i.price,0),
date:currentQuoteId?undefined:Date.now()
};
if(!quote.customer.name){toast('Enter the customer name');document.getElementById('custName').focus();return;}
// If editing, preserve status and date
if(currentQuoteId){
dbGet('quotes',currentQuoteId).then(existing=>{
quote.status=existing?.status||'pending';
quote.date=existing?.date||Date.now();
return dbPut('quotes',quote);
}).then(()=>{
toast('Quote updated','success');
renderQuotes();
showView('viewQuotes');
}).catch(err=>{
console.error('Error updating quote:',err);
toast('Error saving quote');
});
}else{
dbPut('quotes',quote).then(()=>{
toast('Quote saved','success');
renderQuotes();
showView('viewQuotes');
}).catch(err=>{
console.error('Error saving quote:',err);
toast('Error saving quote');
});
}
}

// View quote detail
function viewQuote(id){
dbGet('quotes',id).then(q=>{
if(!q)return;
const typeLabel={'gas-insert':'Gas Insert','wood-insert':'Wood Insert','pellet-stove':'Pellet Stove','gas-stove':'Gas Stove','wood-stove':'Wood Stove','gas-fireplace':'Gas Fireplace','electric-fireplace':'Electric','outdoor-fireplace':'Outdoor','service-repair':'Service/Repair'}[q.product?.type]||'Quote';
const statusClass={'pending':'status-pending','sent':'status-sent','accepted':'status-accepted','declined':'status-declined'}[q.status]||'status-pending';
const dateStr=new Date(q.date).toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});
const photosHtml=q.photos?.length?`<div class="photo-grid">${q.photos.map((p,i)=>`<div class="photo-cell"><img src="${p}" alt="Photo ${i+1} of job site"></div>`).join('')}</div>`:'';
document.getElementById('detailContent').innerHTML=`
<button class="back-btn" onclick="showView('viewQuotes')" aria-label="Back to quotes list">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><polyline points="12 19 5 12 12 5"/></svg>
Back
</button>
<div class="card">
<div class="detail-header">
<h2 style="font-family:'Bitter',serif">${q.customer?.name}</h2>
<span class="status-badge ${statusClass}">${q.status}</span>
</div>
<p style="font-size:.88rem;color:var(--text-muted)">${typeLabel}${q.product?.model?' — '+q.product.model:''}</p>
<p style="font-size:.85rem;color:var(--text-muted);margin-top:6px">${q.customer?.address||''}</p>
<p style="font-size:.8rem;color:var(--text-muted);margin-top:6px">${dateStr}</p>
</div>
<div class="card">
<h3 style="font-size:.9rem;margin-bottom:12px;color:var(--text);font-weight:600">Status</h3>
<div class="status-select">
<button class="${q.status==='pending'?'active':''}" onclick="updateStatus('${id}','pending')">Pending</button>
<button class="${q.status==='sent'?'active':''}" onclick="updateStatus('${id}','sent')">Sent</button>
<button class="${q.status==='accepted'?'active':''}" onclick="updateStatus('${id}','accepted')">Accepted</button>
<button class="${q.status==='declined'?'active':''}" onclick="updateStatus('${id}','declined')">Declined</button>
</div>
</div>
<div class="card">
<h3 style="font-size:.9rem;margin-bottom:12px;color:var(--text);font-weight:600">Line Items</h3>
${q.lineItems?.map(i=>`<div class="line-item"><span class="item-name">${i.name}</span><span class="item-price">$${i.price.toLocaleString()}</span></div>`).join('')||'<p style="color:var(--text-muted);font-size:.85rem;padding:8px 0">No items in this quote</p>'}
<div class="quote-totals" style="margin-top:12px">
<div class="row total"><span>Total</span><span>$${(q.total||0).toLocaleString()}</span></div>
</div>
</div>
${q.notes?`<div class="card"><h3 style="font-size:.9rem;margin-bottom:12px;color:var(--text);font-weight:600">Notes</h3><p style="font-size:.85rem;color:var(--text-muted);line-height:1.6">${q.notes}</p></div>`:''}
${photosHtml?`<div class="card"><h3 style="font-size:.9rem;margin-bottom:12px;color:var(--text);font-weight:600">Photos</h3>${photosHtml}</div>`:''}
<div style="display:flex;gap:10px;margin-top:16px">
<button class="btn btn-primary" style="flex:1" onclick="editQuote('${id}')">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:6px"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
Edit
</button>
<button class="btn btn-outline" style="flex:1" onclick="shareQuoteById('${id}')">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:6px"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
Share
</button>
</div>
<button class="btn btn-danger btn-block" style="margin-top:10px" onclick="deleteQuote('${id}')">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:6px"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
Delete Quote
</button>
`;
showView('viewDetail');
}).catch(err=>{
console.error('Error viewing quote:',err);
toast('Error loading quote');
});
}

function updateStatus(id,status){
dbGet('quotes',id).then(q=>{
q.status=status;
return dbPut('quotes',q);
}).then(()=>{
toast('Status updated','success');
viewQuote(id);
renderQuotes();
}).catch(err=>{
console.error('Error updating status:',err);
toast('Error updating status');
});
}

function editQuote(id){
dbGet('quotes',id).then(q=>{
if(!q)return;
currentQuoteId=id;
currentLineItems=[...(q.lineItems||[])];
currentPhotos=[...(q.photos||[])];
document.getElementById('editTitle').textContent='Edit Quote';
document.getElementById('custName').value=q.customer?.name||'';
document.getElementById('custPhone').value=q.customer?.phone||'';
document.getElementById('custEmail').value=q.customer?.email||'';
document.getElementById('custAddr').value=q.customer?.address||'';
document.getElementById('prodType').value=q.product?.type||'';
document.getElementById('prodModel').value=q.product?.model||'';
document.getElementById('quoteNotes').value=q.notes||'';
renderLineItems();
renderPhotos();
updateTotals();
showView('viewEdit');
}).catch(err=>{
console.error('Error editing quote:',err);
toast('Error loading quote');
});
}

function deleteQuote(id){
if(!confirm('Delete this quote? This action cannot be undone.'))return;
dbDelete('quotes',id).then(()=>{
toast('Quote deleted','success');
renderQuotes();
showView('viewQuotes');
}).catch(err=>{
console.error('Error deleting quote:',err);
toast('Error deleting quote');
});
}

// Share via Web Share API
function shareQuote(){
const name=document.getElementById('custName').value||'Customer';
const total=currentLineItems.reduce((s,i)=>s+i.price,0);
const type=document.getElementById('prodType').selectedOptions[0]?.text||'Quote';
const items=currentLineItems.map(i=>`  ${i.name}: $${i.price.toLocaleString()}`).join('\n');
const text=`Etowah Fireplace & Patio\nQuote for: ${name}\n\n${type}\n${items}\n\nTotal: $${total.toLocaleString()}\n\nQuestions? Call (828) 891-5661`;
if(navigator.share){
navigator.share({title:'Fireplace Quote from Etowah Fireplace',text}).catch(()=>{});
}else{
navigator.clipboard.writeText(text).then(()=>toast('Quote copied to clipboard','success'));
}
}

function shareQuoteById(id){
dbGet('quotes',id).then(q=>{
if(!q)return;
const typeLabel={'gas-insert':'Gas Insert','wood-insert':'Wood Insert','pellet-stove':'Pellet Stove','gas-stove':'Gas Stove','wood-stove':'Wood Stove','gas-fireplace':'Gas Fireplace','electric-fireplace':'Electric','outdoor-fireplace':'Outdoor','service-repair':'Service/Repair'}[q.product?.type]||'Quote';
const items=(q.lineItems||[]).map(i=>`  ${i.name}: $${i.price.toLocaleString()}`).join('\n');
const text=`Etowah Fireplace & Patio\nQuote for: ${q.customer?.name}\n\n${typeLabel}${q.product?.model?' - '+q.product.model:''}\n${items}\n\nTotal: $${(q.total||0).toLocaleString()}\n\nQuestions? Call (828) 891-5661`;
if(navigator.share){
navigator.share({title:'Fireplace Quote from Etowah Fireplace',text}).catch(()=>{});
}else{
navigator.clipboard.writeText(text).then(()=>toast('Quote copied to clipboard','success'));
}
}).catch(err=>{
console.error('Error sharing quote:',err);
toast('Error sharing quote');
});
}

// Data management
function exportData(){
dbGetAll('quotes').then(data=>{
const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;a.download='hearthquote-backup.json';a.click();
URL.revokeObjectURL(url);
toast('Data exported','success');
}).catch(err=>{
console.error('Error exporting:',err);
toast('Error exporting data');
});
}

function importData(event){
const file=event.target.files[0];if(!file)return;
const reader=new FileReader();
reader.onload=e=>{
try{
const data=JSON.parse(e.target.result);
if(!Array.isArray(data)){toast('Invalid file format');return;}
Promise.all(data.map(d=>dbPut('quotes',d))).then(()=>{
toast('Data imported','success');
renderQuotes();
});
}catch{toast('Could not read file. Check format.');}
};
reader.readAsText(file);
event.target.value='';
}

function clearAllData(){
const tx=db.transaction('quotes','readwrite');
tx.objectStore('quotes').clear();
tx.oncomplete=()=>{
localStorage.removeItem('hq_visited');
toast('All data deleted','success');
renderQuotes();
};
tx.onerror=()=>toast('Error deleting data');
}

// Toast - improved with types
function toast(msg,type='info'){
const container=document.getElementById('toastContainer');
const el=document.createElement('div');
const icon=type==='success'?'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>':
type==='error'?'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>':
'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>';
el.className=`toast toast-${type}`;
el.innerHTML=`${icon}<span>${msg}</span>`;
container.appendChild(el);
setTimeout(()=>{
el.style.opacity='0';
el.style.transform='translate(-50%,-20px)';
el.style.transition='all 0.2s';
setTimeout(()=>el.remove(),200);
},3000);
}

// Keyboard shortcuts
document.addEventListener('keydown',e=>{
// Enter to add line item
if(e.key==='Enter'&&document.activeElement.id==='newItemPrice'){
addLineItem();
}
// Escape to close camera
if(e.key==='Escape'&&document.getElementById('cameraOverlay').style.display==='block'){
closeCamera();
}
});

// Handle Enter key on photo add button for accessibility
document.addEventListener('keypress',e=>{
if(e.key==='Enter'&&e.target.classList.contains('add-photo')){
openCamera();
}
});
</script>
<script src="https://book.bennycutools.com/tracker.js" async></script>
</body>
</html>