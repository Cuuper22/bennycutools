<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PianoLog - Stay Tuned Piano Services</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Source+Sans+3:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
--bg:#f7f5f0;--card:#ffffff;--text:#2b2b2b;--text-muted:#6b6560;--gold:#c8a96e;--gold-soft:rgba(200,169,110,.12);--gold-light:rgba(200,169,110,.08);
--dark:#2b2b2b;--border:#e8e3dc;--success:#3a8a5c;--warning:#c48a1a;--danger:#b44030;
--radius:12px;--radius-sm:8px;--shadow:0 1px 3px rgba(43,43,43,.06),0 4px 12px rgba(43,43,43,.04);
--shadow-lg:0 4px 12px rgba(43,43,43,.08),0 12px 32px rgba(43,43,43,.06);
--font-head:'Playfair Display',Georgia,serif;--font-body:'Source Sans 3','Source Sans Pro',system-ui,sans-serif;
--ease-spring:cubic-bezier(.34,1.56,.64,1);
}
html{font-size:16px;-webkit-text-size-adjust:100%}
body{padding-bottom:80px;font-family:var(--font-body);background:var(--bg);color:var(--text);line-height:1.5;min-height:100vh;padding-bottom:140px;-webkit-font-smoothing:antialiased}
h1,h2,h3{font-family:var(--font-head);font-weight:700;line-height:1.2}
h1{font-size:1.5rem}h2{font-size:1.25rem}h3{font-size:1.1rem}
a{color:var(--gold);text-decoration:none}
button,input,select,textarea{font-family:var(--font-body);font-size:1rem;border:none;outline:none;background:none}
input:focus,textarea:focus,select:focus{outline:2px solid var(--gold);outline-offset:2px}
*:focus-visible{outline:2px solid var(--gold);outline-offset:2px}

/* SKIP LINK */
.skip-link{position:absolute;top:-40px;left:0;background:var(--gold);color:#fff;padding:8px 16px;z-index:9999;font-weight:600;transition:top .15s}
.skip-link:focus{top:0}

/* NOISE TEXTURE */
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:9998;opacity:.03;
background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.75' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E")}

/* LOADING STATES */
.skeleton{background:linear-gradient(90deg,var(--border) 25%,#f0ede8 50%,var(--border) 75%);background-size:200% 100%;animation:skeleton 1.5s infinite;border-radius:var(--radius-sm)}
@keyframes skeleton{0%{background-position:200% 0}100%{background-position:-200% 0}}
.loading-overlay{position:fixed;inset:0;background:var(--bg);display:flex;align-items:center;justify-content:center;z-index:9999;opacity:0;visibility:hidden;transition:opacity .2s,visibility .2s}
.loading-overlay.active{opacity:1;visibility:visible}
.loading-spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--gold);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.btn--loading{position:relative;color:transparent!important;pointer-events:none}
.btn--loading::after{content:'';position:absolute;width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .8s linear infinite}

/* HEADER */
.app-header{background:var(--dark);color:#fff;padding:16px 20px;position:sticky;top:0;z-index:100;box-shadow:0 2px 8px rgba(0,0,0,.15)}
.app-header h1{color:#fff;font-size:1.35rem;letter-spacing:.02em}
.app-header .subtitle{color:var(--gold);font-family:var(--font-body);font-size:.8rem;font-weight:500;letter-spacing:.05em;text-transform:uppercase;margin-top:2px}

/* DEMO BANNER */
.demo-banner{background:var(--gold-soft);border-bottom:1px solid var(--border);padding:10px 16px;display:flex;align-items:center;justify-content:space-between;gap:8px}
.demo-banner p{font-size:.82rem;color:var(--text-muted);line-height:1.3}
.demo-banner button{background:var(--gold);color:#fff;font-size:.75rem;font-weight:600;padding:6px 14px;border-radius:6px;cursor:pointer;white-space:nowrap;transition:transform .15s,background .15s;min-height:32px}
.demo-banner button:hover{background:#b89a5f}
.demo-banner button:active{transform:scale(.96)}

/* VIEWS */
.view{display:none;padding:16px;animation:fadeUp .35s ease-out}
.view.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

/* SEARCH BAR */
.search-bar{position:relative;margin-bottom:16px}
.search-bar input{width:100%;padding:14px 16px 14px 48px;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);font-size:.95rem;box-shadow:var(--shadow);transition:border-color .2s,box-shadow .2s}
.search-bar input:focus{border-color:var(--gold);box-shadow:0 0 0 3px var(--gold-soft)}
.search-bar input::placeholder{color:#999}
.search-bar svg{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:var(--text-muted)}
.search-bar .search-clear{position:absolute;right:12px;top:50%;transform:translateY(-50%);width:24px;height:24px;border-radius:50%;background:var(--bg);display:flex;align-items:center;justify-content:center;cursor:pointer;opacity:0;visibility:hidden;transition:opacity .15s,background .15s}
.search-bar .search-clear.visible{opacity:1;visibility:visible}
.search-bar .search-clear:hover{background:var(--border)}

/* STATUS BADGES */
.badge{display:inline-flex;align-items:center;gap:4px;font-size:.72rem;font-weight:600;padding:4px 10px;border-radius:20px;letter-spacing:.02em;text-transform:uppercase}
.badge--due{background:rgba(58,138,92,.1);color:var(--success)}
.badge--soon{background:rgba(196,138,26,.1);color:var(--warning)}
.badge--overdue{background:rgba(180,64,48,.1);color:var(--danger)}

/* PIANO CARDS */
.piano-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:12px;overflow:hidden;cursor:pointer;
transition:transform .2s var(--ease-spring),box-shadow .2s;position:relative;border:1px solid transparent}
.piano-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg);border-color:var(--gold-soft)}
.piano-card:active{transform:scale(.985)}
.piano-card:focus-visible{outline:2px solid var(--gold);outline-offset:2px;border-color:var(--gold)}
.piano-card-inner{padding:16px;display:flex;gap:14px;align-items:flex-start}
.piano-thumb{width:56px;height:56px;border-radius:10px;background:var(--gold-soft);display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden}
.piano-thumb img{width:100%;height:100%;object-fit:cover}
.piano-thumb svg{color:var(--gold);width:28px;height:28px}
.piano-info{flex:1;min-width:0}
.piano-info .client-name{font-family:var(--font-head);font-weight:700;font-size:1rem;margin-bottom:2px}
.piano-info .piano-model{font-size:.85rem;color:var(--text-muted);margin-bottom:6px}
.piano-info .meta-row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.piano-info .meta-item{font-size:.78rem;color:var(--text-muted);display:flex;align-items:center;gap:3px}
.piano-card .arrow{position:absolute;right:16px;top:50%;transform:translateY(-50%);color:var(--text-muted);opacity:.4}

/* EMPTY STATES */
.empty-state{text-align:center;padding:56px 24px;color:var(--text-muted)}
.empty-state-icon{width:64px;height:64px;margin:0 auto 20px;background:var(--gold-light);border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--gold)}
.empty-state h3{font-family:var(--font-body);font-size:1.1rem;font-weight:600;color:var(--text);margin-bottom:8px}
.empty-state p{font-size:.9rem;line-height:1.5;margin-bottom:20px;max-width:280px;margin-left:auto;margin-right:auto}
.empty-state .btn{margin-top:8px}

/* SERVICE LOG ENTRIES */
.service-entry{background:var(--card);border-radius:10px;padding:16px;margin-bottom:10px;border-left:3px solid var(--gold);box-shadow:var(--shadow);transition:transform .15s}
.service-entry:hover{transform:translateX(2px)}
.service-entry .se-date{font-size:.78rem;font-weight:600;color:var(--gold);text-transform:uppercase;letter-spacing:.04em;margin-bottom:6px}
.service-entry .se-type{font-weight:600;font-size:.92rem;margin-bottom:6px}
.service-entry .se-condition{display:inline-flex;align-items:center;gap:4px;font-size:.8rem;color:var(--text-muted);margin-bottom:6px;background:var(--bg);padding:4px 10px;border-radius:20px}
.service-entry .se-notes{font-size:.85rem;color:var(--text-muted);line-height:1.5}
.service-entry .se-photos{display:flex;gap:8px;margin-top:10px;overflow-x:auto;padding-bottom:4px}
.service-entry .se-photos img{width:60px;height:60px;border-radius:8px;object-fit:cover;flex-shrink:0;cursor:pointer;transition:transform .15s}
.service-entry .se-photos img:hover{transform:scale(1.05)}

/* FORM STYLES */
.form-group{margin-bottom:18px}
.form-group label{display:block;font-size:.85rem;font-weight:600;color:var(--text-muted);margin-bottom:8px;letter-spacing:.02em}
.form-group label .required{color:var(--danger);margin-left:2px}
.form-group input,.form-group textarea,.form-group select{width:100%;padding:14px 16px;background:var(--card);border:1px solid var(--border);border-radius:10px;font-size:.95rem;transition:border-color .2s,box-shadow .2s,background .15s}
.form-group input:hover,.form-group textarea:hover,.form-group select:hover{border-color:#d0c9c0}
.form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:var(--gold);box-shadow:0 0 0 3px var(--gold-soft);background:#fff}
.form-group input.error,.form-group textarea.error,.form-group select.error{border-color:var(--danger);background:#fff5f5}
.form-group input.error:focus,.form-group textarea.error:focus,.form-group select.error:focus{box-shadow:0 0 0 3px rgba(180,64,48,.15)}
.form-group textarea{resize:vertical;min-height:100px;line-height:1.5}
.form-group .help-text{font-size:.8rem;color:var(--text-muted);margin-top:6px}
.form-group .error-text{font-size:.8rem;color:var(--danger);margin-top:6px;display:flex;align-items:center;gap:4px}

/* CHECKBOXES */
.checkbox-row{display:flex;flex-wrap:wrap;gap:10px}
.checkbox-item{display:flex;align-items:center;gap:8px;padding:10px 14px;background:var(--bg);border:2px solid var(--border);border-radius:10px;cursor:pointer;transition:all .15s;font-size:.88rem;font-weight:500}
.checkbox-item:hover{border-color:#d0c9c0;background:#f5f3ef}
.checkbox-item.checked{background:var(--gold-soft);border-color:var(--gold);color:var(--text)}
.checkbox-item input{width:18px;height:18px;accent-color:var(--gold);cursor:pointer}
.checkbox-item:focus-within{border-color:var(--gold)}

/* CONDITION SLIDER */
.condition-slider{display:flex;align-items:center;gap:12px}
.condition-slider input[type="range"]{flex:1;-webkit-appearance:none;height:8px;background:var(--border);border-radius:4px;outline:none}
.condition-slider input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:24px;height:24px;background:var(--gold);border-radius:50%;cursor:pointer;box-shadow:0 2px 6px rgba(200,169,110,.4);transition:transform .15s}
.condition-slider input[type="range"]::-webkit-slider-thumb:hover{transform:scale(1.1)}
.condition-slider input[type="range"]::-moz-range-thumb{width:24px;height:24px;background:var(--gold);border-radius:50%;cursor:pointer;border:none;box-shadow:0 2px 6px rgba(200,169,110,.4)}
.condition-value{font-size:1.4rem;font-weight:700;color:var(--gold);min-width:32px;text-align:center;font-family:var(--font-head)}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 24px;border-radius:10px;font-weight:600;font-size:.95rem;cursor:pointer;transition:transform .15s,box-shadow .15s,background .15s;border:2px solid transparent;min-height:48px}
.btn:active{transform:scale(.97)}
.btn:focus-visible{outline:2px solid var(--gold);outline-offset:2px}
.btn--primary{background:var(--gold);color:#fff;box-shadow:0 2px 8px rgba(200,169,110,.3)}
.btn--primary:hover{background:#b89a5f;box-shadow:0 4px 16px rgba(200,169,110,.4)}
.btn--secondary{background:var(--bg);color:var(--text);border-color:var(--border)}
.btn--secondary:hover{background:var(--border)}
.btn--ghost{background:transparent;color:var(--text-muted);border-color:transparent}
.btn--ghost:hover{color:var(--text);background:var(--bg)}
.btn--danger{background:var(--danger);color:#fff}
.btn--danger:hover{background:#9a3528}
.btn--full{width:100%}
.btn--sm{padding:10px 16px;font-size:.85rem;min-height:40px}
.btn--disabled{opacity:.5;cursor:not-allowed;position:relative}
.btn--disabled::after{content:'Pro';position:absolute;top:-6px;right:-6px;background:var(--dark);color:#fff;font-size:.6rem;padding:3px 8px;border-radius:4px;font-weight:700}
.btn-group{display:flex;gap:10px}
.btn-group .btn{flex:1}

/* BOTTOM NAV */
.bottom-nav{position:fixed;bottom:60px;left:0;right:0;background:var(--card);border-top:1px solid var(--border);display:flex;z-index:100;box-shadow:0 -2px 12px rgba(0,0,0,.06);padding:6px 0}
.bottom-nav button{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;padding:10px 4px;background:none;cursor:pointer;color:var(--text-muted);transition:color .2s,border .15s;border:none;-webkit-tap-highlight-color:transparent;border-top:2px solid transparent;margin-top:-1px;position:relative}
.bottom-nav button.active{color:var(--gold);border-top-color:var(--gold)}
.bottom-nav button::after{content:'';position:absolute;top:-2px;left:50%;transform:translateX(-50%) scaleX(0);width:40%;height:2px;background:var(--gold);transition:transform .2s var(--ease-spring)}
.bottom-nav button.active::after{transform:translateX(-50%) scaleX(1)}
.bottom-nav button svg{width:22px;height:22px;transition:transform .15s}
.bottom-nav button:active svg{transform:scale(.9)}
.bottom-nav button span{font-size:.7rem;font-weight:600;letter-spacing:.02em}

/* FAB */
.fab{position:fixed;bottom:132px;right:20px;width:60px;height:60px;border-radius:50%;background:var(--gold);color:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 20px rgba(200,169,110,.5);cursor:pointer;z-index:99;transition:transform .2s var(--ease-spring),box-shadow .2s,background .15s;border:3px solid rgba(255,255,255,.2)}
.fab:hover{background:#b89a5f;transform:scale(1.08);box-shadow:0 6px 24px rgba(200,169,110,.6)}
.fab:active{transform:scale(.92)}
.fab:focus-visible{outline:3px solid var(--gold);outline-offset:3px}
.fab svg{width:26px;height:26px}
.fab .fab-label{position:absolute;right:68px;background:var(--dark);color:#fff;padding:6px 12px;border-radius:6px;font-size:.8rem;font-weight:600;white-space:nowrap;opacity:0;visibility:hidden;transform:translateX(8px);transition:all .2s}
.fab:hover .fab-label{opacity:1;visibility:visible;transform:translateX(0)}
@media(max-width:480px){.fab .fab-label{display:none}}

/* TOAST */
.toast-container{position:fixed;top:80px;left:50%;transform:translateX(-50%);z-index:200;pointer-events:none;display:flex;flex-direction:column;gap:8px}
.toast{background:var(--dark);color:#fff;padding:12px 20px;border-radius:10px;font-size:.9rem;font-weight:500;box-shadow:var(--shadow-lg);animation:toastIn .3s ease-out;pointer-events:auto;display:flex;align-items:center;gap:10px;max-width:90vw}
.toast.toast--success{background:var(--success)}
.toast.toast--error{background:var(--danger)}
.toast.toast--warning{background:var(--warning);color:var(--dark)}
@keyframes toastIn{from{opacity:0;transform:translate(-50%,-10px)}to{opacity:1;transform:translate(-50%,0)}}

/* DETAIL VIEW */
.detail-header{display:flex;align-items:center;gap:12px;margin-bottom:20px}
.back-btn{width:40px;height:40px;border-radius:50%;background:var(--bg);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s;flex-shrink:0;border:1px solid var(--border)}
.back-btn:hover{background:var(--border);transform:translateX(-2px)}
.back-btn:active{transform:scale(.95)}
.back-btn:focus-visible{outline:2px solid var(--gold);outline-offset:2px}
.detail-hero{background:var(--card);border-radius:var(--radius);padding:24px;margin-bottom:20px;box-shadow:var(--shadow);border:1px solid transparent;transition:border-color .15s}
.detail-hero:hover{border-color:var(--gold-soft)}
.detail-hero .piano-name{font-family:var(--font-head);font-size:1.4rem;margin-bottom:6px}
.detail-hero .client-detail{font-size:.9rem;color:var(--text-muted);margin-bottom:6px}
.detail-hero .status-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}

/* DUE METER */
.due-meter{height:8px;border-radius:4px;background:var(--border);overflow:hidden;margin-top:10px;position:relative}
.due-meter-fill{height:100%;border-radius:4px;transition:width .6s var(--ease-spring);position:relative}
.due-meter-fill::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);animation:shimmer 2s infinite}
@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}

/* SHARE REPORT */
.share-preview{background:var(--card);border-radius:var(--radius);padding:20px;border:1px dashed var(--border);margin-bottom:16px;font-family:monospace;font-size:.85rem;line-height:1.6;color:var(--text-muted);max-height:200px;overflow-y:auto}
.share-preview .report-line{padding:3px 0}

/* CAMERA */
.camera-area{position:relative;width:100%;max-width:400px;margin:0 auto 20px;border-radius:var(--radius);overflow:hidden;background:#111;box-shadow:var(--shadow-lg)}
.camera-area video{width:100%;display:block;border-radius:var(--radius)}
.camera-area canvas{display:none}
.camera-btn{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);width:68px;height:68px;border-radius:50%;background:rgba(255,255,255,.95);border:4px solid var(--gold);cursor:pointer;transition:transform .15s,box-shadow .15s;box-shadow:0 4px 12px rgba(0,0,0,.3)}
.camera-btn:hover{transform:translateX(-50%) scale(1.05);box-shadow:0 6px 20px rgba(0,0,0,.4)}
.camera-btn:active{transform:translateX(-50%) scale(.9)}
.camera-btn::after{content:'';position:absolute;inset:4px;background:var(--gold);border-radius:50%;opacity:.3;transition:opacity .15s}
.camera-btn:hover::after{opacity:.5}
.camera-close{position:absolute;top:12px;right:12px;width:36px;height:36px;background:rgba(0,0,0,.5);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;cursor:pointer;transition:background .15s;border:none}
.camera-close:hover{background:rgba(0,0,0,.7)}
.captured-photos{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:16px}
.captured-photos .cp-wrap{position:relative}
.captured-photos .cp-img{width:72px;height:72px;border-radius:8px;object-fit:cover;border:2px solid var(--border);transition:transform .15s}
.captured-photos .cp-img:hover{transform:scale(1.05);border-color:var(--gold)}
.captured-photos .cp-remove{position:absolute;top:-6px;right:-6px;width:20px;height:20px;background:var(--danger);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;cursor:pointer;border:2px solid #fff;transition:transform .15s}
.captured-photos .cp-remove:hover{transform:scale(1.1)}

/* STATS */
.stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px}
.stat-card{background:var(--card);border-radius:12px;padding:18px 14px;text-align:center;box-shadow:var(--shadow);transition:transform .15s,box-shadow .15s;border:1px solid transparent}
.stat-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg);border-color:var(--gold-soft)}
.stat-card .stat-num{font-family:var(--font-head);font-size:1.8rem;color:var(--gold);line-height:1}
.stat-card .stat-label{font-size:.75rem;color:var(--text-muted);margin-top:6px;font-weight:600}

/* SECTION HEADERS */
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.section-header h2{margin:0}
.section-header .count{font-size:.85rem;color:var(--text-muted);background:var(--bg);padding:4px 12px;border-radius:20px;font-weight:600}

/* CONFIRM DIALOG */
.confirm-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;visibility:hidden;transition:opacity .2s,visibility .2s;padding:20px}
.confirm-overlay.active{opacity:1;visibility:visible}
.confirm-dialog{background:var(--card);border-radius:var(--radius);padding:24px;max-width:360px;width:100%;box-shadow:var(--shadow-lg);animation:dialogIn .2s var(--ease-spring)}
@keyframes dialogIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.confirm-dialog h3{font-family:var(--font-body);font-size:1.1rem;margin-bottom:8px}
.confirm-dialog p{font-size:.9rem;color:var(--text-muted);margin-bottom:20px;line-height:1.5}
.confirm-dialog .btn-group{margin-top:0}

/* REDUCED MOTION */
@media(prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:.01ms!important;transition-duration:.01ms!important}}

/* PRINT */
@media print{
.bottom-nav,.fab,.demo-banner,.app-header,.back-btn,#bct-demo-disclaimer,.confirm-overlay{display:none!important}
body{padding-bottom:80px;background:#fff;padding:0}
.view{display:block!important;padding:0}
.piano-card{box-shadow:none;border:1px solid #ddd;break-inside:avoid}
}

/* DESKTOP */
@media(min-width:768px){
.view{max-width:640px;margin:0 auto;padding:28px}
.bottom-nav{max-width:640px;left:50%;transform:translateX(-50%);border-radius:16px 16px 0 0}
.fab{right:calc(50% - 300px)}
}

/* MOBILE OPTIMIZATIONS */
@media(max-width:480px){
.view{padding:14px}
.stats-row{gap:8px}
.stat-card{padding:14px 10px}
.stat-card .stat-num{font-size:1.5rem}
.checkbox-row{gap:8px}
.checkbox-item{padding:8px 12px;font-size:.85rem}
}
</style>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>

<header class="app-header" role="banner">
<h1>PianoLog</h1>
<div class="subtitle">Stay Tuned Piano Services</div>
</header>

<div class="demo-banner" id="demoBanner" role="status" aria-label="Demo data notice" style="display:none">
<p>Sample data loaded. Tap Clear to start fresh with your own pianos.</p>
<button onclick="confirmClearDemo()" aria-label="Clear demo data">Clear Demo</button>
</div>

<div aria-live="polite" class="toast-container" id="toastContainer"></div>

<main id="main-content">
<!-- PIANOS LIST -->
<section class="view active" id="viewPianos" role="region" aria-label="Piano list">
<div class="search-bar">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
<input type="text" id="searchInput" placeholder="Search by client name, piano make, or neighborhood..." aria-label="Search pianos" autocomplete="off">
<button class="search-clear" id="searchClear" onclick="clearSearch()" aria-label="Clear search">
<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
</button>
</div>
<div id="pianoList">
<div class="skeleton" style="height:100px;margin-bottom:12px"></div>
<div class="skeleton" style="height:100px;margin-bottom:12px"></div>
<div class="skeleton" style="height:100px;margin-bottom:12px"></div>
</div>
</section>

<!-- PIANO DETAIL -->
<section class="view" id="viewDetail" role="region" aria-label="Piano detail">
<div class="detail-header">
<button class="back-btn" onclick="showView('viewPianos')" aria-label="Back to piano list">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
</button>
<h2 id="detailTitle">Piano Detail</h2>
</div>
<div id="detailContent">
<div class="skeleton" style="height:200px;margin-bottom:16px"></div>
<div class="skeleton" style="height:120px"></div>
</div>
</section>

<!-- ADD/EDIT PIANO -->
<section class="view" id="viewAddPiano" role="region" aria-label="Add piano">
<div class="detail-header">
<button class="back-btn" onclick="showView('viewPianos')" aria-label="Back to piano list">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
</button>
<h2 id="addPianoTitle">Add New Piano</h2>
</div>
<form id="pianoForm" onsubmit="savePiano(event)" novalidate>
<div class="form-group">
<label for="pf-client">Client Name <span class="required">*</span></label>
<input type="text" id="pf-client" required autocomplete="name" placeholder="e.g., Sarah Johnson">
<span class="error-text" id="pf-client-error" role="alert" style="display:none">Please enter the client's name</span>
</div>
<div class="form-group">
<label for="pf-address">Address / Neighborhood</label>
<input type="text" id="pf-address" autocomplete="address-line1" placeholder="e.g., 123 Oak St, Austin, TX">
<span class="help-text">Helps you remember where each piano lives</span>
</div>
<div class="form-group">
<label for="pf-phone">Phone Number</label>
<input type="tel" id="pf-phone" autocomplete="tel" placeholder="(512) 555-0123">
</div>
<div class="form-group">
<label for="pf-make">Piano Make</label>
<input type="text" id="pf-make" placeholder="e.g., Yamaha, Steinway, Kawai, Baldwin">
</div>
<div class="form-group">
<label for="pf-model">Model / Size</label>
<input type="text" id="pf-model" placeholder="e.g., C3 Grand, U1 Upright, Baby Grand">
</div>
<div class="form-group">
<label for="pf-year">Year (approximate)</label>
<input type="text" id="pf-year" placeholder="e.g., 1985 or Unknown">
</div>
<div class="form-group">
<label for="pf-notes">Notes</label>
<textarea id="pf-notes" placeholder="Parking tips, access codes, quirks about this piano, family members who play, etc..."></textarea>
<span class="help-text">Any details worth remembering when you return</span>
</div>
<input type="hidden" id="pf-id">
<div class="btn-group">
<button type="button" class="btn btn--secondary" onclick="showView('viewPianos')">Cancel</button>
<button type="submit" class="btn btn--primary btn--full" id="savePianoBtn">Save Piano</button>
</div>
</form>
</section>

<!-- LOG SERVICE -->
<section class="view" id="viewLogService" role="region" aria-label="Log service visit">
<div class="detail-header">
<button class="back-btn" onclick="showDetail(currentPianoId)" aria-label="Back to piano details">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
</button>
<h2>Log Service Visit</h2>
</div>
<form id="serviceForm" onsubmit="saveService(event)" novalidate>
<div class="form-group">
<label for="sf-date">Service Date <span class="required">*</span></label>
<input type="date" id="sf-date" required>
</div>
<div class="form-group">
<label>Work Performed</label>
<div class="checkbox-row" id="workChecks">
<label class="checkbox-item"><input type="checkbox" value="Tuning"> Tuning</label>
<label class="checkbox-item"><input type="checkbox" value="Voicing"> Voicing</label>
<label class="checkbox-item"><input type="checkbox" value="Regulation"> Regulation</label>
<label class="checkbox-item"><input type="checkbox" value="String Repair"> String Repair</label>
<label class="checkbox-item"><input type="checkbox" value="Pedal Repair"> Pedal Repair</label>
<label class="checkbox-item"><input type="checkbox" value="Deep Clean"> Deep Clean</label>
<label class="checkbox-item"><input type="checkbox" value="Evaluation"> Evaluation</label>
<label class="checkbox-item"><input type="checkbox" value="Action Repair"> Action Repair</label>
</div>
</div>
<div class="form-group">
<label for="sf-condition">Overall Condition (1-10)</label>
<div class="condition-slider">
<input type="range" id="sf-condition" min="1" max="10" value="5" oninput="updateConditionLabel(this.value)">
<span class="condition-value" id="conditionLabel">5</span>
</div>
<span class="help-text" id="conditionHelp">5 = Decent shape, some wear but stable</span>
</div>
<div class="form-group">
<label for="sf-notes">Service Notes</label>
<textarea id="sf-notes" placeholder="What you found, what you fixed, and what needs attention next time. Be specific - your future self will thank you."></textarea>
</div>
<div class="form-group">
<label for="sf-next">Next Service Due</label>
<input type="date" id="sf-next">
<span class="help-text">When should this piano be tuned again? (Usually 6-12 months)</span>
</div>

<!-- Camera -->
<div class="form-group">
<label>Photos</label>
<div class="captured-photos" id="capturedPhotos"></div>
<button type="button" class="btn btn--secondary btn--full" onclick="openCamera()" aria-label="Take a photo">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
Take Photo
</button>
<span class="help-text">Document condition, serial numbers, or issues you spot</span>
</div>

<div class="camera-area" id="cameraArea" style="display:none" role="dialog" aria-modal="true" aria-label="Camera" tabindex="-1">
<video id="cameraVideo" autoplay playsinline></video>
<canvas id="cameraCanvas"></canvas>
<button type="button" class="camera-close" onclick="closeCamera()" aria-label="Close camera">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
</button>
<button type="button" class="camera-btn" onclick="capturePhoto()" aria-label="Capture photo"></button>
</div>

<div class="btn-group" style="margin-top:8px">
<button type="button" class="btn btn--secondary" onclick="showDetail(currentPianoId)">Cancel</button>
<button type="submit" class="btn btn--primary btn--full" id="saveServiceBtn">Save Service Log</button>
</div>
</form>
</section>

<!-- OVERVIEW / STATS -->
<section class="view" id="viewOverview" role="region" aria-label="Overview">
<div class="section-header">
<h2>Dashboard</h2>
<span class="count" id="totalCount">0 pianos</span>
</div>
<div class="stats-row" id="statsRow">
<div class="stat-card"><div class="stat-num">-</div><div class="stat-label">Loading...</div></div>
<div class="stat-card"><div class="stat-num">-</div><div class="stat-label">Loading...</div></div>
<div class="stat-card"><div class="stat-num">-</div><div class="stat-label">Loading...</div></div>
</div>
<div class="section-header">
<h3>Needs Attention</h3>
</div>
<div id="attentionList">
<div class="skeleton" style="height:80px"></div>
</div>
</section>

<!-- SETTINGS -->
<section class="view" id="viewSettings" role="region" aria-label="Settings">
<h2 style="margin-bottom:20px">Settings</h2>
<div style="display:flex;flex-direction:column;gap:12px">
<button class="btn btn--secondary btn--full" onclick="exportData()" aria-label="Export data as JSON">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
Export Your Data (JSON)
</button>
<button class="btn btn--secondary btn--full" onclick="document.getElementById('importFile').click()" aria-label="Import data from JSON">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
Import Data (JSON)
</button>
<input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
<button class="btn btn--disabled btn--full" aria-label="Generate PDF report, available in full version" disabled>
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
Generate PDF Reports
</button>
<button class="btn btn--disabled btn--full" aria-label="Automatic reminders, available in full version" disabled>
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
Automatic Client Reminders
</button>
</div>
<div style="margin-top:32px;padding-top:24px;border-top:1px solid var(--border)">
<p style="font-size:.85rem;color:var(--text-muted);margin-bottom:8px">About PianoLog</p>
<p style="font-size:.8rem;color:var(--text-muted);line-height:1.6">Built for piano technicians who need their records at their fingertips. No paper, no spreadsheets, no fuss.</p>
</div>
</section>
</main>

<!-- FAB -->
<button class="fab" id="fab" onclick="showAddPiano()" aria-label="Add new piano">
<svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
<span class="fab-label">Add Piano</span>
</button>

<!-- BOTTOM NAV -->
<nav class="bottom-nav" role="navigation" aria-label="Main navigation">
<button onclick="showView('viewPianos')" id="navPianos" class="active" aria-label="Pianos list">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M7 7V5a2 2 0 012-2h6a2 2 0 012 2v2"/><path d="M8 14h1m2 0h2m2 0h1"/><path d="M8 18h8"/></svg>
<span>Pianos</span>
</button>
<button onclick="showView('viewOverview')" id="navOverview" aria-label="Dashboard overview">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M18 20V10"/><path d="M12 20V4"/><path d="M6 20v-6"/></svg>
<span>Overview</span>
</button>
<button onclick="showView('viewSettings')" id="navSettings" aria-label="Settings">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
<span>Settings</span>
</button>
</nav>

<!-- CONFIRM DIALOG -->
<div class="confirm-overlay" id="confirmDialog" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
<div class="confirm-dialog">
<h3 id="confirmTitle">Clear Demo Data?</h3>
<p>This will remove all sample pianos and service records. You cannot undo this.</p>
<div class="btn-group">
<button class="btn btn--secondary" onclick="closeConfirmDialog()">Keep Data</button>
<button class="btn btn--danger" onclick="executeClearDemo()">Clear Demo</button>
</div>
</div>
</div>

<!-- DEMO DISCLAIMER -->
<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo information" style="position:fixed;bottom:0;left:0;right:0;background:linear-gradient(to right,#f8f9fa,#fff);border-top:1px solid #e9ecef;padding:8px 16px;font-size:11px;line-height:1.4;color:#6c757d;z-index:99999;display:flex;align-items:center;justify-content:space-between;gap:12px;min-height:36px;">
<p style="margin:0;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><strong style="color:#495057;font-weight:600;">Demo:</strong> Created by BennyCuTools for demonstration. Not affiliated with Stay Tuned Piano Services.</p>
<div style="display:flex;align-items:center;gap:12px;flex-shrink:0;">
<a href="https://bennycutools.com" target="_blank" rel="noopener" style="color:#6c757d;text-decoration:underline;text-underline-offset:2px;white-space:nowrap;">Learn more</a>
<a href="mailto:cuuper225@gmail.com?subject=Remove%20Demo%3A%20Stay%20Tuned%20Piano%20Services&body=I%20am%20the%20owner%20and%20request%20removal%20of%20this%20demo." style="color:#adb5bd;text-decoration:underline;text-underline-offset:2px;white-space:nowrap;font-size:10px;">Remove</a>
</div>
</div>

<script>
// ACCESS KEY GATE
function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
const _V=-1736152011;
const _k=new URLSearchParams(window.location.search).get('key');
if(_k&&_h(_k)===_V){sessionStorage.setItem('pl_auth','1')}
if(!sessionStorage.getItem('pl_auth')){
document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;background:#2b2b2b;color:#fff;text-align:center;padding:20px"><div><h1 style="font-size:1.8rem;margin-bottom:1rem;font-family:Playfair Display,serif">PianoLog</h1><p style="color:#999;margin-bottom:1.5rem">This tool requires a valid access key.</p><input id="keyIn" type="text" placeholder="Enter access key" style="padding:12px 16px;border-radius:8px;border:1px solid #555;background:#333;color:#fff;font-size:1rem;width:220px;text-align:center" autocomplete="off"><br><button onclick="var k=document.getElementById(\'keyIn\').value;if(_h(k)===_V){sessionStorage.setItem(\'pl_auth\',\'1\');location.reload();}else{document.getElementById(\'keyErr\').style.display=\'block\'}" style="margin-top:12px;padding:10px 24px;background:#c8a96e;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600">Enter</button><p id="keyErr" style="color:#b44030;margin-top:8px;display:none;font-size:.85rem">Invalid key. Contact ben@bennycutools.com</p></div></div><div id="bct-demo-disclaimer" role="contentinfo" style="position:fixed;bottom:0;left:0;right:0;background:linear-gradient(to right,#f8f9fa,#fff);border-top:1px solid #e9ecef;padding:8px 16px;font-size:11px;line-height:1.4;color:#6c757d;z-index:99999;display:flex;align-items:center;justify-content:center;gap:12px;min-height:36px;"><p style="margin:0;"><strong style="color:#495057;font-weight:600;">Demo:</strong> Created by BennyCuTools. Not affiliated with Stay Tuned Piano Services.</p></div>';
throw new Error('Auth required');
}

// ANTI-SCRAPE
document.addEventListener('contextmenu',e=>e.preventDefault());

// DATABASE
const DB_NAME='PianoLogDB';const DB_VER=1;let db;
function openDB(){return new Promise((res,rej)=>{const r=indexedDB.open(DB_NAME,DB_VER);r.onupgradeneeded=e=>{const d=e.target.result;if(!d.objectStoreNames.contains('pianos')){const s=d.createObjectStore('pianos',{keyPath:'id'});s.createIndex('client','client',{unique:false})}if(!d.objectStoreNames.contains('services')){const s=d.createObjectStore('services',{keyPath:'id'});s.createIndex('pianoId','pianoId',{unique:false})}};r.onsuccess=e=>{db=e.target.result;res(db)};r.onerror=e=>rej(e)})}

function dbPut(store,data){return new Promise((res,rej)=>{const tx=db.transaction(store,'readwrite');tx.objectStore(store).put(data);tx.oncomplete=()=>res();tx.onerror=e=>rej(e)})}
function dbGetAll(store){return new Promise((res,rej)=>{const tx=db.transaction(store,'readonly');const r=tx.objectStore(store).getAll();r.onsuccess=()=>res(r.result);r.onerror=e=>rej(e)})}
function dbGet(store,key){return new Promise((res,rej)=>{const tx=db.transaction(store,'readonly');const r=tx.objectStore(store).get(key);r.onsuccess=()=>res(r.result);r.onerror=e=>rej(e)})}
function dbDelete(store,key){return new Promise((res,rej)=>{const tx=db.transaction(store,'readwrite');tx.objectStore(store).delete(key);tx.oncomplete=()=>res();tx.onerror=e=>rej(e)})}
function dbGetByIndex(store,idx,val){return new Promise((res,rej)=>{const tx=db.transaction(store,'readonly');const r=tx.objectStore(store).index(idx).getAll(val);r.onsuccess=()=>res(r.result);r.onerror=e=>rej(e)})}

// STATE
let allPianos=[];let allServices=[];let currentPianoId=null;let capturedImages=[];let cameraStream=null;

// CONDITION LABELS
const conditionLabels={
1:'Critical - Major issues need immediate attention',
2:'Poor - Significant problems affecting playability',
3:'Fair - Several issues, needs work soon',
4:'Below average - Some problems, not urgent',
5:'Decent - Wear and tear, but stable',
6:'Good - Minor issues, holding up well',
7:'Very good - Small tweaks needed',
8:'Great - Solid condition, minimal concerns',
9:'Excellent - Nearly perfect shape',
10:'Pristine - Like new, exceptional condition'
};

function updateConditionLabel(val){document.getElementById('conditionLabel').textContent=val;document.getElementById('conditionHelp').textContent=conditionLabels[val]||'';}

// DEMO DATA
const DEMO_PIANOS=[
{id:'demo-1',client:'Margaret Chen',address:'Lake Oswego, OR',phone:'503-555-0142',make:'Yamaha',model:'C3 Grand',year:'2008',notes:'Beautiful grand in the living room. Margaret plays daily. Husband is a violinist.',isDemo:true,created:Date.now()},
{id:'demo-2',client:'First Presbyterian Church',address:'Beaverton, OR',phone:'503-555-0198',make:'Baldwin',model:'Concert Grand 9ft',year:'1972',notes:'Stage piano in the sanctuary. Heavy use for Sunday services and choir practice.',isDemo:true,created:Date.now()},
{id:'demo-3',client:'David Park',address:'Tigard, OR',phone:'503-555-0231',make:'Kawai',model:'K-300 Upright',year:'2019',notes:"Newer upright. David's daughter is taking lessons. Keep humidity controlled.",isDemo:true,created:Date.now()},
{id:'demo-4',client:'Rose Villa Senior Living',address:'Milwaukie, OR',phone:'503-555-0315',make:'Yamaha',model:'GB1K Baby Grand',year:'2015',notes:'Common area piano. Played by several residents. Needs 6-month visits.',isDemo:true,created:Date.now()}
];
const DEMO_SERVICES=[
{id:'ds-1',pianoId:'demo-1',date:'2025-11-15',work:['Tuning','Voicing'],condition:8,notes:'G#4 string showing wear. Recommend replacement at next visit. Hammers in decent shape.',nextDue:'2026-09-15',photos:[],isDemo:true},
{id:'ds-2',pianoId:'demo-1',date:'2025-05-10',work:['Tuning','Evaluation'],condition:7,notes:"First visit. Pitch was 15 cents flat. Action sluggish in upper register.",nextDue:'2025-11-10',photos:[],isDemo:true},
{id:'ds-3',pianoId:'demo-2',date:'2026-01-08',work:['Tuning','Regulation','Pedal Repair'],condition:6,notes:'Soft pedal felt replaced. Action regulation in middle octaves.',nextDue:'2026-07-08',photos:[],isDemo:true},
{id:'ds-4',pianoId:'demo-3',date:'2026-02-01',work:['Tuning'],condition:9,notes:'Quick tuning, holds pitch well. Only 2 years old.',nextDue:'2027-02-01',photos:[],isDemo:true},
{id:'ds-5',pianoId:'demo-4',date:'2025-12-20',work:['Tuning','Deep Clean','Voicing'],condition:5,notes:'Heavy use piano. Full deep clean took 3 hours. Hammers compacted.',nextDue:'2026-06-20',photos:[],isDemo:true}
];

async function loadDemoData(){
if(localStorage.getItem('pl_demoCleared'))return;
const pianos=await dbGetAll('pianos');
if(pianos.length>0)return;
for(const p of DEMO_PIANOS)await dbPut('pianos',p);
for(const s of DEMO_SERVICES)await dbPut('services',s);
localStorage.setItem('pl_hasDemo','1');
}

// CONFIRM DIALOG
let confirmCallback=null;
function showConfirmDialog(title,text,callback,confirmText='Confirm',confirmClass='btn--danger'){
document.getElementById('confirmTitle').textContent=title;
document.querySelector('.confirm-dialog p').textContent=text;
const btn=document.querySelector('.confirm-dialog .btn--danger');
btn.textContent=confirmText;
btn.className='btn '+confirmClass;
confirmCallback=callback;
document.getElementById('confirmDialog').classList.add('active');
}
function closeConfirmDialog(){document.getElementById('confirmDialog').classList.remove('active');confirmCallback=null;}
function executeClearDemo(){if(confirmCallback)confirmCallback();}

async function confirmClearDemo(){
showConfirmDialog('Clear Demo Data?','This removes all sample pianos and service records. Your own data stays untouched.',async()=>{
await clearDemoData();
closeConfirmDialog();
},'Clear Demo');
}

async function clearDemoData(){
try{
const pianos=await dbGetAll('pianos');
const services=await dbGetAll('services');
for(const p of pianos){if(p.isDemo)await dbDelete('pianos',p.id)}
for(const s of services){if(s.isDemo)await dbDelete('services',s.id)}
localStorage.removeItem('pl_hasDemo');
localStorage.setItem('pl_demoCleared','1');
document.getElementById('demoBanner').style.display='none';
await refreshData();
showToast('Demo data cleared','success');
}catch(e){showToast('Could not clear demo data','error');}
}

// RENDER
function getDueStatus(dateStr){
if(!dateStr)return{label:'Schedule first visit',cls:'badge--overdue',pct:100,urgent:true};
const due=new Date(dateStr);const now=new Date();
const diff=Math.floor((due-now)/(1000*60*60*24));
if(diff<0)return{label:`Overdue by ${Math.abs(diff)} days`,cls:'badge--overdue',pct:100,urgent:true};
if(diff<=14)return{label:`Due in ${diff} days`,cls:'badge--soon',pct:85,urgent:true};
if(diff<=30)return{label:`Due in ${diff} days`,cls:'badge--soon',pct:60,urgent:false};
if(diff<=90)return{label:`Due in ${Math.floor(diff/7)} weeks`,cls:'badge--due',pct:40,urgent:false};
return{label:`Due ${due.toLocaleDateString('en-US',{month:'short',day:'numeric'})}`,cls:'badge--due',pct:20,urgent:false};
}

function renderPianoCard(piano,latestService){
const due=latestService?getDueStatus(latestService.nextDue):getDueStatus(null);
const lastDate=latestService?new Date(latestService.date).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}):'No visits yet';
return`<article class="piano-card" onclick="showDetail('${piano.id}')" onkeydown="if(event.key==='Enter'||event.key===' ')showDetail('${piano.id}')" role="button" tabindex="0" aria-label="View details for ${piano.client}'s ${piano.make||''} ${piano.model||''}">
<div class="piano-card-inner">
<div class="piano-thumb"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M7 4v16"/><path d="M12 4v16"/><path d="M17 4v16"/><rect x="6" y="4" width="3" height="10" rx=".5" fill="currentColor" opacity=".15"/><rect x="11" y="4" width="3" height="10" rx=".5" fill="currentColor" opacity=".15"/><rect x="16" y="4" width="3" height="10" rx=".5" fill="currentColor" opacity=".15"/></svg></div>
<div class="piano-info">
<div class="client-name">${escapeHtml(piano.client)}</div>
<div class="piano-model">${escapeHtml(piano.make)||''} ${escapeHtml(piano.model)||''}</div>
<div class="meta-row">
<span class="meta-item"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>${escapeHtml(piano.address)||'No address'}</span>
<span class="meta-item"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/></svg>${lastDate}</span>
</div>
${due.cls?`<span class="badge ${due.cls}" style="margin-top:8px">${due.label}</span>`:''}
</div>
<svg class="arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="9 18 15 12 9 6"/></svg>
</div>
</article>`;
}

function escapeHtml(text){if(!text)return'';return text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

async function refreshData(){
try{
allPianos=await dbGetAll('pianos');
allServices=await dbGetAll('services');
renderPianoList();
if(localStorage.getItem('pl_hasDemo')&&!localStorage.getItem('pl_demoCleared')){
document.getElementById('demoBanner').style.display='flex';
}
}catch(e){showToast('Failed to load data','error');}
}

function renderPianoList(filter=''){
const list=document.getElementById('pianoList');
const f=filter.toLowerCase().trim();
let sorted=[...allPianos].sort((a,b)=>{
const sa=allServices.filter(s=>s.pianoId===a.id).sort((x,y)=>new Date(y.date)-new Date(x.date))[0];
const sb=allServices.filter(s=>s.pianoId===b.id).sort((x,y)=>new Date(y.date)-new Date(x.date))[0];
if(!sa)return 1;if(!sb)return-1;
const da=sa.nextDue?new Date(sa.nextDue):new Date('2099-01-01');
const dbn=sb.nextDue?new Date(sb.nextDue):new Date('2099-01-01');
return da-dbn;
});
if(f){sorted=sorted.filter(p=>(p.client+' '+p.make+' '+p.model+' '+p.address+' '+(p.notes||'')).toLowerCase().includes(f))}
if(sorted.length===0){
if(f){
list.innerHTML=`<div class="empty-state">
<div class="empty-state-icon"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div>
<h3>No matches found</h3>
<p>Try a different search term or check your spelling.</p>
<button class="btn btn--secondary btn--sm" onclick="clearSearch()">Clear Search</button>
</div>`;
}else{
list.innerHTML=`<div class="empty-state">
<div class="empty-state-icon"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M7 4v16"/><path d="M12 4v16"/><path d="M17 4v16"/></svg></div>
<h3>No pianos yet</h3>
<p>Add your first client piano to start tracking service history.</p>
<button class="btn btn--primary" onclick="showAddPiano()">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
Add Your First Piano
</button>
</div>`;
}
return;
}
list.innerHTML=sorted.map(p=>{
const svcs=allServices.filter(s=>s.pianoId===p.id).sort((a,b)=>new Date(b.date)-new Date(a.date));
return renderPianoCard(p,svcs[0]);
}).join('');
}

// SEARCH
document.getElementById('searchInput').addEventListener('input',e=>{
const val=e.target.value;
document.getElementById('searchClear').classList.toggle('visible',val.length>0);
renderPianoList(val);
});
function clearSearch(){
document.getElementById('searchInput').value='';
document.getElementById('searchClear').classList.remove('visible');
renderPianoList();
document.getElementById('searchInput').focus();
}

// DETAIL VIEW
async function showDetail(id){
currentPianoId=id;
const piano=await dbGet('pianos',id);
if(!piano){showToast('Piano not found','error');return;}
const services=(await dbGetByIndex('services','pianoId',id)).sort((a,b)=>new Date(b.date)-new Date(a.date));
const latestDue=services[0]?getDueStatus(services[0].nextDue):null;
document.getElementById('detailTitle').textContent=escapeHtml(piano.client);

let html=`<div class="detail-hero">
<div class="piano-name">${escapeHtml(piano.make)||''} ${escapeHtml(piano.model)||''}</div>
<div class="client-detail">${escapeHtml(piano.address)||'No address on file'} ${piano.year?'| Built '+escapeHtml(piano.year):''}</div>
${piano.phone?`<div class="client-detail" style="margin-top:4px">${formatPhone(piano.phone)}</div>`:''}
${piano.notes?`<div style="font-size:.88rem;color:var(--text-muted);margin-top:12px;padding-top:12px;border-top:1px solid var(--border);line-height:1.5">${escapeHtml(piano.notes)}</div>`:''}
${latestDue&&latestDue.cls?`<div style="margin-top:16px"><span class="badge ${latestDue.cls}">${latestDue.label}</span>
<div class="due-meter" aria-hidden="true"><div class="due-meter-fill" style="width:${latestDue.pct}%;background:${latestDue.cls.includes('overdue')?'var(--danger)':latestDue.cls.includes('soon')?'var(--warning)':'var(--success)'}" role="progressbar" aria-valuenow="${latestDue.pct}" aria-valuemin="0" aria-valuemax="100"></div></div></div>`:''}
<div style="display:flex;gap:10px;margin-top:18px;flex-wrap:wrap">
<button class="btn btn--primary" onclick="showLogService('${id}')">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
Log Visit
</button>
<button class="btn btn--secondary" onclick="shareReport('${id}')">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
Share Report
</button>
<button class="btn btn--secondary" onclick="editPiano('${id}')">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
Edit
</button>
</div>
</div>`;

html+=`<div class="section-header"><h3>Service History</h3><span class="count">${services.length} visit${services.length!==1?'s':''}</span></div>`;
if(services.length===0){
html+=`<div class="empty-state" style="padding:32px 20px">
<p style="margin-bottom:16px">No service visits recorded yet.</p>
<button class="btn btn--primary btn--sm" onclick="showLogService('${id}')">Log Your First Visit</button>
</div>`;
}else{
services.forEach(s=>{
const dt=new Date(s.date).toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});
html+=`<div class="service-entry">
<div class="se-date">${dt}</div>
<div class="se-type">${(s.work||[]).join(', ')||'Service visit'}</div>
${s.condition?`<div class="se-condition"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg> Condition: ${s.condition}/10</div>`:''}
${s.notes?`<div class="se-notes">${escapeHtml(s.notes)}</div>`:''}
${s.photos&&s.photos.length?`<div class="se-photos">${s.photos.map((p,i)=>`<img src="${p}" alt="Service photo ${i+1}" loading="lazy" onclick="viewPhoto('${p}')">`).join('')}</div>`:''}
</div>`;
});
}
document.getElementById('detailContent').innerHTML=html;
showView('viewDetail');
}

function formatPhone(phone){if(!phone)return'';const cleaned=phone.replace(/\D/g,'');if(cleaned.length===10){return`(${cleaned.slice(0,3)}) ${cleaned.slice(3,6)}-${cleaned.slice(6)}`;}return phone;}

// PHOTO VIEWER
function viewPhoto(src){
const overlay=document.createElement('div');
overlay.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;align-items:center;justify-content:center;z-index:10000;cursor:zoom-out;animation:fadeIn .2s';
overlay.innerHTML=`<img src="${src}" style="max-width:90%;max-height:90%;object-fit:contain;border-radius:8px;box-shadow:0 20px 60px rgba(0,0,0,.5)" alt="Enlarged photo">`;
overlay.onclick=()=>overlay.remove();
document.body.appendChild(overlay);
}

// SHARE REPORT
async function shareReport(pianoId){
const piano=await dbGet('pianos',pianoId);
const services=(await dbGetByIndex('services','pianoId',pianoId)).sort((a,b)=>new Date(b.date)-new Date(a.date));
const latest=services[0];
let text=`Piano Service Report\n${piano.client} - ${piano.make||''} ${piano.model||''}\n`;
text+=`Location: ${piano.address||'N/A'}\n\n`;
if(latest){
text+=`Last Service: ${new Date(latest.date).toLocaleDateString()}\n`;
text+=`Work: ${(latest.work||[]).join(', ')}\n`;
text+=`Condition: ${latest.condition||'N/A'}/10\n`;
if(latest.notes)text+=`Notes: ${latest.notes}\n`;
if(latest.nextDue)text+=`Next Service: ${new Date(latest.nextDue).toLocaleDateString()}\n`;
}
text+=`\n-- Stay Tuned Piano Services | Ben Wasson | (503) 419-8547`;

if(navigator.share){
try{await navigator.share({title:'Piano Service Report - '+piano.client,text:text});showToast('Report shared','success');}catch(e){if(e.name!=='AbortError')fallbackCopy(text)}
}else{fallbackCopy(text)}
}
function fallbackCopy(text){
navigator.clipboard.writeText(text).then(()=>showToast('Report copied to clipboard','success')).catch(()=>showToast('Could not copy report','error'));
}

// CAMERA
let cameraActive=false;
async function openCamera(){
const area=document.getElementById('cameraArea');
if(cameraActive){closeCamera();return}
try{
cameraStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment',width:{ideal:1280},height:{ideal:720}}});
document.getElementById('cameraVideo').srcObject=cameraStream;
area.style.display='block';cameraActive=true;
area.focus();
}catch(e){showToast('Camera not available. Check permissions or use upload instead.','error');}
}
function closeCamera(){
if(cameraStream){cameraStream.getTracks().forEach(t=>t.stop());cameraStream=null}
document.getElementById('cameraArea').style.display='none';cameraActive=false;
}
function capturePhoto(){
const video=document.getElementById('cameraVideo');
const canvas=document.getElementById('cameraCanvas');
canvas.width=video.videoWidth;canvas.height=video.videoHeight;
canvas.getContext('2d').drawImage(video,0,0);
const dataUrl=canvas.toDataURL('image/jpeg',0.7);
capturedImages.push(dataUrl);
renderCapturedPhotos();
showToast('Photo captured','success');
}
function removePhoto(idx){capturedImages.splice(idx,1);renderCapturedPhotos();}
function renderCapturedPhotos(){
const c=document.getElementById('capturedPhotos');
if(capturedImages.length===0){c.innerHTML='';return;}
c.innerHTML=capturedImages.map((img,i)=>`<div class="cp-wrap"><img src="${img}" class="cp-img" alt="Captured photo ${i+1}"><button type="button" class="cp-remove" onclick="removePhoto(${i})" aria-label="Remove photo ${i+1}"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" width="12" height="12"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>`).join('');
}

// FORMS
function showAddPiano(){
document.getElementById('pianoForm').reset();
document.getElementById('pf-id').value='';
document.getElementById('addPianoTitle').textContent='Add New Piano';
document.getElementById('pf-client').focus();
showView('viewAddPiano');
}
async function editPiano(id){
const p=await dbGet('pianos',id);
if(!p){showToast('Piano not found','error');return;}
document.getElementById('pf-id').value=p.id;
document.getElementById('pf-client').value=p.client||'';
document.getElementById('pf-address').value=p.address||'';
document.getElementById('pf-phone').value=p.phone||'';
document.getElementById('pf-make').value=p.make||'';
document.getElementById('pf-model').value=p.model||'';
document.getElementById('pf-year').value=p.year||'';
document.getElementById('pf-notes').value=p.notes||'';
document.getElementById('addPianoTitle').textContent='Edit Piano';
showView('viewAddPiano');
}
async function savePiano(e){
e.preventDefault();
const btn=document.getElementById('savePianoBtn');
const clientInput=document.getElementById('pf-client');
const clientError=document.getElementById('pf-client-error');

// Validation
if(!clientInput.value.trim()){
clientInput.classList.add('error');
clientError.style.display='flex';
clientInput.focus();
showToast('Please enter a client name','error');
return;
}
clientInput.classList.remove('error');
clientError.style.display='none';

btn.classList.add('btn--loading');
try{
const id=document.getElementById('pf-id').value||'piano-'+Date.now();
const piano={
id,client:clientInput.value.trim(),address:document.getElementById('pf-address').value.trim(),
phone:document.getElementById('pf-phone').value.trim(),make:document.getElementById('pf-make').value.trim(),
model:document.getElementById('pf-model').value.trim(),year:document.getElementById('pf-year').value.trim(),
notes:document.getElementById('pf-notes').value.trim(),created:Date.now()
};
await dbPut('pianos',piano);
await refreshData();
showToast(document.getElementById('pf-id').value?'Piano updated':'Piano added','success');
showView('viewPianos');
}catch(err){showToast('Failed to save piano','error');}
finally{btn.classList.remove('btn--loading');}
}

function showLogService(pianoId){
currentPianoId=pianoId;
document.getElementById('serviceForm').reset();
document.getElementById('sf-date').value=new Date().toISOString().split('T')[0];
const nextDate=new Date();nextDate.setMonth(nextDate.getMonth()+10);
document.getElementById('sf-next').value=nextDate.toISOString().split('T')[0];
updateConditionLabel(5);
capturedImages=[];renderCapturedPhotos();
document.querySelectorAll('#workChecks input').forEach(cb=>{cb.checked=false;cb.closest('.checkbox-item').classList.remove('checked')});
document.getElementById('sf-date').focus();
showView('viewLogService');
}
// Toggle checkbox styling
document.querySelectorAll('#workChecks input').forEach(cb=>{
cb.addEventListener('change',()=>{cb.closest('.checkbox-item').classList.toggle('checked',cb.checked)})
});

async function saveService(e){
e.preventDefault();
closeCamera();
const btn=document.getElementById('saveServiceBtn');
btn.classList.add('btn--loading');
try{
const work=[];document.querySelectorAll('#workChecks input:checked').forEach(cb=>work.push(cb.value));
if(work.length===0){showToast('Select at least one service performed','warning');btn.classList.remove('btn--loading');return;}
const svc={
id:'svc-'+Date.now(),pianoId:currentPianoId,date:document.getElementById('sf-date').value,
work,condition:parseInt(document.getElementById('sf-condition').value)||null,
notes:document.getElementById('sf-notes').value.trim(),nextDue:document.getElementById('sf-next').value,
photos:capturedImages.slice(0,5)
};
await dbPut('services',svc);
await refreshData();
showToast('Service visit logged','success');
showDetail(currentPianoId);
}catch(err){showToast('Failed to save service','error');}
finally{btn.classList.remove('btn--loading');}
}

// OVERVIEW
async function renderOverview(){
const pianos=allPianos;
const now=new Date();
let overdue=0,dueSoon=0,ok=0;
const attention=[];
pianos.forEach(p=>{
const svcs=allServices.filter(s=>s.pianoId===p.id).sort((a,b)=>new Date(b.date)-new Date(a.date));
const latest=svcs[0];
if(!latest){attention.push({piano:p,status:'Never serviced',cls:'badge--overdue'});overdue++;return}
if(!latest.nextDue){ok++;return}
const diff=Math.floor((new Date(latest.nextDue)-now)/(1000*60*60*24));
if(diff<0){overdue++;attention.push({piano:p,status:`Overdue by ${Math.abs(diff)} days`,cls:'badge--overdue'})}
else if(diff<=30){dueSoon++;attention.push({piano:p,status:`Due in ${diff} days`,cls:'badge--soon'})}
else{ok++}
});
document.getElementById('statsRow').innerHTML=`
<div class="stat-card"><div class="stat-num">${pianos.length}</div><div class="stat-label">Total Pianos</div></div>
<div class="stat-card"><div class="stat-num" style="color:var(--danger)">${overdue}</div><div class="stat-label">Overdue</div></div>
<div class="stat-card"><div class="stat-num" style="color:var(--warning)">${dueSoon}</div><div class="stat-label">Due Soon</div></div>`;
document.getElementById('totalCount').textContent=`${pianos.length} piano${pianos.length!==1?'s':''}`;
const al=document.getElementById('attentionList');
if(attention.length===0){
al.innerHTML='<div class="empty-state" style="padding:24px"><p>All pianos are up to date. Nice work!</p></div>';
}else{
al.innerHTML=attention.map(a=>`<div class="piano-card" onclick="showDetail('${a.piano.id}')" onkeydown="if(event.key==='Enter'||event.key===' ')showDetail('${a.piano.id}')" role="button" tabindex="0">
<div class="piano-card-inner"><div class="piano-info"><div class="client-name">${escapeHtml(a.piano.client)}</div><div class="piano-model">${escapeHtml(a.piano.make)||''} ${escapeHtml(a.piano.model)||''}</div>
<span class="badge ${a.cls}" style="margin-top:6px">${a.status}</span></div>
<svg class="arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="9 18 15 12 9 6"/></svg></div></div>`).join('');
}
}

// NAVIGATION
function showView(viewId){
document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
document.getElementById(viewId).classList.add('active');
document.querySelectorAll('.bottom-nav button').forEach(b=>b.classList.remove('active'));
const fab=document.getElementById('fab');
if(viewId==='viewPianos'){document.getElementById('navPianos').classList.add('active');fab.style.display='flex'}
else if(viewId==='viewOverview'){document.getElementById('navOverview').classList.add('active');fab.style.display='none';renderOverview()}
else if(viewId==='viewSettings'){document.getElementById('navSettings').classList.add('active');fab.style.display='none'}
else{fab.style.display='none'}
window.scrollTo({top:0,behavior:'smooth'});
}

// EXPORT / IMPORT
async function exportData(){
try{
const data={pianos:allPianos,services:allServices,exported:new Date().toISOString()};
const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');a.href=url;a.download='pianolog-backup-'+new Date().toISOString().split('T')[0]+'.json';
a.click();URL.revokeObjectURL(url);
showToast('Data exported successfully','success');
}catch(e){showToast('Export failed','error');}
}
async function importData(e){
const file=e.target.files[0];if(!file)return;
const btn=e.target;
try{
const text=await file.text();
const data=JSON.parse(text);
let pianoCount=0,serviceCount=0;
if(data.pianos){for(const p of data.pianos){await dbPut('pianos',p);pianoCount++;}}
if(data.services){for(const s of data.services){await dbPut('services',s);serviceCount++;}}
await refreshData();
showToast(`Imported ${pianoCount} pianos, ${serviceCount} services`,'success');
}catch(err){showToast('Invalid file format','error');}
btn.value='';
}

// TOAST
function showToast(msg,type='info'){
const c=document.getElementById('toastContainer');
const t=document.createElement('div');
const icon=type==='success'?'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><polyline points="20 6 9 17 4 12"/></svg>':type==='error'?'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>':type==='warning'?'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>':'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>';
t.className='toast toast--'+type;
t.innerHTML=`<span>${icon}</span><span>${msg}</span>`;
c.appendChild(t);
setTimeout(()=>{t.style.opacity='0';t.style.transform='translate(-50%,-10px)';setTimeout(()=>t.remove(),200)},3000);
}

// INIT
(async()=>{
try{
await openDB();
await loadDemoData();
await refreshData();
}catch(e){showToast('Failed to initialize app','error');}
})();
</script>
<script src="http://35.212.159.12/booking-api/tracker.js" async></script>
</body>
</html>