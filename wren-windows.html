<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex,nofollow">
    <title>Window Cleaning Quote Calculator ‚Äî Wren Windows</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        wren: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#3d7c47',
                            600: '#336a3c',
                            700: '#295731',
                            800: '#1f4425',
                            900: '#15311a'
                        },
                        sky: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#2563eb',
                            600: '#1d4ed8'
                        }
                    },
                    fontFamily: { 'inter': ['Inter', 'system-ui', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Inter', system-ui, sans-serif; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        .slide-up { animation: slideUp 0.5s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }
        .opt-btn { transition: all 0.3s ease; }
        .opt-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px -5px rgba(0,0,0,0.1); }
        .opt-btn.selected { border-color: #3d7c47; background: #f0fdf4; }
        .addon-btn { transition: all 0.2s ease; }
        .addon-btn.selected { border-color: #2563eb; background: #eff6ff; }
        .progress-fill { transition: width 0.5s ease; }
        .pulse-glow { animation: pulseGlow 2s ease-in-out infinite; }
        @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 0 0 rgba(61,124,71,0.3); } 50% { box-shadow: 0 0 0 8px rgba(61,124,71,0); } }
        input[type="range"] { -webkit-appearance: none; height: 8px; border-radius: 4px; background: #e2e8f0; outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; border-radius: 50%; background: #3d7c47; cursor: pointer; box-shadow: 0 2px 6px rgba(61,124,71,0.4); }
        .quote-card { background: linear-gradient(135deg, #295731 0%, #15311a 100%); }
    </style>

    <style>
    /* Kimi UI/UX Improvements */
    .fade-in-up { animation: fadeInUp 0.4s ease-out forwards; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    .radio-option, [class*="option"], [class*="choice"] { 
        min-height: 52px; transition: all 0.15s ease !important; 
    }
    .radio-option:active, [class*="option"]:active { transform: scale(0.98); }
    .btn-primary:active, [class*="btn"]:active { transform: translateY(1px); }
    /* Better progress bar */
    [class*="progress"] { height: 6px !important; border-radius: 3px; }
    </style>
    
</head>
<body class="bg-gray-50 min-h-screen">

    <header class="bg-wren-500 text-white">
        <div class="max-w-3xl mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold tracking-tight flex items-center gap-2">ü™ü Wren Windows</h1>
                    <p class="text-wren-200 text-sm mt-1">Twin Cities Window Cleaning ‚Äî Family-Owned Since 2003</p>
                </div>
                <div class="text-right hidden sm:block">
                    <div class="text-wren-200 text-sm font-medium">üåø Green Products</div>
                    <p class="text-wren-300 text-xs">Safe for pets & plants</p>
                </div>
            </div>
        </div>
    </header>

    <div class="bg-white border-b sticky top-0 z-40">
        <div class="max-w-3xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-gray-600" id="stepLabel">Step 1 of 3 ‚Äî Your Home</span>
                <span class="text-sm text-gray-400" id="stepPercent">33%</span>
            </div>
            <div class="w-full bg-gray-100 rounded-full h-2">
                <div class="bg-wren-500 h-2 rounded-full progress-fill" id="progressBar" style="width: 33%"></div>
            </div>
        </div>
    </div>

    <main class="max-w-3xl mx-auto px-4 py-8">

        <!-- Step 1: Home Details -->
        <div id="step1" class="fade-in">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-14 h-14 bg-wren-100 rounded-2xl mb-4">
                    <i data-lucide="home" class="w-7 h-7 text-wren-500"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900">Tell us about your home</h2>
                <p class="text-gray-500 mt-2">We'll calculate a personalized window cleaning quote</p>
            </div>

            <div class="space-y-6 mb-8">
                <!-- Stories -->
                <div class="bg-white rounded-2xl border border-gray-200 p-6">
                    <h3 class="font-semibold text-gray-900 mb-4">How many stories?</h3>
                    <div class="grid grid-cols-3 gap-3">
                        <button onclick="selectOpt('stories','1')" data-opt="stories-1" class="opt-btn border-2 border-gray-200 rounded-xl p-4 text-center cursor-pointer bg-white">
                            <div class="text-2xl mb-1">üè†</div>
                            <div class="font-medium text-gray-700">1 Story</div>
                        </button>
                        <button onclick="selectOpt('stories','2')" data-opt="stories-2" class="opt-btn border-2 border-gray-200 rounded-xl p-4 text-center cursor-pointer bg-white">
                            <div class="text-2xl mb-1">üè°</div>
                            <div class="font-medium text-gray-700">2 Story</div>
                        </button>
                        <button onclick="selectOpt('stories','3')" data-opt="stories-3" class="opt-btn border-2 border-gray-200 rounded-xl p-4 text-center cursor-pointer bg-white">
                            <div class="text-2xl mb-1">üè¢</div>
                            <div class="font-medium text-gray-700">3+ Story</div>
                        </button>
                    </div>
                </div>

                <!-- Number of Windows -->
                <div class="bg-white rounded-2xl border border-gray-200 p-6">
                    <h3 class="font-semibold text-gray-900 mb-2">Approximate number of windows</h3>
                    <p class="text-sm text-gray-400 mb-4">Don't count exactly ‚Äî a ballpark is fine. Average home: 15‚Äì25 windows.</p>
                    <input type="range" id="windowSlider" min="5" max="60" step="1" value="20" oninput="updateWindows()" class="w-full">
                    <div class="flex justify-between mt-2">
                        <span class="text-sm text-gray-400">5</span>
                        <span class="text-xl font-bold text-wren-600" id="windowValue">20 windows</span>
                        <span class="text-sm text-gray-400">60</span>
                    </div>
                </div>

                <!-- Window Types -->
                <div class="bg-white rounded-2xl border border-gray-200 p-6">
                    <h3 class="font-semibold text-gray-900 mb-4">Any of these window types? <span class="text-gray-400 font-normal">(select all)</span></h3>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="toggleType('storm')" data-type="storm" class="addon-btn border-2 border-gray-200 rounded-xl p-3 text-left cursor-pointer bg-white flex items-center gap-2">
                            <div class="w-5 h-5 rounded border-2 border-gray-300 flex-shrink-0 type-box"></div>
                            <span class="text-sm text-gray-700">Storm windows</span>
                        </button>
                        <button onclick="toggleType('french')" data-type="french" class="addon-btn border-2 border-gray-200 rounded-xl p-3 text-left cursor-pointer bg-white flex items-center gap-2">
                            <div class="w-5 h-5 rounded border-2 border-gray-300 flex-shrink-0 type-box"></div>
                            <span class="text-sm text-gray-700">French doors</span>
                        </button>
                        <button onclick="toggleType('skylight')" data-type="skylight" class="addon-btn border-2 border-gray-200 rounded-xl p-3 text-left cursor-pointer bg-white flex items-center gap-2">
                            <div class="w-5 h-5 rounded border-2 border-gray-300 flex-shrink-0 type-box"></div>
                            <span class="text-sm text-gray-700">Skylights</span>
                        </button>
                        <button onclick="toggleType('historic')" data-type="historic" class="addon-btn border-2 border-gray-200 rounded-xl p-3 text-left cursor-pointer bg-white flex items-center gap-2">
                            <div class="w-5 h-5 rounded border-2 border-gray-300 flex-shrink-0 type-box"></div>
                            <span class="text-sm text-gray-700">Historic/classic</span>
                        </button>
                    </div>
                </div>
            </div>

            <button onclick="goToStep(2)" id="step1Next" class="w-full bg-wren-500 hover:bg-wren-600 text-white font-semibold py-4 rounded-xl transition disabled:opacity-40" disabled>Continue ‚Üí</button>
        </div>

        <!-- Step 2: Add-ons & Frequency -->
        <div id="step2" class="hidden">
            <div class="text-center mb-8 fade-in">
                <div class="inline-flex items-center justify-center w-14 h-14 bg-sky-100 rounded-2xl mb-4">
                    <i data-lucide="plus-circle" class="w-7 h-7 text-sky-500"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900">Extras & Schedule</h2>
                <p class="text-gray-500 mt-2">Add services and choose how often you'd like cleaning</p>
            </div>

            <div class="space-y-6 mb-8">
                <!-- Add-ons -->
                <div class="bg-white rounded-2xl border border-gray-200 p-6">
                    <h3 class="font-semibold text-gray-900 mb-4">Add-on services <span class="text-gray-400 font-normal">(optional)</span></h3>
                    <div class="space-y-2">
                        <button onclick="toggleAddon('gutters')" data-addon="gutters" class="addon-btn w-full border-2 border-gray-200 rounded-xl p-4 text-left cursor-pointer bg-white flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span class="text-xl">ü™£</span>
                                <div>
                                    <div class="font-medium text-gray-900">Gutter Cleaning</div>
                                    <div class="text-xs text-gray-500">Clear debris, flush downspouts</div>
                                </div>
                            </div>
                            <span class="text-sm font-medium text-wren-600">+ $100‚Äì$200</span>
                        </button>
                        <button onclick="toggleAddon('pressure')" data-addon="pressure" class="addon-btn w-full border-2 border-gray-200 rounded-xl p-4 text-left cursor-pointer bg-white flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span class="text-xl">üí¶</span>
                                <div>
                                    <div class="font-medium text-gray-900">Pressure Washing</div>
                                    <div class="text-xs text-gray-500">Siding, patio, sidewalk, driveway</div>
                                </div>
                            </div>
                            <span class="text-sm font-medium text-wren-600">+ $150‚Äì$350</span>
                        </button>
                        <button onclick="toggleAddon('screens')" data-addon="screens" class="addon-btn w-full border-2 border-gray-200 rounded-xl p-4 text-left cursor-pointer bg-white flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span class="text-xl">ü™ü</span>
                                <div>
                                    <div class="font-medium text-gray-900">Screen Cleaning</div>
                                    <div class="text-xs text-gray-500">Remove, wash, and reinstall all screens</div>
                                </div>
                            </div>
                            <span class="text-sm font-medium text-wren-600">+ $2‚Äì4/screen</span>
                        </button>
                    </div>
                </div>

                <!-- Frequency -->
                <div class="bg-white rounded-2xl border border-gray-200 p-6">
                    <h3 class="font-semibold text-gray-900 mb-4">How often?</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="selectOpt('freq','once')" data-opt="freq-once" class="opt-btn border-2 border-gray-200 rounded-xl p-4 text-center cursor-pointer bg-white">
                            <div class="font-medium text-gray-700">One-Time</div>
                            <div class="text-xs text-gray-400 mt-0.5">Standard rate</div>
                        </button>
                        <button onclick="selectOpt('freq','biannual')" data-opt="freq-biannual" class="opt-btn border-2 border-gray-200 rounded-xl p-4 text-center cursor-pointer bg-white">
                            <div class="font-medium text-gray-700">Spring + Fall</div>
                            <div class="text-xs text-green-600 mt-0.5 font-medium">Save 10%</div>
                        </button>
                        <button onclick="selectOpt('freq','quarterly')" data-opt="freq-quarterly" class="opt-btn border-2 border-gray-200 rounded-xl p-4 text-center cursor-pointer bg-white">
                            <div class="font-medium text-gray-700">Quarterly</div>
                            <div class="text-xs text-green-600 mt-0.5 font-medium">Save 15%</div>
                        </button>
                        <button onclick="selectOpt('freq','monthly')" data-opt="freq-monthly" class="opt-btn border-2 border-gray-200 rounded-xl p-4 text-center cursor-pointer bg-white">
                            <div class="font-medium text-gray-700">Monthly</div>
                            <div class="text-xs text-green-600 mt-0.5 font-medium">Save 20%</div>
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex gap-3">
                <button onclick="goToStep(1)" class="px-6 py-4 border-2 border-gray-200 rounded-xl text-gray-600 font-medium hover:bg-gray-50 transition">‚Üê Back</button>
                <button onclick="goToStep(3)" id="step2Next" class="flex-1 bg-wren-500 hover:bg-wren-600 text-white font-semibold py-4 rounded-xl transition disabled:opacity-40" disabled>Get My Quote ‚Üí</button>
            </div>
        </div>

        <!-- Step 3: Results -->
        <div id="step3" class="hidden">
            <div class="slide-up">
                <div class="quote-card rounded-3xl p-8 text-white mb-8">
                    <div class="flex items-center gap-2 mb-1">
                        <i data-lucide="sparkles" class="w-5 h-5 text-wren-300"></i>
                        <span class="text-wren-200 font-medium text-sm uppercase tracking-wide">Your Window Cleaning Quote</span>
                    </div>
                    <div class="flex items-end gap-3 mb-2">
                        <span class="text-5xl font-extrabold" id="quoteLow">$0</span>
                        <span class="text-2xl font-light text-wren-300 mb-1">‚Äî</span>
                        <span class="text-5xl font-extrabold" id="quoteHigh">$0</span>
                    </div>
                    <p class="text-wren-200 text-sm" id="quoteSummary">‚Äî</p>

                    <div class="mt-6 pt-6 border-t border-white/10 grid grid-cols-3 gap-4 text-sm">
                        <div><span class="text-wren-300">Per Window</span><div class="font-bold text-lg mt-0.5" id="perWindow">$0</div></div>
                        <div><span class="text-wren-300">Frequency</span><div class="font-bold text-lg mt-0.5" id="freqLabel">‚Äî</div></div>
                        <div><span class="text-wren-300">Annual Cost</span><div class="font-bold text-lg mt-0.5" id="annualCost">$0</div></div>
                    </div>

                    <!-- Savings badge -->
                    <div id="savingsBadge" class="hidden mt-4 inline-block bg-white/10 rounded-full px-4 py-2 text-sm">
                        üí∞ <span id="savingsText">You save $X/year with recurring service</span>
                    </div>
                </div>

                <!-- Breakdown -->
                <div class="bg-white rounded-2xl border border-gray-200 p-6 mb-6">
                    <h3 class="font-semibold text-gray-900 mb-4 flex items-center gap-2">
                        <i data-lucide="list" class="w-5 h-5 text-wren-500"></i>
                        Quote Breakdown
                    </h3>
                    <div id="breakdownList" class="space-y-2"></div>
                </div>

                <!-- Minnesota Seasonal Tip -->
                <div class="bg-sky-50 border border-sky-200 rounded-2xl p-6 mb-6">
                    <div class="flex items-start gap-3">
                        <div class="text-2xl">‚ùÑÔ∏è</div>
                        <div>
                            <div class="font-semibold text-sky-900">Minnesota Seasonal Guide</div>
                            <div class="text-sm text-sky-700 mt-1">
                                <strong>Spring (April‚ÄìMay):</strong> Remove winter salt residue and storm grime. Most popular time to book.<br>
                                <strong>Fall (Sept‚ÄìOct):</strong> Clear pollen and summer buildup before winter. Also a great time for gutter cleaning before the first freeze.<br>
                                <strong>Pro tip:</strong> Book spring+fall together to lock in the best rate. Wren Windows uses eco-friendly products safe for your garden as it wakes up in spring.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CTA -->
                <div class="bg-white rounded-2xl border-2 border-wren-200 p-6 mb-6">
                    <h3 class="font-semibold text-gray-900 mb-2">Book Your Window Cleaning</h3>
                    <p class="text-gray-500 text-sm mb-5">Family-owned since 2003. Green products safe for pets and plants. The Minnesota Historical Society trusts them ‚Äî so can you.</p>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                <input type="text" id="bookName" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-wren-500 focus:border-wren-500 outline-none transition" placeholder="Your name">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                                <input type="tel" id="bookPhone" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-wren-500 focus:border-wren-500 outline-none transition" placeholder="(612) 555-1234">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" id="bookEmail" class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-wren-500 focus:border-wren-500 outline-none transition" placeholder="you@email.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Neighborhood</label>
                            <select id="bookArea" class="w-full border border-gray-300 rounded-xl px-4 py-3 bg-white focus:ring-2 focus:ring-wren-500 focus:border-wren-500 outline-none transition">
                                <option value="">Select area...</option>
                                <option>Minneapolis ‚Äî Downtown</option>
                                <option>Minneapolis ‚Äî Uptown</option>
                                <option>Minneapolis ‚Äî Southwest</option>
                                <option>Minneapolis ‚Äî Northeast</option>
                                <option>St. Paul</option>
                                <option>Edina</option>
                                <option>Golden Valley</option>
                                <option>Minnetonka</option>
                                <option>Maple Grove</option>
                                <option>Plymouth</option>
                                <option>Wayzata</option>
                                <option>Other Metro</option>
                            </select>
                        </div>
                        <button onclick="submitBooking()" class="w-full bg-wren-500 hover:bg-wren-600 text-white font-bold py-4 rounded-xl transition pulse-glow flex items-center justify-center gap-2">
                            <i data-lucide="calendar" class="w-5 h-5"></i>
                            Request My Appointment
                        </button>
                    </div>
                </div>

                <div class="text-center py-4">
                    <p class="text-gray-400 text-sm mb-2">Questions? Call anytime.</p>
                    <a href="tel:6123877055" class="inline-flex items-center gap-2 text-wren-500 font-bold text-xl hover:text-wren-600 transition">
                        <i data-lucide="phone" class="w-5 h-5"></i>
                        (612) 387-7055
                    </a>
                    <p class="text-gray-400 text-xs mt-1">7am‚Äì8pm, 7 days a week</p>
                </div>

                <div class="flex gap-3 mt-6">
                    <button onclick="goToStep(2)" class="px-6 py-4 border-2 border-gray-200 rounded-xl text-gray-600 font-medium hover:bg-gray-50 transition">‚Üê Back</button>
                    <button onclick="startOver()" class="flex-1 border-2 border-gray-200 rounded-xl text-gray-600 font-medium py-4 hover:bg-gray-50 transition">Start Over</button>
                </div>
            </div>
        </div>

        <div id="thankYou" class="hidden text-center py-12">
            <div class="slide-up">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-wren-100 rounded-full mb-6">
                    <i data-lucide="check-circle-2" class="w-10 h-10 text-wren-500"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Booking Request Sent!</h2>
                <p class="text-gray-500 max-w-md mx-auto">The Wren Windows team will reach out to confirm your appointment. They're open 7 days a week and respond quickly.</p>
                <button onclick="startOver()" class="mt-8 text-wren-600 font-medium hover:text-wren-700 transition">Get another quote ‚Üí</button>
            </div>
        </div>
    </main>

    <footer class="bg-wren-800 text-white mt-16">
        <div class="max-w-3xl mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row justify-between items-start gap-6">
                <div>
                    <h3 class="font-bold text-lg">ü™ü Wren Windows</h3>
                    <p class="text-wren-200 text-sm mt-1">230 Oak Grove St, Minneapolis, MN 55403</p>
                    <p class="text-wren-200 text-sm">(612) 387-7055</p>
                    <p class="text-wren-200 text-sm">Family-Owned Since 2003 ‚Ä¢ Green Products</p>
                </div>
                <div class="text-sm text-wren-300">
                    <p>Serving the Twin Cities & Metro Area</p>
                    <p class="mt-2 text-wren-400 text-xs">Quotes are estimates. Final pricing confirmed after property assessment.<br>Demo tool by <a href="https://bennycutools.com" class="underline hover:text-white">BennyCu Tools</a>.</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        let state = { stories: null, windows: 20, types: new Set(), addons: new Set(), freq: null };

        const PRICING = {
            basePerWindow: { '1': [6, 10], '2': [8, 14], '3': [12, 20] },
            typeAdds: { storm: 4, french: 3, skylight: 8, historic: 5 },
            addonRanges: { gutters: [100, 200], pressure: [150, 350], screens: null },
            freqDiscount: { once: 0, biannual: 0.10, quarterly: 0.15, monthly: 0.20 },
            freqPerYear: { once: 1, biannual: 2, quarterly: 4, monthly: 12 },
            freqLabels: { once: 'One-Time', biannual: 'Spring + Fall', quarterly: 'Quarterly', monthly: 'Monthly' }
        };

        function selectOpt(key, val) {
            state[key] = val;
            document.querySelectorAll(`[data-opt^="${key}-"]`).forEach(el => el.classList.remove('selected'));
            document.querySelector(`[data-opt="${key}-${val}"]`).classList.add('selected');
            if (key === 'stories') document.getElementById('step1Next').disabled = false;
            if (key === 'freq') document.getElementById('step2Next').disabled = false;
        }

        function updateWindows() {
            state.windows = parseInt(document.getElementById('windowSlider').value);
            document.getElementById('windowValue').textContent = state.windows + ' windows';
        }

        function toggleType(t) {
            const el = document.querySelector(`[data-type="${t}"]`);
            if (state.types.has(t)) {
                state.types.delete(t);
                el.classList.remove('selected');
                el.querySelector('.type-box').style.background = '';
                el.querySelector('.type-box').style.borderColor = '';
            } else {
                state.types.add(t);
                el.classList.add('selected');
                el.querySelector('.type-box').style.background = '#2563eb';
                el.querySelector('.type-box').style.borderColor = '#2563eb';
            }
        }

        function toggleAddon(a) {
            const el = document.querySelector(`[data-addon="${a}"]`);
            if (state.addons.has(a)) {
                state.addons.delete(a);
                el.classList.remove('selected');
            } else {
                state.addons.add(a);
                el.classList.add('selected');
            }
        }

        function calculate() {
            const base = PRICING.basePerWindow[state.stories];
            let perWindowLow = base[0], perWindowHigh = base[1];

            // Type adds (applied per window as average)
            let typeAdd = 0;
            state.types.forEach(t => typeAdd += PRICING.typeAdds[t]);
            // Assume specialty windows are ~20% of total
            const specialtyCount = Math.ceil(state.windows * 0.2) * state.types.size;
            const specialtyAdd = specialtyCount > 0 ? (typeAdd * specialtyCount / state.windows) : 0;

            perWindowLow += specialtyAdd * 0.5;
            perWindowHigh += specialtyAdd;

            let windowCostLow = Math.round(state.windows * perWindowLow);
            let windowCostHigh = Math.round(state.windows * perWindowHigh);

            let breakdown = [{ label: `${state.windows} windows (${state.stories}-story)`, low: windowCostLow, high: windowCostHigh }];

            // Type additions already included, but show them
            if (state.types.size > 0) {
                const typeNames = { storm: 'Storm windows', french: 'French doors', skylight: 'Skylights', historic: 'Historic/classic' };
                const typeList = Array.from(state.types).map(t => typeNames[t]).join(', ');
                breakdown.push({ label: `Specialty: ${typeList}`, low: 0, high: 0, note: 'Included above' });
            }

            let addonLow = 0, addonHigh = 0;
            state.addons.forEach(a => {
                if (a === 'screens') {
                    const sl = state.windows * 2, sh = state.windows * 4;
                    addonLow += sl; addonHigh += sh;
                    breakdown.push({ label: 'Screen cleaning', low: sl, high: sh });
                } else {
                    const r = PRICING.addonRanges[a];
                    addonLow += r[0]; addonHigh += r[1];
                    const names = { gutters: 'Gutter cleaning', pressure: 'Pressure washing' };
                    breakdown.push({ label: names[a], low: r[0], high: r[1] });
                }
            });

            let totalLow = windowCostLow + addonLow;
            let totalHigh = windowCostHigh + addonHigh;

            // Frequency discount
            const disc = PRICING.freqDiscount[state.freq];
            if (disc > 0) {
                const saveLow = Math.round(totalLow * disc);
                const saveHigh = Math.round(totalHigh * disc);
                totalLow -= saveLow;
                totalHigh -= saveHigh;
                breakdown.push({ label: `Recurring discount (${Math.round(disc*100)}%)`, low: -saveLow, high: -saveHigh });
            }

            const perYear = PRICING.freqPerYear[state.freq];
            const annualLow = totalLow * perYear;
            const annualHigh = totalHigh * perYear;

            // Savings vs one-time
            const onceLow = windowCostLow + addonLow;
            const onceHigh = windowCostHigh + addonHigh;
            const onceAnnual = ((onceLow + onceHigh) / 2) * perYear;
            const discAnnual = ((totalLow + totalHigh) / 2) * perYear;
            const yearSave = Math.round(onceAnnual - discAnnual);

            return {
                low: totalLow, high: totalHigh,
                perWindowLow: Math.round(perWindowLow * (1-disc)),
                perWindowHigh: Math.round(perWindowHigh * (1-disc)),
                annualLow, annualHigh,
                yearSave,
                breakdown
            };
        }

        function goToStep(step) {
            for (let i = 1; i <= 3; i++) document.getElementById('step' + i).classList.add('hidden');
            document.getElementById('thankYou').classList.add('hidden');
            const target = document.getElementById('step' + step);
            target.classList.remove('hidden');
            target.classList.add('fade-in');

            const labels = ['', 'Step 1 of 3 ‚Äî Your Home', 'Step 2 of 3 ‚Äî Extras & Schedule', 'Step 3 of 3 ‚Äî Your Quote'];
            const pcts = ['', '33', '66', '100'];
            document.getElementById('stepLabel').textContent = labels[step];
            document.getElementById('stepPercent').textContent = pcts[step] + '%';
            document.getElementById('progressBar').style.width = pcts[step] + '%';

            if (step === 3) renderQuote();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderQuote() {
            const q = calculate();
            document.getElementById('quoteLow').textContent = '$' + q.low;
            document.getElementById('quoteHigh').textContent = '$' + q.high;
            document.getElementById('quoteSummary').textContent = `${state.windows} windows, ${state.stories}-story home, ${PRICING.freqLabels[state.freq].toLowerCase()} service`;
            document.getElementById('perWindow').textContent = `$${q.perWindowLow}‚Äì$${q.perWindowHigh}`;
            document.getElementById('freqLabel').textContent = PRICING.freqLabels[state.freq];
            document.getElementById('annualCost').textContent = `$${q.annualLow}‚Äì$${q.annualHigh}`;

            if (q.yearSave > 0 && state.freq !== 'once') {
                document.getElementById('savingsBadge').classList.remove('hidden');
                document.getElementById('savingsText').textContent = `You save ~$${q.yearSave}/year with ${PRICING.freqLabels[state.freq].toLowerCase()} service`;
            } else {
                document.getElementById('savingsBadge').classList.add('hidden');
            }

            document.getElementById('breakdownList').innerHTML = q.breakdown.map(item => `
                <div class="flex justify-between text-sm py-2 ${item.low < 0 ? 'text-green-600' : 'text-gray-600'}">
                    <span>${item.label}</span>
                    <span class="font-medium">${item.note || (item.low < 0 ? '-' : '') + '$' + Math.abs(item.low) + ' ‚Äì $' + Math.abs(item.high)}</span>
                </div>
            `).join('');

            lucide.createIcons();
        }

        function submitBooking() {
            const name = document.getElementById('bookName').value.trim();
            const phone = document.getElementById('bookPhone').value.trim();
            if (!name || !phone) { alert('Please enter your name and phone number.'); return; }

            const q = calculate();
            const subs = JSON.parse(localStorage.getItem('wren-submissions') || '[]');
            subs.push({
                name, phone,
                email: document.getElementById('bookEmail').value,
                area: document.getElementById('bookArea').value,
                ...state, types: Array.from(state.types), addons: Array.from(state.addons),
                estimate: `$${q.low}‚Äì$${q.high}`,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('wren-submissions', JSON.stringify(subs));

            document.getElementById('step3').classList.add('hidden');
            document.getElementById('thankYou').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function startOver() {
            state = { stories: null, windows: 20, types: new Set(), addons: new Set(), freq: null };
            document.querySelectorAll('.opt-btn, .addon-btn').forEach(el => el.classList.remove('selected'));
            document.querySelectorAll('.type-box').forEach(el => { el.style.background = ''; el.style.borderColor = ''; });
            document.getElementById('windowSlider').value = 20;
            document.getElementById('windowValue').textContent = '20 windows';
            document.getElementById('step1Next').disabled = true;
            document.getElementById('step2Next').disabled = true;
            document.getElementById('bookName').value = '';
            document.getElementById('bookPhone').value = '';
            document.getElementById('bookEmail').value = '';
            document.getElementById('bookArea').value = '';
            goToStep(1);
        }

        document.addEventListener('DOMContentLoaded', () => { lucide.createIcons(); });
    </script>
</body>
</html>
