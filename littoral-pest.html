<!DOCTYPE html>
<html lang="en">
<head>
<meta name="robots" content="noindex, nofollow">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Littoral Line — Littoral Pest Solutions</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%232F4D9E' rx='20' width='100' height='100'/><path fill='%2397C940' d='M50 25c-5 0-10 2-13 6l-5-3-2 4 5 3c-2 3-3 7-3 11 0 3 1 6 2 9l-8 4 2 4 8-4c4 6 11 11 20 12v-8c-5 0-10-3-13-7l8-4-2-4-8 4c-1-2-2-4-2-6 0-2 1-4 2-6l8 4 2-4-8-4c2-3 5-5 9-5v-2z'/></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Courgette&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>

// Security: HTML entity escaping to prevent XSS
function escapeHTML(str) {
  if (str === null || str === undefined) return '';
  const s = String(str);
  const div = document.createElement('div');
  div.appendChild(document.createTextNode(s));
  return div.innerHTML;
}
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'littoral': {
                            'green': '#97C940',
                            'green-dark': '#7BAF2E',
                            'blue': '#2F4D9E',
                            'blue-dark': '#243D7E',
                            'gray': '#939393',
                            'sand': '#F5F5DC',
                            'dark': '#333333'
                        }
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                        'courgette': ['Courgette', 'cursive']
                    }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Poppins', sans-serif; }
        
        /* Smooth transitions */
        .tab-transition { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Toast animations */
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes slideDown {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(100%); opacity: 0; }
        }
        .toast-enter { animation: slideUp 0.3s ease forwards; }
        .toast-exit { animation: slideDown 0.3s ease forwards; }
        
        /* Card hover effects */
        .card-hover { transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        
        /* Loading skeleton */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: #97C940; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #7BAF2E; }
        
        /* Input focus states */
        input, select, textarea {
            user-select: text !important;
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #97C940;
            box-shadow: 0 0 0 3px rgba(151, 201, 64, 0.2);
        }
        
        /* Ripple effect */
        .ripple {
            position: relative;
            overflow: hidden;
        }
        .ripple::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }
        .ripple:active::after {
            width: 200%;
            height: 200%;
        }
        
        /* Print styles */
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white !important; }
            .card-hover { box-shadow: none !important; border: 1px solid #ddd !important; }
        }
        .print-only { display: none; }
        
        /* Bottom tab bar safe area */
        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            .bottom-nav { padding-bottom: env(safe-area-inset-bottom); }
        }
    
/* === DEMO DISCLAIMER === */
#bct-demo-disclaimer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #f8f8f8;
  border-top: 1px solid #ddd;
  padding: 10px 16px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 12px;
  line-height: 1.4;
  color: #666;
  z-index: 99999;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 8px 16px;
  text-align: center;
}
#bct-demo-disclaimer p {
  margin: 0;
  max-width: 700px;
}
#bct-demo-disclaimer strong {
  color: #333;
  font-weight: 600;
}
#bct-demo-disclaimer a.bct-delete-btn {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: #dc3545;
  color: #fff;
  padding: 5px 12px;
  border-radius: 4px;
  text-decoration: none;
  font-size: 11px;
  font-weight: 500;
  white-space: nowrap;
  transition: background 0.15s;
}
#bct-demo-disclaimer a.bct-delete-btn:hover {
  background: #b02a37;
}
@media (max-width: 600px) {
  #bct-demo-disclaimer {
    flex-direction: column;
    padding: 8px 12px 12px;
    font-size: 11px;
  }
}
/* Add bottom padding to body so disclaimer doesn't cover content */
body { padding-bottom: 60px !important; }
</style>
</head>
<body class="bg-gray-50 min-h-screen font-poppins" x-data="littoralApp()" x-init="init()" style="user-select:none; -webkit-user-select:none; -moz-user-select:none; -ms-user-select:none;">
    
    <!-- Demo Banner -->
    <div x-show="showDemoBanner && hasDemoData" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform -translate-y-full"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         class="fixed top-0 left-0 right-0 bg-gradient-to-r from-littoral-blue to-littoral-blue-dark text-white py-2 px-4 z-50 flex items-center justify-between no-print">
        <div class="flex items-center gap-2 text-sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span>Demo data loaded — showing sample Savannah-area customers</span>
        </div>
        <button @click="clearDemoData()" class="text-xs bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full transition">
            Clear Demo
        </button>
    </div>

    <!-- Main Container -->
    <div class="pb-20 lg:pb-0 lg:flex" :class="showDemoBanner && hasDemoData ? 'pt-10' : ''">
        
        <!-- Desktop Sidebar -->
        <nav class="hidden lg:flex lg:flex-col lg:w-64 lg:min-h-screen lg:bg-gradient-to-b lg:from-white lg:to-gray-50 lg:border-r lg:border-gray-200 lg:fixed lg:left-0 lg:top-0 lg:shadow-xl no-print">
            <div class="p-6 border-b border-gray-100 bg-gradient-to-r from-littoral-blue/5 to-transparent">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-littoral-blue to-littoral-blue-dark rounded-xl flex items-center justify-center shadow-lg shadow-littoral-blue/30">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="font-courgette text-xl text-littoral-blue">The Littoral Line</h1>
                        <p class="text-xs text-littoral-gray">Pest Solutions Hub</p>
                    </div>
                </div>
            </div>
            
            <div class="flex-1 py-4">
                <template x-for="item in navItems" :key="item.id">
                    <button @click="currentTab = item.id" 
                            :class="currentTab === item.id ? 'bg-littoral-green/10 text-littoral-green border-r-4 border-littoral-green' : 'text-littoral-gray hover:bg-gray-50'"
                            class="w-full flex items-center gap-3 px-6 py-3 text-left transition">
                        <span x-html="item.icon"></span>
                        <span class="font-medium" x-text="item.label"></span>
                        <span x-show="item.id === 'today' && todayAppointments.length > 0" 
                              class="ml-auto bg-littoral-green text-gray-900 text-xs font-semibold px-2 py-0.5 rounded-full"
                              x-text="todayAppointments.length"></span>
                    </button>
                </template>
            </div>
            
            <div class="p-4 border-t border-gray-100">
                <button @click="showImportModal = true" class="w-full flex items-center gap-2 text-sm text-littoral-gray hover:text-littoral-blue transition px-2 py-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                    </svg>
                    Import / Export
                </button>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="lg:ml-64 flex-1 min-h-screen">
            
            <!-- Mobile Header -->
            <header class="lg:hidden bg-gradient-to-r from-littoral-blue to-littoral-blue-dark text-white px-4 py-4 sticky top-0 z-40 no-print shadow-lg" :class="showDemoBanner && hasDemoData ? 'mt-10' : ''">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                            </svg>
                        </div>
                        <h1 class="font-courgette text-xl text-white">The Littoral Line</h1>
                    </div>
                    <button @click="showImportModal = true" class="w-10 h-10 flex items-center justify-center bg-white/20 hover:bg-white/30 rounded-xl transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Tab Content -->
            <div class="p-4 lg:p-8">
                
                <!-- TODAY TAB -->
                <div x-show="currentTab === 'today'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 transform translate-x-4" x-transition:enter-end="opacity-100 transform translate-x-0">
                    
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-littoral-blue">Today's Route</h2>
                            <p class="text-littoral-gray text-sm" x-text="dayjs().format('dddd, MMMM D, YYYY')"></p>
                        </div>
                        <button @click="openAppointmentModal()" class="bg-littoral-green hover:bg-littoral-green-dark text-gray-900 px-5 py-3 rounded-xl font-semibold transition ripple flex items-center gap-2 shadow-lg shadow-littoral-green/30 min-h-[48px]">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            <span class="hidden sm:inline">New Appointment</span>
                        </button>
                    </div>
                    
                    <!-- Empty State -->
                    <div x-show="todayAppointments.length === 0 && !loading" class="bg-gradient-to-br from-littoral-blue/5 to-littoral-green/5 rounded-2xl shadow-sm border border-littoral-blue/20 p-12 text-center">
                        <div class="w-24 h-24 bg-gradient-to-br from-littoral-blue to-littoral-blue-dark rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg shadow-littoral-blue/30">
                            <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-littoral-blue mb-2">No appointments today</h3>
                        <p class="text-littoral-gray mb-8 max-w-md mx-auto">Time to hit the road! Schedule your first appointment or load demo data to see The Littoral Line in action.</p>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center">
                            <button @click="openAppointmentModal()" class="bg-littoral-green hover:bg-littoral-green-dark text-gray-900 px-8 py-4 rounded-xl font-semibold transition ripple shadow-lg shadow-littoral-green/30 text-lg">
                                + Add First Appointment
                            </button>
                            <button @click="loadDemoData()" class="bg-littoral-blue/10 hover:bg-littoral-blue hover:text-white text-littoral-blue px-8 py-4 rounded-xl font-semibold transition text-lg border-2 border-littoral-blue/30">
                                Load Demo Data
                            </button>
                        </div>
                    </div>
                    
                    <!-- Loading State -->
                    <div x-show="loading" class="space-y-4">
                        <template x-for="i in 3" :key="i">
                            <div class="bg-white rounded-2xl p-4 border border-gray-100">
                                <div class="flex gap-4">
                                    <div class="skeleton w-16 h-16 rounded-xl"></div>
                                    <div class="flex-1 space-y-2">
                                        <div class="skeleton h-5 w-3/4 rounded"></div>
                                        <div class="skeleton h-4 w-1/2 rounded"></div>
                                        <div class="skeleton h-4 w-1/3 rounded"></div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                    
                    <!-- Appointments List -->
                    <div x-show="todayAppointments.length > 0" class="space-y-4">
                        <template x-for="(apt, index) in todayAppointments" :key="apt.id">
                            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 card-hover cursor-pointer"
                                 @click="viewAppointment(apt)"
                                 :class="apt.status === 'completed' ? 'opacity-60' : ''">
                                <div class="flex gap-4">
                                    <!-- Time Block -->
                                    <div class="w-16 text-center flex-shrink-0">
                                        <div class="bg-gradient-to-br from-littoral-blue to-littoral-blue-dark text-white rounded-xl p-2">
                                            <div class="text-lg font-bold" x-text="formatTime(apt.time).split(' ')[0]"></div>
                                            <div class="text-xs opacity-80" x-text="formatTime(apt.time).split(' ')[1]"></div>
                                        </div>
                                        <div class="mt-2 text-xs text-littoral-gray" x-text="'Stop #' + (index + 1)"></div>
                                    </div>
                                    
                                    <!-- Details -->
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-start justify-between gap-2">
                                            <h3 class="font-semibold text-littoral-dark truncate" x-text="getCustomerName(apt.customerId)"></h3>
                                            <span :class="getServiceBadgeClass(apt.serviceType)" 
                                                  class="px-2 py-0.5 rounded-full text-xs font-medium flex-shrink-0"
                                                  x-text="apt.serviceType"></span>
                                        </div>
                                        <p class="text-sm text-littoral-gray truncate mt-1" x-text="getCustomerAddress(apt.customerId)"></p>
                                        <div class="flex items-center gap-3 mt-2">
                                            <span class="text-xs text-littoral-gray flex items-center gap-1">
                                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                </svg>
                                                <span x-text="apt.duration + ' min'"></span>
                                            </span>
                                            <span x-show="apt.notes" class="text-xs text-littoral-blue flex items-center gap-1">
                                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
                                                </svg>
                                                Notes
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- Status/Actions -->
                                    <div class="flex-shrink-0 flex flex-col items-end gap-2">
                                        <template x-if="apt.status === 'scheduled'">
                                            <button @click.stop="completeAppointment(apt.id)" 
                                                    class="bg-littoral-green/10 hover:bg-littoral-green text-littoral-green hover:text-gray-900 p-2.5 min-w-[44px] min-h-[44px] rounded-lg transition"
                                                    title="Mark Complete">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                            </button>
                                        </template>
                                        <template x-if="apt.status === 'completed'">
                                            <span class="bg-littoral-green text-gray-900 p-2 rounded-lg">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                            </span>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                    
                    <!-- Today's Stats -->
                    <div x-show="todayAppointments.length > 0" class="mt-6 grid grid-cols-2 sm:grid-cols-4 gap-4">
                        <div class="bg-white rounded-xl p-4 border border-gray-100 text-center">
                            <div class="text-2xl font-bold text-littoral-blue" x-text="todayAppointments.length"></div>
                            <div class="text-xs text-littoral-gray">Total Stops</div>
                        </div>
                        <div class="bg-white rounded-xl p-4 border border-gray-100 text-center">
                            <div class="text-2xl font-bold text-littoral-green" x-text="todayAppointments.filter(a => a.status === 'completed').length"></div>
                            <div class="text-xs text-littoral-gray">Completed</div>
                        </div>
                        <div class="bg-white rounded-xl p-4 border border-gray-100 text-center">
                            <div class="text-2xl font-bold text-littoral-dark" x-text="getTotalDuration()"></div>
                            <div class="text-xs text-littoral-gray">Est. Hours</div>
                        </div>
                        <div class="bg-white rounded-xl p-4 border border-gray-100 text-center">
                            <div class="text-2xl font-bold text-littoral-green" x-text="'$' + getTodayRevenue()"></div>
                            <div class="text-xs text-littoral-gray">Est. Revenue</div>
                        </div>
                    </div>
                </div>

                <!-- CUSTOMERS TAB -->
                <div x-show="currentTab === 'customers'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 transform translate-x-4" x-transition:enter-end="opacity-100 transform translate-x-0">
                    
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-littoral-blue">Customers</h2>
                            <p class="text-littoral-gray text-sm" x-text="customers.length + ' total customers'"></p>
                        </div>
                        <button @click="openCustomerModal()" class="bg-littoral-green hover:bg-littoral-green-dark text-gray-900 px-5 py-3 rounded-xl font-semibold transition ripple flex items-center gap-2 shadow-lg shadow-littoral-green/30 min-h-[48px]">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            <span class="hidden sm:inline">Add Customer</span>
                        </button>
                    </div>
                    
                    <!-- Search -->
                    <div class="mb-4">
                        <div class="relative">
                            <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-littoral-gray" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                            <input type="text" x-model="customerSearch" placeholder="Search by name, address, or phone..."
                                   class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 bg-white text-base">
                        </div>
                    </div>
                    
                    <!-- Empty State -->
                    <div x-show="customers.length === 0" class="bg-white rounded-2xl shadow-sm border border-gray-100 p-12 text-center">
                        <div class="w-20 h-20 bg-littoral-sand rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-10 h-10 text-littoral-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-littoral-dark mb-2">No customers yet</h3>
                        <p class="text-littoral-gray mb-6">Add your first customer or import from a CSV file to get started.</p>
                        <div class="flex flex-col sm:flex-row gap-3 justify-center">
                            <button @click="openCustomerModal()" class="bg-littoral-green hover:bg-littoral-green-dark text-gray-900 px-6 py-3 rounded-xl font-semibold transition ripple">
                                + Add First Customer
                            </button>
                            <button @click="showImportModal = true" class="bg-gray-100 hover:bg-gray-200 text-littoral-dark px-6 py-3 rounded-xl font-medium transition">
                                Import CSV
                            </button>
                        </div>
                    </div>
                    
                    <!-- Customer Cards -->
                    <div x-show="filteredCustomers.length > 0" class="space-y-3">
                        <template x-for="customer in filteredCustomers" :key="customer.id">
                            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 card-hover"
                                 @click="viewCustomer(customer)">
                                <div class="flex items-start gap-4">
                                    <div class="w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0 text-white font-bold text-lg"
                                         :style="'background-color:' + getCustomerColor(customer.name)">
                                        <span x-text="customer.name.charAt(0).toUpperCase()"></span>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-2">
                                            <h3 class="font-semibold text-littoral-dark" x-text="customer.name"></h3>
                                            <span x-show="customer.isDemo" class="text-xs bg-gray-100 text-littoral-gray px-2 py-0.5 rounded-full">Demo</span>
                                        </div>
                                        <p class="text-sm text-littoral-gray truncate" x-text="customer.address"></p>
                                        <div class="flex items-center gap-4 mt-2 text-sm">
                                            <a :href="'tel:' + customer.phone" @click.stop class="text-littoral-blue hover:underline" x-text="customer.phone"></a>
                                            <span x-show="customer.lastService" class="text-littoral-gray">
                                                Last: <span x-text="dayjs(customer.lastService).format('MMM D')"></span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="flex-shrink-0 flex gap-2">
                                        <button @click.stop="openAppointmentModal(customer)" 
                                                class="p-2.5 min-w-[44px] min-h-[44px] bg-littoral-green/10 hover:bg-littoral-green text-littoral-green hover:text-gray-900 rounded-lg transition"
                                                title="Schedule">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                            </svg>
                                        </button>
                                        <button @click.stop="deleteCustomer(customer.id)" 
                                                class="p-2.5 min-w-[44px] min-h-[44px] bg-red-50 hover:bg-red-500 text-red-500 hover:text-white rounded-lg transition"
                                                title="Delete">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- QUOTES TAB -->
                <div x-show="currentTab === 'quotes'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 transform translate-x-4" x-transition:enter-end="opacity-100 transform translate-x-0">
                    
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-littoral-blue">Quick Quote</h2>
                            <p class="text-littoral-gray text-sm">Generate instant price estimates</p>
                        </div>
                    </div>
                    
                    <!-- Quote Calculator -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            
                            <!-- Service Type -->
                            <div>
                                <label class="block text-sm font-medium text-littoral-dark mb-2">Service Type</label>
                                <select x-model="quoteForm.serviceType" class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base bg-white">
                                    <option value="">Select service...</option>
                                    <option value="General Pest">General Pest Control</option>
                                    <option value="Bed Bug">Bed Bug Heat Treatment</option>
                                    <option value="Mosquito">Mosquito Control</option>
                                    <option value="Rodent">Rodent Control</option>
                                    <option value="Termite">Termite Inspection</option>
                                    <option value="Roach">Roach Extermination</option>
                                </select>
                            </div>
                            
                            <!-- Property Type -->
                            <div>
                                <label class="block text-sm font-medium text-littoral-dark mb-2">Property Type</label>
                                <select x-model="quoteForm.propertyType" class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base bg-white">
                                    <option value="">Select property...</option>
                                    <option value="single-family">Single Family Home</option>
                                    <option value="condo">Condo/Townhouse</option>
                                    <option value="apartment">Apartment</option>
                                    <option value="airbnb">Vacation Rental/Airbnb</option>
                                    <option value="restaurant">Restaurant</option>
                                    <option value="commercial">Commercial Building</option>
                                </select>
                            </div>
                            
                            <!-- Square Footage -->
                            <div>
                                <label class="block text-sm font-medium text-littoral-dark mb-2">Square Footage</label>
                                <input type="number" x-model="quoteForm.sqft" placeholder="e.g., 2000"
                                       class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base">
                            </div>
                            
                            <!-- Frequency -->
                            <div>
                                <label class="block text-sm font-medium text-littoral-dark mb-2">Service Frequency</label>
                                <select x-model="quoteForm.frequency" class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base bg-white">
                                    <option value="one-time">One-Time Treatment</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="bimonthly">Bi-Monthly (Every 2 Mo)</option>
                                    <option value="quarterly">Quarterly</option>
                                </select>
                            </div>
                        </div>
                        
                        <button @click="calculateQuote()" 
                                class="mt-6 w-full bg-littoral-blue hover:bg-littoral-blue-dark text-white py-3 rounded-xl font-medium transition ripple">
                            Calculate Estimate
                        </button>
                    </div>
                    
                    <!-- Quote Result -->
                    <div x-show="quoteResult" x-transition class="bg-gradient-to-br from-littoral-green to-littoral-green-dark text-white rounded-2xl p-6">
                        <div class="text-center">
                            <div class="text-sm opacity-80 mb-1">Estimated Price</div>
                            <div class="text-5xl font-bold mb-2">$<span x-text="quoteResult?.price || 0"></span></div>
                            <div class="text-sm opacity-80" x-text="quoteResult?.frequency || 'per service'"></div>
                        </div>
                        
                        <div class="mt-6 pt-6 border-t border-white/20 grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <div class="opacity-70">Service</div>
                                <div class="font-medium" x-text="quoteResult?.service || '-'"></div>
                            </div>
                            <div>
                                <div class="opacity-70">Property</div>
                                <div class="font-medium" x-text="quoteResult?.property || '-'"></div>
                            </div>
                            <div>
                                <div class="opacity-70">Sq Ft</div>
                                <div class="font-medium" x-text="(quoteResult?.sqft || 0).toLocaleString() + ' sq ft'"></div>
                            </div>
                            <div>
                                <div class="opacity-70">Annual Value</div>
                                <div class="font-medium">$<span x-text="quoteResult?.annual || 0"></span>/year</div>
                            </div>
                        </div>
                        
                        <div class="mt-6 flex gap-3">
                            <button @click="copyQuote()" class="flex-1 bg-white/20 hover:bg-white/30 py-3 rounded-xl font-medium transition">
                                Copy Quote
                            </button>
                            <button @click="printQuote()" class="flex-1 bg-white text-littoral-green py-3 rounded-xl font-medium transition hover:bg-white/90">
                                Print
                            </button>
                        </div>
                    </div>
                    
                    <!-- Saved Quotes -->
                    <div x-show="quotes.length > 0" class="mt-6">
                        <h3 class="text-lg font-semibold text-littoral-dark mb-4">Recent Quotes</h3>
                        <div class="space-y-3">
                            <template x-for="quote in quotes.slice(0, 5)" :key="quote.id">
                                <div class="bg-white rounded-xl p-4 border border-gray-100 flex items-center justify-between">
                                    <div>
                                        <div class="font-medium text-littoral-dark" x-text="quote.service + ' — ' + quote.property"></div>
                                        <div class="text-sm text-littoral-gray" x-text="dayjs(quote.createdAt).format('MMM D, YYYY h:mm A')"></div>
                                    </div>
                                    <div class="text-xl font-bold text-littoral-green">$<span x-text="quote.price"></span></div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- HISTORY TAB -->
                <div x-show="currentTab === 'history'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 transform translate-x-4" x-transition:enter-end="opacity-100 transform translate-x-0">
                    
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-littoral-blue">Treatment History</h2>
                            <p class="text-littoral-gray text-sm" x-text="treatments.length + ' treatments recorded'"></p>
                        </div>
                    </div>
                    
                    <!-- Empty State -->
                    <div x-show="treatments.length === 0" class="bg-white rounded-2xl shadow-sm border border-gray-100 p-12 text-center">
                        <div class="w-20 h-20 bg-littoral-sand rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-10 h-10 text-littoral-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-littoral-dark mb-2">No treatment history yet</h3>
                        <p class="text-littoral-gray mb-6">Complete appointments to build treatment history for each customer.</p>
                    </div>
                    
                    <!-- Treatment Timeline -->
                    <div x-show="treatments.length > 0" class="space-y-4">
                        <template x-for="treatment in treatments" :key="treatment.id">
                            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4">
                                <div class="flex items-start gap-4">
                                    <div class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"
                                         :class="getServiceBgClass(treatment.serviceType)">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center justify-between">
                                            <h3 class="font-semibold text-littoral-dark" x-text="getCustomerName(treatment.customerId)"></h3>
                                            <span class="text-sm text-littoral-gray" x-text="dayjs(treatment.date).format('MMM D, YYYY')"></span>
                                        </div>
                                        <p class="text-sm text-littoral-blue mt-1" x-text="treatment.serviceType"></p>
                                        <p x-show="treatment.products" class="text-sm text-littoral-gray mt-2">
                                            <span class="font-medium">Products:</span> <span x-text="treatment.products"></span>
                                        </p>
                                        <p x-show="treatment.notes" class="text-sm text-littoral-gray mt-1">
                                            <span class="font-medium">Notes:</span> <span x-text="treatment.notes"></span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- STATS TAB -->
                <div x-show="currentTab === 'stats'" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 transform translate-x-4" x-transition:enter-end="opacity-100 transform translate-x-0">
                    
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-littoral-blue">Dashboard</h2>
                        <p class="text-littoral-gray text-sm">Business overview and insights</p>
                    </div>
                    
                    <!-- Stats Grid -->
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-littoral-blue to-littoral-blue-dark rounded-2xl p-5 text-white shadow-lg shadow-littoral-blue/20">
                            <div class="text-white/70 text-sm mb-1">Total Customers</div>
                            <div class="text-3xl font-bold" x-text="customers.length"></div>
                        </div>
                        <div class="bg-gradient-to-br from-littoral-green to-littoral-green-dark rounded-2xl p-5 text-white shadow-lg shadow-littoral-green/20">
                            <div class="text-white/70 text-sm mb-1">This Month</div>
                            <div class="text-3xl font-bold" x-text="getMonthlyTreatments()"></div>
                        </div>
                        <div class="bg-white rounded-2xl p-5 border border-gray-100 shadow-sm">
                            <div class="text-littoral-gray text-sm mb-1">Est. MRR</div>
                            <div class="text-3xl font-bold text-littoral-blue">$<span x-text="calculateMRR()"></span></div>
                        </div>
                        <div class="bg-white rounded-2xl p-5 border border-gray-100 shadow-sm">
                            <div class="text-littoral-gray text-sm mb-1">Upcoming</div>
                            <div class="text-3xl font-bold text-littoral-green" x-text="getUpcomingCount()"></div>
                        </div>
                    </div>
                    
                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-2xl p-5 border border-gray-100">
                            <h3 class="font-semibold text-littoral-dark mb-4">Services by Type</h3>
                            <canvas id="serviceChart" class="w-full" height="200"></canvas>
                        </div>
                        <div class="bg-white rounded-2xl p-5 border border-gray-100">
                            <h3 class="font-semibold text-littoral-dark mb-4">Monthly Appointments</h3>
                            <canvas id="monthlyChart" class="w-full" height="200"></canvas>
                        </div>
                    </div>
                    
                    <!-- Top Customers -->
                    <div class="mt-6 bg-white rounded-2xl p-5 border border-gray-100">
                        <h3 class="font-semibold text-littoral-dark mb-4">Top Customers</h3>
                        <div x-show="customers.length === 0" class="text-center py-8 text-littoral-gray">
                            No customers yet
                        </div>
                        <div x-show="customers.length > 0" class="space-y-3">
                            <template x-for="customer in getTopCustomers()" :key="customer.id">
                                <div class="flex items-center justify-between py-2 border-b border-gray-100 last:border-0">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white font-bold"
                                             :style="'background-color:' + getCustomerColor(customer.name)">
                                            <span x-text="customer.name.charAt(0).toUpperCase()"></span>
                                        </div>
                                        <div>
                                            <div class="font-medium text-littoral-dark" x-text="customer.name"></div>
                                            <div class="text-xs text-littoral-gray" x-text="customer.address.split(',')[0]"></div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-semibold text-littoral-green" x-text="customer.treatmentCount + ' visits'"></div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="lg:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50 bottom-nav no-print">
        <div class="flex justify-around py-2">
            <template x-for="item in navItems" :key="item.id">
                <button @click="currentTab = item.id" 
                        :class="currentTab === item.id ? 'text-littoral-green' : 'text-littoral-gray'"
                        class="flex flex-col items-center py-2 px-4 min-w-[64px] tab-transition">
                    <span x-html="item.icon" class="w-6 h-6"></span>
                    <span class="text-xs mt-1 font-medium" x-text="item.label"></span>
                </button>
            </template>
        </div>
    </nav>

    <!-- Customer Modal -->
    <div x-show="showCustomerModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black/50 z-50 flex items-end lg:items-center justify-center no-print"
         @click.self="showCustomerModal = false">
        <div x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-y-full lg:translate-y-0 lg:scale-95"
             x-transition:enter-end="opacity-100 transform translate-y-0 lg:scale-100"
             class="bg-white w-full lg:max-w-lg lg:rounded-2xl rounded-t-3xl max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                <h2 class="text-xl font-bold text-littoral-dark" x-text="editingCustomer ? 'Edit Customer' : 'New Customer'"></h2>
                <button @click="showCustomerModal = false" class="p-2 hover:bg-gray-100 rounded-full transition">
                    <svg class="w-5 h-5 text-littoral-gray" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <form @submit.prevent="saveCustomer()" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-littoral-dark mb-1">Full Name *</label>
                    <input type="text" x-model="customerForm.name" required
                           class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base"
                           placeholder="John Smith">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-littoral-dark mb-1">Phone *</label>
                    <input type="tel" x-model="customerForm.phone" required
                           class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base"
                           placeholder="(912) 555-1234">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-littoral-dark mb-1">Email</label>
                    <input type="email" x-model="customerForm.email"
                           class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base"
                           placeholder="john@example.com">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-littoral-dark mb-1">Address *</label>
                    <input type="text" x-model="customerForm.address" required
                           class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base"
                           placeholder="123 Oak St, Savannah, GA 31401">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-littoral-dark mb-1">Property Type</label>
                    <select x-model="customerForm.propertyType" class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base bg-white">
                        <option value="single-family">Single Family Home</option>
                        <option value="condo">Condo/Townhouse</option>
                        <option value="apartment">Apartment</option>
                        <option value="airbnb">Vacation Rental/Airbnb</option>
                        <option value="commercial">Commercial</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-littoral-dark mb-1">Service Plan</label>
                    <select x-model="customerForm.servicePlan" class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base bg-white">
                        <option value="one-time">One-Time</option>
                        <option value="monthly">Monthly</option>
                        <option value="bimonthly">Bi-Monthly ($60)</option>
                        <option value="quarterly">Quarterly</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-littoral-dark mb-1">Notes</label>
                    <textarea x-model="customerForm.notes" rows="3"
                              class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base resize-none"
                              placeholder="Gate code, pet info, access notes..."></textarea>
                </div>
                
                <button type="submit" class="w-full bg-littoral-green hover:bg-littoral-green-dark text-gray-900 py-3 rounded-xl font-semibold transition ripple">
                    <span x-text="editingCustomer ? 'Update Customer' : 'Add Customer'"></span>
                </button>
            </form>
        </div>
    </div>

    <!-- Appointment Modal -->
    <div x-show="showAppointmentModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black/50 z-50 flex items-end lg:items-center justify-center no-print"
         @click.self="showAppointmentModal = false">
        <div x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-y-full lg:translate-y-0 lg:scale-95"
             x-transition:enter-end="opacity-100 transform translate-y-0 lg:scale-100"
             class="bg-white w-full lg:max-w-lg lg:rounded-2xl rounded-t-3xl max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                <h2 class="text-xl font-bold text-littoral-dark">New Appointment</h2>
                <button @click="showAppointmentModal = false" class="p-2 hover:bg-gray-100 rounded-full transition">
                    <svg class="w-5 h-5 text-littoral-gray" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <form @submit.prevent="saveAppointment()" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-littoral-dark mb-1">Customer *</label>
                    <select x-model="appointmentForm.customerId" required class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base bg-white">
                        <option value="">Select customer...</option>
                        <template x-for="customer in customers" :key="customer.id">
                            <option :value="customer.id" x-text="customer.name + ' — ' + customer.address.split(',')[0]"></option>
                        </template>
                    </select>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-littoral-dark mb-1">Date *</label>
                        <input type="date" x-model="appointmentForm.date" required
                               class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-littoral-dark mb-1">Time *</label>
                        <input type="time" x-model="appointmentForm.time" required
                               class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-littoral-dark mb-1">Service Type *</label>
                    <select x-model="appointmentForm.serviceType" required class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base bg-white">
                        <option value="">Select service...</option>
                        <option value="General Pest">General Pest Control</option>
                        <option value="Bed Bug">Bed Bug Heat Treatment</option>
                        <option value="Mosquito">Mosquito Control</option>
                        <option value="Rodent">Rodent Control</option>
                        <option value="Termite">Termite Inspection</option>
                        <option value="Roach">Roach Extermination</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-littoral-dark mb-1">Duration (minutes)</label>
                    <select x-model="appointmentForm.duration" class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base bg-white">
                        <option value="30">30 min</option>
                        <option value="45">45 min</option>
                        <option value="60">1 hour</option>
                        <option value="90">1.5 hours</option>
                        <option value="120">2 hours</option>
                        <option value="180">3 hours</option>
                        <option value="240">4 hours</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-littoral-dark mb-1">Price ($)</label>
                    <input type="number" x-model="appointmentForm.price" step="0.01"
                           class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base"
                           placeholder="60.00">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-littoral-dark mb-1">Notes</label>
                    <textarea x-model="appointmentForm.notes" rows="2"
                              class="w-full px-4 py-3 rounded-xl border border-gray-200 text-base resize-none"
                              placeholder="Special instructions..."></textarea>
                </div>
                
                <button type="submit" class="w-full bg-littoral-green hover:bg-littoral-green-dark text-gray-900 py-3 rounded-xl font-semibold transition ripple">
                    Schedule Appointment
                </button>
            </form>
        </div>
    </div>

    <!-- Customer Detail Modal -->
    <div x-show="showCustomerDetail" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black/50 z-50 flex items-end lg:items-center justify-center no-print"
         @click.self="showCustomerDetail = false">
        <div x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-y-full lg:translate-y-0 lg:scale-95"
             x-transition:enter-end="opacity-100 transform translate-y-0 lg:scale-100"
             class="bg-white w-full lg:max-w-lg lg:rounded-2xl rounded-t-3xl max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                <h2 class="text-xl font-bold text-littoral-dark" x-text="selectedCustomer?.name || 'Customer'"></h2>
                <button @click="showCustomerDetail = false" class="p-2 hover:bg-gray-100 rounded-full transition">
                    <svg class="w-5 h-5 text-littoral-gray" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div x-show="selectedCustomer" class="p-6">
                <!-- Customer Info -->
                <div class="flex items-center gap-4 mb-6">
                    <div class="w-16 h-16 rounded-full flex items-center justify-center text-white font-bold text-2xl"
                         :style="'background-color:' + getCustomerColor(selectedCustomer?.name || '')">
                        <span x-text="(selectedCustomer?.name || 'C').charAt(0).toUpperCase()"></span>
                    </div>
                    <div class="flex-1">
                        <h3 class="font-semibold text-lg text-littoral-dark" x-text="selectedCustomer?.name"></h3>
                        <p class="text-littoral-gray text-sm" x-text="selectedCustomer?.address"></p>
                    </div>
                </div>
                
                <!-- Contact Actions -->
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <a :href="'tel:' + selectedCustomer?.phone" 
                       class="flex items-center justify-center gap-2 bg-littoral-blue text-white py-3 rounded-xl font-medium transition hover:bg-littoral-blue-dark">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                        Call
                    </a>
                    <a :href="'sms:' + selectedCustomer?.phone" 
                       class="flex items-center justify-center gap-2 bg-littoral-green text-gray-900 py-3 rounded-xl font-semibold transition hover:bg-littoral-green-dark">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        Text
                    </a>
                </div>
                
                <!-- Details -->
                <div class="space-y-3 mb-6">
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-littoral-gray">Phone</span>
                        <span class="font-medium text-littoral-dark" x-text="selectedCustomer?.phone"></span>
                    </div>
                    <div x-show="selectedCustomer?.email" class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-littoral-gray">Email</span>
                        <span class="font-medium text-littoral-dark" x-text="selectedCustomer?.email"></span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-littoral-gray">Property</span>
                        <span class="font-medium text-littoral-dark capitalize" x-text="selectedCustomer?.propertyType?.replace('-', ' ')"></span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-littoral-gray">Plan</span>
                        <span class="font-medium text-littoral-dark capitalize" x-text="selectedCustomer?.servicePlan"></span>
                    </div>
                    <div x-show="selectedCustomer?.notes" class="py-2">
                        <span class="text-littoral-gray block mb-1">Notes</span>
                        <span class="text-littoral-dark" x-text="selectedCustomer?.notes"></span>
                    </div>
                </div>
                
                <!-- Treatment History -->
                <div class="mb-6">
                    <h4 class="font-semibold text-littoral-dark mb-3">Treatment History</h4>
                    <div x-show="getCustomerTreatments(selectedCustomer?.id).length === 0" class="text-center py-4 text-littoral-gray text-sm bg-gray-50 rounded-xl">
                        No treatments recorded yet
                    </div>
                    <div x-show="getCustomerTreatments(selectedCustomer?.id).length > 0" class="space-y-2">
                        <template x-for="treatment in getCustomerTreatments(selectedCustomer?.id).slice(0, 5)" :key="treatment.id">
                            <div class="flex justify-between items-center py-2 px-3 bg-gray-50 rounded-lg">
                                <div>
                                    <span class="font-medium text-littoral-dark text-sm" x-text="treatment.serviceType"></span>
                                    <span class="text-xs text-littoral-gray block" x-text="dayjs(treatment.date).format('MMM D, YYYY')"></span>
                                </div>
                                <svg class="w-5 h-5 text-littoral-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                            </div>
                        </template>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="flex gap-3">
                    <button @click="editCustomer(selectedCustomer)" class="flex-1 bg-gray-100 hover:bg-gray-200 text-littoral-dark py-3 rounded-xl font-medium transition">
                        Edit
                    </button>
                    <button @click="showCustomerDetail = false; openAppointmentModal(selectedCustomer)" class="flex-1 bg-littoral-green hover:bg-littoral-green-dark text-gray-900 py-3 rounded-xl font-semibold transition">
                        Schedule
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import/Export Modal -->
    <div x-show="showImportModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black/50 z-50 flex items-end lg:items-center justify-center no-print"
         @click.self="showImportModal = false">
        <div x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-y-full lg:translate-y-0 lg:scale-95"
             x-transition:enter-end="opacity-100 transform translate-y-0 lg:scale-100"
             class="bg-white w-full lg:max-w-lg lg:rounded-2xl rounded-t-3xl max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                <h2 class="text-xl font-bold text-littoral-dark">Import / Export Data</h2>
                <button @click="showImportModal = false" class="p-2 hover:bg-gray-100 rounded-full transition">
                    <svg class="w-5 h-5 text-littoral-gray" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="p-6 space-y-6">
                <!-- Import Section -->
                <div>
                    <h3 class="font-semibold text-littoral-dark mb-3">Import Data</h3>
                    
                    <div class="space-y-3">
                        <!-- CSV Import -->
                        <label class="block cursor-pointer">
                            <div class="border-2 border-dashed border-gray-200 rounded-xl p-4 text-center hover:border-littoral-green transition">
                                <svg class="w-8 h-8 text-littoral-gray mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <div class="text-sm text-littoral-dark font-medium">Import CSV</div>
                                <div class="text-xs text-littoral-gray">name, phone, email, address</div>
                            </div>
                            <input type="file" accept=".csv" @change="importCSV($event)" class="hidden">
                        </label>
                        
                        <!-- JSON Restore -->
                        <label class="block cursor-pointer">
                            <div class="border-2 border-dashed border-gray-200 rounded-xl p-4 text-center hover:border-littoral-blue transition">
                                <svg class="w-8 h-8 text-littoral-gray mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"/>
                                </svg>
                                <div class="text-sm text-littoral-dark font-medium">Restore JSON Backup</div>
                                <div class="text-xs text-littoral-gray">Full data restore</div>
                            </div>
                            <input type="file" accept=".json" @change="restoreJSON($event)" class="hidden">
                        </label>
                        
                        <!-- Paste Data -->
                        <div>
                            <textarea x-model="pasteData" rows="3" 
                                      placeholder="Paste CSV data here (name, phone, email, address)..."
                                      class="w-full px-4 py-3 rounded-xl border border-gray-200 text-sm resize-none"></textarea>
                            <button @click="importPastedData()" 
                                    :disabled="!pasteData.trim()"
                                    class="w-full mt-2 bg-gray-100 hover:bg-gray-200 disabled:opacity-50 text-littoral-dark py-2 rounded-xl font-medium transition text-sm">
                                Import Pasted Data
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Export Section -->
                <div>
                    <h3 class="font-semibold text-littoral-dark mb-3">Export Data</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button @click="exportCSV()" class="bg-littoral-green/10 hover:bg-littoral-green hover:text-white text-littoral-green py-3 rounded-xl font-medium transition text-sm">
                            Export CSV
                        </button>
                        <button @click="exportJSON()" class="bg-littoral-blue/10 hover:bg-littoral-blue hover:text-white text-littoral-blue py-3 rounded-xl font-medium transition text-sm">
                            Export JSON Backup
                        </button>
                    </div>
                </div>
                
                <!-- Demo Data -->
                <div class="pt-4 border-t border-gray-100">
                    <button @click="loadDemoData(); showImportModal = false" class="w-full bg-littoral-sand hover:bg-yellow-100 text-littoral-dark py-3 rounded-xl font-medium transition text-sm">
                        Load Demo Data (Savannah Area)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="fixed bottom-24 lg:bottom-6 left-4 right-4 lg:left-auto lg:right-6 lg:w-80 z-50 space-y-2 no-print">
        <template x-for="toast in toasts" :key="toast.id">
            <div x-show="toast.visible"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-y-2"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100"
                 x-transition:leave-end="opacity-0"
                 :class="{
                     'bg-littoral-green text-gray-900': toast.type === 'success',
                     'bg-red-500 text-white': toast.type === 'error',
                     'bg-littoral-blue text-white': toast.type === 'info',
                     'bg-yellow-500 text-white': toast.type === 'warning'
                 }"
                 class="px-4 py-3 rounded-xl shadow-lg flex items-center justify-between gap-3">
                <div class="flex items-center gap-3">
                    <template x-if="toast.type === 'success'">
                        <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                    </template>
                    <span class="text-sm font-medium" x-text="toast.message"></span>
                </div>
                <button x-show="toast.undoAction" @click="toast.undoAction(); dismissToast(toast.id)" class="text-xs bg-white/20 hover:bg-white/30 px-2 py-1 rounded transition">
                    Undo
                </button>
            </div>
        </template>
    </div>

    <!-- Print Layout -->
    <div class="print-only p-8">
        <div class="text-center mb-8">
            <h1 class="text-2xl font-bold text-littoral-dark font-courgette">The Littoral Line</h1>
            <p class="text-littoral-gray">Littoral Pest Solutions — Savannah, GA</p>
            <p class="text-sm text-littoral-gray mt-2" x-text="dayjs().format('MMMM D, YYYY')"></p>
        </div>
    </div>

    <script>
        dayjs.extend(dayjs_plugin_relativeTime);
        
        // Security Layer: Access Key Validation
        function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
        const _V=1373208383;
        const _k=new URLSearchParams(window.location.search).get('key');
        if(!_k||_h(_k)!==_V){
          document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;background:#111;color:#fff;text-align:center;padding:20px"><div><h1 style="font-size:2rem;margin-bottom:1rem">Access Denied</h1><p style="color:#999">This tool requires a valid access key.</p><p style="margin-top:1rem"><a href="mailto:ben@bennycutools.com" style="color:#4da6ff">ben@bennycutools.com</a></p></div></div>';
          throw new Error('Invalid key');
        }

// Security: Rate limiting + session expiry
(function(){
  const RL_KEY = 'bct_rl';
  const SE_KEY = 'bct_se';
  const MAX_ATTEMPTS = 5;
  const LOCKOUT_MS = 30 * 60 * 1000; // 30 minutes
  const SESSION_MS = 24 * 60 * 60 * 1000; // 24 hours
  
  // Check session expiry
  const sessionExp = localStorage.getItem(SE_KEY);
  if (sessionExp && Date.now() > parseInt(sessionExp)) {
    localStorage.removeItem('bct_auth');
    localStorage.removeItem(SE_KEY);
  }
  
  // Set session expiry on successful auth
  if (!localStorage.getItem(SE_KEY)) {
    localStorage.setItem(SE_KEY, String(Date.now() + SESSION_MS));
  }
  
  // Rate limit check (used by auth forms)
  window._bctCheckRL = function() {
    try {
      const rl = JSON.parse(localStorage.getItem(RL_KEY) || '{"c":0,"t":0}');
      if (rl.c >= MAX_ATTEMPTS && (Date.now() - rl.t) < LOCKOUT_MS) {
        const mins = Math.ceil((LOCKOUT_MS - (Date.now() - rl.t)) / 60000);
        return { locked: true, mins: mins };
      }
      if ((Date.now() - rl.t) >= LOCKOUT_MS) {
        localStorage.setItem(RL_KEY, JSON.stringify({c: 0, t: Date.now()}));
        return { locked: false };
      }
      return { locked: false };
    } catch(e) { return { locked: false }; }
  };
  window._bctRecordFail = function() {
    try {
      const rl = JSON.parse(localStorage.getItem(RL_KEY) || '{"c":0,"t":0}');
      rl.c++;
      rl.t = Date.now();
      localStorage.setItem(RL_KEY, JSON.stringify(rl));
    } catch(e) {}
  };
  window._bctResetRL = function() {
    localStorage.removeItem(RL_KEY);
  };
})();

        
        // Anti-tampering: Block context menu and dev tools
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', e => {
            if(e.key==='F12'||(e.ctrlKey&&e.shiftKey&&(e.key==='I'||e.key==='J'||e.key==='C'))||(e.ctrlKey&&e.key==='U')){
                e.preventDefault();
                return false;
            }
        });
        
        function littoralApp() {
            return {
                // State
                currentTab: 'today',
                loading: true,
                showDemoBanner: true,
                hasDemoData: false,
                
                // Data
                customers: [],
                appointments: [],
                treatments: [],
                quotes: [],
                
                // Search
                customerSearch: '',
                
                // Modals
                showCustomerModal: false,
                showAppointmentModal: false,
                showCustomerDetail: false,
                showImportModal: false,
                
                // Forms
                customerForm: {},
                appointmentForm: {},
                quoteForm: {},
                editingCustomer: null,
                selectedCustomer: null,
                quoteResult: null,
                pasteData: '',
                
                // Toasts
                toasts: [],
                
                // Undo state
                deletedItems: [],
                
                // Navigation
                navItems: [
                    { id: 'today', label: 'Today', icon: '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>' },
                    { id: 'customers', label: 'Customers', icon: '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>' },
                    { id: 'quotes', label: 'Quotes', icon: '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>' },
                    { id: 'history', label: 'History', icon: '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>' },
                    { id: 'stats', label: 'Stats', icon: '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>' }
                ],
                
                // Database
                db: null,
                
                async init() {
                    await this.initDB();
                    await this.loadData();
                    this.resetForms();
                    // Brief delay to ensure DOM is ready, then show content
                    setTimeout(() => { this.loading = false; }, 100);
                    
                    // Check for demo data
                    this.hasDemoData = this.customers.some(c => c.isDemo);
                    
                    // Initialize charts when on stats tab
                    this.$watch('currentTab', (tab) => {
                        if (tab === 'stats') {
                            setTimeout(() => this.initCharts(), 100);
                        }
                    });
                },
                
                async initDB() {
                    return new Promise((resolve, reject) => {
                        const request = indexedDB.open('LittoralLineDB', 1);
                        
                        request.onerror = () => {
                            console.error('IndexedDB failed, using localStorage');
                            resolve();
                        };
                        
                        request.onsuccess = (e) => {
                            this.db = e.target.result;
                            resolve();
                        };
                        
                        request.onupgradeneeded = (e) => {
                            const db = e.target.result;
                            if (!db.objectStoreNames.contains('customers')) {
                                db.createObjectStore('customers', { keyPath: 'id' });
                            }
                            if (!db.objectStoreNames.contains('appointments')) {
                                db.createObjectStore('appointments', { keyPath: 'id' });
                            }
                            if (!db.objectStoreNames.contains('treatments')) {
                                db.createObjectStore('treatments', { keyPath: 'id' });
                            }
                            if (!db.objectStoreNames.contains('quotes')) {
                                db.createObjectStore('quotes', { keyPath: 'id' });
                            }
                        };
                    });
                },
                
                async loadData() {
                    if (this.db) {
                        this.customers = await this.getAllFromStore('customers');
                        this.appointments = await this.getAllFromStore('appointments');
                        this.treatments = await this.getAllFromStore('treatments');
                        this.quotes = await this.getAllFromStore('quotes');
                    } else {
                        // Fallback to localStorage
                        this.customers = JSON.parse(localStorage.getItem('ll_customers') || '[]');
                        this.appointments = JSON.parse(localStorage.getItem('ll_appointments') || '[]');
                        this.treatments = JSON.parse(localStorage.getItem('ll_treatments') || '[]');
                        this.quotes = JSON.parse(localStorage.getItem('ll_quotes') || '[]');
                    }
                },
                
                getAllFromStore(storeName) {
                    return new Promise((resolve) => {
                        const tx = this.db.transaction(storeName, 'readonly');
                        const store = tx.objectStore(storeName);
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result || []);
                        request.onerror = () => resolve([]);
                    });
                },
                
                async saveToStore(storeName, data) {
                    if (this.db) {
                        return new Promise((resolve) => {
                            const tx = this.db.transaction(storeName, 'readwrite');
                            const store = tx.objectStore(storeName);
                            store.put(data);
                            tx.oncomplete = () => resolve();
                        });
                    } else {
                        const key = 'll_' + storeName;
                        const items = JSON.parse(localStorage.getItem(key) || '[]');
                        const idx = items.findIndex(i => i.id === data.id);
                        if (idx >= 0) items[idx] = data;
                        else items.push(data);
                        localStorage.setItem(key, JSON.stringify(items));
                    }
                },
                
                async deleteFromStore(storeName, id) {
                    if (this.db) {
                        return new Promise((resolve) => {
                            const tx = this.db.transaction(storeName, 'readwrite');
                            const store = tx.objectStore(storeName);
                            store.delete(id);
                            tx.oncomplete = () => resolve();
                        });
                    } else {
                        const key = 'll_' + storeName;
                        const items = JSON.parse(localStorage.getItem(key) || '[]');
                        localStorage.setItem(key, JSON.stringify(items.filter(i => i.id !== id)));
                    }
                },
                
                async clearStore(storeName) {
                    if (this.db) {
                        return new Promise((resolve) => {
                            const tx = this.db.transaction(storeName, 'readwrite');
                            const store = tx.objectStore(storeName);
                            store.clear();
                            tx.oncomplete = () => resolve();
                        });
                    } else {
                        localStorage.removeItem('ll_' + storeName);
                    }
                },
                
                resetForms() {
                    this.customerForm = {
                        name: '',
                        phone: '',
                        email: '',
                        address: '',
                        propertyType: 'single-family',
                        servicePlan: 'bimonthly',
                        notes: ''
                    };
                    this.appointmentForm = {
                        customerId: '',
                        date: dayjs().format('YYYY-MM-DD'),
                        time: '09:00',
                        serviceType: 'General Pest',
                        duration: '45',
                        price: '60',
                        notes: ''
                    };
                    this.quoteForm = {
                        serviceType: '',
                        propertyType: '',
                        sqft: '',
                        frequency: 'bimonthly'
                    };
                },
                
                // Customer methods
                openCustomerModal(customer = null) {
                    if (customer && customer.id) {
                        this.editingCustomer = customer;
                        this.customerForm = { ...customer };
                    } else {
                        this.editingCustomer = null;
                        this.resetForms();
                    }
                    this.showCustomerModal = true;
                },
                
                async saveCustomer() {
                    const customer = {
                        ...this.customerForm,
                        id: this.editingCustomer?.id || 'cust_' + Date.now(),
                        createdAt: this.editingCustomer?.createdAt || new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    await this.saveToStore('customers', customer);
                    
                    const idx = this.customers.findIndex(c => c.id === customer.id);
                    if (idx >= 0) this.customers[idx] = customer;
                    else this.customers.push(customer);
                    
                    this.showCustomerModal = false;
                    this.showToast(this.editingCustomer ? 'Customer updated' : 'Customer added', 'success');
                    this.resetForms();
                },
                
                async deleteCustomer(id) {
                    const customer = this.customers.find(c => c.id === id);
                    if (!customer) return;
                    
                    const idx = this.customers.findIndex(c => c.id === id);
                    this.customers.splice(idx, 1);
                    await this.deleteFromStore('customers', id);
                    
                    this.showToast('Customer deleted', 'success', () => {
                        this.customers.push(customer);
                        this.saveToStore('customers', customer);
                    });
                },
                
                viewCustomer(customer) {
                    this.selectedCustomer = customer;
                    this.showCustomerDetail = true;
                },
                
                editCustomer(customer) {
                    this.showCustomerDetail = false;
                    setTimeout(() => this.openCustomerModal(customer), 100);
                },
                
                // Appointment methods
                openAppointmentModal(customer = null) {
                    this.resetForms();
                    if (customer) {
                        this.appointmentForm.customerId = customer.id;
                    }
                    this.showAppointmentModal = true;
                },
                
                async saveAppointment() {
                    const appointment = {
                        ...this.appointmentForm,
                        id: 'apt_' + Date.now(),
                        status: 'scheduled',
                        createdAt: new Date().toISOString()
                    };
                    
                    await this.saveToStore('appointments', appointment);
                    this.appointments.push(appointment);
                    
                    this.showAppointmentModal = false;
                    this.showToast('Appointment scheduled', 'success');
                    this.resetForms();
                },
                
                async completeAppointment(id) {
                    const apt = this.appointments.find(a => a.id === id);
                    if (!apt) return;
                    
                    apt.status = 'completed';
                    apt.completedAt = new Date().toISOString();
                    await this.saveToStore('appointments', apt);
                    
                    // Create treatment record
                    const treatment = {
                        id: 'treat_' + Date.now(),
                        customerId: apt.customerId,
                        appointmentId: apt.id,
                        serviceType: apt.serviceType,
                        date: apt.date,
                        products: '',
                        notes: apt.notes,
                        createdAt: new Date().toISOString()
                    };
                    
                    await this.saveToStore('treatments', treatment);
                    this.treatments.unshift(treatment);
                    
                    // Update customer last service
                    const customer = this.customers.find(c => c.id === apt.customerId);
                    if (customer) {
                        customer.lastService = apt.date;
                        await this.saveToStore('customers', customer);
                    }
                    
                    this.showToast('Appointment completed!', 'success');
                },
                
                viewAppointment(apt) {
                    const customer = this.customers.find(c => c.id === apt.customerId);
                    if (customer) this.viewCustomer(customer);
                },
                
                // Quote methods
                calculateQuote() {
                    if (!this.quoteForm.serviceType || !this.quoteForm.propertyType || !this.quoteForm.sqft) {
                        this.showToast('Please fill all fields', 'warning');
                        return;
                    }
                    
                    // Pricing logic based on research ($60 bimonthly baseline)
                    const basePrices = {
                        'General Pest': 60,
                        'Bed Bug': 800,
                        'Mosquito': 75,
                        'Rodent': 150,
                        'Termite': 85,
                        'Roach': 100
                    };
                    
                    const propertyMultipliers = {
                        'single-family': 1,
                        'condo': 0.8,
                        'apartment': 0.7,
                        'airbnb': 1.1,
                        'restaurant': 1.5,
                        'commercial': 2
                    };
                    
                    const frequencyMultipliers = {
                        'one-time': 1.5,
                        'monthly': 0.9,
                        'bimonthly': 1,
                        'quarterly': 1.1
                    };
                    
                    const frequencyLabels = {
                        'one-time': 'one-time',
                        'monthly': 'per month',
                        'bimonthly': 'every 2 months',
                        'quarterly': 'per quarter'
                    };
                    
                    const annualMultipliers = {
                        'one-time': 1,
                        'monthly': 12,
                        'bimonthly': 6,
                        'quarterly': 4
                    };
                    
                    let price = basePrices[this.quoteForm.serviceType] || 60;
                    price *= propertyMultipliers[this.quoteForm.propertyType] || 1;
                    price *= frequencyMultipliers[this.quoteForm.frequency] || 1;
                    
                    // Adjust for square footage
                    const sqft = parseInt(this.quoteForm.sqft);
                    if (sqft > 2500) price *= 1.25;
                    else if (sqft > 4000) price *= 1.5;
                    
                    price = Math.round(price);
                    
                    this.quoteResult = {
                        price: price,
                        service: this.quoteForm.serviceType,
                        property: this.quoteForm.propertyType.replace('-', ' '),
                        sqft: sqft,
                        frequency: frequencyLabels[this.quoteForm.frequency],
                        annual: price * annualMultipliers[this.quoteForm.frequency]
                    };
                    
                    // Save quote
                    const quote = {
                        id: 'quote_' + Date.now(),
                        ...this.quoteResult,
                        createdAt: new Date().toISOString()
                    };
                    this.quotes.unshift(quote);
                    this.saveToStore('quotes', quote);
                },
                
                copyQuote() {
                    if (!this.quoteResult) return;
                    const text = `Littoral Pest Solutions Quote\n\nService: ${this.quoteResult.service}\nProperty: ${this.quoteResult.property}\nSize: ${this.quoteResult.sqft.toLocaleString()} sq ft\n\nPrice: $${this.quoteResult.price} ${this.quoteResult.frequency}\nAnnual Value: $${this.quoteResult.annual}/year\n\nCall (912) 656-9357 to schedule!`;
                    navigator.clipboard.writeText(text);
                    this.showToast('Quote copied to clipboard', 'success');
                },
                
                printQuote() {
                    window.print();
                },
                
                // Computed properties
                get todayAppointments() {
                    const today = dayjs().format('YYYY-MM-DD');
                    return this.appointments
                        .filter(a => a.date === today)
                        .sort((a, b) => a.time.localeCompare(b.time));
                },
                
                get filteredCustomers() {
                    if (!this.customerSearch.trim()) return this.customers;
                    const search = this.customerSearch.toLowerCase();
                    return this.customers.filter(c => 
                        c.name.toLowerCase().includes(search) ||
                        c.address.toLowerCase().includes(search) ||
                        c.phone.includes(search)
                    );
                },
                
                // Helper methods
                getCustomerName(id) {
                    const customer = this.customers.find(c => c.id === id);
                    return customer?.name || 'Unknown Customer';
                },
                
                getCustomerAddress(id) {
                    const customer = this.customers.find(c => c.id === id);
                    return customer?.address || '';
                },
                
                getCustomerColor(name) {
                    const colors = ['#97C940', '#2F4D9E', '#F59E0B', '#8B5CF6', '#EC4899', '#10B981', '#3B82F6', '#EF4444'];
                    let hash = 0;
                    for (let i = 0; i < name.length; i++) {
                        hash = name.charCodeAt(i) + ((hash << 5) - hash);
                    }
                    return colors[Math.abs(hash) % colors.length];
                },
                
                getServiceBadgeClass(type) {
                    const classes = {
                        'General Pest': 'bg-green-100 text-green-700',
                        'Bed Bug': 'bg-red-100 text-red-700',
                        'Mosquito': 'bg-blue-100 text-blue-700',
                        'Rodent': 'bg-yellow-100 text-yellow-700',
                        'Termite': 'bg-orange-100 text-orange-700',
                        'Roach': 'bg-purple-100 text-purple-700'
                    };
                    return classes[type] || 'bg-gray-100 text-gray-700';
                },
                
                getServiceBgClass(type) {
                    const classes = {
                        'General Pest': 'bg-littoral-green',
                        'Bed Bug': 'bg-red-500',
                        'Mosquito': 'bg-blue-500',
                        'Rodent': 'bg-yellow-500',
                        'Termite': 'bg-orange-500',
                        'Roach': 'bg-purple-500'
                    };
                    return classes[type] || 'bg-gray-500';
                },
                
                formatTime(time) {
                    const [h, m] = time.split(':');
                    const hour = parseInt(h);
                    const ampm = hour >= 12 ? 'PM' : 'AM';
                    const displayHour = hour % 12 || 12;
                    return `${displayHour}:${m} ${ampm}`;
                },
                
                getTotalDuration() {
                    const mins = this.todayAppointments.reduce((sum, a) => sum + parseInt(a.duration || 45), 0);
                    return (mins / 60).toFixed(1);
                },
                
                getTodayRevenue() {
                    return this.todayAppointments.reduce((sum, a) => sum + parseFloat(a.price || 60), 0);
                },
                
                getMonthlyTreatments() {
                    const thisMonth = dayjs().format('YYYY-MM');
                    return this.treatments.filter(t => t.date.startsWith(thisMonth)).length;
                },
                
                calculateMRR() {
                    // Estimate based on bimonthly customers
                    const bimonthlyCount = this.customers.filter(c => c.servicePlan === 'bimonthly').length;
                    const monthlyCount = this.customers.filter(c => c.servicePlan === 'monthly').length;
                    return (bimonthlyCount * 30) + (monthlyCount * 60);
                },
                
                getUpcomingCount() {
                    const today = dayjs().format('YYYY-MM-DD');
                    return this.appointments.filter(a => a.date > today && a.status !== 'completed').length;
                },
                
                getCustomerTreatments(customerId) {
                    if (!customerId) return [];
                    return this.treatments.filter(t => t.customerId === customerId).sort((a, b) => b.date.localeCompare(a.date));
                },
                
                getTopCustomers() {
                    return this.customers.map(c => ({
                        ...c,
                        treatmentCount: this.treatments.filter(t => t.customerId === c.id).length
                    })).sort((a, b) => b.treatmentCount - a.treatmentCount).slice(0, 5);
                },
                
                // Toast
                showToast(message, type = 'success', undoAction = null) {
                    const id = Date.now();
                    const toast = { id, message, type, visible: true, undoAction };
                    this.toasts.push(toast);
                    
                    setTimeout(() => {
                        toast.visible = false;
                        setTimeout(() => {
                            this.toasts = this.toasts.filter(t => t.id !== id);
                        }, 300);
                    }, undoAction ? 5000 : 3000);
                },
                
                dismissToast(id) {
                    const toast = this.toasts.find(t => t.id === id);
                    if (toast) toast.visible = false;
                },
                
                // Demo data
                async loadDemoData() {
                    const demoCustomers = [
                        {
                            id: 'demo_cust_1',
                            name: 'Debra Richardson',
                            phone: '(912) 555-0147',
                            email: 'debra.r@email.com',
                            address: '428 Bull St, Savannah, GA 31401',
                            propertyType: 'single-family',
                            servicePlan: 'bimonthly',
                            notes: 'Historic district home. Gate code: 1234. Dog in backyard.',
                            isDemo: true,
                            createdAt: '2024-03-15T10:00:00Z',
                            lastService: '2026-01-15'
                        },
                        {
                            id: 'demo_cust_2',
                            name: 'Marcus Thompson',
                            phone: '(912) 555-0293',
                            email: 'marcus.t@gmail.com',
                            address: '1205 Pooler Pkwy, Pooler, GA 31322',
                            propertyType: 'single-family',
                            servicePlan: 'bimonthly',
                            notes: 'Ant problem near kitchen sink. Use granular bait.',
                            isDemo: true,
                            createdAt: '2024-06-20T14:30:00Z',
                            lastService: '2026-01-28'
                        },
                        {
                            id: 'demo_cust_3',
                            name: 'Coastal View Rentals',
                            phone: '(912) 555-0389',
                            email: 'manager@coastalviewrentals.com',
                            address: '14 Tybrisa St, Tybee Island, GA 31328',
                            propertyType: 'airbnb',
                            servicePlan: 'monthly',
                            notes: 'Vacation rental - schedule between guest checkouts. Contact Maria for access.',
                            isDemo: true,
                            createdAt: '2024-01-10T09:00:00Z',
                            lastService: '2026-02-01'
                        },
                        {
                            id: 'demo_cust_4',
                            name: 'Jennifer Okonkwo',
                            phone: '(912) 555-0521',
                            email: 'jen.okonkwo@outlook.com',
                            address: '892 Ford Ave, Richmond Hill, GA 31324',
                            propertyType: 'single-family',
                            servicePlan: 'quarterly',
                            notes: 'Termite warranty customer. Annual inspection in April.',
                            isDemo: true,
                            createdAt: '2023-11-05T11:00:00Z',
                            lastService: '2025-11-12'
                        },
                        {
                            id: 'demo_cust_5',
                            name: 'River Street Bistro',
                            phone: '(912) 555-0678',
                            email: 'info@riverstreetbistro.com',
                            address: '307 W River St, Savannah, GA 31401',
                            propertyType: 'commercial',
                            servicePlan: 'monthly',
                            notes: 'Restaurant - service after 10 PM. Focus on kitchen and storage areas.',
                            isDemo: true,
                            createdAt: '2024-08-01T16:00:00Z',
                            lastService: '2026-02-03'
                        }
                    ];
                    
                    const today = dayjs().format('YYYY-MM-DD');
                    const demoAppointments = [
                        {
                            id: 'demo_apt_1',
                            customerId: 'demo_cust_2',
                            date: today,
                            time: '09:00',
                            serviceType: 'General Pest',
                            duration: '45',
                            price: '60',
                            status: 'scheduled',
                            notes: 'Bimonthly maintenance',
                            isDemo: true
                        },
                        {
                            id: 'demo_apt_2',
                            customerId: 'demo_cust_1',
                            date: today,
                            time: '10:30',
                            serviceType: 'Mosquito',
                            duration: '60',
                            price: '75',
                            status: 'scheduled',
                            notes: 'Yard treatment for outdoor event',
                            isDemo: true
                        },
                        {
                            id: 'demo_apt_3',
                            customerId: 'demo_cust_3',
                            date: today,
                            time: '14:00',
                            serviceType: 'General Pest',
                            duration: '45',
                            price: '70',
                            status: 'scheduled',
                            notes: 'Between guest checkout - key under mat',
                            isDemo: true
                        }
                    ];
                    
                    const demoTreatments = [
                        {
                            id: 'demo_treat_1',
                            customerId: 'demo_cust_2',
                            serviceType: 'General Pest',
                            date: '2026-01-28',
                            products: 'Termidor SC, Advion Ant Gel',
                            notes: 'Treated kitchen baseboards and exterior perimeter',
                            isDemo: true
                        },
                        {
                            id: 'demo_treat_2',
                            customerId: 'demo_cust_1',
                            serviceType: 'General Pest',
                            date: '2026-01-15',
                            products: 'Suspend SC, Delta Dust',
                            notes: 'Full interior and exterior treatment',
                            isDemo: true
                        },
                        {
                            id: 'demo_treat_3',
                            customerId: 'demo_cust_5',
                            serviceType: 'Roach',
                            date: '2026-02-03',
                            products: 'Vendetta Plus, Gentrol IGR',
                            notes: 'Kitchen and storage focus. No activity in dining area.',
                            isDemo: true
                        },
                        {
                            id: 'demo_treat_4',
                            customerId: 'demo_cust_3',
                            serviceType: 'General Pest',
                            date: '2026-02-01',
                            products: 'Demand CS, MaxForce Granular',
                            notes: 'Full unit treatment between rentals',
                            isDemo: true
                        }
                    ];
                    
                    // Save demo data
                    for (const customer of demoCustomers) {
                        await this.saveToStore('customers', customer);
                    }
                    for (const apt of demoAppointments) {
                        await this.saveToStore('appointments', apt);
                    }
                    for (const treat of demoTreatments) {
                        await this.saveToStore('treatments', treat);
                    }
                    
                    this.customers = [...this.customers.filter(c => !c.isDemo), ...demoCustomers];
                    this.appointments = [...this.appointments.filter(a => !a.isDemo), ...demoAppointments];
                    this.treatments = [...this.treatments.filter(t => !t.isDemo), ...demoTreatments];
                    
                    this.hasDemoData = true;
                    this.showToast('Demo data loaded — 5 Savannah-area customers', 'success');
                },
                
                async clearDemoData() {
                    // Remove demo items
                    for (const c of this.customers.filter(c => c.isDemo)) {
                        await this.deleteFromStore('customers', c.id);
                    }
                    for (const a of this.appointments.filter(a => a.isDemo)) {
                        await this.deleteFromStore('appointments', a.id);
                    }
                    for (const t of this.treatments.filter(t => t.isDemo)) {
                        await this.deleteFromStore('treatments', t.id);
                    }
                    
                    this.customers = this.customers.filter(c => !c.isDemo);
                    this.appointments = this.appointments.filter(a => !a.isDemo);
                    this.treatments = this.treatments.filter(t => !t.isDemo);
                    
                    this.hasDemoData = false;
                    this.showDemoBanner = false;
                    this.showToast('Demo data cleared', 'success');
                },
                
                // Import/Export
                async importCSV(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const text = await file.text();
                    this.parseAndImportCSV(text);
                    event.target.value = '';
                },
                
                importPastedData() {
                    if (!this.pasteData.trim()) return;
                    this.parseAndImportCSV(this.pasteData);
                    this.pasteData = '';
                },
                
                async parseAndImportCSV(text) {
                    const lines = text.trim().split('\n');
                    let imported = 0;
                    
                    for (const line of lines) {
                        const parts = line.split(',').map(p => p.trim().replace(/^["']|["']$/g, ''));
                        if (parts.length >= 2) {
                            const customer = {
                                id: 'cust_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5),
                                name: parts[0] || 'Unknown',
                                phone: parts[1] || '',
                                email: parts[2] || '',
                                address: parts[3] || '',
                                propertyType: 'single-family',
                                servicePlan: 'bimonthly',
                                notes: '',
                                createdAt: new Date().toISOString()
                            };
                            await this.saveToStore('customers', customer);
                            this.customers.push(customer);
                            imported++;
                        }
                    }
                    
                    this.showImportModal = false;
                    this.showToast(`Imported ${imported} customers`, 'success');
                },
                
                async restoreJSON(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    try {
                        const text = await file.text();
                        const data = JSON.parse(text);
                        
                        if (data.customers) {
                            await this.clearStore('customers');
                            for (const c of data.customers) {
                                await this.saveToStore('customers', c);
                            }
                            this.customers = data.customers;
                        }
                        if (data.appointments) {
                            await this.clearStore('appointments');
                            for (const a of data.appointments) {
                                await this.saveToStore('appointments', a);
                            }
                            this.appointments = data.appointments;
                        }
                        if (data.treatments) {
                            await this.clearStore('treatments');
                            for (const t of data.treatments) {
                                await this.saveToStore('treatments', t);
                            }
                            this.treatments = data.treatments;
                        }
                        if (data.quotes) {
                            await this.clearStore('quotes');
                            for (const q of data.quotes) {
                                await this.saveToStore('quotes', q);
                            }
                            this.quotes = data.quotes;
                        }
                        
                        this.hasDemoData = this.customers.some(c => c.isDemo);
                        this.showImportModal = false;
                        this.showToast('Data restored successfully', 'success');
                    } catch (e) {
                        this.showToast('Invalid JSON file', 'error');
                    }
                    
                    event.target.value = '';
                },
                
                exportCSV() {
                    const rows = [['Name', 'Phone', 'Email', 'Address', 'Property Type', 'Service Plan']];
                    for (const c of this.customers) {
                        rows.push([c.name, c.phone, c.email || '', c.address, c.propertyType, c.servicePlan]);
                    }
                    const csv = rows.map(r => r.map(f => `"${f}"`).join(',')).join('\n');
                    this.downloadFile(csv, 'littoral-customers.csv', 'text/csv');
                    this.showToast('CSV exported', 'success');
                },
                
                exportJSON() {
                    const data = {
                        customers: this.customers,
                        appointments: this.appointments,
                        treatments: this.treatments,
                        quotes: this.quotes,
                        exportedAt: new Date().toISOString()
                    };
                    this.downloadFile(JSON.stringify(data, null, 2), 'littoral-backup.json', 'application/json');
                    this.showToast('JSON backup exported', 'success');
                },
                
                downloadFile(content, filename, type) {
                    const blob = new Blob([content], { type });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    a.click();
                    URL.revokeObjectURL(url);
                },
                
                // Charts
                initCharts() {
                    // Service type chart
                    const serviceCtx = document.getElementById('serviceChart');
                    if (serviceCtx && !serviceCtx.chart) {
                        const serviceCounts = {};
                        this.treatments.forEach(t => {
                            serviceCounts[t.serviceType] = (serviceCounts[t.serviceType] || 0) + 1;
                        });
                        
                        serviceCtx.chart = new Chart(serviceCtx, {
                            type: 'doughnut',
                            data: {
                                labels: Object.keys(serviceCounts).length ? Object.keys(serviceCounts) : ['No Data'],
                                datasets: [{
                                    data: Object.values(serviceCounts).length ? Object.values(serviceCounts) : [1],
                                    backgroundColor: ['#97C940', '#2F4D9E', '#F59E0B', '#8B5CF6', '#EC4899', '#10B981']
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { position: 'bottom' }
                                }
                            }
                        });
                    }
                    
                    // Monthly chart
                    const monthlyCtx = document.getElementById('monthlyChart');
                    if (monthlyCtx && !monthlyCtx.chart) {
                        const months = [];
                        const counts = [];
                        for (let i = 5; i >= 0; i--) {
                            const month = dayjs().subtract(i, 'month');
                            months.push(month.format('MMM'));
                            const monthStr = month.format('YYYY-MM');
                            counts.push(this.appointments.filter(a => a.date.startsWith(monthStr)).length);
                        }
                        
                        monthlyCtx.chart = new Chart(monthlyCtx, {
                            type: 'bar',
                            data: {
                                labels: months,
                                datasets: [{
                                    label: 'Appointments',
                                    data: counts,
                                    backgroundColor: '#97C940',
                                    borderRadius: 8
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { display: false }
                                },
                                scales: {
                                    y: { beginAtZero: true, ticks: { stepSize: 1 } }
                                }
                            }
                        });
                    }
                }
            };
        }
    </script>

<!-- DEMO DISCLAIMER - Legal Notice -->

<!-- BennyCuTools Purchase CTA — injected by inject-cta.py -->
<style>
#bct-cta-bar {
  position: fixed;
  bottom: 48px;
  left: 0;
  right: 0;
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  border-top: 2px solid #6366f1;
  padding: 10px 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  z-index: 99998;
  flex-wrap: wrap;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
}
#bct-cta-bar .bct-cta-text {
  color: #e4e4e7;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 14px;
  font-weight: 500;
}
#bct-cta-bar .bct-cta-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 20px;
  background: #6366f1;
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 14px;
  font-weight: 600;
  border: none;
  border-radius: 6px;
  text-decoration: none;
  cursor: pointer;
  transition: background 0.2s, transform 0.1s;
}
#bct-cta-bar .bct-cta-btn:hover {
  background: #4f46e5;
  transform: translateY(-1px);
}
#bct-cta-bar .bct-cta-btn-secondary {
  background: transparent;
  border: 1px solid #6366f1;
  color: #a5b4fc;
}
#bct-cta-bar .bct-cta-btn-secondary:hover {
  background: rgba(99,102,241,0.15);
}
@media (max-width: 600px) {
  #bct-cta-bar {
    flex-direction: column;
    gap: 8px;
    padding: 8px 12px;
    bottom: 44px;
  }
  #bct-cta-bar .bct-cta-text { font-size: 12px; }
  #bct-cta-bar .bct-cta-btn { font-size: 13px; padding: 7px 16px; width: 100%; justify-content: center; }
}
</style>
<div id="bct-cta-bar" role="banner" aria-label="Purchase this tool">
  <span class="bct-cta-text">Like this tool? Make it yours.</span>
  <a class="bct-cta-btn" id="bct-buy-btn" href="https://bennycutools.com/buy.html">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
    Get It — $200 One-Time
  </a>
  <a class="bct-cta-btn bct-cta-btn-secondary" href="mailto:cuuper225@gmail.com?subject=Question%20about%20my%20custom%20tool">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
    Questions? Email Ben
  </a>
</div>
<script>
// Auto-fill the buy link with the current tool's page name
(function(){
  try {
    var pg = location.pathname.replace(/.*\//, '').replace('.html','');
    var buyBtn = document.getElementById('bct-buy-btn');
    if (buyBtn && pg) {
      buyBtn.href = 'https://bennycutools.com/buy.html?tool=' + encodeURIComponent(pg);
    }
  } catch(e){}
})();
</script>
<!-- End BennyCuTools Purchase CTA -->

<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer">
  <p><strong>DEMO NOTICE:</strong> This tool was created by BennyCuTools as a free demonstration only.
  It is not affiliated with, endorsed by, or authorized by Littoral Pest Solutions.
  All brand references are used solely for demonstration purposes.</p>
  <a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20Littoral%20Pest%20Solutions&body=I%20am%20the%20owner%20of%20Littoral%20Pest%20Solutions%20and%20I%20request%20permanent%20deletion%20of%20the%20demo%20tool%20on%20bennycutools.com." class="bct-delete-btn" aria-label="Request permanent deletion of this demo">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
    Request Permanent Deletion
  </a>
</div>

</body>
</html>
