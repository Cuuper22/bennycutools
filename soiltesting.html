<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>BoringLog - Soil Testing Inc</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
--pri:#1a237e;--pri-l:#283593;--pri-d:#0d1647;
--earth:#795548;--earth-l:#8d6e63;
--bg:#eceef2;--surf:#fff;--surf-a:#f5f6f8;
--text:#1a1e2c;--text-m:#5c6270;--text-l:#8c919f;
--bdr:#d5d9e2;--bdr-f:#1a237e;
--ok:#2e7d32;--warn:#e65100;--err:#b71c1c;
--sh:0 2px 4px rgba(0,0,0,.07);--sh-md:0 4px 8px rgba(0,0,0,.1);--sh-lg:0 10px 20px rgba(0,0,0,.1);
--r:6px;--rl:10px;
--fh:'IBM Plex Sans',sans-serif;--fm:'IBM Plex Mono',monospace;
}
html{font-size:15px}
body{font-family:var(--fh);background:var(--bg);color:var(--text);line-height:1.5;padding-bottom:120px!important;overflow-x:hidden;-webkit-font-smoothing:antialiased}
h1,h2,h3{font-weight:700;line-height:1.2}
*:focus-visible{outline:2px solid var(--pri);outline-offset:2px}
@media(prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:.01ms!important;transition-duration:.01ms!important}}
.skip{position:absolute;top:-100px;left:0;background:var(--pri);color:#fff;padding:8px 16px;z-index:100000}.skip:focus{top:0}

#app{display:none;min-height:100vh}
.hdr{background:linear-gradient(135deg,var(--pri-d),var(--pri));color:#fff;padding:14px 18px;position:sticky;top:0;z-index:900}
.hdr h1{font-size:1.1rem;letter-spacing:.02em}.hdr p{font-size:.72rem;opacity:.65;margin-top:1px}

.demo-b{background:#e8eaf6;border-bottom:1px solid #c5cae9;padding:8px 14px;display:flex;align-items:center;justify-content:space-between;font-size:.78rem;color:#1a237e}
.demo-b button{background:none;border:1px solid #3f51b5;color:#1a237e;padding:3px 8px;border-radius:4px;cursor:pointer;font-size:.72rem}

.view{display:none;padding:14px;animation:fu .25s ease-out}.view.active{display:block}
@keyframes fu{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

.card{background:var(--surf);border-radius:var(--rl);box-shadow:var(--sh);padding:14px;margin-bottom:8px;cursor:pointer;transition:transform .1s;position:relative}
.card:hover{transform:translateY(-1px);box-shadow:var(--sh-md)}
.card-name{font-weight:600;font-size:.9rem;margin-bottom:2px}
.card-sub{font-size:.78rem;color:var(--text-m)}
.card-meta{display:flex;gap:8px;margin-top:6px;font-size:.72rem;color:var(--text-l)}
.tag{display:inline-block;padding:1px 6px;border-radius:12px;font-size:.68rem;font-weight:600}
.tag-active{background:#e8f5e9;color:#2e7d32}.tag-draft{background:#f5f5f5;color:#757575}

.fg{margin-bottom:10px}
.fg label{display:block;font-size:.75rem;font-weight:500;color:var(--text-m);margin-bottom:2px}
.fg input,.fg select,.fg textarea{width:100%;padding:8px 10px;border:1.5px solid var(--bdr);border-radius:var(--r);font-size:.9rem;background:var(--surf);color:var(--text);font-family:var(--fh);transition:border-color .12s}
.fg input:focus,.fg select:focus,.fg textarea:focus{border-color:var(--bdr-f);box-shadow:0 0 0 2px rgba(26,35,126,.08)}
.fr{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.fr3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}

/* Boring list */
.boring-tab{display:flex;gap:4px;overflow-x:auto;padding:4px 0;margin-bottom:12px;-webkit-overflow-scrolling:touch}
.boring-tab::-webkit-scrollbar{display:none}
.b-tab{padding:6px 14px;border-radius:20px;background:var(--surf-a);border:1.5px solid var(--bdr);font-size:.78rem;font-weight:600;cursor:pointer;white-space:nowrap;transition:all .1s;flex-shrink:0}
.b-tab.active{background:var(--pri);color:#fff;border-color:var(--pri)}
.b-tab:active{transform:scale(.96)}

/* Sample row */
.sample-row{display:grid;grid-template-columns:50px 1fr 60px 40px;gap:6px;align-items:center;padding:8px 6px;border-bottom:1px solid var(--bdr);font-size:.8rem}
.sample-row:nth-child(even){background:var(--surf-a)}
.sample-depth{font-family:var(--fm);font-weight:600;font-size:.82rem;color:var(--pri);text-align:center}
.sample-desc{font-size:.78rem;color:var(--text)}
.sample-n{font-family:var(--fm);font-weight:600;text-align:center;font-size:.85rem}
.sample-del{background:none;border:none;color:var(--text-l);cursor:pointer;font-size:.7rem;padding:4px}

/* Soil column viz */
.soil-column{display:flex;flex-direction:column;width:40px;border:1px solid var(--bdr);border-radius:var(--r);overflow:hidden;margin-right:10px;flex-shrink:0}
.soil-band{min-height:12px;width:100%}

/* Boring header */
.boring-hdr{display:grid;grid-template-columns:50px 1fr 60px 40px;gap:6px;padding:6px;background:var(--pri);color:#fff;border-radius:var(--r) var(--r) 0 0;font-size:.7rem;font-weight:600;text-transform:uppercase;letter-spacing:.04em}
.boring-hdr span{text-align:center}
.boring-hdr span:nth-child(2){text-align:left}

/* GW marker */
.gw-line{display:flex;align-items:center;gap:6px;padding:4px 6px;background:#e3f2fd;border:1px dashed #42a5f5;border-radius:var(--r);font-size:.75rem;color:#1565c0;margin:4px 0}

.sec-t{font-weight:600;font-size:.8rem;color:var(--pri);text-transform:uppercase;letter-spacing:.04em;margin:12px 0 6px;padding-bottom:4px;border-bottom:2px solid var(--bdr)}

.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:9px 16px;border:none;border-radius:var(--r);font-size:.82rem;font-weight:600;cursor:pointer;transition:transform .08s;font-family:var(--fh)}
.btn:active{transform:scale(.97)}
.btn-pri{background:var(--pri);color:#fff;box-shadow:var(--sh)}.btn-pri:hover{background:var(--pri-l)}
.btn-sec{background:var(--surf);color:var(--text);border:1.5px solid var(--bdr)}
.btn-sm{padding:6px 10px;font-size:.75rem}
.btn-block{width:100%}
.btn-danger{background:#ffebee;color:var(--err)}
.upsell-lock{opacity:.4;pointer-events:none;position:relative}
.upsell-lock::after{content:'Full Version';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--pri);color:#fff;padding:2px 8px;border-radius:12px;font-size:.68rem;font-weight:600}

.bnav{position:fixed;bottom:40px;left:0;right:0;background:var(--surf);border-top:1px solid var(--bdr);display:flex;z-index:800;box-shadow:0 -2px 6px rgba(0,0,0,.04)}
.ni{flex:1;display:flex;flex-direction:column;align-items:center;padding:7px 0;cursor:pointer;color:var(--text-l);border:none;background:none;font-size:.65rem;font-weight:500;gap:2px}
.ni.active{color:var(--pri)}.ni svg{width:20px;height:20px}

.toast-c{position:fixed;top:70px;right:14px;z-index:6000}
.toast{background:var(--pri-d);color:#fff;padding:8px 12px;border-radius:var(--r);font-size:.78rem;margin-bottom:6px;animation:si .2s ease-out;box-shadow:var(--sh-lg)}
@keyframes si{from{opacity:0;transform:translateX(12px)}to{opacity:1;transform:translateX(0)}}

.empty{text-align:center;padding:40px 18px}
.empty h3{margin-bottom:6px;font-size:1rem}.empty p{color:var(--text-m);font-size:.85rem;margin-bottom:14px}

.sbox{padding:14px;background:var(--surf);border-radius:var(--rl);margin-bottom:8px;box-shadow:var(--sh)}
.sbox h3{font-size:.82rem;font-weight:600;margin-bottom:8px;color:var(--pri)}

@media print{.bnav,.hdr,.demo-b,.toast-c,#bct-demo-disclaimer,.btn{display:none!important}body{background:#fff;padding:0!important;font-size:11px}.view{display:block!important;padding:0}.sample-row{font-size:.72rem}.boring-hdr{font-size:.65rem}}
@media(min-width:1024px){.bnav{display:none}#app{max-width:520px;margin:0 auto}}

/* Soil colors */
.sc-clay{background:#8d6e63}.sc-sand{background:#d4a437}.sc-silt{background:#9e9e9e}.sc-gravel{background:#78909c}.sc-fill{background:#6d4c41}
.sc-rock{background:#455a64}.sc-topsoil{background:#33691e}.sc-peat{background:#3e2723}.sc-till{background:#607d8b}
</style>
</head>
<body>
<a href="#main" class="skip">Skip to content</a>
<div id="gate" style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:var(--fh);background:#111;color:#fff;text-align:center;padding:20px"><div><h1 style="font-size:1.8rem;margin-bottom:1rem">Access Required</h1><p style="color:#999;margin-bottom:20px">This tool needs a valid access key.</p><p><a href="mailto:ben@bennycutools.com" style="color:#4da6ff">ben@bennycutools.com</a></p></div></div>

<div id="app" role="application">
<header class="hdr"><h1>BoringLog</h1><p>Soil Testing Inc -- Field Logger</p></header>
<div class="demo-b" id="demoB" role="alert"><span>Sample project loaded.</span><button onclick="clearDemo()" aria-label="Clear">Clear</button></div>

<main id="main">
<!-- PROJECTS LIST -->
<section class="view active" id="projView" aria-label="Projects">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
<h2 style="font-size:1rem">Projects</h2>
<button class="btn btn-pri btn-sm" onclick="newProj()" aria-label="New project"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> New</button>
</div>
<div id="projList"></div>
</section>

<!-- PROJECT EDIT -->
<section class="view" id="editView" aria-label="Project details">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
<h2 id="editTitle" style="font-size:.95rem">New Project</h2>
<button class="btn btn-sec btn-sm" onclick="go('proj')">Back</button>
</div>
<div class="sec-t">Project Info</div>
<div class="fg"><label for="pName">Site / Project Name</label><input type="text" id="pName" placeholder="Stamford Commercial Site"></div>
<div class="fr"><div class="fg"><label for="pLoc">Location</label><input type="text" id="pLoc" placeholder="123 Main St, Stamford, CT"></div><div class="fg"><label for="pClient">Client</label><input type="text" id="pClient" placeholder="Engineering firm name"></div></div>
<div class="fr"><div class="fg"><label for="pJob">Job #</label><input type="text" id="pJob" placeholder="2026-015"></div><div class="fg"><label for="pDate">Date</label><input type="date" id="pDate"></div></div>

<div class="sec-t" style="display:flex;justify-content:space-between;align-items:center">Borings <button class="btn btn-sec btn-sm" onclick="addBoring()"><svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> Add Boring</button></div>
<div class="boring-tab" id="boringTabs"></div>

<!-- Current boring samples -->
<div id="boringContent"></div>

<div style="display:flex;gap:6px;margin-top:14px">
<button class="btn btn-pri btn-block" onclick="saveProj()">Save Project</button>
</div>
<div style="display:flex;gap:6px;margin-top:6px">
<button class="btn btn-sec btn-block" onclick="printLog()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg> Print Log</button>
<button class="btn btn-sec btn-block" onclick="shareLog()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg> Share</button>
<button class="btn btn-sec btn-block upsell-lock" disabled>gINT Export</button>
</div>
</section>

<!-- ADD SAMPLE -->
<section class="view" id="sampleView" aria-label="Add sample">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
<h2 style="font-size:.95rem" id="sampleTitle">Add Sample</h2>
<button class="btn btn-sec btn-sm" onclick="go('edit')">Cancel</button>
</div>
<div class="fr"><div class="fg"><label for="sDepthFrom">Depth From (ft)</label><input type="number" id="sDepthFrom" step="0.5" min="0" placeholder="15.0"></div><div class="fg"><label for="sDepthTo">Depth To (ft)</label><input type="number" id="sDepthTo" step="0.5" min="0" placeholder="17.0"></div></div>
<div class="fg"><label for="sSoilType">Soil Type</label><select id="sSoilType"><option value="clay">Clay</option><option value="silt">Silt</option><option value="sand">Sand</option><option value="gravel">Gravel</option><option value="fill">Fill</option><option value="topsoil">Topsoil</option><option value="peat">Peat/Organic</option><option value="till">Glacial Till</option><option value="rock">Rock/Bedrock</option></select></div>
<div class="fr"><div class="fg"><label for="sColor">Color</label><select id="sColor"><option value="brown">Brown</option><option value="gray">Gray</option><option value="tan">Tan</option><option value="red-brown">Red-Brown</option><option value="dark-brown">Dark Brown</option><option value="black">Black</option><option value="yellow-brown">Yellow-Brown</option><option value="mottled">Mottled</option></select></div>
<div class="fg"><label for="sMoisture">Moisture</label><select id="sMoisture"><option value="dry">Dry</option><option value="moist">Moist</option><option value="wet">Wet</option><option value="saturated">Saturated</option></select></div></div>
<div class="fg"><label for="sConsist">Consistency/Density</label><select id="sConsist"><option value="very-soft">Very Soft</option><option value="soft">Soft</option><option value="medium">Medium Stiff</option><option value="stiff">Stiff</option><option value="very-stiff">Very Stiff</option><option value="hard">Hard</option><option value="loose">Loose</option><option value="medium-dense">Medium Dense</option><option value="dense">Dense</option><option value="very-dense">Very Dense</option></select></div>
<div class="sec-t">SPT Blow Counts</div>
<p style="font-size:.75rem;color:var(--text-m);margin-bottom:8px">Enter blows per 6-inch increment. N-value = sum of last two increments.</p>
<div class="fr3">
<div class="fg"><label for="sB1">0-6"</label><input type="number" id="sB1" min="0" max="100" placeholder="5" class="spt-input"></div>
<div class="fg"><label for="sB2">6-12"</label><input type="number" id="sB2" min="0" max="100" placeholder="4" class="spt-input"></div>
<div class="fg"><label for="sB3">12-18"</label><input type="number" id="sB3" min="0" max="100" placeholder="3" class="spt-input"></div>
</div>
<div style="text-align:center;padding:10px;background:var(--surf-a);border-radius:var(--r);margin:8px 0;font-family:var(--fm)">
<span style="font-size:.75rem;color:var(--text-m)">N-Value =</span> <strong style="font-size:1.3rem;color:var(--pri)" id="nVal">--</strong>
</div>
<div class="fg"><label for="sNotes">Notes</label><input type="text" id="sNotes" placeholder="Trace gravel, slight odor, etc."></div>
<div class="fg"><label><input type="checkbox" id="sGW" style="width:auto;margin-right:6px"> Groundwater encountered at this depth</label></div>
<button class="btn btn-pri btn-block" onclick="saveSample()">Save Sample</button>
</section>

<!-- SETTINGS -->
<section class="view" id="settingsView" aria-label="Settings">
<h2 style="margin-bottom:12px;font-size:1rem">Settings</h2>
<div class="sbox"><h3>Company</h3>
<div class="fg"><label for="coName">Name</label><input type="text" id="coName" value="Soil Testing, Inc."></div>
<div class="fg"><label for="coLic">License</label><input type="text" id="coLic" placeholder="State registration #"></div>
</div>
<div class="sbox"><h3>Data</h3>
<div style="display:flex;gap:6px;flex-wrap:wrap">
<button class="btn btn-sec btn-sm" onclick="expData()">Export JSON</button>
<button class="btn btn-sec btn-sm" onclick="document.getElementById('impF').click()">Import</button>
<input type="file" id="impF" accept=".json" style="display:none" onchange="impData(event)">
<button class="btn btn-danger btn-sm" onclick="resetAll()">Reset</button>
</div></div>
<div class="sbox"><h3 style="display:flex;align-items:center;gap:6px">gINT / AGS Export <span style="display:inline-block;padding:1px 6px;background:#e8eaf6;border:1px solid #c5cae9;border-radius:12px;font-size:.65rem;font-weight:600;color:#1a237e;text-transform:uppercase">Full Version</span></h3>
<p style="font-size:.78rem;color:var(--text-m)">Export boring logs to gINT-compatible format or AGS data transfer. Includes multi-project batch export and custom report templates. $200 one-time.</p>
</div>
</section>
</main>

<nav class="bnav" aria-label="Navigation">
<button class="ni active" onclick="go('proj')" data-v="proj" aria-label="Projects"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>Projects</button>
<button class="ni" onclick="newProj()" data-v="edit" aria-label="New"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>New</button>
<button class="ni" onclick="go('settings')" data-v="settings" aria-label="Settings"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>Settings</button>
</nav>
</div>

<div class="toast-c" id="toastC" aria-live="polite"></div>

<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer" style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:10px 16px;font-size:12px;line-height:1.4;color:#666;z-index:99999;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:8px 16px;text-align:center;">
<p style="margin:0;max-width:700px;"><strong style="color:#333;">DEMO NOTICE:</strong> This tool was created by BennyCuTools as a free demonstration only. It is not affiliated with, endorsed by, or authorized by Soil Testing, Inc. All brand references are used solely for demonstration purposes.</p>
<a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20Soil%20Testing%20Inc&body=I%20am%20the%20owner%20and%20I%20request%20permanent%20deletion%20of%20this%20demo." style="display:inline-flex;align-items:center;gap:4px;background:#dc3545;color:#fff;padding:5px 12px;border-radius:4px;text-decoration:none;font-size:11px;font-weight:500;white-space:nowrap;"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>Request Permanent Deletion</a>
</div>

<script>
function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
const _V=1488041267;
const _k=new URLSearchParams(window.location.search).get('key');
if(_k&&_h(_k)===_V){localStorage.setItem('bl_a','1');document.getElementById('gate').style.display='none';document.getElementById('app').style.display='block';init();}
else if(localStorage.getItem('bl_a')==='1'){document.getElementById('gate').style.display='none';document.getElementById('app').style.display='block';init();}
document.addEventListener('contextmenu',e=>e.preventDefault());

let db;
function odb(){return new Promise((r,j)=>{const q=indexedDB.open('BoringLogDB',1);q.onupgradeneeded=e=>{const d=e.target.result;if(!d.objectStoreNames.contains('projects'))d.createObjectStore('projects',{keyPath:'id'});};q.onsuccess=e=>{db=e.target.result;r();};q.onerror=e=>j(e);});}
function pt(d){return new Promise(r=>{const t=db.transaction('projects','readwrite');t.objectStore('projects').put(d);t.oncomplete=()=>r();});}
function ga(){return new Promise(r=>{const t=db.transaction('projects','readonly');const q=t.objectStore('projects').getAll();q.onsuccess=()=>r(q.result);});}
function gt(k){return new Promise(r=>{const t=db.transaction('projects','readonly');const q=t.objectStore('projects').get(k);q.onsuccess=()=>r(q.result);});}
function dl(k){return new Promise(r=>{const t=db.transaction('projects','readwrite');t.objectStore('projects').delete(k);t.oncomplete=()=>r();});}
function cl(){return new Promise(r=>{const t=db.transaction('projects','readwrite');t.objectStore('projects').clear();t.oncomplete=()=>r();});}

let editId=null;let proj={borings:[]};let curBoring=0;let editSampleIdx=-1;

const SOIL_COLORS={clay:'#8d6e63',silt:'#9e9e9e',sand:'#d4a437',gravel:'#78909c',fill:'#6d4c41',topsoil:'#33691e',peat:'#3e2723',till:'#607d8b',rock:'#455a64'};

const DEMO={id:'demo-1',name:'Stamford Commercial Site',loc:'450 Atlantic St, Stamford, CT',client:'Barton Engineering LLC',job:'2026-008',date:'2026-02-10',borings:[
{name:'B-1',gw:12,samples:[
{from:0,to:2,type:'topsoil',color:'dark-brown',moisture:'moist',consist:'soft',b1:2,b2:3,b3:3,n:6,notes:'Organic topsoil with roots',gw:false},
{from:2,to:4,type:'fill',color:'brown',moisture:'moist',consist:'medium',b1:4,b2:5,b3:6,n:11,notes:'Sandy fill with brick fragments',gw:false},
{from:4,to:6,type:'sand',color:'tan',moisture:'moist',consist:'medium-dense',b1:6,b2:8,b3:9,n:17,notes:'Fine to medium sand, trace silt',gw:false},
{from:6,to:8,type:'sand',color:'tan',moisture:'moist',consist:'medium-dense',b1:7,b2:9,b3:10,n:19,notes:'Medium sand',gw:false},
{from:8,to:10,type:'silt',color:'gray',moisture:'wet',consist:'soft',b1:3,b2:4,b3:4,n:8,notes:'Clayey silt, some organics',gw:false},
{from:10,to:12,type:'silt',color:'gray',moisture:'wet',consist:'medium',b1:5,b2:6,b3:7,n:13,notes:'Silt, becoming saturated',gw:false},
{from:12,to:14,type:'clay',color:'gray',moisture:'saturated',consist:'stiff',b1:8,b2:10,b3:12,n:22,notes:'Stiff clay. GW at 12ft.',gw:true},
{from:14,to:16,type:'clay',color:'gray',moisture:'saturated',consist:'stiff',b1:10,b2:12,b3:14,n:26,notes:'Glacial clay',gw:false},
]},
{name:'B-2',gw:14,samples:[
{from:0,to:2,type:'topsoil',color:'dark-brown',moisture:'moist',consist:'soft',b1:2,b2:2,b3:3,n:5,notes:'Topsoil',gw:false},
{from:2,to:5,type:'fill',color:'brown',moisture:'moist',consist:'medium',b1:5,b2:6,b3:7,n:13,notes:'Granular fill',gw:false},
{from:5,to:8,type:'sand',color:'yellow-brown',moisture:'moist',consist:'dense',b1:12,b2:15,b3:18,n:33,notes:'Coarse sand with gravel',gw:false},
{from:8,to:12,type:'silt',color:'gray',moisture:'moist',consist:'medium',b1:6,b2:7,b3:8,n:15,notes:'Silty fine sand',gw:false},
{from:12,to:16,type:'clay',color:'gray',moisture:'saturated',consist:'stiff',b1:9,b2:11,b3:13,n:24,notes:'Hard clay. GW at 14ft.',gw:true},
]},
{name:'B-3',gw:null,samples:[
{from:0,to:3,type:'fill',color:'brown',moisture:'dry',consist:'loose',b1:3,b2:3,b3:4,n:7,notes:'Loose fill, asphalt cap',gw:false},
{from:3,to:6,type:'gravel',color:'tan',moisture:'moist',consist:'dense',b1:15,b2:20,b3:22,n:42,notes:'Sandy gravel, well-graded',gw:false},
{from:6,to:10,type:'till',color:'gray',moisture:'moist',consist:'very-dense',b1:25,b2:35,b3:40,n:75,notes:'Glacial till. Refusal at 10ft.',gw:false},
]}
],status:'active',date_ts:Date.now()-86400000*2,isDemo:true};

async function init(){
await odb();
const projs=await ga();
if(!localStorage.getItem('bl_v')&&!projs.length){await pt(DEMO);localStorage.setItem('bl_v','1');}
renderProjs();
document.querySelectorAll('.spt-input').forEach(el=>el.addEventListener('input',calcN));
}

function go(v){
document.querySelectorAll('.view').forEach(el=>el.classList.remove('active'));
document.getElementById(v+'View').classList.add('active');
document.querySelectorAll('.ni').forEach(b=>b.classList.toggle('active',b.getAttribute('data-v')===v));
if(v==='proj'){renderProjs();editId=null;proj={borings:[]};}
}

async function renderProjs(){
const projs=(await ga()).sort((a,b)=>(b.date_ts||0)-(a.date_ts||0));
const el=document.getElementById('projList');
document.getElementById('demoB').style.display=projs.some(p=>p.isDemo)?'flex':'none';
if(!projs.length){el.innerHTML=`<div class="empty"><h3>No projects</h3><p>Start a new boring log from the field.</p><button class="btn btn-pri" onclick="newProj()">New Project</button></div>`;return;}
el.innerHTML=projs.map(p=>{
const tc=p.borings.reduce((a,b)=>a+b.samples.length,0);
return `<div class="card" onclick="openProj('${p.id}')" tabindex="0" aria-label="${p.name}"><div class="card-name">${p.name}</div><div class="card-sub">${p.loc||''} -- ${p.client||''}</div><div class="card-meta"><span>${p.borings.length} boring${p.borings.length!==1?'s':''}</span><span>${tc} samples</span><span class="tag ${p.status==='active'?'tag-active':'tag-draft'}">${p.status||'draft'}</span>${p.job?'<span>Job: '+p.job+'</span>':''}</div></div>`;
}).join('');
}

function newProj(){
editId=null;proj={borings:[]};
['pName','pLoc','pClient','pJob'].forEach(id=>document.getElementById(id).value='');
document.getElementById('pDate').value=new Date().toISOString().split('T')[0];
curBoring=0;renderBorings();
document.getElementById('editTitle').textContent='New Project';
go('edit');
}

async function openProj(id){
const p=await gt(id);if(!p)return;
editId=id;proj=JSON.parse(JSON.stringify(p));
document.getElementById('pName').value=p.name||'';
document.getElementById('pLoc').value=p.loc||'';
document.getElementById('pClient').value=p.client||'';
document.getElementById('pJob').value=p.job||'';
document.getElementById('pDate').value=p.date||'';
curBoring=0;renderBorings();
document.getElementById('editTitle').textContent=p.name||'Edit Project';
go('edit');
}

function addBoring(){
const n='B-'+(proj.borings.length+1);
proj.borings.push({name:n,gw:null,samples:[]});
curBoring=proj.borings.length-1;
renderBorings();toast('Added '+n);
}

function renderBorings(){
const tabs=document.getElementById('boringTabs');
tabs.innerHTML=proj.borings.map((b,i)=>`<div class="b-tab ${i===curBoring?'active':''}" onclick="switchBoring(${i})">${b.name} (${b.samples.length})</div>`).join('');
renderBoringContent();
}

function switchBoring(i){curBoring=i;renderBorings();}

function renderBoringContent(){
const el=document.getElementById('boringContent');
if(!proj.borings.length){el.innerHTML='<p style="text-align:center;color:var(--text-m);padding:20px;font-size:.85rem">Tap "Add Boring" to start your first boring log.</p>';return;}
const b=proj.borings[curBoring];
if(!b){el.innerHTML='';return;}
const samples=b.samples.sort((a,c)=>a.from-c.from);

// Build soil column + table
let html=`<div style="display:flex;gap:8px;margin-bottom:12px">`;
// Soil column visualization
if(samples.length){
const maxD=Math.max(...samples.map(s=>s.to));
html+=`<div class="soil-column" style="height:${Math.max(samples.length*24,120)}px" aria-label="Visual soil profile">`;
samples.forEach(s=>{
const pct=((s.to-s.from)/maxD)*100;
html+=`<div class="soil-band" style="background:${SOIL_COLORS[s.type]||'#bbb'};flex:${s.to-s.from}" title="${s.from}-${s.to}ft: ${s.type}"></div>`;
});
html+=`</div>`;
}

html+=`<div style="flex:1;overflow:hidden">`;
html+=`<div class="boring-hdr"><span>Depth</span><span>Description</span><span>N</span><span></span></div>`;

samples.forEach((s,i)=>{
const gwMark=s.gw?`<div class="gw-line"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#42a5f5" stroke-width="2"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/></svg> GW at ${s.from}ft</div>`:'';
html+=gwMark;
html+=`<div class="sample-row" onclick="editSample(${i})" tabindex="0" aria-label="Sample ${s.from}-${s.to}ft">
<div class="sample-depth">${s.from}-${s.to}</div>
<div class="sample-desc">${s.color} ${s.type}${s.consist?', '+s.consist.replace(/-/g,' '):''}${s.moisture?', '+s.moisture:''}${s.notes?'<br><span style="color:var(--text-l);font-size:.72rem">'+s.notes+'</span>':''}</div>
<div class="sample-n" style="color:${s.n>30?'var(--ok)':s.n<10?'var(--err)':'var(--text)'}">${s.n||'--'}</div>
<button class="sample-del" onclick="event.stopPropagation();rmSample(${i})" aria-label="Delete sample">x</button>
</div>`;
});

html+=`</div></div>`;
html+=`<button class="btn btn-sec btn-block btn-sm" onclick="addSample()" style="margin-top:6px"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> Add Sample at ${samples.length?samples[samples.length-1].to:0}ft</button>`;

// Summary
const totalSamples=samples.length;
const maxDepth=samples.length?Math.max(...samples.map(s=>s.to)):0;
const avgN=totalSamples?Math.round(samples.reduce((a,s)=>a+(s.n||0),0)/totalSamples):0;
html+=`<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-top:10px;text-align:center">
<div style="padding:8px;background:var(--surf-a);border-radius:var(--r)"><div style="font-family:var(--fm);font-size:1.1rem;font-weight:700;color:var(--pri)">${totalSamples}</div><div style="font-size:.68rem;color:var(--text-m)">Samples</div></div>
<div style="padding:8px;background:var(--surf-a);border-radius:var(--r)"><div style="font-family:var(--fm);font-size:1.1rem;font-weight:700;color:var(--pri)">${maxDepth}ft</div><div style="font-size:.68rem;color:var(--text-m)">Max Depth</div></div>
<div style="padding:8px;background:var(--surf-a);border-radius:var(--r)"><div style="font-family:var(--fm);font-size:1.1rem;font-weight:700;color:${avgN>30?'var(--ok)':avgN<10?'var(--err)':'var(--pri)'}">${avgN||'--'}</div><div style="font-size:.68rem;color:var(--text-m)">Avg N</div></div>
</div>`;

el.innerHTML=html;
}

function addSample(){
editSampleIdx=-1;
const b=proj.borings[curBoring];
const lastTo=b&&b.samples.length?Math.max(...b.samples.map(s=>s.to)):0;
document.getElementById('sDepthFrom').value=lastTo;
document.getElementById('sDepthTo').value=lastTo+2;
document.getElementById('sSoilType').value='clay';
document.getElementById('sColor').value='brown';
document.getElementById('sMoisture').value='moist';
document.getElementById('sConsist').value='medium';
['sB1','sB2','sB3','sNotes'].forEach(id=>document.getElementById(id).value='');
document.getElementById('sGW').checked=false;
document.getElementById('nVal').textContent='--';
document.getElementById('sampleTitle').textContent='Add Sample';
go('sample');
}

function editSample(i){
editSampleIdx=i;
const s=proj.borings[curBoring].samples[i];
document.getElementById('sDepthFrom').value=s.from;
document.getElementById('sDepthTo').value=s.to;
document.getElementById('sSoilType').value=s.type;
document.getElementById('sColor').value=s.color;
document.getElementById('sMoisture').value=s.moisture;
document.getElementById('sConsist').value=s.consist;
document.getElementById('sB1').value=s.b1||'';
document.getElementById('sB2').value=s.b2||'';
document.getElementById('sB3').value=s.b3||'';
document.getElementById('sGW').checked=s.gw||false;
document.getElementById('sNotes').value=s.notes||'';
calcN();
document.getElementById('sampleTitle').textContent='Edit Sample';
go('sample');
}

function calcN(){
const b2=parseInt(document.getElementById('sB2').value)||0;
const b3=parseInt(document.getElementById('sB3').value)||0;
const n=b2+b3;
document.getElementById('nVal').textContent=n||'--';
}

function saveSample(){
const s={
from:parseFloat(document.getElementById('sDepthFrom').value)||0,
to:parseFloat(document.getElementById('sDepthTo').value)||0,
type:document.getElementById('sSoilType').value,
color:document.getElementById('sColor').value,
moisture:document.getElementById('sMoisture').value,
consist:document.getElementById('sConsist').value,
b1:parseInt(document.getElementById('sB1').value)||0,
b2:parseInt(document.getElementById('sB2').value)||0,
b3:parseInt(document.getElementById('sB3').value)||0,
n:(parseInt(document.getElementById('sB2').value)||0)+(parseInt(document.getElementById('sB3').value)||0),
notes:document.getElementById('sNotes').value.trim(),
gw:document.getElementById('sGW').checked
};
if(s.to<=s.from){toast('Depth To must be greater than From');return;}
if(editSampleIdx>=0){proj.borings[curBoring].samples[editSampleIdx]=s;}
else{proj.borings[curBoring].samples.push(s);}
renderBorings();toast('Sample saved');go('edit');
}

function rmSample(i){proj.borings[curBoring].samples.splice(i,1);renderBorings();toast('Removed');}

async function saveProj(){
const name=document.getElementById('pName').value.trim();
if(!name){toast('Enter project name');return;}
proj.id=editId||'p-'+Date.now();
proj.name=name;proj.loc=document.getElementById('pLoc').value.trim();
proj.client=document.getElementById('pClient').value.trim();
proj.job=document.getElementById('pJob').value.trim();
proj.date=document.getElementById('pDate').value;
proj.status=proj.status||'active';proj.date_ts=proj.date_ts||Date.now();
proj.isDemo=false;
await pt(proj);toast(editId?'Updated':'Saved');editId=proj.id;
document.getElementById('editTitle').textContent=name;
}

function printLog(){window.print();}

async function shareLog(){
const name=proj.name||'(unsaved)';
const lines=[`Soil Testing Inc -- Boring Log\n${name}`,`Location: ${proj.loc||''}`,`Client: ${proj.client||''}\n`];
proj.borings.forEach(b=>{
lines.push(`--- ${b.name} ---`);
b.samples.sort((a,c)=>a.from-c.from).forEach(s=>{
lines.push(`${s.from}-${s.to}ft: ${s.color} ${s.type}, ${s.consist.replace(/-/g,' ')}, ${s.moisture}, N=${s.n}${s.notes?' ('+s.notes+')':''}`);
});
lines.push('');
});
const text=lines.join('\n');
if(navigator.share){try{await navigator.share({title:'Boring Log',text});}catch(e){}}
else{try{await navigator.clipboard.writeText(text);toast('Copied');}catch(e){}}
}

async function clearDemo(){const all=await ga();for(const p of all){if(p.isDemo)await dl(p.id);}document.getElementById('demoB').style.display='none';renderProjs();toast('Cleared');}
async function resetAll(){if(!confirm('Delete all data?'))return;await cl();proj={borings:[]};renderProjs();toast('Reset');}
async function expData(){const d=await ga();const b=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='boringlog-backup.json';a.click();}
async function impData(e){const f=e.target.files[0];if(!f)return;try{const t=await f.text();const d=JSON.parse(t);if(Array.isArray(d))for(const p of d)await pt(p);renderProjs();toast('Imported');}catch(err){toast('Bad file');}}

function toast(m){const el=document.createElement('div');el.className='toast';el.textContent=m;document.getElementById('toastC').appendChild(el);setTimeout(()=>el.remove(),2200);}
</script>
</body>
</html>
