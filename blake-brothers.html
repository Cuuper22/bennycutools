<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Blake Shield Risk Visualizer â€” Blake Brothers</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='16' fill='%23d22630'/%3E%3Cpath d='M50 15L20 32v36c0 18.5 12.8 35.8 30 40 17.2-4.2 30-21.5 30-40V32L50 15z' fill='none' stroke='white' stroke-width='6'/%3E%3Cpath d='M50 35L50 65M38 50L62 50' stroke='white' stroke-width='6' stroke-linecap='round'/%3E%3C/svg%3E">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Libre+Caslon+Text:wght@400;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ============================================================
   CSS CUSTOM PROPERTIES
   ============================================================ */
:root {
  --blake-red: #d22630;
  --blake-red-dark: #a81e27;
  --blake-dark: #1c1b1a;
  --blake-gold: #bdb07e;
  --blake-gold-light: #d4c99a;
  --blake-white: #ffffff;
  --blake-grey-100: #f7f7f6;
  --blake-grey-200: #e8e7e5;
  --blake-grey-300: #d0cfcc;
  --blake-grey-500: #8a8984;
  --blake-grey-700: #4a4946;
  --risk-green: #22c55e;
  --risk-yellow: #eab308;
  --risk-red: #ef4444;
  --risk-green-bg: rgba(34,197,94,0.12);
  --risk-yellow-bg: rgba(234,179,8,0.12);
  --risk-red-bg: rgba(239,68,68,0.12);
  --font-heading: 'Libre Caslon Text', Georgia, serif;
  --font-body: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
  --radius-sm: 6px;
  --radius-md: 10px;
  --radius-lg: 16px;
  --radius-xl: 24px;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
  --shadow-lg: 0 8px 30px rgba(0,0,0,0.12);
  --shadow-xl: 0 20px 60px rgba(0,0,0,0.15);
  --transition: 0.2s ease;
  /* Light mode defaults */
  --bg-primary: var(--blake-white);
  --bg-secondary: var(--blake-grey-100);
  --bg-card: var(--blake-white);
  --bg-input: var(--blake-grey-100);
  --text-primary: var(--blake-dark);
  --text-secondary: var(--blake-grey-700);
  --text-muted: var(--blake-grey-500);
  --border-color: var(--blake-grey-200);
  --hud-glow: rgba(210,38,48,0.15);
}

[data-theme="dark"] {
  --bg-primary: #0f0f0e;
  --bg-secondary: #1a1918;
  --bg-card: #222120;
  --bg-input: #2a2928;
  --text-primary: #f0efed;
  --text-secondary: #b8b7b4;
  --text-muted: #7a7975;
  --border-color: #3a3938;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
  --shadow-lg: 0 8px 30px rgba(0,0,0,0.5);
  --shadow-xl: 0 20px 60px rgba(0,0,0,0.6);
  --hud-glow: rgba(210,38,48,0.25);
}

/* ============================================================
   RESET & BASE
   ============================================================ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

/* Prevent text selection on structural elements (keep on inputs/textareas) */
.demo-banner, .top-nav, .bottom-nav, .card-header, .hud-stat, .stat-card, 
.risk-report-header, .risk-report-cta, .report-list-item, .page-header,
.risk-scenario, .factor-chip, .empty-state, .settings-section h3,
.rli-risk, .rli-status, .conversion-actions, .btn, .nav-links a {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Keep selection enabled for inputs and textareas */
input, textarea, .form-input, .form-textarea {
  -webkit-user-select: text;
  -moz-user-select: text;
  -ms-user-select: text;
  user-select: text;
}

html { font-size: 16px; -webkit-text-size-adjust: 100%; overflow-x: hidden; }

body {
  font-family: var(--font-body);
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.6;
  min-height: 100vh;
  min-height: 100dvh;
  overflow-x: hidden;
  transition: background var(--transition), color var(--transition);
  max-width: 100vw;
}

/* ============================================================
   DEMO BANNER
   ============================================================ */
.demo-banner {
  background: linear-gradient(90deg, var(--blake-gold) 0%, var(--blake-gold-light) 100%);
  color: var(--blake-dark);
  font-family: var(--font-body);
  font-size: 0.75rem;
  font-weight: 600;
  text-align: center;
  padding: 8px 40px 8px 12px;
  position: relative;
  z-index: 1000;
  letter-spacing: 0.02em;
  width: 100%;
  box-sizing: border-box;
  overflow: hidden;
}
.demo-banner .demo-close {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0,0,0,0.15);
  border: none;
  color: var(--blake-dark);
  width: 28px;
  height: 28px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background var(--transition);
}
.demo-banner .demo-close:hover { background: rgba(0,0,0,0.25); }
.demo-banner.hidden { display: none; }

/* ============================================================
   TOP NAV (â‰¥1024)
   ============================================================ */
.top-nav {
  display: none;
  background: var(--blake-dark);
  padding: 0 24px;
  height: 56px;
  align-items: center;
  justify-content: space-between;
  border-bottom: 2px solid var(--blake-red);
  position: sticky;
  top: 0;
  z-index: 900;
}
@media (min-width: 1024px) {
  .top-nav { display: flex; }
  .bottom-nav { display: none !important; }
}
.top-nav .brand {
  display: flex;
  align-items: center;
  gap: 12px;
}
.top-nav .brand-icon {
  width: 32px;
  height: 32px;
  background: var(--blake-red);
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
}
.top-nav .brand-icon svg { width: 20px; height: 20px; fill: white; }
.top-nav .brand-name {
  font-family: var(--font-heading);
  color: var(--blake-white);
  font-size: 1rem;
  font-weight: 700;
}
.top-nav .brand-sub {
  color: var(--blake-gold);
  font-size: 0.7rem;
  font-weight: 400;
  letter-spacing: 0.08em;
  text-transform: uppercase;
}
.top-nav .nav-links {
  display: flex;
  gap: 4px;
  list-style: none;
}
.top-nav .nav-links li a {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  color: var(--blake-grey-300);
  text-decoration: none;
  font-size: 0.85rem;
  font-weight: 500;
  border-radius: var(--radius-sm);
  transition: all var(--transition);
}
.top-nav .nav-links li a:hover,
.top-nav .nav-links li a.active {
  color: var(--blake-white);
  background: rgba(255,255,255,0.08);
}
.top-nav .nav-links li a.active {
  border-bottom: 2px solid var(--blake-red);
  border-radius: var(--radius-sm) var(--radius-sm) 0 0;
}
.top-nav .nav-links li a svg { width: 18px; height: 18px; }
.top-nav .nav-actions {
  display: flex;
  align-items: center;
  gap: 12px;
}
.theme-toggle {
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.12);
  color: var(--blake-grey-300);
  width: 40px;
  height: 40px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--transition);
  font-size: 1.1rem;
}
.theme-toggle:hover { background: rgba(255,255,255,0.15); color: var(--blake-white); }

/* ============================================================
   BOTTOM NAV (<1024)
   ============================================================ */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--blake-dark);
  display: flex;
  justify-content: space-around;
  align-items: center;
  height: 64px;
  padding-bottom: env(safe-area-inset-bottom, 0);
  border-top: 2px solid var(--blake-red);
  z-index: 900;
  width: 100%;
  box-sizing: border-box;
}
.bottom-nav a {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 3px;
  color: var(--blake-grey-500);
  text-decoration: none;
  font-size: 0.65rem;
  font-weight: 500;
  min-width: 56px;
  min-height: 44px;
  padding: 4px;
  border-radius: var(--radius-sm);
  transition: all var(--transition);
}
.bottom-nav a svg { width: 22px; height: 22px; }
.bottom-nav a { transition: all 0.2s ease; }
.bottom-nav a:hover, .bottom-nav a.active { color: var(--blake-white); }
.bottom-nav a.active { background: rgba(210,38,48,0.25); box-shadow: inset 0 2px 8px rgba(210,38,48,0.3); }
.bottom-nav a:active { transform: scale(0.95); }

/* ============================================================
   MAIN LAYOUT
   ============================================================ */
.app-container {
  max-width: 900px;
  margin: 0 auto;
  padding: 20px 12px 84px;
  min-height: calc(100vh - 64px);
  width: 100%;
  overflow-x: hidden;
  box-sizing: border-box;
}
@media (min-width: 1024px) {
  .app-container { padding: 32px 24px 48px; }
}
@media (max-width: 374px) {
  .app-container { padding: 16px 8px 84px; }
  .hud-grid { gap: 6px; }
  .stat-row { gap: 6px; }
  .hud-stat { padding: 8px 6px; }
  .stat-card { padding: 8px 4px; }
}
@media (min-width: 1024px) {
  .app-container { padding: 32px 24px 48px; }
}

/* ============================================================
   PAGE / VIEW SYSTEM
   ============================================================ */
.view { display: none; animation: fadeIn 0.25s ease; }
.view.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

/* ============================================================
   TYPOGRAPHY
   ============================================================ */
h1, h2, h3 { font-family: var(--font-heading); font-weight: 700; line-height: 1.3; }
h1 { font-size: 1.5rem; }
h2 { font-size: 1.25rem; }
h3 { font-size: 1.1rem; }
.subtitle { color: var(--text-muted); font-size: 0.85rem; font-weight: 400; margin-top: 4px; }

/* ============================================================
   CARDS
   ============================================================ */
.card {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 20px;
  margin-bottom: 16px;
  box-shadow: var(--shadow-sm);
  transition: all var(--transition);
}
.card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); border-color: var(--blake-grey-300); }
.card { transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); }
.card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
}
.card-header h3 { font-size: 1rem; }

/* ============================================================
   HUD STAT BARS
   ============================================================ */
.hud-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 8px;
  margin-bottom: 20px;
  width: 100%;
  min-width: 0;
}
.hud-grid > * {
  min-width: 0;
  max-width: 100%;
  overflow: hidden;
}
@media (min-width: 768px) {
  .hud-grid { gap: 10px; }
}
.hud-stat {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: 10px 8px;
  position: relative;
  overflow: hidden;
  transition: all 0.2s ease;
  min-width: 0;
  max-width: 100%;
}
@media (min-width: 768px) {
  .hud-stat { padding: 12px; }
}
.hud-stat:hover {
  border-color: var(--stat-color, var(--blake-red));
  box-shadow: 0 4px 12px rgba(0,0,0,0.08), 0 0 0 1px var(--stat-color, var(--blake-red));
  transform: translateY(-2px);
}
.hud-stat::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--stat-color, var(--blake-red));
}
.hud-stat .stat-label {
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--text-muted);
  margin-bottom: 4px;
}
.hud-stat .stat-value {
  font-family: var(--font-heading);
  font-size: clamp(0.95rem, 4vw, 1.1rem);
  font-weight: 700;
  color: var(--stat-color, var(--blake-red));
}
.hud-stat .stat-detail {
  font-size: 0.65rem;
  color: var(--text-muted);
  margin-top: 2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ============================================================
   FORMS
   ============================================================ */
.form-group { margin-bottom: 16px; }
.form-label {
  display: block;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}
.form-input, .form-select, .form-textarea {
  width: 100%;
  padding: 12px 14px;
  font-family: var(--font-body);
  font-size: 16px;
  color: var(--text-primary);
  background: var(--bg-input);
  border: 1.5px solid var(--border-color);
  border-radius: var(--radius-md);
  transition: all var(--transition);
  -webkit-appearance: none;
}
.form-input:focus, .form-select:focus, .form-textarea:focus {
  outline: none;
  border-color: var(--blake-red);
  box-shadow: 0 0 0 4px var(--hud-glow), 0 2px 8px rgba(210,38,48,0.1);
  transform: translateY(-1px);
}
.form-input, .form-select, .form-textarea { transition: all 0.2s ease; }
.form-select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%238a8984' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 14px center;
  padding-right: 36px;
}
.form-textarea { min-height: 80px; resize: vertical; }

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

/* ============================================================
   BUTTONS
   ============================================================ */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 10px 16px;
  font-family: var(--font-body);
  font-size: 0.85rem;
  font-weight: 600;
  border: none;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all var(--transition);
  min-height: 40px;
  min-width: 40px;
  text-decoration: none;
  white-space: nowrap;
}
@media (min-width: 768px) {
  .btn { padding: 12px 24px; font-size: 0.9rem; gap: 8px; min-height: 44px; }
}
.btn svg { width: 18px; height: 18px; flex-shrink: 0; }
.btn-primary {
  background: var(--blake-red);
  color: var(--blake-white);
  box-shadow: 0 2px 8px rgba(210,38,48,0.3);
}
.btn-primary:hover { background: var(--blake-red-dark); box-shadow: 0 4px 20px rgba(210,38,48,0.5); transform: translateY(-2px) scale(1.02); }
.btn-primary:active { transform: translateY(0) scale(0.98); }
.btn-primary:focus-visible { outline: 2px solid var(--blake-red); outline-offset: 2px; }
.btn-secondary {
  background: var(--bg-secondary);
  color: var(--text-primary);
  border: 1.5px solid var(--border-color);
}
.btn-secondary:hover { border-color: var(--blake-red); color: var(--blake-red); }
.btn-gold {
  background: linear-gradient(135deg, var(--blake-gold), var(--blake-gold-light));
  color: var(--blake-dark);
  font-weight: 700;
}
.btn-gold:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(189,176,126,0.4); }
.btn-sm { padding: 6px 12px; font-size: 0.75rem; min-height: 32px; }
@media (min-width: 768px) {
  .btn-sm { padding: 8px 14px; font-size: 0.8rem; min-height: 36px; }
}
.btn-block { width: 100%; }
.btn-ghost {
  background: transparent;
  color: var(--text-secondary);
  padding: 8px 12px;
}
.btn-ghost:hover { color: var(--blake-red); background: var(--hud-glow); }

/* ============================================================
   RISK BARS
   ============================================================ */
.risk-bar-container {
  background: var(--bg-secondary);
  border-radius: 20px;
  height: 12px;
  overflow: hidden;
  position: relative;
}
.risk-bar {
  height: 100%;
  border-radius: 20px;
  transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
  position: relative;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}
.risk-bar::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 20px;
  background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
  animation: shimmer 2s infinite;
}
@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(200%); }
}
.risk-bar.low { background: linear-gradient(90deg, #16a34a, #22c55e); }
.risk-bar.medium { background: linear-gradient(90deg, #ca8a04, #eab308); }
.risk-bar.high { background: linear-gradient(90deg, #dc2626, #ef4444); }
.risk-bar.critical { background: linear-gradient(90deg, #991b1b, #dc2626); }

.risk-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 3px 10px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}
.risk-badge.low { background: var(--risk-green-bg); color: var(--risk-green); }
.risk-badge.medium { background: var(--risk-yellow-bg); color: var(--risk-yellow); }
.risk-badge.high { background: var(--risk-red-bg); color: var(--risk-red); }
.risk-badge.critical { background: rgba(153,27,27,0.15); color: #dc2626; }

/* ============================================================
   PHOTO UPLOAD
   ============================================================ */
.photo-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 10px;
  margin-bottom: 16px;
}
.photo-slot {
  aspect-ratio: 1;
  border: 2px dashed var(--border-color);
  border-radius: var(--radius-md);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 6px;
  cursor: pointer;
  transition: all var(--transition);
  position: relative;
  overflow: hidden;
  background: var(--bg-secondary);
  min-height: 100px;
}
.photo-slot:hover { border-color: var(--blake-red); background: var(--hud-glow); transform: scale(1.02); box-shadow: 0 4px 12px var(--hud-glow); }
.photo-slot { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
.photo-slot svg { width: 28px; height: 28px; color: var(--text-muted); }
.photo-slot .photo-label {
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  color: var(--text-muted);
}
.photo-slot img {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: var(--radius-md);
}
.photo-slot .photo-remove {
  position: absolute;
  top: 4px;
  right: 4px;
  width: 24px;
  height: 24px;
  background: rgba(0,0,0,0.6);
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 0.75rem;
  cursor: pointer;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 2;
}
.photo-slot.has-photo .photo-remove { display: flex; }
.photo-slot.has-photo svg,
.photo-slot.has-photo .photo-label { display: none; }

/* ============================================================
   RISK REPORT (THE HERO)
   ============================================================ */
.risk-report {
  background: var(--bg-card);
  border: 2px solid var(--blake-red);
  border-radius: var(--radius-xl);
  overflow: hidden;
  box-shadow: var(--shadow-lg), 0 0 40px var(--hud-glow);
  margin-bottom: 24px;
}
.risk-report-header {
  background: linear-gradient(135deg, var(--blake-dark) 0%, #2a2928 100%);
  padding: 20px 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 2px solid var(--blake-red);
}
.risk-report-header .rr-brand {
  display: flex;
  align-items: center;
  gap: 12px;
}
.risk-report-header .rr-shield {
  width: 44px;
  height: 44px;
  background: var(--blake-red);
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
}
.risk-report-header .rr-shield svg { width: 26px; height: 26px; fill: white; }
.risk-report-header .rr-title {
  font-family: var(--font-heading);
  color: var(--blake-white);
  font-size: 1.1rem;
  font-weight: 700;
}
.risk-report-header .rr-subtitle {
  color: var(--blake-gold);
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  font-weight: 600;
}
.risk-report-header .rr-date {
  color: var(--blake-grey-500);
  font-size: 0.75rem;
  text-align: right;
}

.risk-report-body { padding: 24px; }

.risk-report .customer-info {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border-color);
}
.risk-report .customer-info .ci-item {
  font-size: 0.8rem;
}
.risk-report .customer-info .ci-label {
  color: var(--text-muted);
  font-size: 0.65rem;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  font-weight: 600;
}
.risk-report .customer-info .ci-value {
  font-weight: 600;
  color: var(--text-primary);
}

.risk-report .local-factors {
  margin-bottom: 20px;
}
.risk-report .local-factors h4 {
  font-family: var(--font-body);
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--blake-gold);
  margin-bottom: 10px;
}
.factor-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.factor-chip {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 5px 10px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: 20px;
  font-size: 0.72rem;
  font-weight: 500;
  color: var(--text-secondary);
}
.factor-chip .fc-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.risk-comparison {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 20px;
}
.risk-scenario {
  border-radius: var(--radius-lg);
  padding: 18px;
  text-align: center;
  position: relative;
}
.risk-scenario.without {
  background: linear-gradient(135deg, rgba(239,68,68,0.06), rgba(239,68,68,0.12));
  border: 1.5px solid rgba(239,68,68,0.25);
}
.risk-scenario.with {
  background: linear-gradient(135deg, rgba(34,197,94,0.06), rgba(34,197,94,0.12));
  border: 1.5px solid rgba(34,197,94,0.25);
}
.risk-scenario .scenario-label {
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: 8px;
}
.risk-scenario.without .scenario-label { color: var(--risk-red); }
.risk-scenario.with .scenario-label { color: var(--risk-green); }
.risk-scenario .scenario-risk {
  font-family: var(--font-heading);
  font-size: 2rem;
  font-weight: 700;
  line-height: 1;
  margin-bottom: 4px;
}
.risk-scenario.without .scenario-risk { color: var(--risk-red); }
.risk-scenario.with .scenario-risk { color: var(--risk-green); }
.risk-scenario .scenario-sublabel {
  font-size: 0.7rem;
  color: var(--text-muted);
  margin-bottom: 10px;
}
.risk-scenario .scenario-cost {
  font-size: 1.1rem;
  font-weight: 700;
}
.risk-scenario.without .scenario-cost { color: var(--risk-red); }
.risk-scenario.with .scenario-cost { color: var(--risk-green); }
.risk-scenario .scenario-cost-label {
  font-size: 0.65rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

.risk-formula {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: 14px;
  margin-bottom: 20px;
  font-family: 'Courier New', monospace;
  font-size: 0.78rem;
  color: var(--text-secondary);
  line-height: 1.8;
  overflow-x: auto;
}
.risk-formula .formula-title {
  font-family: var(--font-body);
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--blake-gold);
  margin-bottom: 6px;
}

.risk-report .photo-evidence {
  margin-bottom: 20px;
}
.photo-evidence h4 {
  font-family: var(--font-body);
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--blake-gold);
  margin-bottom: 10px;
}
.evidence-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 8px;
}
.evidence-item {
  position: relative;
  border-radius: var(--radius-md);
  overflow: hidden;
  aspect-ratio: 1;
  background: var(--bg-secondary);
}
.evidence-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.evidence-item .evidence-label {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(transparent, rgba(0,0,0,0.7));
  color: white;
  font-size: 0.65rem;
  font-weight: 700;
  padding: 16px 8px 6px;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}

.risk-report-cta {
  background: linear-gradient(135deg, var(--blake-dark) 0%, #2a2928 100%);
  border-top: 2px solid var(--blake-red);
  padding: 20px 24px;
  text-align: center;
}
.risk-report-cta .cta-headline {
  font-family: var(--font-heading);
  color: var(--blake-white);
  font-size: 1rem;
  margin-bottom: 4px;
}
.risk-report-cta .cta-price {
  color: var(--blake-gold);
  font-size: 0.85rem;
  font-weight: 600;
  margin-bottom: 12px;
}

.risk-report .conversion-actions {
  display: flex;
  gap: 10px;
  margin-top: 16px;
}
.risk-report .conversion-actions .btn { flex: 1; }

/* ============================================================
   EMPTY STATE
   ============================================================ */
.empty-state {
  text-align: center;
  padding: 60px 24px;
}
.empty-state .empty-icon {
  width: 80px;
  height: 80px;
  margin: 0 auto 20px;
  background: var(--hud-glow);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}
.empty-state .empty-icon svg { width: 40px; height: 40px; color: var(--blake-red); }
.empty-state h2 { margin-bottom: 8px; }
.empty-state p {
  color: var(--text-muted);
  font-size: 0.9rem;
  max-width: 400px;
  margin: 0 auto 24px;
}

/* ============================================================
   HISTORY LIST
   ============================================================ */
.report-list-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px;
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  margin-bottom: 8px;
  cursor: pointer;
  transition: all var(--transition);
}
.report-list-item:hover { border-color: var(--blake-red); box-shadow: var(--shadow-md); transform: translateX(4px); }
.report-list-item { transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); }
.report-list-item .rli-risk {
  width: 48px;
  height: 48px;
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-heading);
  font-weight: 700;
  font-size: 0.9rem;
  color: white;
  flex-shrink: 0;
}
.report-list-item .rli-risk.low { background: var(--risk-green); }
.report-list-item .rli-risk.medium { background: var(--risk-yellow); }
.report-list-item .rli-risk.high { background: var(--risk-red); }
.report-list-item .rli-risk.critical { background: #991b1b; }
.report-list-item .rli-info { flex: 1; min-width: 0; }
.report-list-item .rli-name { font-weight: 600; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.report-list-item .rli-meta { font-size: 0.75rem; color: var(--text-muted); }
.report-list-item .rli-status {
  flex-shrink: 0;
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  padding: 4px 10px;
  border-radius: 20px;
}
.report-list-item .rli-status.converted { background: var(--risk-green-bg); color: var(--risk-green); }
.report-list-item .rli-status.pending { background: var(--risk-yellow-bg); color: var(--risk-yellow); }
.report-list-item .rli-status.declined { background: var(--risk-red-bg); color: var(--risk-red); }

/* ============================================================
   ANALYTICS CARDS
   ============================================================ */
.stat-row {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 8px;
  margin-bottom: 20px;
  width: 100%;
  min-width: 0;
}
.stat-row > * {
  min-width: 0;
  max-width: 100%;
  overflow: hidden;
}
@media (min-width: 768px) {
  .stat-row { gap: 10px; }
}
.stat-card {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: 10px 4px;
  text-align: center;
  min-width: 0;
  max-width: 100%;
  overflow: hidden;
}
@media (min-width: 768px) {
  .stat-card { padding: 16px; }
}
.stat-card .sc-value {
  font-family: var(--font-heading);
  font-size: clamp(1.1rem, 4vw, 1.5rem);
  font-weight: 700;
  color: var(--blake-red);
  line-height: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.stat-card .sc-label {
  font-size: clamp(0.55rem, 2.2vw, 0.7rem);
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.02em;
  margin-top: 4px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ============================================================
   SETTINGS
   ============================================================ */
.settings-section {
  margin-bottom: 24px;
}
.settings-section h3 {
  font-size: 0.9rem;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border-color);
}
.settings-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 0;
}
.settings-row .sr-label { font-size: 0.85rem; font-weight: 500; }
.settings-row .sr-desc { font-size: 0.75rem; color: var(--text-muted); }

/* ============================================================
   MODAL
   ============================================================ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 16px;
  backdrop-filter: blur(4px);
}
.modal-overlay.active { display: flex; }
.modal {
  background: var(--bg-card);
  border-radius: var(--radius-xl);
  width: 100%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: var(--shadow-xl);
  animation: modalIn 0.25s ease;
}
@keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 24px;
  border-bottom: 1px solid var(--border-color);
}
.modal-header h3 { font-size: 1rem; }
.modal-body { padding: 24px; }
.modal-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--border-color);
  display: flex;
  gap: 10px;
  justify-content: flex-end;
}

/* ============================================================
   TOAST
   ============================================================ */
.toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1100;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.toast {
  background: var(--blake-dark);
  color: var(--blake-white);
  padding: 12px 20px;
  border-radius: var(--radius-md);
  font-size: 0.85rem;
  font-weight: 500;
  box-shadow: var(--shadow-lg);
  animation: toastIn 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
  max-width: 340px;
}
.toast.success { border-left: 4px solid var(--risk-green); }
.toast.error { border-left: 4px solid var(--risk-red); }
.toast.info { border-left: 4px solid var(--blake-gold); }
@keyframes toastIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }

/* ============================================================
   SEARCH BAR
   ============================================================ */
.search-bar {
  position: relative;
  margin-bottom: 16px;
}
.search-bar svg {
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
  width: 18px;
  height: 18px;
  color: var(--text-muted);
}
.search-bar input {
  width: 100%;
  padding: 12px 14px 12px 42px;
  font-family: var(--font-body);
  font-size: 16px;
  color: var(--text-primary);
  background: var(--bg-input);
  border: 1.5px solid var(--border-color);
  border-radius: var(--radius-md);
  transition: all var(--transition);
}
.search-bar input:focus {
  outline: none;
  border-color: var(--blake-red);
  box-shadow: 0 0 0 3px var(--hud-glow);
}

/* ============================================================
   PAGE HEADER
   ============================================================ */
.page-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 12px;
}
.page-header > div {
  flex: 1;
  min-width: 0;
}
.page-header h1 {
  font-size: 1.35rem;
  line-height: 1.2;
}
.page-header .btn {
  flex-shrink: 0;
  white-space: nowrap;
  max-width: 45%;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ============================================================
   DETAIL BACK
   ============================================================ */
.back-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 0.85rem;
  font-weight: 500;
  color: var(--text-muted);
  cursor: pointer;
  background: none;
  border: none;
  font-family: var(--font-body);
  padding: 8px 0;
  margin-bottom: 12px;
  transition: color var(--transition);
}
.back-btn:hover { color: var(--blake-red); }
.back-btn svg { width: 16px; height: 16px; }

/* ============================================================
   DATA MANAGEMENT BUTTONS
   ============================================================ */
.data-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 12px;
}

/* ============================================================
   PRINT STYLES
   ============================================================ */
@media print {
  body { background: white !important; color: black !important; }
  .top-nav, .bottom-nav, .demo-banner, .toast-container, .back-btn, .conversion-actions, .page-header .btn { display: none !important; }
  .app-container { padding: 0; max-width: 100%; }
  .view { display: none !important; }
  .view.print-target { display: block !important; }
  .risk-report {
    box-shadow: none !important;
    border: 2px solid #333 !important;
    break-inside: avoid;
  }
  .risk-report-header {
    background: #1c1b1a !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  .risk-report-cta {
    background: #1c1b1a !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  .risk-scenario.without, .risk-scenario.with {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
}

/* ============================================================
   SCROLLBAR
   ============================================================ */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

/* ============================================================
   UTILITY
   ============================================================ */
.text-red { color: var(--blake-red); }
.text-gold { color: var(--blake-gold); }
.text-muted { color: var(--text-muted); }
.mt-8 { margin-top: 8px; }
.mt-16 { margin-top: 16px; }
.mb-8 { margin-bottom: 8px; }
.mb-16 { margin-bottom: 16px; }
.gap-8 { gap: 8px; }
.flex { display: flex; }
.items-center { align-items: center; }
.justify-between { justify-content: space-between; }
.hidden { display: none !important; }

/* === DEMO DISCLAIMER === */
#bct-demo-disclaimer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #f8f8f8;
  border-top: 1px solid #ddd;
  padding: 10px 16px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 12px;
  line-height: 1.4;
  color: #666;
  z-index: 99999;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 8px 16px;
  text-align: center;
}
#bct-demo-disclaimer p {
  margin: 0;
  max-width: 700px;
}
#bct-demo-disclaimer strong {
  color: #333;
  font-weight: 600;
}
#bct-demo-disclaimer a.bct-delete-btn {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: #dc3545;
  color: #fff;
  padding: 5px 12px;
  border-radius: 4px;
  text-decoration: none;
  font-size: 11px;
  font-weight: 500;
  white-space: nowrap;
  transition: background 0.15s;
}
#bct-demo-disclaimer a.bct-delete-btn:hover {
  background: #b02a37;
}
@media (max-width: 600px) {
  #bct-demo-disclaimer {
    flex-direction: column;
    padding: 8px 12px 12px;
    font-size: 11px;
  }
}
/* Add bottom padding to body so disclaimer doesn't cover content */
body { padding-bottom: 60px !important; }
</style>
</head>
<body>

<!-- ============================================================
     DEMO BANNER
     ============================================================ -->
<div class="demo-banner" id="demoBanner">
  âš¡ DEMO MODE â€” Loaded with sample Huntsville data. Dismiss to start fresh.
  <button class="demo-close" onclick="dismissDemo()" aria-label="Close demo banner">Ã—</button>
</div>

<!-- ============================================================
     TOP NAV (Desktop â‰¥1024)
     ============================================================ -->
<nav class="top-nav">
  <div class="brand">
    <div class="brand-icon">
      <svg viewBox="0 0 24 24"><path d="M12 2L3 7v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-9-5zm0 2.18l7 3.82v5c0 4.52-3.13 8.72-7 9.93C8.13 21.72 5 17.52 5 13V8l7-3.82zm-1 5.82v6h2v-6h-2zm0 8v2h2v-2h-2z"/></svg>
    </div>
    <div>
      <div class="brand-name">Blake Shield</div>
      <div class="brand-sub">Risk Visualizer</div>
    </div>
  </div>
  <ul class="nav-links">
    <li><a href="#" data-view="dashboard" class="active" onclick="switchView('dashboard')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
      Dashboard
    </a></li>
    <li><a href="#" data-view="new-visit" onclick="switchView('new-visit')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      New Visit
    </a></li>
    <li><a href="#" data-view="history" onclick="switchView('history')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
      History
    </a></li>
    <li><a href="#" data-view="settings" onclick="switchView('settings')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      Settings
    </a></li>
  </ul>
  <div class="nav-actions">
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">ðŸŒ™</button>
  </div>
</nav>

<!-- ============================================================
     BOTTOM NAV (Mobile <1024)
     ============================================================ -->
<nav class="bottom-nav">
  <a href="#" data-view="dashboard" class="active" onclick="switchView('dashboard')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
    Home
  </a>
  <a href="#" data-view="new-visit" onclick="switchView('new-visit')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
    New Visit
  </a>
  <a href="#" data-view="history" onclick="switchView('history')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
    History
  </a>
  <a href="#" data-view="settings" onclick="switchView('settings')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
    Settings
  </a>
</nav>

<!-- ============================================================
     TOAST CONTAINER
     ============================================================ -->
<div class="toast-container" id="toastContainer"></div>

<!-- ============================================================
     MODAL
     ============================================================ -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal" id="modalContent"></div>
</div>

<!-- ============================================================
     MAIN APP CONTAINER
     ============================================================ -->
<div class="app-container">

  <!-- ==========================================================
       VIEW: DASHBOARD
       ========================================================== -->
  <div class="view active" id="view-dashboard">
    <div class="page-header">
      <div>
        <h1>Blake Shield</h1>
        <div class="subtitle">Priority Maintenance Risk Visualizer</div>
      </div>
      <button class="btn btn-primary" onclick="switchView('new-visit')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        New Site Visit
      </button>
    </div>

    <!-- HUD Stats -->
    <div class="hud-grid" id="hudStats">
      <div class="hud-stat" style="--stat-color: var(--risk-yellow)">
        <div class="stat-label">Pollen Index</div>
        <div class="stat-value">High</div>
        <div class="stat-detail">Tennessee Valley avg</div>
      </div>
      <div class="hud-stat" style="--stat-color: var(--risk-red)">
        <div class="stat-label">Water Hardness</div>
        <div class="stat-value">8.2 GPG</div>
        <div class="stat-detail">Huntsville municipal</div>
      </div>
      <div class="hud-stat" style="--stat-color: var(--risk-yellow)">
        <div class="stat-label">Humidity</div>
        <div class="stat-value">72%</div>
        <div class="stat-detail">Avg relative humidity</div>
      </div>
      <div class="hud-stat" style="--stat-color: var(--blake-red)">
        <div class="stat-label">Grid Load</div>
        <div class="stat-value">Peak</div>
        <div class="stat-detail">TVA summer demand</div>
      </div>
    </div>

    <!-- KPI Stats -->
    <div class="stat-row" id="kpiStats">
      <div class="stat-card">
        <div class="sc-value" id="statReports">0</div>
        <div class="sc-label">Reports</div>
      </div>
      <div class="stat-card">
        <div class="sc-value" id="statConverted">0</div>
        <div class="sc-label">Signed Up</div>
      </div>
      <div class="stat-card">
        <div class="sc-value" id="statRate">0%</div>
        <div class="sc-label">Conversion</div>
      </div>
    </div>

    <!-- Recent Reports or Empty State -->
    <div id="dashboardContent"></div>
  </div>

  <!-- ==========================================================
       VIEW: NEW SITE VISIT
       ========================================================== -->
  <div class="view" id="view-new-visit">
    <div class="page-header">
      <div>
        <h1>New Site Visit</h1>
        <div class="subtitle">Generate a Risk Report for the homeowner</div>
      </div>
    </div>

    <form id="visitForm" onsubmit="generateReport(event)">
      <!-- Customer Info -->
      <div class="card">
        <div class="card-header">
          <h3>Customer Information</h3>
        </div>
        <div class="form-group">
          <label class="form-label" for="custName">Homeowner Name</label>
          <input class="form-input" type="text" id="custName" placeholder="e.g., Sarah Mitchell" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="custAddress">Address</label>
            <input class="form-input" type="text" id="custAddress" placeholder="123 Research Park Blvd" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="custPhone">Phone</label>
            <input class="form-input" type="tel" id="custPhone" placeholder="(256) 555-0123">
          </div>
        </div>
      </div>

      <!-- Equipment -->
      <div class="card">
        <div class="card-header">
          <h3>Equipment Details</h3>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="equipType">System Type</label>
            <select class="form-select" id="equipType" required>
              <option value="">Select...</option>
              <option value="central-ac">Central A/C</option>
              <option value="heat-pump">Heat Pump</option>
              <option value="furnace">Gas Furnace</option>
              <option value="mini-split">Mini-Split</option>
              <option value="water-heater">Water Heater (Tank)</option>
              <option value="tankless">Tankless Water Heater</option>
              <option value="plumbing">Plumbing System</option>
              <option value="electrical">Electrical Panel</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="equipAge">System Age (years)</label>
            <input class="form-input" type="number" id="equipAge" placeholder="e.g., 8" min="0" max="50" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="equipBrand">Brand</label>
            <input class="form-input" type="text" id="equipBrand" placeholder="e.g., Trane, Rheem">
          </div>
          <div class="form-group">
            <label class="form-label" for="lastService">Last Service</label>
            <select class="form-select" id="lastService">
              <option value="unknown">Unknown</option>
              <option value="recent">Within 6 months</option>
              <option value="year">6-12 months ago</option>
              <option value="over-year">1-2 years ago</option>
              <option value="never">2+ years / Never</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label" for="issueNotes">Current Issue / Notes</label>
          <textarea class="form-textarea" id="issueNotes" placeholder="What brought us out today? Any observed problems..."></textarea>
        </div>
      </div>

      <!-- Photo Evidence -->
      <div class="card">
        <div class="card-header">
          <h3>Photo Evidence</h3>
          <span class="text-muted" style="font-size:0.75rem;">Tap to capture / upload</span>
        </div>
        <div class="photo-grid">
          <div class="photo-slot" id="photoGood" onclick="capturePhoto('good')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
            <span class="photo-label">âœ“ The Good</span>
            <input type="file" accept="image/*" capture="environment" class="hidden" id="inputGood" onchange="handlePhoto(this, 'good')">
            <button type="button" class="photo-remove" onclick="removePhoto(event, 'good')">Ã—</button>
          </div>
          <div class="photo-slot" id="photoBad" onclick="capturePhoto('bad')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
            <span class="photo-label">âš  The Bad</span>
            <input type="file" accept="image/*" capture="environment" class="hidden" id="inputBad" onchange="handlePhoto(this, 'bad')">
            <button type="button" class="photo-remove" onclick="removePhoto(event, 'bad')">Ã—</button>
          </div>
          <div class="photo-slot" id="photoUgly" onclick="capturePhoto('ugly')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
            <span class="photo-label">âœ• The Ugly</span>
            <input type="file" accept="image/*" capture="environment" class="hidden" id="inputUgly" onchange="handlePhoto(this, 'ugly')">
            <button type="button" class="photo-remove" onclick="removePhoto(event, 'ugly')">Ã—</button>
          </div>
        </div>
      </div>

      <!-- Local Context Override -->
      <div class="card">
        <div class="card-header">
          <h3>Huntsville Conditions</h3>
          <span class="text-muted" style="font-size:0.75rem;">Auto-populated, adjust if needed</span>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="ctxPollen">Pollen Level</label>
            <select class="form-select" id="ctxPollen">
              <option value="low">Low</option>
              <option value="moderate">Moderate</option>
              <option value="high" selected>High</option>
              <option value="very-high">Very High</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="ctxHardness">Water Hardness (GPG)</label>
            <input class="form-input" type="number" id="ctxHardness" value="8.2" min="0" max="30" step="0.1">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="ctxHumidity">Relative Humidity %</label>
            <input class="form-input" type="number" id="ctxHumidity" value="72" min="0" max="100">
          </div>
          <div class="form-group">
            <label class="form-label" for="ctxGrid">Grid Load</label>
            <select class="form-select" id="ctxGrid">
              <option value="normal">Normal</option>
              <option value="elevated">Elevated</option>
              <option value="peak" selected>Peak</option>
              <option value="critical">Critical</option>
            </select>
          </div>
        </div>
      </div>

      <button type="submit" class="btn btn-primary btn-block" style="font-size:1rem; padding:16px;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:22px;height:22px"><path d="M12 2L3 7v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-9-5z"/></svg>
        Generate Risk Report
      </button>
    </form>
  </div>

  <!-- ==========================================================
       VIEW: REPORT DETAIL
       ========================================================== -->
  <div class="view" id="view-report">
    <button class="back-btn" onclick="switchView('history')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
      Back to History
    </button>
    <div id="reportContainer"></div>
  </div>

  <!-- ==========================================================
       VIEW: HISTORY
       ========================================================== -->
  <div class="view" id="view-history">
    <div class="page-header">
      <div>
        <h1>Report History</h1>
        <div class="subtitle">All generated Risk Reports</div>
      </div>
    </div>
    <div class="search-bar">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input type="text" id="historySearch" placeholder="Search by name, address, or equipment..." oninput="renderHistory()">
    </div>
    <div id="historyList"></div>
  </div>

  <!-- ==========================================================
       VIEW: SETTINGS
       ========================================================== -->
  <div class="view" id="view-settings">
    <div class="page-header">
      <div>
        <h1>Settings</h1>
        <div class="subtitle">Manage your data & preferences</div>
      </div>
    </div>

    <div class="card">
      <div class="settings-section">
        <h3>Appearance</h3>
        <div class="settings-row">
          <div>
            <div class="sr-label">Dark Mode</div>
            <div class="sr-desc">High-contrast for attics & crawlspaces</div>
          </div>
          <button class="btn btn-sm btn-secondary" onclick="toggleTheme()" id="themeBtn">Enable</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="settings-section">
        <h3>Technician Profile</h3>
        <div class="form-group">
          <label class="form-label" for="techName">Your Name</label>
          <input class="form-input" type="text" id="techName" placeholder="e.g., Marcus Johnson" onchange="saveTechName()">
        </div>
      </div>
    </div>

    <div class="card">
      <div class="settings-section">
        <h3>Data Management</h3>
        <div class="settings-row">
          <div>
            <div class="sr-label">Total Reports</div>
            <div class="sr-desc" id="settingsCount">0 reports stored</div>
          </div>
        </div>
        <div class="data-actions">
          <button class="btn btn-sm btn-secondary" onclick="exportCSV()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Export CSV
          </button>
          <button class="btn btn-sm btn-secondary" onclick="exportJSON()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Backup JSON
          </button>
          <button class="btn btn-sm btn-secondary" onclick="document.getElementById('importJSON').click()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
            Restore JSON
          </button>
          <input type="file" accept=".json" class="hidden" id="importJSON" onchange="importJSON(this)">
          <button class="btn btn-sm btn-secondary" onclick="document.getElementById('importCSV').click()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px"><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
            Import CSV
          </button>
          <input type="file" accept=".csv" class="hidden" id="importCSV" onchange="importCSV(this)">
          <button class="btn btn-sm btn-secondary" onclick="pasteClipboard()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            Paste CSV
          </button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="settings-section">
        <h3>Demo Data</h3>
        <div class="settings-row">
          <div>
            <div class="sr-label">Load Sample Data</div>
            <div class="sr-desc">Populate with Huntsville demo records</div>
          </div>
          <button class="btn btn-sm btn-gold" onclick="loadDemoData()">Load Demo</button>
        </div>
        <div class="settings-row">
          <div>
            <div class="sr-label">Clear All Data</div>
            <div class="sr-desc">Remove all reports permanently</div>
          </div>
          <button class="btn btn-sm btn-secondary" onclick="clearAllData()" style="color:var(--risk-red);border-color:var(--risk-red)">Clear All</button>
        </div>
      </div>
    </div>

    <div style="text-align:center;padding:24px;color:var(--text-muted);font-size:0.75rem;">
      Blake Shield Risk Visualizer v1.0<br>
      Built for Blake Brothers Plumbing, Electrical, Heating & Air<br>
      Huntsville, Alabama â€” Since 1884
    </div>
  </div>

</div>

<!-- ============================================================
     JAVASCRIPT
     ============================================================ -->
<script>
// ===========================================================
// SECURITY LAYER â€” Access Key Gate
// ===========================================================
function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
const _V=-778997210;
const _k=new URLSearchParams(window.location.search).get('key');
if(!_k||_h(_k)!==_V){
  document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;background:#111;color:#fff;text-align:center;padding:20px"><div><h1 style="font-size:2rem;margin-bottom:1rem">Access Denied</h1><p style="color:#999">This tool requires a valid access key.</p><p style="margin-top:1rem"><a href="mailto:ben@bennycutools.com" style="color:#4da6ff">ben@bennycutools.com</a></p></div></div>';
  throw new Error('Invalid key');
}
// Additional security: disable right-click
document.addEventListener('contextmenu',e=>e.preventDefault());
// Block dev tools shortcuts
document.addEventListener('keydown',e=>{
  if((e.ctrlKey||e.metaKey)&&e.shiftKey&&(e.key==='I'||e.key==='J'||e.key==='C')){e.preventDefault();}
  if((e.ctrlKey||e.metaKey)&&e.key==='u'){e.preventDefault();}
  if(e.key==='F12'){e.preventDefault();}
});
(function() {
  'use strict';

  // ===========================================================
  // DATABASE LAYER (IndexedDB + localStorage fallback)
  // ===========================================================
  const DB_NAME = 'BlakeShieldDB';
  const DB_VERSION = 1;
  const STORE_NAME = 'reports';
  const LS_KEY = 'blake_shield_reports';
  let db = null;
  let useIndexedDB = true;

  function openDB() {
    return new Promise((resolve, reject) => {
      if (!window.indexedDB) { useIndexedDB = false; resolve(null); return; }
      const req = indexedDB.open(DB_NAME, DB_VERSION);
      req.onupgradeneeded = (e) => {
        const d = e.target.result;
        if (!d.objectStoreNames.contains(STORE_NAME)) {
          const store = d.createObjectStore(STORE_NAME, { keyPath: 'id' });
          store.createIndex('date', 'date', { unique: false });
          store.createIndex('status', 'status', { unique: false });
        }
      };
      req.onsuccess = (e) => { db = e.target.result; resolve(db); };
      req.onerror = () => { useIndexedDB = false; resolve(null); };
    });
  }

  function getAllReports() {
    return new Promise((resolve) => {
      if (useIndexedDB && db) {
        const tx = db.transaction(STORE_NAME, 'readonly');
        const store = tx.objectStore(STORE_NAME);
        const req = store.getAll();
        req.onsuccess = () => resolve(req.result || []);
        req.onerror = () => resolve(getLS());
      } else {
        resolve(getLS());
      }
    });
  }

  function saveReport(report) {
    return new Promise((resolve) => {
      if (useIndexedDB && db) {
        const tx = db.transaction(STORE_NAME, 'readwrite');
        tx.objectStore(STORE_NAME).put(report);
        tx.oncomplete = () => { syncToLS(report); resolve(); };
        tx.onerror = () => { saveToLS(report); resolve(); };
      } else {
        saveToLS(report);
        resolve();
      }
    });
  }

  function deleteReport(id) {
    return new Promise((resolve) => {
      if (useIndexedDB && db) {
        const tx = db.transaction(STORE_NAME, 'readwrite');
        tx.objectStore(STORE_NAME).delete(id);
        tx.oncomplete = () => { deleteFromLS(id); resolve(); };
        tx.onerror = () => { deleteFromLS(id); resolve(); };
      } else {
        deleteFromLS(id);
        resolve();
      }
    });
  }

  function clearDB() {
    return new Promise((resolve) => {
      if (useIndexedDB && db) {
        const tx = db.transaction(STORE_NAME, 'readwrite');
        tx.objectStore(STORE_NAME).clear();
        tx.oncomplete = () => { localStorage.removeItem(LS_KEY); resolve(); };
        tx.onerror = () => { localStorage.removeItem(LS_KEY); resolve(); };
      } else {
        localStorage.removeItem(LS_KEY);
        resolve();
      }
    });
  }

  function bulkSave(reports) {
    return new Promise(async (resolve) => {
      for (const r of reports) { await saveReport(r); }
      resolve();
    });
  }

  // localStorage helpers
  function getLS() {
    try { return JSON.parse(localStorage.getItem(LS_KEY)) || []; } catch { return []; }
  }
  function saveToLS(report) {
    const all = getLS();
    const idx = all.findIndex(r => r.id === report.id);
    if (idx >= 0) all[idx] = report; else all.push(report);
    localStorage.setItem(LS_KEY, JSON.stringify(all));
  }
  function syncToLS(report) { saveToLS(report); }
  function deleteFromLS(id) {
    const all = getLS().filter(r => r.id !== id);
    localStorage.setItem(LS_KEY, JSON.stringify(all));
  }

  // ===========================================================
  // PHOTO STATE
  // ===========================================================
  const photos = { good: null, bad: null, ugly: null };

  // ===========================================================
  // RISK CALCULATION ENGINE
  // ===========================================================
  const EQUIPMENT_DATA = {
    'central-ac':    { label: 'Central A/C',           avgLife: 15, avgRepair: 2400, pollenWeight: 0.25, humidityWeight: 0.20, hardnessWeight: 0.05, gridWeight: 0.15 },
    'heat-pump':     { label: 'Heat Pump',             avgLife: 14, avgRepair: 2800, pollenWeight: 0.20, humidityWeight: 0.20, hardnessWeight: 0.05, gridWeight: 0.15 },
    'furnace':       { label: 'Gas Furnace',           avgLife: 18, avgRepair: 1800, pollenWeight: 0.05, humidityWeight: 0.15, hardnessWeight: 0.05, gridWeight: 0.10 },
    'mini-split':    { label: 'Mini-Split',            avgLife: 16, avgRepair: 2200, pollenWeight: 0.20, humidityWeight: 0.15, hardnessWeight: 0.05, gridWeight: 0.10 },
    'water-heater':  { label: 'Water Heater (Tank)',   avgLife: 12, avgRepair: 1600, pollenWeight: 0.02, humidityWeight: 0.10, hardnessWeight: 0.35, gridWeight: 0.05 },
    'tankless':      { label: 'Tankless Water Heater', avgLife: 20, avgRepair: 2000, pollenWeight: 0.02, humidityWeight: 0.05, hardnessWeight: 0.40, gridWeight: 0.05 },
    'plumbing':      { label: 'Plumbing System',       avgLife: 25, avgRepair: 3200, pollenWeight: 0.00, humidityWeight: 0.05, hardnessWeight: 0.40, gridWeight: 0.02 },
    'electrical':    { label: 'Electrical Panel',      avgLife: 30, avgRepair: 3800, pollenWeight: 0.00, humidityWeight: 0.10, hardnessWeight: 0.02, gridWeight: 0.30 },
  };

  const POLLEN_SCORES  = { 'low': 0.1, 'moderate': 0.3, 'high': 0.6, 'very-high': 0.9 };
  const GRID_SCORES    = { 'normal': 0.1, 'elevated': 0.35, 'peak': 0.65, 'critical': 0.9 };
  const SERVICE_SCORES = { 'recent': 0.05, 'year': 0.15, 'over-year': 0.35, 'never': 0.55, 'unknown': 0.30 };

  function calculateRisk(data) {
    const eq = EQUIPMENT_DATA[data.equipType];
    if (!eq) return null;

    // Age factor: exponential curve as system approaches/exceeds avg lifespan
    const ageRatio = Math.min(data.equipAge / eq.avgLife, 2.0);
    const ageFactor = Math.pow(ageRatio, 1.6) * 0.35;

    // Environmental factors
    const pollenScore   = (POLLEN_SCORES[data.pollen] || 0.3) * eq.pollenWeight;
    const humidityScore = (data.humidity / 100) * eq.humidityWeight;
    const hardnessScore = Math.min(data.hardness / 15, 1.0) * eq.hardnessWeight;
    const gridScore     = (GRID_SCORES[data.grid] || 0.3) * eq.gridWeight;

    // Service neglect factor
    const serviceFactor = (SERVICE_SCORES[data.lastService] || 0.3) * 0.25;

    // Composite risk (0-1)
    let rawRisk = ageFactor + pollenScore + humidityScore + hardnessScore + gridScore + serviceFactor;
    rawRisk = Math.min(Math.max(rawRisk, 0.03), 0.95);

    // With Shield: Priority Maintenance reduces risk significantly
    const shieldReduction = 0.72; // 72% risk reduction
    const shieldRisk = rawRisk * (1 - shieldReduction);

    // Estimated failure cost
    const failureCost = Math.round(eq.avgRepair * (0.6 + rawRisk * 0.8));

    return {
      riskWithout: Math.round(rawRisk * 100),
      riskWith: Math.round(shieldRisk * 100),
      failureCost,
      equipLabel: eq.label,
      avgLife: eq.avgLife,
      breakdown: {
        age: Math.round(ageFactor * 100),
        pollen: Math.round(pollenScore * 100),
        humidity: Math.round(humidityScore * 100),
        hardness: Math.round(hardnessScore * 100),
        grid: Math.round(gridScore * 100),
        service: Math.round(serviceFactor * 100),
      }
    };
  }

  function getRiskLevel(pct) {
    if (pct <= 20) return 'low';
    if (pct <= 45) return 'medium';
    if (pct <= 70) return 'high';
    return 'critical';
  }

  function getRiskLabel(pct) {
    if (pct <= 20) return 'Low Risk';
    if (pct <= 45) return 'Moderate Risk';
    if (pct <= 70) return 'High Risk';
    return 'Critical Risk';
  }

  // ===========================================================
  // VIEW MANAGEMENT
  // ===========================================================
  window.switchView = function(viewName) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active', 'print-target'));
    const target = document.getElementById('view-' + viewName);
    if (target) target.classList.add('active');

    // Update nav
    document.querySelectorAll('[data-view]').forEach(a => {
      a.classList.toggle('active', a.dataset.view === viewName);
    });

    // Refresh data on certain views
    if (viewName === 'dashboard') refreshDashboard();
    if (viewName === 'history') renderHistory();
    if (viewName === 'settings') updateSettingsCount();

    window.scrollTo(0, 0);
  };

  // ===========================================================
  // THEME
  // ===========================================================
  window.toggleTheme = function() {
    const html = document.documentElement;
    const isDark = html.getAttribute('data-theme') === 'dark';
    html.setAttribute('data-theme', isDark ? 'light' : 'dark');
    localStorage.setItem('blake_theme', isDark ? 'light' : 'dark');
    const btn = document.getElementById('themeBtn');
    if (btn) btn.textContent = isDark ? 'Enable' : 'Disable';
    document.querySelector('.theme-toggle').textContent = isDark ? 'ðŸŒ™' : 'â˜€ï¸';
  };

  function initTheme() {
    const saved = localStorage.getItem('blake_theme');
    if (saved === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
      const btn = document.getElementById('themeBtn');
      if (btn) btn.textContent = 'Disable';
      document.querySelector('.theme-toggle').textContent = 'â˜€ï¸';
    }
  }

  // ===========================================================
  // DEMO BANNER
  // ===========================================================
  window.dismissDemo = function() {
    document.getElementById('demoBanner').classList.add('hidden');
    localStorage.setItem('blake_demo_dismissed', 'true');
  };

  function initDemoBanner() {
    if (localStorage.getItem('blake_demo_dismissed') === 'true') {
      document.getElementById('demoBanner').classList.add('hidden');
    }
  }

  // ===========================================================
  // PHOTO HANDLING
  // ===========================================================
  window.capturePhoto = function(type) {
    const slot = document.getElementById('photo' + type.charAt(0).toUpperCase() + type.slice(1));
    if (slot.classList.contains('has-photo')) return;
    document.getElementById('input' + type.charAt(0).toUpperCase() + type.slice(1)).click();
  };

  window.handlePhoto = function(input, type) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      photos[type] = e.target.result;
      const slot = document.getElementById('photo' + type.charAt(0).toUpperCase() + type.slice(1));
      let img = slot.querySelector('img');
      if (!img) { img = document.createElement('img'); slot.appendChild(img); }
      img.src = e.target.result;
      slot.classList.add('has-photo');
    };
    reader.readAsDataURL(file);
  };

  window.removePhoto = function(e, type) {
    e.stopPropagation();
    photos[type] = null;
    const capType = type.charAt(0).toUpperCase() + type.slice(1);
    const slot = document.getElementById('photo' + capType);
    const img = slot.querySelector('img');
    if (img) img.remove();
    slot.classList.remove('has-photo');
    document.getElementById('input' + capType).value = '';
  };

  // ===========================================================
  // GENERATE REPORT
  // ===========================================================
  window.generateReport = async function(e) {
    e.preventDefault();

    const data = {
      custName: document.getElementById('custName').value.trim(),
      custAddress: document.getElementById('custAddress').value.trim(),
      custPhone: document.getElementById('custPhone').value.trim(),
      equipType: document.getElementById('equipType').value,
      equipAge: parseInt(document.getElementById('equipAge').value) || 0,
      equipBrand: document.getElementById('equipBrand').value.trim(),
      lastService: document.getElementById('lastService').value,
      issueNotes: document.getElementById('issueNotes').value.trim(),
      pollen: document.getElementById('ctxPollen').value,
      hardness: parseFloat(document.getElementById('ctxHardness').value) || 8.2,
      humidity: parseInt(document.getElementById('ctxHumidity').value) || 72,
      grid: document.getElementById('ctxGrid').value,
    };

    const risk = calculateRisk(data);
    if (!risk) { showToast('Please select equipment type', 'error'); return; }

    const report = {
      id: 'rpt_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6),
      date: new Date().toISOString(),
      ...data,
      photos: { ...photos },
      risk,
      status: 'pending', // pending, converted, declined
      isDemo: false,
      techName: localStorage.getItem('blake_tech_name') || '',
    };

    await saveReport(report);
    showToast('Risk Report generated!', 'success');

    // Reset form
    document.getElementById('visitForm').reset();
    document.getElementById('ctxPollen').value = 'high';
    document.getElementById('ctxHardness').value = '8.2';
    document.getElementById('ctxHumidity').value = '72';
    document.getElementById('ctxGrid').value = 'peak';
    ['good','bad','ugly'].forEach(t => { photos[t] = null; window.removePhoto({stopPropagation:()=>{}}, t); });

    // Show the report
    viewReport(report);
  };

  // ===========================================================
  // RENDER RISK REPORT (THE HERO COMPONENT)
  // ===========================================================
  function renderRiskReport(report) {
    const r = report.risk;
    const level = getRiskLevel(r.riskWithout);
    const shieldLevel = getRiskLevel(r.riskWith);
    const dateStr = new Date(report.date).toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
    const timeStr = new Date(report.date).toLocaleTimeString('en-US', { hour:'2-digit', minute:'2-digit' });

    const pollenColors = { 'low':'var(--risk-green)', 'moderate':'var(--risk-yellow)', 'high':'var(--risk-yellow)', 'very-high':'var(--risk-red)' };
    const gridColors = { 'normal':'var(--risk-green)', 'elevated':'var(--risk-yellow)', 'peak':'var(--risk-red)', 'critical':'var(--risk-red)' };
    const humidColor = report.humidity > 75 ? 'var(--risk-red)' : report.humidity > 55 ? 'var(--risk-yellow)' : 'var(--risk-green)';
    const hardnessColor = report.hardness > 10 ? 'var(--risk-red)' : report.hardness > 7 ? 'var(--risk-yellow)' : 'var(--risk-green)';

    let photosHtml = '';
    if (report.photos && (report.photos.good || report.photos.bad || report.photos.ugly)) {
      const labels = { good: 'âœ“ The Good', bad: 'âš  The Bad', ugly: 'âœ• The Ugly' };
      let items = '';
      ['good','bad','ugly'].forEach(k => {
        if (report.photos[k]) {
          items += `<div class="evidence-item"><img src="${report.photos[k]}" alt="${labels[k]}"><div class="evidence-label">${labels[k]}</div></div>`;
        }
      });
      if (items) {
        photosHtml = `<div class="photo-evidence"><h4>ðŸ“¸ Photo Evidence</h4><div class="evidence-grid">${items}</div></div>`;
      }
    }

    return `
      <div class="risk-report" id="printableReport">
        <div class="risk-report-header">
          <div class="rr-brand">
            <div class="rr-shield">
              <svg viewBox="0 0 24 24"><path d="M12 2L3 7v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-9-5zm0 2.18l7 3.82v5c0 4.52-3.13 8.72-7 9.93C8.13 21.72 5 17.52 5 13V8l7-3.82z"/></svg>
            </div>
            <div>
              <div class="rr-title">Blake Shield Risk Report</div>
              <div class="rr-subtitle">Priority Maintenance Assessment</div>
            </div>
          </div>
          <div class="rr-date">${dateStr}<br>${timeStr}</div>
        </div>

        <div class="risk-report-body">
          <div class="customer-info">
            <div class="ci-item"><div class="ci-label">Homeowner</div><div class="ci-value">${escHtml(report.custName)}</div></div>
            <div class="ci-item"><div class="ci-label">Address</div><div class="ci-value">${escHtml(report.custAddress)}</div></div>
            <div class="ci-item"><div class="ci-label">Equipment</div><div class="ci-value">${r.equipLabel} (${report.equipAge} yrs${report.equipBrand ? ', '+escHtml(report.equipBrand) : ''})</div></div>
            <div class="ci-item"><div class="ci-label">Avg. Lifespan</div><div class="ci-value">${r.avgLife} years</div></div>
          </div>

          <div class="local-factors">
            <h4>ðŸ“ Huntsville Local Risk Factors</h4>
            <div class="factor-chips">
              <div class="factor-chip"><span class="fc-dot" style="background:${pollenColors[report.pollen]}"></span> Pollen: ${capitalize(report.pollen)}</div>
              <div class="factor-chip"><span class="fc-dot" style="background:${hardnessColor}"></span> Water: ${report.hardness} GPG</div>
              <div class="factor-chip"><span class="fc-dot" style="background:${humidColor}"></span> Humidity: ${report.humidity}%</div>
              <div class="factor-chip"><span class="fc-dot" style="background:${gridColors[report.grid]}"></span> Grid: ${capitalize(report.grid)}</div>
            </div>
          </div>

          ${photosHtml}

          <div class="risk-comparison">
            <div class="risk-scenario without">
              <div class="scenario-label">âŒ Without Shield</div>
              <div class="scenario-risk">${r.riskWithout}%</div>
              <div class="scenario-sublabel">${getRiskLabel(r.riskWithout)}</div>
              <div class="risk-bar-container" style="margin-bottom:10px"><div class="risk-bar ${level}" style="width:${r.riskWithout}%"></div></div>
              <div class="scenario-cost">$${r.failureCost.toLocaleString()}</div>
              <div class="scenario-cost-label">Est. Failure Cost</div>
            </div>
            <div class="risk-scenario with">
              <div class="scenario-label">ðŸ›¡ï¸ With Blake Shield</div>
              <div class="scenario-risk">${r.riskWith}%</div>
              <div class="scenario-sublabel">${getRiskLabel(r.riskWith)}</div>
              <div class="risk-bar-container" style="margin-bottom:10px"><div class="risk-bar ${shieldLevel}" style="width:${Math.max(r.riskWith, 3)}%"></div></div>
              <div class="scenario-cost" style="color:var(--risk-green)">$0</div>
              <div class="scenario-cost-label">Covered by Membership</div>
            </div>
          </div>

          <div class="risk-formula">
            <div class="formula-title">âš™ Risk Calculation Breakdown</div>
            System Age Factor: ${r.breakdown.age}% (${report.equipAge}yr / ${r.avgLife}yr avg life)<br>
            + Pollen Impact: ${r.breakdown.pollen}% (${capitalize(report.pollen)} â€” Tennessee Valley)<br>
            + Humidity Impact: ${r.breakdown.humidity}% (${report.humidity}% RH)<br>
            + Water Hardness: ${r.breakdown.hardness}% (${report.hardness} GPG)<br>
            + Grid Stress: ${r.breakdown.grid}% (${capitalize(report.grid)} load â€” TVA)<br>
            + Service Gap: ${r.breakdown.service}% (Last: ${formatService(report.lastService)})<br>
            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>
            <strong>Composite Risk: ${r.riskWithout}% â†’ With Shield: ${r.riskWith}%</strong>
          </div>

          ${report.issueNotes ? `<div style="margin-bottom:16px;padding:12px;background:var(--bg-secondary);border-radius:var(--radius-md);font-size:0.85rem;"><strong style="font-size:0.7rem;text-transform:uppercase;letter-spacing:0.04em;color:var(--blake-gold);">Tech Notes</strong><br>${escHtml(report.issueNotes)}</div>` : ''}

          <div class="conversion-actions">
            <button class="btn btn-primary" onclick="updateStatus('${report.id}','converted')">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:18px;height:18px"><polyline points="20 6 9 17 4 12"/></svg>
              Signed Up!
            </button>
            <button class="btn btn-secondary" onclick="updateStatus('${report.id}','declined')">Declined</button>
            <button class="btn btn-ghost" onclick="printReport('${report.id}')">ðŸ–¨ï¸ Print</button>
            <button class="btn btn-ghost" style="color:var(--risk-red)" onclick="deleteReportById('${report.id}')">ðŸ—‘</button>
          </div>
        </div>

        <div class="risk-report-cta">
          <div class="cta-headline">Priority Maintenance Membership</div>
          <div class="cta-price">Blake Shield â€” Protecting Huntsville Homes Since 1884</div>
        </div>
      </div>
    `;
  }

  // ===========================================================
  // VIEW REPORT
  // ===========================================================
  function viewReport(report) {
    document.getElementById('reportContainer').innerHTML = renderRiskReport(report);
    switchView('report');
    // Animate risk bars after render
    setTimeout(() => {
      document.querySelectorAll('.risk-bar').forEach(bar => {
        const w = bar.style.width;
        bar.style.width = '0%';
        requestAnimationFrame(() => { bar.style.width = w; });
      });
    }, 50);
  }

  window.viewReportById = async function(id) {
    const reports = await getAllReports();
    const report = reports.find(r => r.id === id);
    if (report) viewReport(report);
  };

  // ===========================================================
  // UPDATE STATUS
  // ===========================================================
  window.updateStatus = async function(id, status) {
    const reports = await getAllReports();
    const report = reports.find(r => r.id === id);
    if (report) {
      report.status = status;
      await saveReport(report);
      showToast(status === 'converted' ? 'ðŸŽ‰ Membership signed!' : 'Status updated', status === 'converted' ? 'success' : 'info');
      viewReport(report);
    }
  };

  // ===========================================================
  // DELETE REPORT
  // ===========================================================
  window.deleteReportById = async function(id) {
    if (!confirm('Delete this report permanently?')) return;
    await deleteReport(id);
    showToast('Report deleted', 'info');
    switchView('history');
  };

  // ===========================================================
  // PRINT
  // ===========================================================
  window.printReport = function(id) {
    const reportView = document.getElementById('view-report');
    reportView.classList.add('print-target');
    window.print();
  };

  // ===========================================================
  // DASHBOARD
  // ===========================================================
  async function refreshDashboard() {
    const reports = await getAllReports();
    const total = reports.length;
    const converted = reports.filter(r => r.status === 'converted').length;
    const rate = total > 0 ? Math.round((converted / total) * 100) : 0;

    document.getElementById('statReports').textContent = total;
    document.getElementById('statConverted').textContent = converted;
    document.getElementById('statRate').textContent = rate + '%';

    const container = document.getElementById('dashboardContent');

    if (total === 0) {
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L3 7v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-9-5z"/></svg>
          </div>
          <h2>Welcome to Blake Shield</h2>
          <p>Generate data-driven Risk Reports that help Huntsville homeowners see why Priority Maintenance makes sense â€” no sales pitch needed.</p>
          <button class="btn btn-primary btn-block" onclick="switchView('new-visit')" style="max-width:320px;margin:0 auto;font-size:1rem;padding:16px;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:22px;height:22px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            New Site Visit
          </button>
          <div style="margin-top:16px;">
            <button class="btn btn-sm btn-gold" onclick="loadDemoData()">or Load Demo Data</button>
          </div>
        </div>
      `;
    } else {
      // Recent reports
      const recent = [...reports].sort((a,b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
      let html = '<h3 style="margin-bottom:12px;">Recent Reports</h3>';
      recent.forEach(r => { html += renderListItem(r); });
      container.innerHTML = html;
    }
  }

  // ===========================================================
  // HISTORY
  // ===========================================================
  async function renderHistoryAsync() {
    const reports = await getAllReports();
    const search = (document.getElementById('historySearch')?.value || '').toLowerCase();
    let filtered = reports;
    if (search) {
      filtered = reports.filter(r =>
        r.custName.toLowerCase().includes(search) ||
        r.custAddress.toLowerCase().includes(search) ||
        (r.risk?.equipLabel || '').toLowerCase().includes(search)
      );
    }
    filtered.sort((a,b) => new Date(b.date) - new Date(a.date));

    const container = document.getElementById('historyList');
    if (filtered.length === 0) {
      container.innerHTML = `<div class="empty-state"><p style="color:var(--text-muted)">${search ? 'No reports match your search.' : 'No reports yet. Start a new site visit!'}</p></div>`;
    } else {
      container.innerHTML = filtered.map(r => renderListItem(r)).join('');
    }
  }
  window.renderHistory = function() { renderHistoryAsync(); };

  function renderListItem(r) {
    const level = getRiskLevel(r.risk.riskWithout);
    const dateStr = new Date(r.date).toLocaleDateString('en-US', { month:'short', day:'numeric' });
    const statusMap = { converted:'converted', pending:'pending', declined:'declined' };
    const statusLabel = { converted:'Signed Up', pending:'Pending', declined:'Declined' };
    return `
      <div class="report-list-item" onclick="viewReportById('${r.id}')">
        <div class="rli-risk ${level}">${r.risk.riskWithout}%</div>
        <div class="rli-info">
          <div class="rli-name">${escHtml(r.custName)}${r.isDemo ? ' <span style="font-size:0.65rem;color:var(--blake-gold)">DEMO</span>' : ''}</div>
          <div class="rli-meta">${r.risk.equipLabel} Â· ${escHtml(r.custAddress)} Â· ${dateStr}</div>
        </div>
        <span class="rli-status ${statusMap[r.status] || 'pending'}">${statusLabel[r.status] || 'Pending'}</span>
      </div>
    `;
  }

  // ===========================================================
  // SETTINGS
  // ===========================================================
  async function updateSettingsCount() {
    const reports = await getAllReports();
    document.getElementById('settingsCount').textContent = reports.length + ' reports stored';
  }

  window.saveTechName = function() {
    localStorage.setItem('blake_tech_name', document.getElementById('techName').value.trim());
    showToast('Name saved', 'success');
  };

  function initTechName() {
    const name = localStorage.getItem('blake_tech_name');
    if (name) document.getElementById('techName').value = name;
  }

  // ===========================================================
  // EXPORT / IMPORT
  // ===========================================================
  window.exportCSV = async function() {
    const reports = await getAllReports();
    if (!reports.length) { showToast('No data to export', 'error'); return; }
    const headers = ['ID','Date','Customer','Address','Phone','Equipment','Age','Brand','Last Service','Risk Without','Risk With','Failure Cost','Status','Pollen','Hardness','Humidity','Grid','Notes'];
    const rows = reports.map(r => [
      r.id, r.date, r.custName, r.custAddress, r.custPhone, r.risk?.equipLabel, r.equipAge, r.equipBrand,
      r.lastService, r.risk?.riskWithout+'%', r.risk?.riskWith+'%', '$'+r.risk?.failureCost, r.status,
      r.pollen, r.hardness, r.humidity, r.grid, r.issueNotes
    ]);
    let csv = headers.join(',') + '\n';
    rows.forEach(row => { csv += row.map(v => '"'+(v||'').toString().replace(/"/g,'""')+'"').join(',') + '\n'; });
    downloadFile(csv, 'blake-shield-reports.csv', 'text/csv');
    showToast('CSV exported', 'success');
  };

  window.exportJSON = async function() {
    const reports = await getAllReports();
    if (!reports.length) { showToast('No data to export', 'error'); return; }
    const json = JSON.stringify({ version: 1, exported: new Date().toISOString(), reports }, null, 2);
    downloadFile(json, 'blake-shield-backup.json', 'application/json');
    showToast('JSON backup created', 'success');
  };

  window.importJSON = async function(input) {
    const file = input.files[0];
    if (!file) return;
    try {
      const text = await file.text();
      const data = JSON.parse(text);
      const reports = data.reports || data;
      if (!Array.isArray(reports)) throw new Error('Invalid format');
      await bulkSave(reports);
      showToast(`Imported ${reports.length} reports`, 'success');
      refreshDashboard();
    } catch(e) { showToast('Import failed: ' + e.message, 'error'); }
    input.value = '';
  };

  window.importCSV = async function(input) {
    const file = input.files[0];
    if (!file) return;
    try {
      const text = await file.text();
      const lines = text.trim().split('\n');
      if (lines.length < 2) throw new Error('No data rows');
      const headers = parseCSVRow(lines[0]);
      const nameIdx = headers.findIndex(h => h.toLowerCase().includes('customer') || h.toLowerCase().includes('name'));
      const addrIdx = headers.findIndex(h => h.toLowerCase().includes('address'));
      const equipIdx = headers.findIndex(h => h.toLowerCase().includes('equipment'));
      let imported = 0;
      for (let i = 1; i < lines.length; i++) {
        const cols = parseCSVRow(lines[i]);
        if (!cols[nameIdx]) continue;
        const report = {
          id: 'rpt_csv_' + Date.now() + '_' + i,
          date: new Date().toISOString(),
          custName: cols[nameIdx] || 'Unknown',
          custAddress: cols[addrIdx] || '',
          custPhone: '',
          equipType: 'central-ac',
          equipAge: 5,
          equipBrand: cols[equipIdx] || '',
          lastService: 'unknown',
          issueNotes: 'Imported from CSV',
          pollen: 'high',
          hardness: 8.2,
          humidity: 72,
          grid: 'peak',
          photos: {},
          risk: calculateRisk({ equipType:'central-ac', equipAge:5, pollen:'high', humidity:72, hardness:8.2, grid:'peak', lastService:'unknown' }),
          status: 'pending',
          isDemo: false,
        };
        await saveReport(report);
        imported++;
      }
      showToast(`Imported ${imported} records from CSV`, 'success');
      refreshDashboard();
    } catch(e) { showToast('CSV import failed: ' + e.message, 'error'); }
    input.value = '';
  };

  window.pasteClipboard = async function() {
    try {
      const text = await navigator.clipboard.readText();
      if (!text.trim()) { showToast('Clipboard is empty', 'error'); return; }
      const lines = text.trim().split('\n');
      if (lines.length < 2) { showToast('Need header row + data rows', 'error'); return; }
      // Simulate CSV import
      const blob = new Blob([text], { type:'text/csv' });
      const file = new File([blob], 'clipboard.csv');
      const dt = new DataTransfer();
      dt.items.add(file);
      const input = document.getElementById('importCSV');
      input.files = dt.files;
      await window.importCSV(input);
    } catch(e) { showToast('Could not read clipboard', 'error'); }
  };

  function parseCSVRow(row) {
    const result = [];
    let current = '';
    let inQuotes = false;
    for (let i = 0; i < row.length; i++) {
      const ch = row[i];
      if (inQuotes) {
        if (ch === '"' && row[i+1] === '"') { current += '"'; i++; }
        else if (ch === '"') inQuotes = false;
        else current += ch;
      } else {
        if (ch === '"') inQuotes = true;
        else if (ch === ',') { result.push(current.trim()); current = ''; }
        else current += ch;
      }
    }
    result.push(current.trim());
    return result;
  }

  function downloadFile(content, filename, type) {
    const blob = new Blob([content], { type });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = filename;
    document.body.appendChild(a); a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // ===========================================================
  // DEMO DATA
  // ===========================================================
  window.loadDemoData = async function() {
    const demos = [
      {
        id: 'rpt_demo_001',
        date: new Date(Date.now() - 86400000*2).toISOString(),
        custName: 'Sarah Mitchell',
        custAddress: '4825 Research Park Blvd, Huntsville',
        custPhone: '(256) 555-0147',
        equipType: 'central-ac',
        equipAge: 11,
        equipBrand: 'Trane XR15',
        lastService: 'over-year',
        issueNotes: 'Blowing warm air. Filter hasn\'t been changed in 18+ months. Visible dust buildup on evaporator coils.',
        pollen: 'high',
        hardness: 8.5,
        humidity: 78,
        grid: 'peak',
        photos: {},
        risk: null,
        status: 'converted',
        isDemo: true,
        techName: 'Marcus Johnson',
      },
      {
        id: 'rpt_demo_002',
        date: new Date(Date.now() - 86400000*1).toISOString(),
        custName: 'Dr. James Whitfield',
        custAddress: '1209 Monte Sano Blvd SE, Huntsville',
        custPhone: '(256) 555-0283',
        equipType: 'heat-pump',
        equipAge: 7,
        equipBrand: 'Carrier Infinity',
        lastService: 'year',
        issueNotes: 'Routine call. System running but short-cycling. Noticed corrosion on outdoor unit base.',
        pollen: 'high',
        hardness: 9.0,
        humidity: 74,
        grid: 'elevated',
        photos: {},
        risk: null,
        status: 'converted',
        isDemo: true,
        techName: 'Marcus Johnson',
      },
      {
        id: 'rpt_demo_003',
        date: new Date(Date.now() - 86400000*0.5).toISOString(),
        custName: 'Angela Torres',
        custAddress: '2701 Holmes Ave NW, Huntsville',
        custPhone: '(256) 555-0391',
        equipType: 'water-heater',
        equipAge: 9,
        equipBrand: 'Rheem ProTerra',
        lastService: 'never',
        issueNotes: 'Lukewarm water complaint. Significant mineral scale on heating elements. Anode rod completely deteriorated.',
        pollen: 'moderate',
        hardness: 8.8,
        humidity: 70,
        grid: 'normal',
        photos: {},
        risk: null,
        status: 'pending',
        isDemo: true,
        techName: 'Marcus Johnson',
      },
      {
        id: 'rpt_demo_004',
        date: new Date(Date.now() - 86400000*3).toISOString(),
        custName: 'Robert Chen',
        custAddress: '515 Wynn Dr NW, Huntsville',
        custPhone: '(256) 555-0512',
        equipType: 'electrical',
        equipAge: 22,
        equipBrand: 'Federal Pacific',
        lastService: 'never',
        issueNotes: 'Flickering lights upstairs. Panel is a Federal Pacific Stab-Lok â€” known fire hazard. Recommended full replacement.',
        pollen: 'low',
        hardness: 7.5,
        humidity: 65,
        grid: 'critical',
        photos: {},
        risk: null,
        status: 'declined',
        isDemo: true,
        techName: 'Marcus Johnson',
      },
      {
        id: 'rpt_demo_005',
        date: new Date().toISOString(),
        custName: 'Patricia Holcomb',
        custAddress: '3412 Governors Dr SW, Huntsville',
        custPhone: '(256) 555-0678',
        equipType: 'tankless',
        equipAge: 4,
        equipBrand: 'Navien NPE-240A',
        lastService: 'recent',
        issueNotes: 'Annual flush. Light scale buildup due to hard water. System performing well otherwise.',
        pollen: 'high',
        hardness: 8.2,
        humidity: 72,
        grid: 'peak',
        photos: {},
        risk: null,
        status: 'converted',
        isDemo: true,
        techName: 'Marcus Johnson',
      },
    ];

    // Calculate risk for each
    demos.forEach(d => {
      d.risk = calculateRisk({
        equipType: d.equipType,
        equipAge: d.equipAge,
        pollen: d.pollen,
        humidity: d.humidity,
        hardness: d.hardness,
        grid: d.grid,
        lastService: d.lastService,
      });
    });

    await bulkSave(demos);
    localStorage.removeItem('blake_demo_dismissed');
    document.getElementById('demoBanner').classList.remove('hidden');
    showToast('Demo data loaded with 5 Huntsville records', 'success');
    refreshDashboard();
  };

  window.clearAllData = async function() {
    if (!confirm('Are you sure? This will permanently delete all reports.')) return;
    await clearDB();
    showToast('All data cleared', 'info');
    refreshDashboard();
    updateSettingsCount();
  };

  // ===========================================================
  // TOAST NOTIFICATIONS
  // ===========================================================
  function showToast(msg, type) {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = 'toast ' + (type || 'info');
    toast.textContent = msg;
    container.appendChild(toast);
    setTimeout(() => { toast.style.opacity = '0'; toast.style.transform = 'translateX(20px)'; setTimeout(() => toast.remove(), 300); }, 3000);
  }
  window.showToast = showToast;

  // ===========================================================
  // HELPERS
  // ===========================================================
  function escHtml(str) {
    const div = document.createElement('div');
    div.textContent = str || '';
    return div.innerHTML;
  }

  function capitalize(str) {
    return (str || '').split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
  }

  function formatService(val) {
    const map = { 'recent':'< 6 months', 'year':'6-12 months', 'over-year':'1-2 years', 'never':'2+ years/Never', 'unknown':'Unknown' };
    return map[val] || val;
  }

  // ===========================================================
  // INITIALIZATION
  // ===========================================================
  async function init() {
    await openDB();
    initTheme();
    initDemoBanner();
    initTechName();

    // Check if any data exists; if not and first visit, load demo
    const reports = await getAllReports();
    if (reports.length === 0 && !localStorage.getItem('blake_visited')) {
      localStorage.setItem('blake_visited', 'true');
      await window.loadDemoData();
    }

    refreshDashboard();
  }

  // Prevent nav link default behavior
  document.addEventListener('click', (e) => {
    if (e.target.closest('[data-view]')) {
      e.preventDefault();
    }
  });

  init();
})();
</script>

<!-- DEMO DISCLAIMER - Legal Notice -->

<!-- BennyCuTools Purchase CTA â€” injected by inject-cta.py -->
<style>
#bct-cta-bar {
  position: fixed;
  bottom: 48px;
  left: 0;
  right: 0;
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  border-top: 2px solid #6366f1;
  padding: 10px 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  z-index: 99998;
  flex-wrap: wrap;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
}
#bct-cta-bar .bct-cta-text {
  color: #e4e4e7;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 14px;
  font-weight: 500;
}
#bct-cta-bar .bct-cta-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 20px;
  background: #6366f1;
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 14px;
  font-weight: 600;
  border: none;
  border-radius: 6px;
  text-decoration: none;
  cursor: pointer;
  transition: background 0.2s, transform 0.1s;
}
#bct-cta-bar .bct-cta-btn:hover {
  background: #4f46e5;
  transform: translateY(-1px);
}
#bct-cta-bar .bct-cta-btn-secondary {
  background: transparent;
  border: 1px solid #6366f1;
  color: #a5b4fc;
}
#bct-cta-bar .bct-cta-btn-secondary:hover {
  background: rgba(99,102,241,0.15);
}
@media (max-width: 600px) {
  #bct-cta-bar {
    flex-direction: column;
    gap: 8px;
    padding: 8px 12px;
    bottom: 44px;
  }
  #bct-cta-bar .bct-cta-text { font-size: 12px; }
  #bct-cta-bar .bct-cta-btn { font-size: 13px; padding: 7px 16px; width: 100%; justify-content: center; }
}
</style>
<div id="bct-cta-bar" role="banner" aria-label="Purchase this tool">
  <span class="bct-cta-text">Like this tool? Make it yours.</span>
  <a class="bct-cta-btn" id="bct-buy-btn" href="https://bennycutools.com/buy.html">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
    Get It â€” $200 One-Time
  </a>
  <a class="bct-cta-btn bct-cta-btn-secondary" href="mailto:cuuper225@gmail.com?subject=Question%20about%20my%20custom%20tool">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
    Questions? Email Ben
  </a>
</div>
<script>
// Auto-fill the buy link with the current tool's page name
(function(){
  try {
    var pg = location.pathname.replace(/.*\//, '').replace('.html','');
    var buyBtn = document.getElementById('bct-buy-btn');
    if (buyBtn && pg) {
      buyBtn.href = 'https://bennycutools.com/buy.html?tool=' + encodeURIComponent(pg);
    }
  } catch(e){}
})();
</script>
<!-- End BennyCuTools Purchase CTA -->

<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer">
  <p><strong>DEMO NOTICE:</strong> This tool was created by BennyCuTools as a free demonstration only.
  It is not affiliated with, endorsed by, or authorized by Blake Brothers.
  All brand references are used solely for demonstration purposes.</p>
  <a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20Blake%20Brothers&body=I%20am%20the%20owner%20of%20Blake%20Brothers%20and%20I%20request%20permanent%20deletion%20of%20the%20demo%20tool%20on%20bennycutools.com." class="bct-delete-btn" aria-label="Request permanent deletion of this demo">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
    Request Permanent Deletion
  </a>
</div>

</body>
</html>
