<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kennedy Color Compass | Kennedy Painting</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23D22027' rx='12' width='100' height='100'/><text fill='white' font-family='Georgia' font-size='65' font-weight='bold' x='50' y='72' text-anchor='middle'>K</text></svg>">
    <!-- Debug removed -->
    <style>
        :root {
            --kennedy-red: #D22027;
            --kennedy-red-dark: #B31B21;
            --kennedy-red-light: #E8434A;
            --navy: #1E3A5F;
            --navy-light: #2A4A73;
            --slate: #33475B;
            --slate-light: #4A5D72;
            --warm-gray: #F2F2F2;
            --cream: #FAF9F7;
            --cream-dark: #EDE9E3;
            --field-border: #CBD6E2;
            --white: #FFFFFF;
            --success: #4CAF50;
            --success-light: #E8F5E9;
            --warning: #FFC107;
            --warning-light: #FFF8E1;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.12);
            --shadow-xl: 0 16px 48px rgba(0,0,0,0.15);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            overflow-x: hidden;
            width: 100%;
        }

        body { padding-bottom: 80px;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--cream);
            color: var(--slate);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            padding-bottom: 80px;
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
            user-select: none;
            -webkit-user-select: none;
        }

        input, textarea, .form-input {
            user-select: text;
            -webkit-user-select: text;
        }

        .app-container {
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        @media (min-width: 1024px) {
            body { padding-bottom: 80px;
                padding-bottom: 0;
            }
        }

        /* Typography */
        h1, h2, h3, h4 {
            font-family: 'Playfair Display', Georgia, serif;
            color: var(--navy);
            font-weight: 600;
            line-height: 1.2;
        }

        h1 { font-size: clamp(1.75rem, 5vw, 2.5rem); }
        h2 { font-size: clamp(1.5rem, 4vw, 2rem); }
        h3 { font-size: clamp(1.25rem, 3vw, 1.5rem); }

        /* Header */
        .header {
            background: var(--white);
            border-bottom: 1px solid var(--cream-dark);
            padding: 12px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
            width: 100%;
        }

        @media (min-width: 480px) {
            .header {
                padding: 16px 20px;
            }
        }

        .header-content {
            max-width: 1280px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--kennedy-red);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            font-size: 18px;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-name {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            font-size: 16px;
            color: var(--navy);
            line-height: 1.1;
        }

        .logo-tagline {
            font-size: 11px;
            color: var(--slate-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Desktop Navigation */
        .desktop-nav {
            display: none;
        }

        @media (min-width: 1024px) {
            .desktop-nav {
                display: flex;
                gap: 8px;
            }

            .desktop-nav button {
                padding: 10px 20px;
                border: none;
                background: transparent;
                color: var(--slate);
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                border-radius: var(--radius-md);
                transition: var(--transition);
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .desktop-nav button:hover {
                background: var(--warm-gray);
            }

            .desktop-nav button.active {
                background: var(--kennedy-red);
                color: white;
            }
        }

        /* Bottom Tab Bar (Mobile) */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            border-top: 1px solid var(--cream-dark);
            display: flex;
            justify-content: space-around;
            padding: 8px 0 max(8px, env(safe-area-inset-bottom));
            z-index: 100;
            box-shadow: 0 -4px 16px rgba(0,0,0,0.08);
        }

        @media (min-width: 1024px) {
            .bottom-nav {
                display: none;
            }
        }

        .nav-tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            border: none;
            background: none;
            color: var(--slate-light);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            min-width: 64px;
            min-height: 44px;
            border-radius: var(--radius-sm);
        }

        .nav-tab:hover {
            background: var(--warm-gray);
        }

        .nav-tab.active {
            color: var(--kennedy-red);
        }

        .nav-tab svg {
            width: 24px;
            height: 24px;
        }

        /* Main Content */
        .main-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 16px;
            overflow-x: hidden;
            width: 100%;
            box-sizing: border-box;
        }

        @media (min-width: 480px) {
            .main-content {
                padding: 20px;
            }
        }

        @media (min-width: 768px) {
            .main-content {
                padding: 32px;
            }
        }

        /* Views */
        .view {
            display: none;
            animation: fadeIn 0.3s ease;
            width: 100%;
            max-width: 100%;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Welcome Screen */
        .welcome-screen {
            text-align: center;
            padding: 24px 0;
        }

        .welcome-hero {
            max-width: 100%;
            margin: 0 auto;
        }

        @media (min-width: 600px) {
            .welcome-screen {
                padding: 40px 0;
            }
            .welcome-hero {
                max-width: 500px;
            }
        }

        @media (min-width: 768px) {
            .welcome-screen {
                padding: 60px 0;
            }
            .welcome-hero {
                max-width: 560px;
            }
        }

        .welcome-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--success-light);
            color: var(--success);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 24px;
        }

        .welcome-title {
            margin-bottom: 16px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            max-width: 100%;
        }

        .welcome-subtitle {
            font-size: 15px;
            color: var(--slate-light);
            margin-bottom: 32px;
            line-height: 1.6;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
        }

        @media (min-width: 480px) {
            .welcome-subtitle {
                font-size: 17px;
            }
        }

        @media (min-width: 768px) {
            .welcome-subtitle {
                font-size: 18px;
            }
        }

        .welcome-cta {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 100%;
            margin: 0 auto 40px;
            padding: 0;
            width: 100%;
            box-sizing: border-box;
        }

        @media (min-width: 480px) {
            .welcome-cta {
                max-width: 320px;
            }
        }

        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 16px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            min-height: 48px;
            text-decoration: none;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .btn svg {
            flex-shrink: 0;
            width: 18px;
            height: 18px;
        }

        @media (min-width: 480px) {
            .btn {
                padding: 16px 24px;
                font-size: 16px;
                min-height: 52px;
                width: auto;
                display: inline-flex;
            }
            .btn svg {
                width: 20px;
                height: 20px;
            }
        }

        .btn-primary {
            background: var(--kennedy-red);
            color: white;
            box-shadow: 0 4px 12px rgba(210, 32, 39, 0.3);
        }

        .btn-primary:hover {
            background: var(--kennedy-red-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(210, 32, 39, 0.4);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--slate);
            border: 2px solid var(--field-border);
        }

        .btn-secondary:hover {
            border-color: var(--navy);
            background: var(--warm-gray);
        }

        .btn-ghost {
            background: transparent;
            color: var(--slate);
            padding: 12px 16px;
            font-size: 14px;
        }

        .btn-ghost:hover {
            background: var(--warm-gray);
        }

        /* Sean Says Quote */
        .sean-quote {
            background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
            color: white;
            padding: 24px;
            border-radius: var(--radius-xl);
            max-width: 600px;
            margin: 40px auto 0;
            position: relative;
        }

        @media (min-width: 480px) {
            .sean-quote {
                padding: 32px;
            }
        }

        .sean-quote::before {
            content: '"';
            font-family: 'Playfair Display', serif;
            font-size: 60px;
            position: absolute;
            top: 8px;
            left: 12px;
            opacity: 0.2;
            line-height: 1;
        }

        @media (min-width: 480px) {
            .sean-quote::before {
                font-size: 80px;
                top: 0;
                left: 20px;
            }
        }

        .sean-quote-text {
            font-size: 15px;
            line-height: 1.7;
            font-style: italic;
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
        }

        @media (min-width: 480px) {
            .sean-quote-text {
                font-size: 17px;
            }
        }

        .sean-quote-author {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sean-avatar {
            width: 48px;
            height: 48px;
            background: var(--kennedy-red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            font-size: 18px;
        }

        .sean-info {
            text-align: left;
        }

        .sean-name {
            font-weight: 600;
            font-size: 15px;
        }

        .sean-role {
            font-size: 13px;
            opacity: 0.8;
        }

        /* Demo Banner */
        .demo-banner {
            background: linear-gradient(135deg, var(--warning-light) 0%, #FFF3CD 100%);
            border: 1px solid #FFE69C;
            padding: 12px 20px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .demo-banner-text {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #856404;
        }

        .demo-banner button {
            background: #856404;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .demo-banner button:hover {
            background: #6C5100;
        }

        /* Style Interview */
        .interview-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .interview-progress {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 32px;
        }

        .progress-step {
            height: 4px;
            flex: 1;
            background: var(--cream-dark);
            border-radius: 2px;
            transition: var(--transition);
        }

        .progress-step.completed {
            background: var(--kennedy-red);
        }

        .progress-step.active {
            background: linear-gradient(90deg, var(--kennedy-red) 50%, var(--cream-dark) 50%);
        }

        .interview-question {
            text-align: center;
            margin-bottom: 32px;
        }

        .question-number {
            display: inline-block;
            background: var(--kennedy-red);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 14px;
            font-weight: 600;
            line-height: 32px;
            margin-bottom: 16px;
        }

        .question-text {
            font-size: clamp(1.25rem, 4vw, 1.75rem);
            margin-bottom: 8px;
        }

        .question-hint {
            color: var(--slate-light);
            font-size: 15px;
        }

        /* Visual Choice Cards */
        .choice-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        @media (min-width: 768px) {
            .choice-grid.cols-3 {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .choice-card {
            background: var(--white);
            border: 3px solid transparent;
            border-radius: var(--radius-lg);
            padding: 20px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .choice-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .choice-card.selected {
            border-color: var(--kennedy-red);
            background: linear-gradient(to bottom, rgba(210, 32, 39, 0.05), var(--white));
        }

        .choice-card.selected::after {
            content: '✓';
            position: absolute;
            top: 12px;
            right: 12px;
            width: 24px;
            height: 24px;
            background: var(--kennedy-red);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .choice-visual {
            height: 80px;
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .choice-title {
            font-weight: 600;
            font-size: 15px;
            color: var(--navy);
            margin-bottom: 4px;
        }

        .choice-desc {
            font-size: 13px;
            color: var(--slate-light);
        }

        /* Interview Navigation */
        .interview-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 24px;
            border-top: 1px solid var(--cream-dark);
        }

        /* Color Palettes View */
        .palettes-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .style-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--navy);
            color: white;
            padding: 10px 20px;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 16px;
        }

        .palette-grid {
            display: grid;
            gap: 24px;
        }

        @media (min-width: 768px) {
            .palette-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .palette-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .palette-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            cursor: pointer;
            border: 3px solid transparent;
        }

        .palette-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .palette-card.selected {
            border-color: var(--kennedy-red);
        }

        .palette-colors {
            display: flex;
            height: 120px;
        }

        .palette-color {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 12px 8px;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .palette-color.light-text {
            color: var(--slate);
            text-shadow: none;
        }

        .palette-color-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.8;
        }

        .palette-color-name {
            font-size: 12px;
            font-weight: 600;
        }

        .palette-info {
            padding: 20px;
        }

        .palette-name {
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            font-weight: 600;
            color: var(--navy);
            margin-bottom: 8px;
        }

        .palette-description {
            font-size: 14px;
            color: var(--slate-light);
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .palette-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .palette-tag {
            background: var(--warm-gray);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            color: var(--slate);
        }

        .selected-indicator {
            display: none;
            background: var(--success-light);
            color: var(--success);
            padding: 12px 16px;
            text-align: center;
            font-weight: 500;
            font-size: 14px;
        }

        .palette-card.selected .selected-indicator {
            display: block;
        }

        /* Saved Palettes */
        .saved-section {
            margin-top: 48px;
            padding-top: 32px;
            border-top: 1px solid var(--cream-dark);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .saved-palette-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        @media (min-width: 768px) {
            .saved-palette-card {
                flex-direction: row;
                align-items: center;
            }
        }

        .saved-colors {
            display: flex;
            gap: 8px;
            flex: 1;
        }

        .saved-color {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-sm);
            box-shadow: inset 0 0 0 1px rgba(0,0,0,0.1);
        }

        .saved-info {
            flex: 2;
        }

        .saved-name {
            font-weight: 600;
            color: var(--navy);
            margin-bottom: 4px;
        }

        .saved-meta {
            font-size: 13px;
            color: var(--slate-light);
        }

        .saved-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--field-border);
            background: var(--white);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            color: var(--slate);
        }

        .btn-icon:hover {
            background: var(--warm-gray);
            border-color: var(--navy);
        }

        .btn-icon.danger:hover {
            background: #FEE2E2;
            border-color: var(--kennedy-red);
            color: var(--kennedy-red);
        }

        /* Confidence Score */
        .confidence-section {
            background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
            color: white;
            border-radius: var(--radius-xl);
            padding: 32px;
            margin: 32px 0;
            text-align: center;
        }

        .confidence-title {
            color: white;
            margin-bottom: 8px;
        }

        .confidence-subtitle {
            opacity: 0.8;
            margin-bottom: 24px;
        }

        .confidence-meter {
            height: 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--kennedy-red), var(--success));
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        .confidence-value {
            font-size: 48px;
            font-weight: 700;
            font-family: 'Playfair Display', serif;
        }

        .confidence-label {
            font-size: 14px;
            opacity: 0.8;
        }

        /* Settings View */
        .settings-section {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
        }

        .settings-section h3 {
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .settings-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid var(--cream-dark);
            flex-wrap: wrap;
            gap: 12px;
        }

        .settings-row:last-child {
            border-bottom: none;
        }

        .settings-label {
            font-weight: 500;
            color: var(--navy);
        }

        .settings-desc {
            font-size: 13px;
            color: var(--slate-light);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--navy);
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--field-border);
            border-radius: var(--radius-md);
            font-size: 16px;
            font-family: inherit;
            transition: var(--transition);
            background: var(--white);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--kennedy-red);
            box-shadow: 0 0 0 3px rgba(210, 32, 39, 0.1);
        }

        textarea.form-input {
            min-height: 100px;
            resize: vertical;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
            pointer-events: none;
        }

        @media (min-width: 1024px) {
            .toast-container {
                bottom: 24px;
            }
        }

        .toast {
            background: var(--navy);
            color: white;
            padding: 14px 24px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: toastIn 0.3s ease;
            pointer-events: auto;
            max-width: 90vw;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.warning {
            background: #F59E0B;
        }

        .toast.error {
            background: var(--kennedy-red);
        }

        .toast-undo {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
            font-size: 13px;
        }

        .toast-undo:hover {
            background: rgba(255,255,255,0.3);
        }

        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Loading State */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255,255,255,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--cream-dark);
            border-top-color: var(--kennedy-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            width: 80px;
            height: 80px;
            background: var(--warm-gray);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
        }

        .empty-icon svg {
            width: 40px;
            height: 40px;
            color: var(--slate-light);
        }

        .empty-title {
            margin-bottom: 8px;
        }

        .empty-text {
            color: var(--slate-light);
            margin-bottom: 24px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Print Styles */
        @media print {
            body { padding-bottom: 80px;
                background: white;
                padding: 0;
            }

            .header, .bottom-nav, .desktop-nav, .demo-banner,
            .btn, button, .toast-container, .interview-nav {
                display: none !important;
            }

            .view {
                display: block !important;
            }

            .palette-card, .saved-palette-card {
                break-inside: avoid;
                page-break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }

            .main-content {
                max-width: 100%;
                padding: 20px;
            }

            .confidence-section {
                background: #333 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }

        /* Import Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--white);
            border-radius: var(--radius-xl);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--cream-dark);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-header h3 {
            margin: 0;
        }

        .modal-close {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--warm-gray);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--cream-dark);
        }

        .modal-body { padding-bottom: 80px;
            padding: 24px;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--cream-dark);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Color swatch visualization */
        .color-swatch-large {
            width: 100%;
            height: 200px;
            border-radius: var(--radius-lg);
            display: flex;
            margin-bottom: 24px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .color-swatch-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 20px;
            color: white;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .color-swatch-section.light {
            color: var(--slate);
            text-shadow: none;
        }

        /* Helpful Tips */
        .tip-card {
            background: linear-gradient(135deg, rgba(210, 32, 39, 0.05) 0%, rgba(30, 58, 95, 0.05) 100%);
            border: 1px solid rgba(210, 32, 39, 0.1);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-top: 24px;
        }

        .tip-header {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--kennedy-red);
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .tip-text {
            font-size: 14px;
            color: var(--slate);
            line-height: 1.6;
        }

        /* Transition helpers */
        .fade-enter {
            opacity: 0;
        }

        .fade-enter-active {
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        /* Utility classes */
        .text-center { text-align: center; }
        .mt-4 { margin-top: 16px; }
        .mt-6 { margin-top: 24px; }
        .mb-4 { margin-bottom: 16px; }
        .mb-6 { margin-bottom: 24px; }

        /* Skip Link Accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--gold, #c8a96e);
            color: #fff;
            padding: 8px 16px;
            z-index: 9999;
            font-weight: 600;
            transition: top .15s;
            text-decoration: none;
        }
        .skip-link:focus {
            top: 0;
        }
    </style>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>
<div class="app-container">
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">K</div>
                <div class="logo-text">
                    <span class="logo-name">Color Compass</span>
                    <span class="logo-tagline">Kennedy Painting</span>
                </div>
            </div>
            <nav class="desktop-nav">
                <button data-view="discover" class="active">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M16.2 7.8l-2 6.3-6.4 2.1 2-6.3z"/></svg>
                    Discover
                </button>
                <button data-view="palettes">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.93 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.04-.23-.29-.38-.63-.38-1.01 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8z"/><circle cx="7.5" cy="11.5" r="1.5"/><circle cx="10.5" cy="7.5" r="1.5"/><circle cx="14.5" cy="7.5" r="1.5"/><circle cx="17.5" cy="11.5" r="1.5"/></svg>
                    Palettes
                </button>
                <button data-view="saved">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>
                    Saved
                </button>
                <button data-view="settings">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v10M4.22 4.22l4.24 4.24m7.08 7.08l4.24 4.24M1 12h6m6 0h10M4.22 19.78l4.24-4.24m7.08-7.08l4.24-4.24"/></svg>
                    Settings
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content" id="main-content">
        <!-- Demo Banner -->
        <div class="demo-banner" id="demoBanner" style="display: none;">
            <div class="demo-banner-text">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                <span>Demo data loaded for preview</span>
            </div>
            <button onclick="clearDemoData()">Clear Demo Data</button>
        </div>

        <!-- Discover View (Welcome/Interview) -->
        <section id="discoverView" class="view active">
            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="welcome-screen">
                <div class="welcome-hero">
                    <div class="welcome-badge">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                        27 Years of Color Excellence
                    </div>
                    <h1 class="welcome-title">Find Your Home's True Colors</h1>
                    <p class="welcome-subtitle">Answer a few quick questions about your style preferences, and we'll create personalized color palettes curated by Sean Kennedy and our team of St. Louis painting experts.</p>
                    <div class="welcome-cta">
                        <button class="btn btn-primary" onclick="startInterview()">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.93 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.04-.23-.29-.38-.63-.38-1.01 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8z"/></svg>
                            Start Color Discovery
                        </button>
                        <button class="btn btn-secondary" onclick="openImportModal()">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
                            Import Previous Results
                        </button>
                    </div>
                    <button class="btn btn-ghost" onclick="loadDemoData()">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg>
                        Load Demo Data
                    </button>
                </div>
                
                <div class="sean-quote">
                    <p class="sean-quote-text">In 27 years of painting St. Louis homes, I've learned that the right color doesn't just look good—it feels right. Let me help you find colors you'll love for years to come.</p>
                    <div class="sean-quote-author">
                        <div class="sean-avatar">SK</div>
                        <div class="sean-info">
                            <div class="sean-name">Sean Kennedy</div>
                            <div class="sean-role">Owner, Kennedy Painting • Since 1998</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Style Interview -->
            <div id="interviewScreen" style="display: none;">
                <div class="interview-container">
                    <div class="interview-progress" id="progressSteps">
                        <!-- Generated dynamically -->
                    </div>
                    
                    <div id="interviewQuestions">
                        <!-- Questions loaded dynamically -->
                    </div>

                    <div class="interview-nav">
                        <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()" style="visibility: hidden;">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                            Back
                        </button>
                        <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>
                            Next
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Palettes View -->
        <section id="palettesView" class="view">
            <div class="palettes-header">
                <div class="style-badge" id="styleBadge">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                    <span id="styleProfileName">Your Style Profile</span>
                </div>
                <h2>Curated Color Palettes</h2>
                <p style="color: var(--slate-light); max-width: 600px; margin: 0 auto;">Based on your style preferences and 27 years of St. Louis expertise, here are palettes we know will transform your home.</p>
            </div>

            <div class="palette-grid" id="paletteGrid">
                <!-- Palettes generated dynamically -->
            </div>

            <div class="confidence-section" id="confidenceSection" style="display: none;">
                <h3 class="confidence-title">Your Color Confidence Score</h3>
                <p class="confidence-subtitle">Based on your selections and popular St. Louis combinations</p>
                <div class="confidence-meter">
                    <div class="confidence-fill" id="confidenceFill" style="width: 0%"></div>
                </div>
                <div class="confidence-value" id="confidenceValue">0%</div>
                <div class="confidence-label">Ready for your consultation</div>
            </div>

            <div class="tip-card">
                <div class="tip-header">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>
                    Sean Says
                </div>
                <p class="tip-text">"Missouri summers are tough on south-facing dark colors. If your home faces south, consider lighter shades for the body—they'll look fresh longer between repaints."</p>
            </div>
        </section>

        <!-- Saved View -->
        <section id="savedView" class="view">
            <div class="section-header">
                <h2>Your Saved Palettes</h2>
                <div style="display: flex; gap: 8px;">
                    <button class="btn btn-secondary" onclick="exportData('csv')">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                        Export CSV
                    </button>
                    <button class="btn btn-secondary" onclick="exportData('json')">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                        Export JSON
                    </button>
                </div>
            </div>

            <div id="savedPalettesContainer">
                <!-- Empty state or saved palettes -->
            </div>
        </section>

        <!-- Settings View -->
        <section id="settingsView" class="view">
            <h2 class="mb-6">Settings</h2>

            <div class="settings-section">
                <h3>
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"/></svg>
                    Your Information
                </h3>
                <div class="form-group">
                    <label class="form-label">Your Name</label>
                    <input type="text" class="form-input" id="settingsName" placeholder="Enter your name" onchange="saveSettings()">
                </div>
                <div class="form-group">
                    <label class="form-label">Home Address (for consultation)</label>
                    <input type="text" class="form-input" id="settingsAddress" placeholder="e.g., 123 Main St, Webster Groves" onchange="saveSettings()">
                </div>
                <div class="form-group">
                    <label class="form-label">Notes for Sean</label>
                    <textarea class="form-input" id="settingsNotes" placeholder="Anything specific about your project..." onchange="saveSettings()"></textarea>
                </div>
            </div>

            <div class="settings-section">
                <h3>
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                    Data Management
                </h3>
                <div class="settings-row">
                    <div>
                        <div class="settings-label">Import Data</div>
                        <div class="settings-desc">Restore from a previous JSON backup</div>
                    </div>
                    <button class="btn btn-secondary" onclick="openImportModal()">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
                        Import
                    </button>
                </div>
                <div class="settings-row">
                    <div>
                        <div class="settings-label">Export All Data</div>
                        <div class="settings-desc">Download your style profile and saved palettes</div>
                    </div>
                    <button class="btn btn-secondary" onclick="exportData('json')">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
                        Export JSON
                    </button>
                </div>
                <div class="settings-row">
                    <div>
                        <div class="settings-label">Clear All Data</div>
                        <div class="settings-desc">Remove all saved palettes and preferences</div>
                    </div>
                    <button class="btn btn-secondary" style="border-color: var(--kennedy-red); color: var(--kennedy-red);" onclick="confirmClearAll()">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                        Clear All
                    </button>
                </div>
            </div>

            <div class="settings-section">
                <h3>
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                    About Kennedy Color Compass
                </h3>
                <p style="color: var(--slate-light); line-height: 1.7;">
                    This color consultation tool was built exclusively for Kennedy Painting customers. Our curated palettes are based on 27 years of experience painting homes throughout the St. Louis metropolitan area.
                </p>
                <p style="color: var(--slate-light); line-height: 1.7; margin-top: 12px;">
                    <strong>Kennedy Painting</strong><br>
                    11678 Gravois Rd, St. Louis, MO 63126<br>
                    (314) 952-0156<br>
                    stlouishousepainting.com
                </p>
            </div>
        </section>
    </main>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
        <button class="nav-tab active" data-view="discover">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M16.2 7.8l-2 6.3-6.4 2.1 2-6.3z"/></svg>
            Discover
        </button>
        <button class="nav-tab" data-view="palettes">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.93 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.04-.23-.29-.38-.63-.38-1.01 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8z"/><circle cx="7.5" cy="11.5" r="1.5"/><circle cx="10.5" cy="7.5" r="1.5"/><circle cx="14.5" cy="7.5" r="1.5"/><circle cx="17.5" cy="11.5" r="1.5"/></svg>
            Palettes
        </button>
        <button class="nav-tab" data-view="saved">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>
            Saved
        </button>
        <button class="nav-tab" data-view="settings">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
            Settings
        </button>
    </nav>

    <!-- Import Modal -->
    <div class="modal-overlay" id="importModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Import Data</h3>
                <button class="modal-close" onclick="closeImportModal()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Paste JSON or CSV data</label>
                    <textarea class="form-input" id="importData" placeholder='{"styleProfile": {...}, "savedPalettes": [...]}'></textarea>
                </div>
                <p style="font-size: 13px; color: var(--slate-light);">Paste the contents of a previously exported JSON file, or import CSV data from another source.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeImportModal()">Cancel</button>
                <button class="btn btn-primary" onclick="importData()">Import</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <script>
        // ===== Security Layer =====
        function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
        const _V=1376181613;
        const _k=new URLSearchParams(window.location.search).get('key');
        if(!_k||_h(_k)!==_V){
            document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;background:#111;color:#fff;text-align:center;padding:20px"><div><h1 style="font-size:2rem;margin-bottom:1rem">Access Denied</h1><p style="color:#999">This tool requires a valid access key.</p><p style="margin-top:1rem"><a href="mailto:ben@bennycutools.com" style="color:#4da6ff">ben@bennycutools.com</a></p></div></div>';
            throw new Error('Invalid key');
        }

        // Anti-devtools & protections
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', e => {
            if(e.key==='F12'||(e.ctrlKey&&e.shiftKey&&(e.key==='I'||e.key==='J'||e.key==='C'))||(e.ctrlKey&&e.key==='U')){
                e.preventDefault();
                return false;
            }
        });

        // ===== Database & State =====
        const DB_NAME = 'KennedyColorCompass';
        const DB_VERSION = 1;
        let db = null;
        
        const state = {
            currentView: 'discover',
            currentQuestion: 0,
            interviewAnswers: {},
            styleProfile: null,
            selectedPalette: null,
            savedPalettes: [],
            settings: { name: '', address: '', notes: '' },
            hasDemo: false,
            undoStack: []
        };

        // Style interview questions
        const questions = [
            {
                id: 'era',
                question: 'What architectural era speaks to you?',
                hint: 'Think about the homes you admire most',
                choices: [
                    { id: 'historic', title: 'Historic Charm', desc: 'Pre-1940s elegance', visual: 'linear-gradient(135deg, #8B4513 0%, #D2691E 100%)' },
                    { id: 'midcentury', title: 'Mid-Century', desc: '1950s-1970s style', visual: 'linear-gradient(135deg, #FF6B35 0%, #F7C59F 100%)' },
                    { id: 'traditional', title: 'Traditional', desc: 'Timeless & classic', visual: 'linear-gradient(135deg, #4A5568 0%, #718096 100%)' },
                    { id: 'modern', title: 'Modern', desc: 'Clean & contemporary', visual: 'linear-gradient(135deg, #1A202C 0%, #4A5568 100%)' }
                ]
            },
            {
                id: 'mood',
                question: 'What mood should your home convey?',
                hint: 'The feeling visitors get when they see your home',
                choices: [
                    { id: 'warm', title: 'Warm & Welcoming', desc: 'Inviting & comfortable', visual: 'linear-gradient(135deg, #F6E05E 0%, #ED8936 100%)' },
                    { id: 'calm', title: 'Calm & Serene', desc: 'Peaceful & relaxed', visual: 'linear-gradient(135deg, #81E6D9 0%, #4299E1 100%)' },
                    { id: 'bold', title: 'Bold & Confident', desc: 'Makes a statement', visual: 'linear-gradient(135deg, #9F7AEA 0%, #ED64A6 100%)' },
                    { id: 'refined', title: 'Refined & Elegant', desc: 'Sophisticated & polished', visual: 'linear-gradient(135deg, #2D3748 0%, #4A5568 100%)' }
                ]
            },
            {
                id: 'colorFamily',
                question: 'Which color family draws you in?',
                hint: 'Don\'t overthink—go with your gut',
                choices: [
                    { id: 'neutrals', title: 'Warm Neutrals', desc: 'Creams, tans, warm grays', visual: 'linear-gradient(135deg, #F5F0E6 0%, #D4C4B0 100%)', lightText: true },
                    { id: 'blues', title: 'Blues & Grays', desc: 'Cool, crisp, classic', visual: 'linear-gradient(135deg, #BEE3F8 0%, #4299E1 100%)' },
                    { id: 'greens', title: 'Greens & Nature', desc: 'Earthy, organic, fresh', visual: 'linear-gradient(135deg, #C6F6D5 0%, #48BB78 100%)' },
                    { id: 'rich', title: 'Rich & Deep', desc: 'Navy, burgundy, forest', visual: 'linear-gradient(135deg, #2D3748 0%, #742A2A 100%)' }
                ]
            },
            {
                id: 'neighborhood',
                question: 'How do you want to fit in your neighborhood?',
                hint: 'There\'s no wrong answer here',
                choices: [
                    { id: 'blend', title: 'Blend Beautifully', desc: 'Complement my neighbors', visual: 'linear-gradient(135deg, #E2E8F0 0%, #A0AEC0 100%)' },
                    { id: 'standout', title: 'Stand Out Tastefully', desc: 'Unique but appropriate', visual: 'linear-gradient(135deg, #FEB2B2 0%, #FC8181 100%)' },
                    { id: 'statement', title: 'Make a Statement', desc: 'Be the conversation starter', visual: 'linear-gradient(135deg, #805AD5 0%, #D53F8C 100%)' }
                ]
            },
            {
                id: 'maintenance',
                question: 'How do you feel about maintenance?',
                hint: 'Honest answers lead to better recommendations',
                choices: [
                    { id: 'minimal', title: 'Keep It Easy', desc: 'Low maintenance preferred', visual: 'linear-gradient(135deg, #E8E8E8 0%, #BEBEBE 100%)', lightText: true },
                    { id: 'moderate', title: 'Worth the Effort', desc: 'Some upkeep is fine', visual: 'linear-gradient(135deg, #90CDF4 0%, #4299E1 100%)' },
                    { id: 'committed', title: 'Fully Committed', desc: 'Will maintain whatever it takes', visual: 'linear-gradient(135deg, #1A365D 0%, #2A4365 100%)' }
                ]
            }
        ];

        // Curated palettes based on style profiles
        const paletteDatabase = {
            'Timeless Traditional': [
                {
                    id: 'webster-classic',
                    name: 'Webster Groves Classic',
                    description: 'A beloved combination seen throughout Webster Groves. Warm, welcoming, and never goes out of style.',
                    colors: [
                        { name: 'Revere Pewter', hex: '#C2B9A7', role: 'body' },
                        { name: 'Simply White', hex: '#F5F1EB', role: 'trim', light: true },
                        { name: 'Wrought Iron', hex: '#3C3C3C', role: 'accent' }
                    ],
                    tags: ['Popular', 'Resale Friendly', 'Low Maintenance']
                },
                {
                    id: 'clayton-colonial',
                    name: 'Clayton Colonial',
                    description: 'Dignified and refined, this palette speaks to the stately homes of Clayton\'s historic streets.',
                    colors: [
                        { name: 'Edgecomb Gray', hex: '#C7BFB0', role: 'body' },
                        { name: 'White Dove', hex: '#F0EBE0', role: 'trim', light: true },
                        { name: 'Hale Navy', hex: '#3C4A5B', role: 'accent' }
                    ],
                    tags: ['Elegant', 'Historic', 'Timeless']
                },
                {
                    id: 'kirkwood-heritage',
                    name: 'Kirkwood Heritage',
                    description: 'Inspired by Kirkwood\'s charming downtown, this warm palette feels like home.',
                    colors: [
                        { name: 'Accessible Beige', hex: '#C9C0AC', role: 'body' },
                        { name: 'Alabaster', hex: '#EDEAE0', role: 'trim', light: true },
                        { name: 'Van Dyke Brown', hex: '#4A3728', role: 'accent' }
                    ],
                    tags: ['Warm', 'Inviting', 'Family-Friendly']
                }
            ],
            'Modern Farmhouse': [
                {
                    id: 'farmhouse-fresh',
                    name: 'Farmhouse Fresh',
                    description: 'Clean whites and deep accents create that sought-after modern farmhouse aesthetic.',
                    colors: [
                        { name: 'Extra White', hex: '#F4F4F2', role: 'body', light: true },
                        { name: 'Pure White', hex: '#FFFFFF', role: 'trim', light: true },
                        { name: 'Iron Ore', hex: '#434343', role: 'accent' }
                    ],
                    tags: ['Trendy', 'Clean', 'Instagram-Ready']
                },
                {
                    id: 'barnhouse-beauty',
                    name: 'Barnhouse Beauty',
                    description: 'Sage and cream evoke the peaceful Missouri countryside without feeling dated.',
                    colors: [
                        { name: 'Evergreen Fog', hex: '#96A697', role: 'body' },
                        { name: 'Creamy', hex: '#F5EFE0', role: 'trim', light: true },
                        { name: 'Tricorn Black', hex: '#2F2F2F', role: 'accent' }
                    ],
                    tags: ['Organic', 'Calming', 'On-Trend']
                },
                {
                    id: 'country-modern',
                    name: 'Country Modern',
                    description: 'Navy and white is a classic American combination that feels fresh and timeless.',
                    colors: [
                        { name: 'Naval', hex: '#3D5A80', role: 'body' },
                        { name: 'Pure White', hex: '#FFFFFF', role: 'trim', light: true },
                        { name: 'Brass Kickplate', hex: '#B8860B', role: 'accent' }
                    ],
                    tags: ['Bold', 'Patriotic', 'Eye-Catching']
                }
            ],
            'Contemporary Cool': [
                {
                    id: 'downtown-loft',
                    name: 'Downtown Loft',
                    description: 'Cool grays and industrial accents perfect for urban St. Louis living.',
                    colors: [
                        { name: 'Repose Gray', hex: '#B5AFA5', role: 'body' },
                        { name: 'Extra White', hex: '#F4F4F2', role: 'trim', light: true },
                        { name: 'Black Magic', hex: '#1C1C1C', role: 'accent' }
                    ],
                    tags: ['Urban', 'Minimal', 'Sophisticated']
                },
                {
                    id: 'central-west-end',
                    name: 'Central West End',
                    description: 'Inspired by the eclectic charm of the CWE, this palette is both bold and balanced.',
                    colors: [
                        { name: 'Sea Salt', hex: '#C3D5C7', role: 'body' },
                        { name: 'Snowbound', hex: '#EDE9E3', role: 'trim', light: true },
                        { name: 'Urbane Bronze', hex: '#5A5248', role: 'accent' }
                    ],
                    tags: ['Artistic', 'Unique', 'Balanced']
                },
                {
                    id: 'gallery-slate',
                    name: 'Gallery Slate',
                    description: 'A museum-worthy combination that lets your home become the art.',
                    colors: [
                        { name: 'Dorian Gray', hex: '#A6A6A0', role: 'body' },
                        { name: 'Chantilly Lace', hex: '#F5F5F5', role: 'trim', light: true },
                        { name: 'Charcoal Blue', hex: '#384D5E', role: 'accent' }
                    ],
                    tags: ['Gallery', 'Refined', 'Art-Forward']
                }
            ],
            'Historic Restoration': [
                {
                    id: 'soulard-victorian',
                    name: 'Soulard Victorian',
                    description: 'Rich jewel tones that honor Soulard\'s vibrant Victorian heritage.',
                    colors: [
                        { name: 'Moroccan Red', hex: '#8C3D3D', role: 'body' },
                        { name: 'Antique White', hex: '#FAE8D4', role: 'trim', light: true },
                        { name: 'Hunter Green', hex: '#2F5233', role: 'accent' }
                    ],
                    tags: ['Historic', 'Bold', 'Character']
                },
                {
                    id: 'tower-grove',
                    name: 'Tower Grove Elegance',
                    description: 'Honoring the grand Victorian homes near Tower Grove Park.',
                    colors: [
                        { name: 'Wedgewood Gray', hex: '#7F909A', role: 'body' },
                        { name: 'Swiss Coffee', hex: '#F2EBE0', role: 'trim', light: true },
                        { name: 'Black Bean', hex: '#241A12', role: 'accent' }
                    ],
                    tags: ['Victorian', 'Stately', 'Elegant']
                },
                {
                    id: 'lafayette-square',
                    name: 'Lafayette Square',
                    description: 'Deep, rich colors that celebrate St. Louis\'s most historic neighborhood.',
                    colors: [
                        { name: 'Naval', hex: '#34495E', role: 'body' },
                        { name: 'Cream', hex: '#FFFDD0', role: 'trim', light: true },
                        { name: 'Burgundy Wine', hex: '#6B2D5C', role: 'accent' }
                    ],
                    tags: ['Prestigious', 'Historic', 'Unique']
                }
            ]
        };

        // Demo data for St. Louis area
        const demoData = {
            styleProfile: {
                era: 'traditional',
                mood: 'warm',
                colorFamily: 'neutrals',
                neighborhood: 'blend',
                maintenance: 'moderate',
                profileName: 'Timeless Traditional'
            },
            savedPalettes: [
                {
                    id: 'demo-1',
                    name: 'Webster Groves Classic',
                    colors: [
                        { name: 'Revere Pewter', hex: '#C2B9A7', role: 'body' },
                        { name: 'Simply White', hex: '#F5F1EB', role: 'trim' },
                        { name: 'Wrought Iron', hex: '#3C3C3C', role: 'accent' }
                    ],
                    savedAt: new Date().toISOString(),
                    notes: 'Perfect for our 1920s bungalow in Webster Groves',
                    isDemo: true
                },
                {
                    id: 'demo-2',
                    name: 'Clayton Colonial',
                    colors: [
                        { name: 'Edgecomb Gray', hex: '#C7BFB0', role: 'body' },
                        { name: 'White Dove', hex: '#F0EBE0', role: 'trim' },
                        { name: 'Hale Navy', hex: '#3C4A5B', role: 'accent' }
                    ],
                    savedAt: new Date(Date.now() - 86400000).toISOString(),
                    notes: 'Considering this for the exterior refresh',
                    isDemo: true
                },
                {
                    id: 'demo-3',
                    name: 'Kirkwood Heritage',
                    colors: [
                        { name: 'Accessible Beige', hex: '#C9C0AC', role: 'body' },
                        { name: 'Alabaster', hex: '#EDEAE0', role: 'trim' },
                        { name: 'Van Dyke Brown', hex: '#4A3728', role: 'accent' }
                    ],
                    savedAt: new Date(Date.now() - 172800000).toISOString(),
                    notes: 'Love how warm this feels',
                    isDemo: true
                }
            ],
            settings: {
                name: 'Sarah Mitchell',
                address: '456 Elm Ave, Webster Groves, MO',
                notes: 'Looking to repaint our 1920s bungalow exterior. South-facing front. Want something that honors the historic character.'
            }
        };

        // ===== Database Functions =====
        async function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = () => {
                    console.warn('IndexedDB not available, using localStorage');
                    resolve(null);
                };
                
                request.onsuccess = (e) => {
                    db = e.target.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (e) => {
                    const database = e.target.result;
                    
                    if (!database.objectStoreNames.contains('palettes')) {
                        database.createObjectStore('palettes', { keyPath: 'id' });
                    }
                    if (!database.objectStoreNames.contains('settings')) {
                        database.createObjectStore('settings', { keyPath: 'key' });
                    }
                    if (!database.objectStoreNames.contains('profile')) {
                        database.createObjectStore('profile', { keyPath: 'key' });
                    }
                };
            });
        }

        async function saveToStorage(store, key, data) {
            if (db) {
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(store, 'readwrite');
                    const objectStore = tx.objectStore(store);
                    objectStore.put({ key, ...data });
                    tx.oncomplete = () => resolve();
                    tx.onerror = () => reject(tx.error);
                });
            } else {
                localStorage.setItem(`kennedy_${store}_${key}`, JSON.stringify(data));
            }
        }

        async function loadFromStorage(store, key) {
            if (db) {
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(store, 'readonly');
                    const objectStore = tx.objectStore(store);
                    const request = objectStore.get(key);
                    request.onsuccess = () => resolve(request.result || null);
                    request.onerror = () => reject(request.error);
                });
            } else {
                const data = localStorage.getItem(`kennedy_${store}_${key}`);
                return data ? JSON.parse(data) : null;
            }
        }

        async function getAllFromStorage(store) {
            if (db) {
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(store, 'readonly');
                    const objectStore = tx.objectStore(store);
                    const request = objectStore.getAll();
                    request.onsuccess = () => resolve(request.result || []);
                    request.onerror = () => reject(request.error);
                });
            } else {
                const results = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith(`kennedy_${store}_`)) {
                        results.push(JSON.parse(localStorage.getItem(key)));
                    }
                }
                return results;
            }
        }

        async function deleteFromStorage(store, key) {
            if (db) {
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(store, 'readwrite');
                    const objectStore = tx.objectStore(store);
                    objectStore.delete(key);
                    tx.oncomplete = () => resolve();
                    tx.onerror = () => reject(tx.error);
                });
            } else {
                localStorage.removeItem(`kennedy_${store}_${key}`);
            }
        }

        async function clearStorage(store) {
            if (db) {
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(store, 'readwrite');
                    const objectStore = tx.objectStore(store);
                    objectStore.clear();
                    tx.oncomplete = () => resolve();
                    tx.onerror = () => reject(tx.error);
                });
            } else {
                const keysToRemove = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith(`kennedy_${store}_`)) {
                        keysToRemove.push(key);
                    }
                }
                keysToRemove.forEach(k => localStorage.removeItem(k));
            }
        }

        // ===== View Navigation =====
        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewName + 'View').classList.add('active');
            
            document.querySelectorAll('.nav-tab, .desktop-nav button').forEach(t => t.classList.remove('active'));
            document.querySelectorAll(`[data-view="${viewName}"]`).forEach(t => t.classList.add('active'));
            
            state.currentView = viewName;
            
            if (viewName === 'saved') {
                renderSavedPalettes();
            } else if (viewName === 'palettes' && state.styleProfile) {
                renderPalettes();
            } else if (viewName === 'settings') {
                loadSettingsForm();
            }
        }

        // ===== Interview Flow =====
        function startInterview() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('interviewScreen').style.display = 'block';
            state.currentQuestion = 0;
            state.interviewAnswers = {};
            renderProgress();
            renderQuestion();
        }

        function renderProgress() {
            const container = document.getElementById('progressSteps');
            container.innerHTML = questions.map((q, i) => {
                let className = 'progress-step';
                if (i < state.currentQuestion) className += ' completed';
                else if (i === state.currentQuestion) className += ' active';
                return `<div class="${className}"></div>`;
            }).join('');
        }

        function renderQuestion() {
            const q = questions[state.currentQuestion];
            const container = document.getElementById('interviewQuestions');
            
            container.innerHTML = `
                <div class="interview-question">
                    <div class="question-number">${state.currentQuestion + 1}</div>
                    <h2 class="question-text">${q.question}</h2>
                    <p class="question-hint">${q.hint}</p>
                </div>
                <div class="choice-grid ${q.choices.length === 3 ? 'cols-3' : ''}">
                    ${q.choices.map(choice => `
                        <div class="choice-card ${state.interviewAnswers[q.id] === choice.id ? 'selected' : ''}" 
                             onclick="selectChoice('${q.id}', '${choice.id}')">
                            <div class="choice-visual" style="background: ${choice.visual}"></div>
                            <div class="choice-title">${choice.title}</div>
                            <div class="choice-desc">${choice.desc}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Update navigation
            document.getElementById('prevBtn').style.visibility = state.currentQuestion > 0 ? 'visible' : 'hidden';
            document.getElementById('nextBtn').disabled = !state.interviewAnswers[q.id];
            document.getElementById('nextBtn').innerHTML = state.currentQuestion === questions.length - 1 
                ? 'See My Palettes <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>'
                : 'Next <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
        }

        function selectChoice(questionId, choiceId) {
            state.interviewAnswers[questionId] = choiceId;
            renderQuestion();
        }

        function prevQuestion() {
            if (state.currentQuestion > 0) {
                state.currentQuestion--;
                renderProgress();
                renderQuestion();
            }
        }

        async function nextQuestion() {
            if (state.currentQuestion < questions.length - 1) {
                state.currentQuestion++;
                renderProgress();
                renderQuestion();
            } else {
                // Calculate style profile
                await calculateStyleProfile();
                switchView('palettes');
            }
        }

        async function calculateStyleProfile() {
            const answers = state.interviewAnswers;
            let profileName = 'Timeless Traditional';
            
            // Simple algorithm based on answers
            if (answers.era === 'modern' || answers.era === 'midcentury') {
                if (answers.mood === 'calm' || answers.mood === 'refined') {
                    profileName = 'Contemporary Cool';
                } else {
                    profileName = 'Modern Farmhouse';
                }
            } else if (answers.era === 'historic') {
                profileName = 'Historic Restoration';
            } else {
                if (answers.colorFamily === 'neutrals' || answers.colorFamily === 'blues') {
                    profileName = 'Timeless Traditional';
                } else if (answers.mood === 'bold' || answers.neighborhood === 'statement') {
                    profileName = 'Historic Restoration';
                } else {
                    profileName = 'Modern Farmhouse';
                }
            }
            
            state.styleProfile = {
                ...answers,
                profileName
            };
            
            await saveToStorage('profile', 'current', state.styleProfile);
            showToast('Style profile created!', 'success');
        }

        // ===== Palette Rendering =====
        function renderPalettes() {
            const profileName = state.styleProfile?.profileName || 'Timeless Traditional';
            document.getElementById('styleProfileName').textContent = profileName;
            
            const palettes = paletteDatabase[profileName] || paletteDatabase['Timeless Traditional'];
            const container = document.getElementById('paletteGrid');
            
            container.innerHTML = palettes.map(palette => `
                <div class="palette-card ${state.selectedPalette?.id === palette.id ? 'selected' : ''}" 
                     onclick="selectPalette('${palette.id}')">
                    <div class="palette-colors">
                        ${palette.colors.map(c => `
                            <div class="palette-color ${c.light ? 'light-text' : ''}" style="background: ${c.hex}">
                                <span class="palette-color-label">${c.role}</span>
                                <span class="palette-color-name">${c.name}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="palette-info">
                        <div class="palette-name">${palette.name}</div>
                        <div class="palette-description">${palette.description}</div>
                        <div class="palette-tags">
                            ${palette.tags.map(t => `<span class="palette-tag">${t}</span>`).join('')}
                        </div>
                    </div>
                    <div class="selected-indicator">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 6px;"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                        Selected — Click to Save
                    </div>
                </div>
            `).join('');
            
            // Show confidence section if palette selected
            if (state.selectedPalette) {
                updateConfidence();
            }
        }

        async function selectPalette(paletteId) {
            const profileName = state.styleProfile?.profileName || 'Timeless Traditional';
            const palettes = paletteDatabase[profileName] || paletteDatabase['Timeless Traditional'];
            const palette = palettes.find(p => p.id === paletteId);
            
            if (palette) {
                if (state.selectedPalette?.id === paletteId) {
                    // Save the palette
                    await savePalette(palette);
                } else {
                    state.selectedPalette = palette;
                    renderPalettes();
                }
            }
        }

        function updateConfidence() {
            const section = document.getElementById('confidenceSection');
            section.style.display = 'block';
            
            // Calculate confidence based on factors
            let confidence = 50;
            if (state.styleProfile) confidence += 20;
            if (state.selectedPalette) confidence += 15;
            if (state.savedPalettes.length > 0) confidence += 15;
            confidence = Math.min(confidence, 100);
            
            setTimeout(() => {
                document.getElementById('confidenceFill').style.width = confidence + '%';
                document.getElementById('confidenceValue').textContent = confidence + '%';
            }, 100);
        }

        // ===== Saved Palettes =====
        async function savePalette(palette) {
            const savedPalette = {
                id: 'palette-' + Date.now(),
                name: palette.name,
                colors: palette.colors,
                savedAt: new Date().toISOString(),
                notes: '',
                isDemo: false
            };
            
            state.savedPalettes.push(savedPalette);
            await saveToStorage('palettes', savedPalette.id, savedPalette);
            showToast(`"${palette.name}" saved to your collection!`, 'success');
            updateConfidence();
        }

        function renderSavedPalettes() {
            const container = document.getElementById('savedPalettesContainer');
            
            if (state.savedPalettes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>
                        </div>
                        <h3 class="empty-title">No Saved Palettes Yet</h3>
                        <p class="empty-text">Complete the style interview and save your favorite color combinations to build your collection.</p>
                        <button class="btn btn-primary" onclick="switchView('discover')">
                            Start Discovery
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = state.savedPalettes.map(palette => `
                <div class="saved-palette-card">
                    <div class="saved-colors">
                        ${palette.colors.map(c => `
                            <div class="saved-color" style="background: ${c.hex}" title="${c.name}"></div>
                        `).join('')}
                    </div>
                    <div class="saved-info">
                        <div class="saved-name">${palette.name}${palette.isDemo ? ' <span style="color: var(--warning); font-size: 12px;">(Demo)</span>' : ''}</div>
                        <div class="saved-meta">Saved ${formatDate(palette.savedAt)}${palette.notes ? ' • ' + truncate(palette.notes, 40) : ''}</div>
                    </div>
                    <div class="saved-actions">
                        <button class="btn-icon" onclick="copyPaletteColors('${palette.id}')" title="Copy colors">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                        </button>
                        <button class="btn-icon danger" onclick="deletePalette('${palette.id}')" title="Delete">
                            <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function deletePalette(id) {
            const palette = state.savedPalettes.find(p => p.id === id);
            if (!palette) return;
            
            const index = state.savedPalettes.findIndex(p => p.id === id);
            state.savedPalettes.splice(index, 1);
            await deleteFromStorage('palettes', id);
            
            // Add to undo stack
            state.undoStack.push({ type: 'delete', data: palette, index });
            
            renderSavedPalettes();
            showToastWithUndo(`"${palette.name}" deleted`, async () => {
                state.savedPalettes.splice(index, 0, palette);
                await saveToStorage('palettes', palette.id, palette);
                renderSavedPalettes();
                showToast('Restored!', 'success');
            });
        }

        function copyPaletteColors(id) {
            const palette = state.savedPalettes.find(p => p.id === id);
            if (!palette) return;
            
            const text = palette.colors.map(c => `${c.role}: ${c.name} (${c.hex})`).join('\n');
            navigator.clipboard.writeText(text).then(() => {
                showToast('Colors copied to clipboard!', 'success');
            }).catch(() => {
                showToast('Could not copy to clipboard', 'error');
            });
        }

        // ===== Data Import/Export =====
        function exportData(format) {
            const data = {
                styleProfile: state.styleProfile,
                savedPalettes: state.savedPalettes,
                settings: state.settings,
                exportedAt: new Date().toISOString(),
                source: 'Kennedy Color Compass'
            };
            
            let content, filename, type;
            
            if (format === 'csv') {
                const rows = [['Palette Name', 'Body Color', 'Body Hex', 'Trim Color', 'Trim Hex', 'Accent Color', 'Accent Hex', 'Notes', 'Saved At']];
                state.savedPalettes.forEach(p => {
                    const body = p.colors.find(c => c.role === 'body') || {};
                    const trim = p.colors.find(c => c.role === 'trim') || {};
                    const accent = p.colors.find(c => c.role === 'accent') || {};
                    rows.push([p.name, body.name || '', body.hex || '', trim.name || '', trim.hex || '', accent.name || '', accent.hex || '', p.notes || '', p.savedAt]);
                });
                content = rows.map(r => r.map(c => `"${c}"`).join(',')).join('\n');
                filename = 'kennedy-color-palettes.csv';
                type = 'text/csv';
            } else {
                content = JSON.stringify(data, null, 2);
                filename = 'kennedy-color-compass-backup.json';
                type = 'application/json';
            }
            
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast(`Exported as ${format.toUpperCase()}!`, 'success');
        }

        function openImportModal() {
            document.getElementById('importModal').classList.add('active');
            document.getElementById('importData').value = '';
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.remove('active');
        }

        async function importData() {
            const input = document.getElementById('importData').value.trim();
            if (!input) {
                showToast('Please paste data to import', 'error');
                return;
            }
            
            try {
                // Try JSON first
                if (input.startsWith('{') || input.startsWith('[')) {
                    const data = JSON.parse(input);
                    
                    if (data.styleProfile) {
                        state.styleProfile = data.styleProfile;
                        await saveToStorage('profile', 'current', state.styleProfile);
                    }
                    
                    if (data.savedPalettes && Array.isArray(data.savedPalettes)) {
                        for (const palette of data.savedPalettes) {
                            palette.isDemo = false;
                            state.savedPalettes.push(palette);
                            await saveToStorage('palettes', palette.id, palette);
                        }
                    }
                    
                    if (data.settings) {
                        state.settings = { ...state.settings, ...data.settings };
                        await saveToStorage('settings', 'user', state.settings);
                    }
                    
                    closeImportModal();
                    showToast('Data imported successfully!', 'success');
                    renderSavedPalettes();
                    return;
                }
                
                // Try CSV
                const lines = input.split('\n').filter(l => l.trim());
                if (lines.length > 1) {
                    // Skip header, parse rows
                    for (let i = 1; i < lines.length; i++) {
                        const cols = lines[i].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                        if (cols && cols.length >= 7) {
                            const clean = c => (c || '').replace(/^"|"$/g, '').trim();
                            const palette = {
                                id: 'imported-' + Date.now() + '-' + i,
                                name: clean(cols[0]),
                                colors: [
                                    { name: clean(cols[1]), hex: clean(cols[2]), role: 'body' },
                                    { name: clean(cols[3]), hex: clean(cols[4]), role: 'trim' },
                                    { name: clean(cols[5]), hex: clean(cols[6]), role: 'accent' }
                                ],
                                notes: clean(cols[7]) || '',
                                savedAt: clean(cols[8]) || new Date().toISOString(),
                                isDemo: false
                            };
                            state.savedPalettes.push(palette);
                            await saveToStorage('palettes', palette.id, palette);
                        }
                    }
                    closeImportModal();
                    showToast('CSV imported successfully!', 'success');
                    renderSavedPalettes();
                    return;
                }
                
                showToast('Could not parse import data', 'error');
            } catch (e) {
                console.error('Import error:', e);
                showToast('Invalid data format', 'error');
            }
        }

        // ===== Demo Data =====
        async function loadDemoData() {
            state.styleProfile = demoData.styleProfile;
            state.settings = demoData.settings;
            state.hasDemo = true;
            
            await saveToStorage('profile', 'current', state.styleProfile);
            await saveToStorage('settings', 'user', state.settings);
            
            for (const palette of demoData.savedPalettes) {
                state.savedPalettes.push(palette);
                await saveToStorage('palettes', palette.id, palette);
            }
            
            document.getElementById('demoBanner').style.display = 'flex';
            showToast('Demo data loaded!', 'success');
            switchView('palettes');
            renderPalettes();
        }

        async function clearDemoData() {
            const demoPalettes = state.savedPalettes.filter(p => p.isDemo);
            for (const p of demoPalettes) {
                await deleteFromStorage('palettes', p.id);
            }
            state.savedPalettes = state.savedPalettes.filter(p => !p.isDemo);
            state.hasDemo = false;
            
            document.getElementById('demoBanner').style.display = 'none';
            showToast('Demo data cleared', 'success');
            renderSavedPalettes();
        }

        // ===== Settings =====
        function loadSettingsForm() {
            document.getElementById('settingsName').value = state.settings.name || '';
            document.getElementById('settingsAddress').value = state.settings.address || '';
            document.getElementById('settingsNotes').value = state.settings.notes || '';
        }

        async function saveSettings() {
            state.settings = {
                name: document.getElementById('settingsName').value,
                address: document.getElementById('settingsAddress').value,
                notes: document.getElementById('settingsNotes').value
            };
            await saveToStorage('settings', 'user', state.settings);
            showToast('Settings saved!', 'success');
        }

        async function confirmClearAll() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                await clearStorage('palettes');
                await clearStorage('settings');
                await clearStorage('profile');
                
                state.savedPalettes = [];
                state.styleProfile = null;
                state.settings = { name: '', address: '', notes: '' };
                state.hasDemo = false;
                
                document.getElementById('demoBanner').style.display = 'none';
                loadSettingsForm();
                showToast('All data cleared', 'success');
                switchView('discover');
                document.getElementById('welcomeScreen').style.display = 'block';
                document.getElementById('interviewScreen').style.display = 'none';
            }
        }

        // ===== Toast Notifications =====
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                    ${type === 'success' ? '<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>' :
                      type === 'error' ? '<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>' :
                      '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>'}
                </svg>
                <span>${message}</span>
            `;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(10px)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function showToastWithUndo(message, undoFn) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <span>${message}</span>
                <button class="toast-undo" onclick="this.parentElement.remove()">Undo</button>
            `;
            
            const undoBtn = toast.querySelector('.toast-undo');
            let timer = 5;
            undoBtn.textContent = `Undo (${timer})`;
            
            const interval = setInterval(() => {
                timer--;
                undoBtn.textContent = `Undo (${timer})`;
                if (timer <= 0) {
                    clearInterval(interval);
                    toast.remove();
                }
            }, 1000);
            
            undoBtn.addEventListener('click', () => {
                clearInterval(interval);
                undoFn();
                toast.remove();
            });
            
            container.appendChild(toast);
        }

        // ===== Utilities =====
        function formatDate(isoString) {
            const date = new Date(isoString);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'just now';
            if (diff < 3600000) return Math.floor(diff / 60000) + ' min ago';
            if (diff < 86400000) return Math.floor(diff / 3600000) + ' hours ago';
            if (diff < 604800000) return Math.floor(diff / 86400000) + ' days ago';
            
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function truncate(str, len) {
            return str.length > len ? str.substring(0, len) + '...' : str;
        }

        // ===== Initialization =====
        async function init() {
            await initDB();
            
            // Load saved data
            const profile = await loadFromStorage('profile', 'current');
            if (profile) {
                state.styleProfile = profile;
            }
            
            const settings = await loadFromStorage('settings', 'user');
            if (settings) {
                state.settings = settings;
            }
            
            const palettes = await getAllFromStorage('palettes');
            state.savedPalettes = palettes.filter(p => p && p.id);
            
            // Check for demo data
            if (state.savedPalettes.some(p => p.isDemo)) {
                state.hasDemo = true;
                document.getElementById('demoBanner').style.display = 'flex';
            }
            
            // If we have a profile, show welcome differently
            if (state.styleProfile) {
                // Could show a "continue" state here
            }
            
            // Navigation event listeners
            document.querySelectorAll('.nav-tab, .desktop-nav button').forEach(btn => {
                btn.addEventListener('click', () => {
                    const view = btn.dataset.view;
                    if (view) switchView(view);
                });
            });
        }

        // Start app
        init();
    </script>
</div>
<script src="https://book.bennycutools.com/tracker.js" async></script>
</body>
</html>
