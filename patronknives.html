<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>BladeBoard - Patron Saint of Knives</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bitter:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
--charcoal:#2B2B2B;--charcoal-light:#3D3D3D;--brass:#C2922E;--brass-light:#D4A94A;--brass-dark:#A67B1F;
--forest:#4A6741;--forest-light:#5E8354;--parchment:#F7F5F0;--card:#FFFFFF;--border:#E2DFD8;
--muted:#7A766E;--text:#1C1C1C;--success:#3A7D44;--error:#B83A3A;--info:#3A6B9F;
--shadow-sm:0 1px 3px rgba(28,28,28,0.06),0 1px 2px rgba(28,28,28,0.04);
--shadow-md:0 4px 14px rgba(28,28,28,0.08),0 2px 6px rgba(28,28,28,0.04);
--shadow-lg:0 12px 36px rgba(28,28,28,0.12),0 4px 12px rgba(28,28,28,0.06);
--radius:10px;--radius-sm:6px;
--font-head:'Bitter',serif;--font-body:'Inter',sans-serif;
}
html{font-size:16px;-webkit-text-size-adjust:100%}
body{font-family:var(--font-body);background:var(--parchment);color:var(--text);line-height:1.5;padding-bottom:120px!important;min-height:100vh;overflow-x:hidden}
h1,h2,h3{font-family:var(--font-head);font-weight:600;line-height:1.2}
h1{font-size:1.5rem}h2{font-size:1.2rem}h3{font-size:1rem}
button,input,select,textarea{font-family:var(--font-body);font-size:16px}
*:focus-visible{outline:2px solid var(--brass);outline-offset:2px}
@media(prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:0.01ms!important;transition-duration:0.01ms!important}}
.skip-link{position:absolute;top:-100px;left:16px;background:var(--charcoal);color:#fff;padding:8px 16px;border-radius:var(--radius-sm);z-index:100000;font-size:14px}
.skip-link:focus{top:8px}

#app{display:none;max-width:480px;margin:0 auto}
@media(min-width:1024px){#app{max-width:720px}}

.app-header{background:var(--charcoal);color:#fff;padding:14px 20px;display:flex;align-items:center;gap:10px;position:sticky;top:0;z-index:100}
.app-header h1{color:#fff;font-size:1.15rem;flex:1}
.header-stats{display:flex;gap:12px;font-size:12px;color:rgba(255,255,255,0.6)}
.header-stats strong{color:var(--brass);font-weight:700}

.demo-banner{background:#FDF6E3;border-bottom:1px solid #EDE0B8;padding:8px 16px;display:flex;align-items:center;gap:8px;font-size:12px;color:#8A7530}
.demo-banner button{background:none;border:none;color:var(--brass-dark);cursor:pointer;font-weight:700;padding:4px;margin-left:auto}

.tab-content{padding:16px;display:none;animation:fadeUp 0.35s ease-out}
.tab-content.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}

.bottom-nav{position:fixed;bottom:48px;left:0;right:0;background:var(--card);border-top:1px solid var(--border);display:flex;z-index:90;padding:4px 0 8px}
.bottom-nav button{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 4px;background:none;border:none;color:var(--muted);cursor:pointer;font-size:10px;font-family:var(--font-body);transition:color 0.15s}
.bottom-nav button.active{color:var(--brass-dark)}
.bottom-nav button svg{width:22px;height:22px}
.bottom-nav button:active{transform:scale(0.95)}

.card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow-sm);border:1px solid var(--border);margin-bottom:10px;overflow:hidden;transition:box-shadow 0.2s}
.card:hover{box-shadow:var(--shadow-md)}

.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:10px 18px;border:none;border-radius:var(--radius-sm);font-weight:600;font-size:14px;cursor:pointer;transition:transform 0.12s,box-shadow 0.15s}
.btn:active{transform:scale(0.97)}
.btn-brass{background:var(--brass);color:#fff}
.btn-brass:hover{background:var(--brass-light)}
.btn-dark{background:var(--charcoal);color:#fff}
.btn-outline{background:transparent;border:1.5px solid var(--border);color:var(--text)}
.btn-sm{padding:6px 12px;font-size:12px}
.btn-block{width:100%}
.btn svg{width:16px;height:16px;flex-shrink:0}

.fab{position:fixed;bottom:118px;right:20px;width:56px;height:56px;border-radius:50%;background:var(--brass);color:#fff;border:none;box-shadow:var(--shadow-lg);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:80;transition:transform 0.2s}
.fab:hover{transform:scale(1.08)}
.fab:active{transform:scale(0.95)}
.fab svg{width:28px;height:28px}

.form-group{margin-bottom:14px}
.form-group label{display:block;font-size:12px;font-weight:600;color:var(--muted);margin-bottom:4px;text-transform:uppercase;letter-spacing:0.04em}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:10px 12px;border:1.5px solid var(--border);border-radius:var(--radius-sm);background:var(--card);color:var(--text);font-size:16px;transition:border-color 0.15s,box-shadow 0.15s}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{border-color:var(--brass);box-shadow:0 0 0 3px rgba(194,146,46,0.15)}

/* Order Card */
.order-card{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;gap:12px;align-items:flex-start;transition:background 0.15s}
.order-card:last-child{border-bottom:none}
.order-photo{width:48px;height:48px;border-radius:var(--radius-sm);background:var(--parchment);display:flex;align-items:center;justify-content:center;overflow:hidden;flex-shrink:0;border:1px solid var(--border)}
.order-photo img{width:100%;height:100%;object-fit:cover}
.order-photo svg{width:20px;height:20px;color:var(--muted)}
.order-info{flex:1;min-width:0}
.order-info h3{font-size:14px;margin-bottom:2px}
.order-info p{font-size:12px;color:var(--muted)}
.order-right{text-align:right;flex-shrink:0}
.order-price{font-weight:700;color:var(--brass-dark);font-size:14px}
.order-time{font-size:11px;color:var(--muted);margin-top:2px}

.status-badge{display:inline-block;padding:2px 8px;border-radius:10px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:0.04em}
.status-received{background:rgba(58,107,159,0.1);color:var(--info)}
.status-progress{background:rgba(194,146,46,0.15);color:var(--brass-dark)}
.status-ready{background:rgba(58,125,68,0.1);color:var(--success)}
.status-notified{background:rgba(74,103,65,0.15);color:var(--forest)}
.status-picked{background:rgba(122,118,110,0.1);color:var(--muted)}

/* Item Counter */
.item-counter{display:flex;align-items:center;gap:8px;padding:8px 0}
.item-counter label{font-size:13px;min-width:80px;color:var(--text)}
.counter-btn{width:36px;height:36px;border-radius:50%;border:1.5px solid var(--border);background:var(--card);color:var(--text);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.12s}
.counter-btn:active{transform:scale(0.9);background:var(--brass);color:#fff;border-color:var(--brass)}
.counter-val{font-size:18px;font-weight:700;min-width:28px;text-align:center}

/* Summary Strip */
.summary-strip{display:flex;gap:0;background:var(--charcoal);border-radius:var(--radius);overflow:hidden;margin-bottom:16px}
.summary-item{flex:1;padding:14px 8px;text-align:center;border-right:1px solid rgba(255,255,255,0.1)}
.summary-item:last-child{border-right:none}
.summary-item .val{font-size:1.4rem;font-weight:700;color:var(--brass);font-family:var(--font-head)}
.summary-item .lbl{font-size:10px;color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:0.06em;margin-top:2px}

/* Filter pills */
.filter-row{display:flex;gap:6px;margin-bottom:12px;overflow-x:auto;padding-bottom:4px}
.filter-pill{padding:5px 12px;border-radius:16px;font-size:12px;font-weight:500;border:1.5px solid var(--border);background:var(--card);color:var(--muted);cursor:pointer;white-space:nowrap;transition:all 0.15s}
.filter-pill.active{background:var(--charcoal);color:#fff;border-color:var(--charcoal)}
.filter-pill:active{transform:scale(0.95)}

.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(28,28,28,0.6);backdrop-filter:blur(4px);z-index:200;display:none;align-items:flex-end;justify-content:center}
.modal-overlay.show{display:flex}
.modal{background:var(--card);border-radius:var(--radius) var(--radius) 0 0;width:100%;max-width:480px;max-height:90vh;overflow-y:auto;padding:24px 20px;animation:slideUp 0.3s cubic-bezier(0.34,1.56,0.64,1)}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.modal h2{margin-bottom:16px}
.modal-close{position:absolute;top:12px;right:12px;background:none;border:none;cursor:pointer;padding:8px;color:var(--muted)}

.camera-container{position:relative;width:100%;aspect-ratio:4/3;background:#000;border-radius:var(--radius);overflow:hidden;margin-bottom:12px}
.camera-container video{width:100%;height:100%;object-fit:cover}
.camera-container canvas{display:none}
.camera-shutter{position:absolute;bottom:16px;left:50%;transform:translateX(-50%);width:56px;height:56px;border-radius:50%;background:rgba(255,255,255,0.9);border:4px solid var(--brass);cursor:pointer}
.camera-shutter:active{transform:translateX(-50%) scale(0.9)}

.toast-container{position:fixed;top:16px;left:50%;transform:translateX(-50%);z-index:10000;pointer-events:none}
.toast{background:var(--charcoal);color:#fff;padding:10px 20px;border-radius:var(--radius);font-size:14px;font-weight:500;box-shadow:var(--shadow-lg);animation:toastIn 0.3s ease-out;margin-bottom:8px}
@keyframes toastIn{from{opacity:0;transform:translateY(-12px)}to{opacity:1;transform:translateY(0)}}

/* Upsell */
.upsell-box{background:var(--parchment);border:1.5px dashed var(--border);border-radius:var(--radius);padding:24px;text-align:center}
.upsell-tag{background:var(--charcoal);color:var(--brass);font-size:10px;font-weight:700;padding:3px 10px;border-radius:8px;text-transform:uppercase;letter-spacing:0.05em;display:inline-block;margin-bottom:12px}

@media print{
.bottom-nav,.fab,.demo-banner,.app-header,.toast-container,.modal-overlay,#bct-demo-disclaimer{display:none!important}
body{background:#fff;padding:0}
.card{box-shadow:none;border:1px solid #ddd}
}
</style>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>

<div id="gate" style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:var(--font-body);background:var(--charcoal);color:#fff;text-align:center;padding:20px">
<div>
<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#C2922E" stroke-width="1.5"><path d="M14.5 3L3 14.5V21h6.5L21 9.5"/><path d="M14 4l6 6"/><line x1="7" y1="17" x2="3" y2="21"/></svg>
<h1 style="font-family:var(--font-head);font-size:1.6rem;margin:16px 0 8px">BladeBoard</h1>
<p style="color:rgba(255,255,255,0.6);margin-bottom:24px">Enter your access key</p>
<form id="gate-form" style="max-width:280px;margin:0 auto">
<input type="text" id="gate-key" placeholder="Access key" aria-label="Access key" style="width:100%;padding:12px;border:1.5px solid rgba(255,255,255,0.2);border-radius:8px;background:rgba(255,255,255,0.1);color:#fff;font-size:16px;text-align:center;margin-bottom:12px">
<button type="submit" style="width:100%;padding:12px;background:var(--brass);color:#fff;border:none;border-radius:8px;font-weight:700;font-size:15px;cursor:pointer;font-family:var(--font-head)">Open</button>
</form>
<p style="margin-top:24px;font-size:13px;color:rgba(255,255,255,0.4)"><a href="mailto:ben@bennycutools.com" style="color:rgba(255,255,255,0.5)">ben@bennycutools.com</a></p>
</div>
</div>

<div id="app">
<header class="app-header" role="banner">
<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 3L3 14.5V21h6.5L21 9.5"/><path d="M14 4l6 6"/></svg>
<h1>BladeBoard</h1>
<div class="header-stats" id="headerStats"></div>
</header>

<div id="demoBanner" class="demo-banner" role="status">
<span>Sample data for Vancouver, WA. Clear to add yours.</span>
<button onclick="clearDemo()" aria-label="Clear demo data">Clear</button>
</div>

<main id="main-content">
<!-- Tab: Board -->
<section id="tab-board" class="tab-content active" role="tabpanel" aria-label="Order board">
<div id="todaySummary" class="summary-strip"></div>
<div class="filter-row" id="filterRow"></div>
<div id="ordersList"></div>
<div id="boardEmpty" style="display:none;text-align:center;padding:40px 20px">
<svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="var(--border)" stroke-width="1"><path d="M14.5 3L3 14.5V21h6.5L21 9.5"/><path d="M14 4l6 6"/></svg>
<h2 style="margin-top:16px">No orders yet</h2>
<p style="color:var(--muted);margin:8px 0 24px;font-size:14px">Tap the + button to log your first knife order.</p>
</div>
</section>

<!-- Tab: History -->
<section id="tab-history" class="tab-content" role="tabpanel" aria-label="History">
<h2 style="margin-bottom:12px">Completed Orders</h2>
<div id="historyList"></div>
<div id="historyEmpty" style="text-align:center;padding:40px 20px;display:none">
<p style="color:var(--muted);font-size:14px">Picked-up orders will show here</p>
</div>
</section>

<!-- Tab: Stats -->
<section id="tab-stats" class="tab-content" role="tabpanel" aria-label="Stats">
<h2 style="margin-bottom:12px">This Week</h2>
<div id="weekStats" class="summary-strip" style="margin-bottom:16px"></div>
<h2 style="margin-bottom:12px">All Time</h2>
<div id="allStats" class="summary-strip"></div>
<div class="upsell-box" style="margin-top:24px">
<span class="upsell-tag">Full Version</span>
<h3 style="margin-bottom:8px">Monthly Trends</h3>
<p style="font-size:13px;color:var(--muted);margin-bottom:12px">See your busiest months, average order size, and repeat customer rate. Track revenue by week and spot patterns.</p>
<a href="mailto:ben@bennycutools.com?subject=BladeBoard%20Full%20Version" style="color:var(--brass-dark);font-weight:600;font-size:14px">Ask about the full version -- $200 one-time</a>
</div>
</section>
</main>

<button id="addFab" class="fab" onclick="showNewOrder()" aria-label="New order">
<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
</button>

<nav class="bottom-nav" role="navigation" aria-label="Main navigation">
<button class="active" onclick="switchTab('board')" data-tab="board" aria-label="Board">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
Board
</button>
<button onclick="switchTab('history')" data-tab="history" aria-label="History">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
History
</button>
<button onclick="switchTab('stats')" data-tab="stats" aria-label="Stats">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
Stats
</button>
</nav>

<!-- New Order Modal -->
<div id="orderModal" class="modal-overlay" role="dialog" aria-modal="true" aria-label="New order">
<div class="modal" style="position:relative">
<button class="modal-close" onclick="closeModal('orderModal')" aria-label="Close">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
</button>
<h2 id="orderModalTitle">New Order</h2>
<div class="form-group">
<label for="custName">Customer Name</label>
<input type="text" id="custName" placeholder="e.g. Johnson" list="custSuggestions">
<datalist id="custSuggestions"></datalist>
</div>
<div class="form-group">
<label for="custPhone">Phone</label>
<input type="tel" id="custPhone" placeholder="(503) 555-1234">
</div>
<div style="margin-bottom:14px">
<label style="display:block;font-size:12px;font-weight:600;color:var(--muted);margin-bottom:8px;text-transform:uppercase;letter-spacing:0.04em">Items</label>
<div class="item-counter"><label>Knives ($9)</label><button class="counter-btn" onclick="adj('knives',-1)" aria-label="Remove knife">-</button><span class="counter-val" id="cnt-knives">0</span><button class="counter-btn" onclick="adj('knives',1)" aria-label="Add knife">+</button></div>
<div class="item-counter"><label>Scissors ($9)</label><button class="counter-btn" onclick="adj('scissors',-1)" aria-label="Remove scissors">-</button><span class="counter-val" id="cnt-scissors">0</span><button class="counter-btn" onclick="adj('scissors',1)" aria-label="Add scissors">+</button></div>
<div class="item-counter"><label>Hatchets ($10)</label><button class="counter-btn" onclick="adj('hatchets',-1)" aria-label="Remove hatchet">-</button><span class="counter-val" id="cnt-hatchets">0</span><button class="counter-btn" onclick="adj('hatchets',1)" aria-label="Add hatchet">+</button></div>
<div class="item-counter"><label>Axes ($11)</label><button class="counter-btn" onclick="adj('axes',-1)" aria-label="Remove axe">-</button><span class="counter-val" id="cnt-axes">0</span><button class="counter-btn" onclick="adj('axes',1)" aria-label="Add axe">+</button></div>
<div class="item-counter"><label>Mauls ($15)</label><button class="counter-btn" onclick="adj('mauls',-1)" aria-label="Remove maul">-</button><span class="counter-val" id="cnt-mauls">0</span><button class="counter-btn" onclick="adj('mauls',1)" aria-label="Add maul">+</button></div>
<div class="item-counter"><label>Pruners ($9)</label><button class="counter-btn" onclick="adj('pruners',-1)" aria-label="Remove pruner">-</button><span class="counter-val" id="cnt-pruners">0</span><button class="counter-btn" onclick="adj('pruners',1)" aria-label="Add pruner">+</button></div>
</div>
<div style="background:var(--parchment);padding:12px;border-radius:var(--radius-sm);margin-bottom:14px;display:flex;justify-content:space-between;align-items:center">
<span style="font-size:13px;color:var(--muted)">Total</span>
<span style="font-size:1.3rem;font-weight:700;color:var(--brass-dark);font-family:var(--font-head)" id="orderTotal">$0</span>
</div>
<div class="form-group">
<label for="orderNotes">Notes</label>
<textarea id="orderNotes" placeholder="Special requests, blade types, etc." rows="2"></textarea>
</div>
<div id="orderPhotoArea" style="margin-bottom:14px">
<label style="display:block;font-size:12px;font-weight:600;color:var(--muted);margin-bottom:6px;text-transform:uppercase;letter-spacing:0.04em">Photo</label>
<div id="orderPhotoPreview" style="display:none;margin-bottom:8px"><img id="orderPhotoImg" style="width:100%;border-radius:var(--radius);max-height:160px;object-fit:cover" alt="Order photo"></div>
<button type="button" class="btn btn-outline btn-block btn-sm" onclick="takeOrderPhoto()">
<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
Snap Photo
</button>
<input type="file" id="orderFileInput" accept="image/*" capture="environment" style="display:none" onchange="handleOrderFile(event)">
</div>
<button class="btn btn-brass btn-block" style="margin-top:8px" onclick="saveOrder()">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
<span id="saveOrderBtn">Log Order</span>
</button>
</div>
</div>

<!-- Camera Modal -->
<div id="cameraModal" class="modal-overlay" role="dialog" aria-modal="true" aria-label="Camera">
<div class="modal" style="position:relative;padding:16px">
<button class="modal-close" onclick="stopCam()" aria-label="Close camera" style="z-index:10">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
</button>
<div class="camera-container">
<video id="camVid" autoplay playsinline></video>
<canvas id="camCan"></canvas>
<button class="camera-shutter" onclick="snapPhoto()" aria-label="Capture"></button>
</div>
</div>
</div>

<!-- Order Detail Modal -->
<div id="detailModal" class="modal-overlay" role="dialog" aria-modal="true" aria-label="Order details">
<div class="modal" style="position:relative">
<button class="modal-close" onclick="closeModal('detailModal')" aria-label="Close">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
</button>
<div id="detailContent"></div>
</div>
</div>

<div class="toast-container" aria-live="polite" id="toastBox"></div>
</div>

<!-- DEMO DISCLAIMER -->
<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer" style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:10px 16px;font-size:12px;line-height:1.4;color:#666;z-index:99999;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:8px 16px;text-align:center;">
<p style="margin:0;max-width:700px;"><strong style="color:#333;">DEMO NOTICE:</strong> This tool was created by BennyCuTools as a free demonstration only. It is not affiliated with, endorsed by, or authorized by Patron Saint of Knives. All brand references are used solely for demonstration purposes.</p>
<a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20Patron%20Saint%20of%20Knives&body=I%20am%20the%20owner%20and%20I%20request%20permanent%20deletion%20of%20this%20demo." style="display:inline-flex;align-items:center;gap:4px;background:#dc3545;color:#fff;padding:5px 12px;border-radius:4px;text-decoration:none;font-size:11px;font-weight:500;white-space:nowrap;">
<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
Request Permanent Deletion
</a>
</div>

<script>
function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
const _V=460473678;
(function(){
const k=new URLSearchParams(window.location.search).get('key');
if(k&&_h(k)===_V){auth();return;}
document.getElementById('gate').style.display='flex';
document.getElementById('app').style.display='none';
document.getElementById('gate-form').addEventListener('submit',function(e){
e.preventDefault();
const v=document.getElementById('gate-key').value.trim();
if(_h(v)===_V)auth();else{document.getElementById('gate-key').style.borderColor='#B83A3A';toast('Wrong key');}
});
})();
function auth(){document.getElementById('gate').style.display='none';document.getElementById('app').style.display='block';document.addEventListener('contextmenu',e=>e.preventDefault());initApp();}

let db;const DB='bladeboard_db';
function openDB(){return new Promise((res,rej)=>{const r=indexedDB.open(DB,1);r.onupgradeneeded=e=>{const d=e.target.result;if(!d.objectStoreNames.contains('orders'))d.createObjectStore('orders',{keyPath:'id'});};r.onsuccess=e=>{db=e.target.result;res();};r.onerror=rej;});}
function put(d){return new Promise((r,j)=>{const t=db.transaction('orders','readwrite');t.objectStore('orders').put(d);t.oncomplete=()=>r();t.onerror=j;});}
function getAll(){return new Promise((r,j)=>{const t=db.transaction('orders','readonly');const q=t.objectStore('orders').getAll();q.onsuccess=()=>r(q.result);q.onerror=j;});}
function del(id){return new Promise((r,j)=>{const t=db.transaction('orders','readwrite');t.objectStore('orders').delete(id);t.oncomplete=()=>r();t.onerror=j;});}

let orders=[];let currentFilter='all';let editId=null;let orderPhoto=null;let camStream=null;
const PRICES={knives:9,scissors:9,hatchets:10,axes:11,mauls:15,pruners:9};
const TYPES=['knives','scissors','hatchets','axes','mauls','pruners'];
const STATUSES=['received','progress','ready','notified','picked'];
const STATUS_LABELS={received:'Received',progress:'In Progress',ready:'Ready',notified:'Notified',picked:'Picked Up'};
let counts={knives:0,scissors:0,hatchets:0,axes:0,mauls:0,pruners:0};

async function initApp(){
await openDB();
if(!localStorage.getItem('bb_init')){await loadDemo();localStorage.setItem('bb_init','1');}
await refresh();
}

async function loadDemo(){
const now=Date.now();
const demos=[
{id:'d1',name:'Johnson',phone:'(503) 555-0142',items:{knives:8,scissors:1,hatchets:0,axes:0,mauls:0,pruners:0},total:81,notes:'Set of Wusthof classics. Handle with care.',status:'progress',photo:null,createdAt:new Date(now-7200000).toISOString(),isDemo:true},
{id:'d2',name:'Martinez Restaurant',phone:'(360) 555-0198',items:{knives:12,scissors:0,hatchets:0,axes:0,mauls:0,pruners:0},total:108,notes:'Chef knives for the kitchen line. Monthly regular.',status:'ready',photo:null,createdAt:new Date(now-14400000).toISOString(),isDemo:true},
{id:'d3',name:'Chen',phone:'(503) 555-0276',items:{knives:0,scissors:0,hatchets:1,axes:2,mauls:0,pruners:0},total:32,notes:'Camping gear. Small chips on one axe.',status:'received',photo:null,createdAt:new Date(now-3600000).toISOString(),isDemo:true},
{id:'d4',name:'Wilkins',phone:'(360) 555-0334',items:{knives:4,scissors:2,hatchets:0,axes:0,mauls:0,pruners:3},total:81,notes:'Kitchen set and garden tools.',status:'notified',photo:null,createdAt:new Date(now-28800000).toISOString(),isDemo:true},
{id:'d5',name:'PDX Butcher Co',phone:'(503) 555-0411',items:{knives:6,scissors:0,hatchets:0,axes:0,mauls:0,pruners:0},total:54,notes:'Butcher knives. Want the convex edge.',status:'picked',photo:null,createdAt:new Date(now-86400000).toISOString(),isDemo:true},
];
for(const d of demos)await put(d);
}

async function clearDemo(){
const all=await getAll();
for(const o of all){if(o.isDemo)await del(o.id);}
document.getElementById('demoBanner').style.display='none';
toast('Demo cleared');
await refresh();
}

async function refresh(){
orders=await getAll();
renderBoard();renderHistory();renderStats();
const hasDemo=orders.some(o=>o.isDemo);
document.getElementById('demoBanner').style.display=hasDemo?'flex':'none';
const active=orders.filter(o=>o.status!=='picked');
const today=orders.filter(o=>{const d=new Date(o.createdAt);const n=new Date();return d.toDateString()===n.toDateString();});
document.getElementById('headerStats').innerHTML=`<span><strong>${active.length}</strong> active</span>`;
}

function renderBoard(){
const active=orders.filter(o=>o.status!=='picked');
const filtered=currentFilter==='all'?active:active.filter(o=>o.status===currentFilter);
const el=document.getElementById('ordersList');
const empty=document.getElementById('boardEmpty');

// Summary
const received=active.filter(o=>o.status==='received').length;
const progress=active.filter(o=>o.status==='progress').length;
const ready=active.filter(o=>o.status==='ready'||o.status==='notified').length;
const totalBlades=active.reduce((s,o)=>s+countBlades(o),0);
document.getElementById('todaySummary').innerHTML=`
<div class="summary-item"><div class="val">${active.length}</div><div class="lbl">Orders</div></div>
<div class="summary-item"><div class="val">${totalBlades}</div><div class="lbl">Blades</div></div>
<div class="summary-item"><div class="val">$${active.reduce((s,o)=>s+o.total,0)}</div><div class="lbl">Value</div></div>
<div class="summary-item"><div class="val">${ready}</div><div class="lbl">Ready</div></div>`;

// Filters
const counts_f={all:active.length,received,progress,ready:active.filter(o=>o.status==='ready').length,notified:active.filter(o=>o.status==='notified').length};
document.getElementById('filterRow').innerHTML=['all','received','progress','ready','notified'].map(f=>`<button class="filter-pill${currentFilter===f?' active':''}" onclick="setFilter('${f}')">${f==='all'?'All':STATUS_LABELS[f]} (${counts_f[f]||0})</button>`).join('');

if(filtered.length===0){empty.style.display='block';el.innerHTML='';return;}
empty.style.display='none';
const sorted=[...filtered].sort((a,b)=>STATUSES.indexOf(a.status)-STATUSES.indexOf(b.status)||new Date(b.createdAt)-new Date(a.createdAt));
el.innerHTML='<div class="card">'+sorted.map(o=>{
const blades=countBlades(o);
const ago=timeAgo(new Date(o.createdAt));
const sc='status-'+o.status;
return `<div class="order-card" onclick="showDetail('${o.id}')">
<div class="order-photo">${o.photo?`<img src="${o.photo}" alt="${esc(o.name)} order">`:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14.5 3L3 14.5V21h6.5L21 9.5"/><path d="M14 4l6 6"/></svg>`}</div>
<div class="order-info">
<h3>${esc(o.name)}</h3>
<p>${blades} blade${blades!==1?'s':''} ${o.notes?'-- '+esc(o.notes.slice(0,40))+(o.notes.length>40?'...':''):''}</p>
<span class="status-badge ${sc}">${STATUS_LABELS[o.status]}</span>
</div>
<div class="order-right">
<div class="order-price">$${o.total}</div>
<div class="order-time">${ago}</div>
</div>
</div>`;}).join('')+'</div>';
}

function renderHistory(){
const picked=orders.filter(o=>o.status==='picked');
const el=document.getElementById('historyList');
const empty=document.getElementById('historyEmpty');
if(picked.length===0){empty.style.display='block';el.innerHTML='';return;}
empty.style.display='none';
const sorted=[...picked].sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));
el.innerHTML='<div class="card">'+sorted.map(o=>{
const blades=countBlades(o);
return `<div class="order-card" style="opacity:0.7" onclick="showDetail('${o.id}')">
<div class="order-info"><h3>${esc(o.name)}</h3><p>${blades} blades</p></div>
<div class="order-right"><div class="order-price">$${o.total}</div><div class="order-time">${timeAgo(new Date(o.createdAt))}</div></div>
</div>`;}).join('')+'</div>';
}

function renderStats(){
const now=new Date();const weekStart=new Date(now);weekStart.setDate(now.getDate()-now.getDay());weekStart.setHours(0,0,0,0);
const weekOrders=orders.filter(o=>new Date(o.createdAt)>=weekStart);
const weekBlades=weekOrders.reduce((s,o)=>s+countBlades(o),0);
const weekRev=weekOrders.reduce((s,o)=>s+o.total,0);
document.getElementById('weekStats').innerHTML=`
<div class="summary-item"><div class="val">${weekOrders.length}</div><div class="lbl">Orders</div></div>
<div class="summary-item"><div class="val">${weekBlades}</div><div class="lbl">Blades</div></div>
<div class="summary-item"><div class="val">$${weekRev}</div><div class="lbl">Revenue</div></div>`;
const allBlades=orders.reduce((s,o)=>s+countBlades(o),0);
const allRev=orders.reduce((s,o)=>s+o.total,0);
document.getElementById('allStats').innerHTML=`
<div class="summary-item"><div class="val">${orders.length}</div><div class="lbl">Orders</div></div>
<div class="summary-item"><div class="val">${allBlades}</div><div class="lbl">Blades</div></div>
<div class="summary-item"><div class="val">$${allRev}</div><div class="lbl">Revenue</div></div>`;
}

function countBlades(o){return TYPES.reduce((s,t)=>s+(o.items[t]||0),0);}

function setFilter(f){currentFilter=f;renderBoard();}

// New/Edit Order
function showNewOrder(){
editId=null;orderPhoto=null;
document.getElementById('orderModalTitle').textContent='New Order';
document.getElementById('saveOrderBtn').textContent='Log Order';
document.getElementById('custName').value='';
document.getElementById('custPhone').value='';
document.getElementById('orderNotes').value='';
document.getElementById('orderPhotoPreview').style.display='none';
TYPES.forEach(t=>{counts[t]=0;document.getElementById('cnt-'+t).textContent='0';});
updateTotal();
// Customer suggestions
const names=[...new Set(orders.map(o=>o.name))];
const dl=document.getElementById('custSuggestions');
dl.innerHTML=names.map(n=>`<option value="${esc(n)}">`).join('');
document.getElementById('orderModal').classList.add('show');
document.getElementById('custName').focus();
}

function adj(type,d){
counts[type]=Math.max(0,counts[type]+d);
document.getElementById('cnt-'+type).textContent=counts[type];
updateTotal();
}

function updateTotal(){
const total=TYPES.reduce((s,t)=>s+counts[t]*PRICES[t],0);
document.getElementById('orderTotal').textContent='$'+total;
}

async function saveOrder(){
const name=document.getElementById('custName').value.trim();
const phone=document.getElementById('custPhone').value.trim();
const notes=document.getElementById('orderNotes').value.trim();
if(!name){toast('Add the customer name');return;}
const total=TYPES.reduce((s,t)=>s+counts[t]*PRICES[t],0);
if(total===0){toast('Add at least one item');return;}

if(editId){
const o=orders.find(o=>o.id===editId);
if(o){o.name=name;o.phone=phone;o.items={...counts};o.total=total;o.notes=notes;if(orderPhoto)o.photo=orderPhoto;await put(o);}
}else{
const order={id:'o'+Date.now(),name,phone,items:{...counts},total,notes,photo:orderPhoto,status:'received',createdAt:new Date().toISOString(),isDemo:false};
await put(order);
}
closeModal('orderModal');
toast(editId?'Updated':'Order logged -- $'+total);
editId=null;orderPhoto=null;
await refresh();
}

function showDetail(id){
const o=orders.find(o=>o.id===id);if(!o)return;
const blades=countBlades(o);
const items=TYPES.filter(t=>o.items[t]>0).map(t=>`${o.items[t]} ${t}`).join(', ');
const si=STATUSES.indexOf(o.status);
const nextStatus=si<STATUSES.length-1?STATUSES[si+1]:null;

let html=`<h2>${esc(o.name)}</h2>`;
if(o.photo)html+=`<img src="${o.photo}" style="width:100%;border-radius:var(--radius);margin:12px 0;max-height:200px;object-fit:cover" alt="${esc(o.name)} order photo">`;
html+=`<p style="color:var(--muted);font-size:13px;margin-bottom:4px">${o.phone||'No phone'}</p>`;
html+=`<p style="margin-bottom:4px"><strong>${blades} blades:</strong> ${items}</p>`;
if(o.notes)html+=`<p style="font-size:13px;color:var(--muted);margin-bottom:8px">${esc(o.notes)}</p>`;
html+=`<div style="display:flex;justify-content:space-between;align-items:center;margin:12px 0">`;
html+=`<span class="status-badge status-${o.status}" style="font-size:12px">${STATUS_LABELS[o.status]}</span>`;
html+=`<span style="font-size:1.3rem;font-weight:700;color:var(--brass-dark);font-family:var(--font-head)">$${o.total}</span>`;
html+=`</div>`;
html+=`<div style="display:flex;flex-direction:column;gap:8px;margin-top:16px">`;
if(nextStatus){
html+=`<button class="btn btn-brass btn-block" onclick="advanceStatus('${o.id}')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Mark as ${STATUS_LABELS[nextStatus]}</button>`;
}
if(o.status==='ready'||o.status==='notified'){
html+=`<button class="btn btn-dark btn-block" onclick="notifyCustomer('${o.id}')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2L15 22l-4-9-9-4z"/></svg> Copy Pickup Text</button>`;
}
html+=`<button class="btn btn-outline btn-block" onclick="editOrder('${o.id}')">Edit Order</button>`;
html+=`<button class="btn btn-outline btn-block" style="color:var(--error)" onclick="deleteOrder('${o.id}')">Delete</button>`;
html+=`</div>`;
document.getElementById('detailContent').innerHTML=html;
document.getElementById('detailModal').classList.add('show');
}

async function advanceStatus(id){
const o=orders.find(o=>o.id===id);if(!o)return;
const si=STATUSES.indexOf(o.status);
if(si<STATUSES.length-1){o.status=STATUSES[si+1];await put(o);toast(STATUS_LABELS[o.status]);closeModal('detailModal');await refresh();}
}

function notifyCustomer(id){
const o=orders.find(o=>o.id===id);if(!o)return;
const blades=countBlades(o);
const text=`Hi ${o.name}, your ${blades} blade${blades!==1?'s':''} ${blades===1?'is':'are'} sharpened and ready for pickup at the locker. Total: $${o.total}. -- Patron Saint of Knives`;
if(navigator.share){
navigator.share({text}).catch(()=>copyText(text));
}else{copyText(text);}
}

function copyText(t){navigator.clipboard.writeText(t).then(()=>toast('Copied -- paste into your texts')).catch(()=>toast('Could not copy'));}

function editOrder(id){
const o=orders.find(o=>o.id===id);if(!o)return;
editId=id;
closeModal('detailModal');
document.getElementById('orderModalTitle').textContent='Edit Order';
document.getElementById('saveOrderBtn').textContent='Save Changes';
document.getElementById('custName').value=o.name;
document.getElementById('custPhone').value=o.phone||'';
document.getElementById('orderNotes').value=o.notes||'';
TYPES.forEach(t=>{counts[t]=o.items[t]||0;document.getElementById('cnt-'+t).textContent=counts[t];});
updateTotal();
if(o.photo){orderPhoto=o.photo;document.getElementById('orderPhotoImg').src=o.photo;document.getElementById('orderPhotoPreview').style.display='block';}
else{orderPhoto=null;document.getElementById('orderPhotoPreview').style.display='none';}
document.getElementById('orderModal').classList.add('show');
}

async function deleteOrder(id){
await del(id);toast('Deleted');closeModal('detailModal');await refresh();
}

// Camera
function takeOrderPhoto(){
if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){
navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}}).then(s=>{
camStream=s;document.getElementById('camVid').srcObject=s;document.getElementById('cameraModal').classList.add('show');
}).catch(()=>document.getElementById('orderFileInput').click());
}else{document.getElementById('orderFileInput').click();}
}

function snapPhoto(){
const v=document.getElementById('camVid');const c=document.getElementById('camCan');
c.width=v.videoWidth;c.height=v.videoHeight;c.getContext('2d').drawImage(v,0,0);
orderPhoto=c.toDataURL('image/jpeg',0.7);
document.getElementById('orderPhotoImg').src=orderPhoto;document.getElementById('orderPhotoPreview').style.display='block';
stopCam();toast('Photo taken');
}

function stopCam(){if(camStream){camStream.getTracks().forEach(t=>t.stop());camStream=null;}closeModal('cameraModal');}

function handleOrderFile(e){
const f=e.target.files[0];if(!f)return;
const r=new FileReader();r.onload=ev=>{orderPhoto=ev.target.result;document.getElementById('orderPhotoImg').src=orderPhoto;document.getElementById('orderPhotoPreview').style.display='block';toast('Photo added');};
r.readAsDataURL(f);e.target.value='';
}

// Tabs
function switchTab(t){
document.querySelectorAll('.tab-content').forEach(el=>el.classList.remove('active'));
document.getElementById('tab-'+t).classList.add('active');
document.querySelectorAll('.bottom-nav button').forEach(b=>b.classList.toggle('active',b.dataset.tab===t));
document.getElementById('addFab').style.display=t==='board'?'flex':'none';
}

function closeModal(id){document.getElementById(id).classList.remove('show');}
function toast(m){const c=document.getElementById('toastBox');const t=document.createElement('div');t.className='toast';t.textContent=m;c.appendChild(t);setTimeout(()=>{t.style.opacity='0';t.style.transition='opacity 0.3s';setTimeout(()=>t.remove(),300);},2500);}
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML;}
function timeAgo(d){const s=Math.floor((Date.now()-d)/1000);if(s<60)return 'just now';if(s<3600)return Math.floor(s/60)+'m ago';if(s<86400)return Math.floor(s/3600)+'h ago';return Math.floor(s/86400)+'d ago';}
</script>
</body>
</html>
