<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#1A3D2A">
<title>TurfQuote Pro â€” Memorial Green Turf Inc</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

:root{
  --green:oklch(0.42 0.1 155);
  --green-hex:#2D5A3D;
  --deep:oklch(0.32 0.08 155);
  --deep-hex:#1A3D2A;
  --brown:oklch(0.55 0.05 65);
  --brown-hex:#8B7355;
  --sand:oklch(0.85 0.02 70);
  --sand-hex:#D4C5B5;
  --orange:oklch(0.58 0.16 35);
  --orange-hex:#D4694A;
  --white:#FFFFFF;
  --off-white:#F8F6F3;
  --gray-50:#F9FAFB;
  --gray-100:#F3F4F6;
  --gray-200:#E5E7EB;
  --gray-300:#D1D5DB;
  --gray-400:#9CA3AF;
  --gray-500:#6B7280;
  --gray-600:#4B5563;
  --gray-700:#374151;
  --gray-800:#1F2937;
  --gray-900:#111827;
  --red:#DC2626;
  --red-light:#FEE2E2;
  --blue:#2563EB;
  --blue-light:#DBEAFE;
  --shadow-sm:0 1px 2px rgba(0,0,0,0.06);
  --shadow-md:0 4px 6px -1px rgba(0,0,0,0.08),0 2px 4px -2px rgba(0,0,0,0.06);
  --shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -4px rgba(0,0,0,0.06);
  --shadow-xl:0 20px 25px -5px rgba(0,0,0,0.1),0 8px 10px -6px rgba(0,0,0,0.06);
  --radius:12px;
  --radius-sm:8px;
  --radius-lg:16px;
}

html{font-size:16px;-webkit-text-size-adjust:100%}
body{
  font-family:'Inter',system-ui,-apple-system,sans-serif;
  background:var(--off-white);
  color:var(--gray-800);
  line-height:1.5;
  -webkit-font-smoothing:antialiased;
  padding-bottom:60px;
  overflow-x:hidden;
  min-height:100vh;
}

/* Focus styles */
*:focus-visible{
  outline:3px solid var(--orange-hex);
  outline-offset:2px;
  border-radius:4px;
}

button,input,select,textarea{font-family:inherit;font-size:inherit}
button{cursor:pointer;border:none;background:none}
a{color:inherit;text-decoration:none}
img{max-width:100%;display:block}

/* Animations */
@keyframes fadeUp{
  from{opacity:0;transform:translateY(16px)}
  to{opacity:1;transform:translateY(0)}
}
@keyframes fadeIn{
  from{opacity:0}
  to{opacity:1}
}
@keyframes slideUp{
  from{transform:translateY(100%)}
  to{transform:translateY(0)}
}
@keyframes scaleIn{
  from{opacity:0;transform:scale(0.95)}
  to{opacity:1;transform:scale(1)}
}
@keyframes pulseGlow{
  0%,100%{box-shadow:0 0 0 0 rgba(212,105,74,0.4)}
  50%{box-shadow:0 0 0 8px rgba(212,105,74,0)}
}

@media(prefers-reduced-motion:reduce){
  *,*::before,*::after{
    animation-duration:0.01ms!important;
    animation-iteration-count:1!important;
    transition-duration:0.01ms!important;
  }
}

.animate-in{animation:fadeUp 400ms ease-out both}
.animate-in:nth-child(1){animation-delay:0ms}
.animate-in:nth-child(2){animation-delay:60ms}
.animate-in:nth-child(3){animation-delay:120ms}
.animate-in:nth-child(4){animation-delay:180ms}
.animate-in:nth-child(5){animation-delay:240ms}
.animate-in:nth-child(6){animation-delay:300ms}

/* ============ AUTH GATE ============ */
#auth-gate{
  position:fixed;inset:0;z-index:9999;
  background:linear-gradient(145deg,var(--deep-hex) 0%,var(--green-hex) 50%,var(--deep-hex) 100%);
  display:flex;align-items:center;justify-content:center;
  padding:24px;
}
#auth-gate.hidden{display:none}
.auth-card{
  background:var(--white);
  border-radius:var(--radius-lg);
  padding:40px 32px;
  max-width:380px;width:100%;
  box-shadow:var(--shadow-xl);
  text-align:center;
  animation:scaleIn 500ms ease-out;
}
.auth-logo{
  width:64px;height:64px;margin:0 auto 24px;
  background:var(--green-hex);border-radius:var(--radius);
  display:flex;align-items:center;justify-content:center;
}
.auth-logo svg{width:36px;height:36px;color:var(--white)}
.auth-title{font-size:24px;font-weight:800;color:var(--deep-hex);margin-bottom:8px}
.auth-sub{font-size:14px;color:var(--gray-500);margin-bottom:32px}
.auth-input-wrap{position:relative;margin-bottom:16px}
.auth-input-wrap label{
  display:block;text-align:left;font-size:13px;font-weight:600;
  color:var(--gray-600);margin-bottom:6px;
}
.auth-input{
  width:100%;padding:14px 16px;
  border:2px solid var(--gray-200);border-radius:var(--radius-sm);
  font-size:16px;color:var(--gray-800);
  transition:border-color 200ms;
}
.auth-input:focus{border-color:var(--green-hex);outline:none}
.auth-input.error{border-color:var(--red)}
.auth-error{
  color:var(--red);font-size:13px;margin-top:8px;
  text-align:left;display:none;
}
.auth-error.show{display:block}
.auth-btn{
  width:100%;padding:14px;
  background:var(--green-hex);color:var(--white);
  font-size:16px;font-weight:700;
  border-radius:var(--radius-sm);
  transition:background 200ms,transform 100ms;
  margin-top:8px;
}
.auth-btn:hover{background:var(--deep-hex)}
.auth-btn:active{transform:scale(0.97)}

/* ============ APP SHELL ============ */
#app{display:none}
#app.active{display:flex;flex-direction:column;min-height:100vh}

/* Top Bar */
.topbar{
  position:sticky;top:0;z-index:100;
  background:var(--deep-hex);
  padding:16px 20px;
  display:flex;align-items:center;justify-content:space-between;
  box-shadow:0 2px 8px rgba(0,0,0,0.15);
}
.topbar-brand{display:flex;align-items:center;gap:10px}
.topbar-logo{
  width:36px;height:36px;
  background:rgba(255,255,255,0.15);border-radius:8px;
  display:flex;align-items:center;justify-content:center;
}
.topbar-logo svg{width:20px;height:20px;color:var(--white)}
.topbar-title{color:var(--white);font-size:16px;font-weight:700;letter-spacing:-0.3px}
.topbar-sub{color:rgba(255,255,255,0.6);font-size:11px;font-weight:500}
.topbar-action{
  width:40px;height:40px;border-radius:10px;
  background:rgba(255,255,255,0.1);
  display:flex;align-items:center;justify-content:center;
  transition:background 200ms;
}
.topbar-action:hover{background:rgba(255,255,255,0.2)}
.topbar-action svg{width:20px;height:20px;color:var(--white)}

/* Bottom Nav */
.bottom-nav{
  position:fixed;bottom:60px;left:0;right:0;z-index:100;
  background:var(--white);
  border-top:1px solid var(--gray-200);
  display:flex;
  padding:6px 0 env(safe-area-inset-bottom,8px);
  box-shadow:0 -2px 10px rgba(0,0,0,0.06);
}
.nav-item{
  flex:1;display:flex;flex-direction:column;align-items:center;
  padding:8px 4px;gap:4px;
  color:var(--gray-400);font-size:11px;font-weight:600;
  transition:color 200ms;position:relative;
}
.nav-item svg{width:22px;height:22px;transition:color 200ms}
.nav-item.active{color:var(--green-hex)}
.nav-item.active::before{
  content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);
  width:32px;height:3px;border-radius:0 0 3px 3px;background:var(--green-hex);
}
.nav-item:active{transform:scale(0.92);transition:transform 100ms}
.nav-badge{
  position:absolute;top:4px;right:50%;transform:translateX(calc(50% + 10px));
  background:var(--orange-hex);color:var(--white);
  font-size:10px;font-weight:700;
  width:18px;height:18px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  line-height:1;
}

/* Views */
.view{display:none;flex:1;padding:20px;padding-bottom:80px}
.view.active{display:block;animation:fadeIn 300ms ease-out}

/* Section titles */
.section-label{
  font-size:12px;font-weight:700;color:var(--gray-400);
  text-transform:uppercase;letter-spacing:0.8px;
  margin-bottom:12px;padding-left:4px;
}

/* ============ DASHBOARD ============ */
.dash-greeting{
  font-size:26px;font-weight:800;color:var(--deep-hex);
  margin-bottom:4px;letter-spacing:-0.5px;
}
.dash-date{font-size:14px;color:var(--gray-500);margin-bottom:24px}

.stat-row{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:24px}
.stat-card{
  background:var(--white);border-radius:var(--radius);padding:16px;
  box-shadow:var(--shadow-sm);border:1px solid var(--gray-100);
  transition:transform 200ms,box-shadow 200ms;
}
.stat-card:active{transform:scale(0.97)}
.stat-num{font-size:28px;font-weight:800;color:var(--deep-hex);line-height:1.1}
.stat-label{font-size:12px;color:var(--gray-500);font-weight:500;margin-top:4px}
.stat-card.highlight{background:var(--green-hex);border-color:var(--green-hex)}
.stat-card.highlight .stat-num{color:var(--white)}
.stat-card.highlight .stat-label{color:rgba(255,255,255,0.7)}

.action-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:28px}
.action-card{
  background:var(--white);border-radius:var(--radius);padding:20px 16px;
  box-shadow:var(--shadow-md);border:1px solid var(--gray-100);
  display:flex;flex-direction:column;align-items:center;gap:10px;
  text-align:center;
  transition:transform 200ms,box-shadow 200ms;
  cursor:pointer;
}
.action-card:hover{box-shadow:var(--shadow-lg);transform:translateY(-2px)}
.action-card:active{transform:scale(0.96)}
.action-icon{
  width:48px;height:48px;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
}
.action-icon svg{width:24px;height:24px}
.action-icon.green{background:rgba(45,90,61,0.1);color:var(--green-hex)}
.action-icon.orange{background:rgba(212,105,74,0.1);color:var(--orange-hex)}
.action-icon.brown{background:rgba(139,115,85,0.1);color:var(--brown-hex)}
.action-icon.blue{background:rgba(37,99,235,0.1);color:var(--blue)}
.action-title{font-size:14px;font-weight:700;color:var(--gray-800)}
.action-desc{font-size:12px;color:var(--gray-500);line-height:1.3}

/* Job cards */
.job-card{
  background:var(--white);border-radius:var(--radius);padding:16px;
  box-shadow:var(--shadow-sm);border:1px solid var(--gray-100);
  margin-bottom:10px;
  transition:transform 200ms,box-shadow 200ms;
  cursor:pointer;position:relative;overflow:hidden;
}
.job-card::before{
  content:'';position:absolute;left:0;top:0;bottom:0;width:4px;
}
.job-card.status-new::before{background:var(--blue)}
.job-card.status-quoted::before{background:var(--orange-hex)}
.job-card.status-accepted::before{background:var(--green-hex)}
.job-card.status-scheduled::before{background:#8B5CF6}
.job-card.status-complete::before{background:var(--gray-400)}
.job-card:hover{box-shadow:var(--shadow-md)}
.job-card:active{transform:scale(0.98)}

.job-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}
.job-name{font-size:15px;font-weight:700;color:var(--gray-800)}
.job-status{
  font-size:11px;font-weight:700;padding:4px 10px;border-radius:20px;
  text-transform:uppercase;letter-spacing:0.5px;white-space:nowrap;
}
.status-new{background:var(--blue-light);color:var(--blue)}
.status-quoted{background:#FFF7ED;color:#C2410C}
.status-accepted{background:#F0FDF4;color:#15803D}
.status-scheduled{background:#F5F3FF;color:#7C3AED}
.status-complete{background:var(--gray-100);color:var(--gray-500)}

.job-address{font-size:13px;color:var(--gray-500);display:flex;align-items:center;gap:6px;margin-bottom:6px}
.job-address svg{width:14px;height:14px;flex-shrink:0}
.job-meta{display:flex;gap:16px;font-size:13px;color:var(--gray-500)}
.job-meta-item{display:flex;align-items:center;gap:4px}
.job-meta-item svg{width:14px;height:14px}
.job-price{font-weight:700;color:var(--deep-hex)}

/* ============ QUOTE BUILDER ============ */
.quote-section{
  background:var(--white);border-radius:var(--radius);padding:20px;
  box-shadow:var(--shadow-sm);border:1px solid var(--gray-100);
  margin-bottom:16px;
}
.quote-section-title{
  font-size:15px;font-weight:700;color:var(--deep-hex);
  margin-bottom:16px;display:flex;align-items:center;gap:8px;
}
.quote-section-title svg{width:18px;height:18px;color:var(--green-hex)}

.form-group{margin-bottom:16px}
.form-label{
  display:block;font-size:13px;font-weight:600;color:var(--gray-600);
  margin-bottom:6px;
}
.form-input,.form-select,.form-textarea{
  width:100%;padding:12px 14px;
  border:2px solid var(--gray-200);border-radius:var(--radius-sm);
  font-size:16px;color:var(--gray-800);background:var(--white);
  transition:border-color 200ms;
  -webkit-appearance:none;
}
.form-input:focus,.form-select:focus,.form-textarea:focus{
  border-color:var(--green-hex);outline:none;
}
.form-select{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236B7280' stroke-width='2'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 12px center;
  padding-right:40px;
}
.form-textarea{min-height:80px;resize:vertical}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.form-hint{font-size:12px;color:var(--gray-400);margin-top:4px}

/* Number input with stepper */
.num-input-wrap{display:flex;align-items:center;gap:0}
.num-btn{
  width:44px;height:44px;
  background:var(--gray-100);border:2px solid var(--gray-200);
  display:flex;align-items:center;justify-content:center;
  font-size:20px;font-weight:700;color:var(--gray-600);
  transition:background 150ms;
}
.num-btn:first-child{border-radius:var(--radius-sm) 0 0 var(--radius-sm);border-right:none}
.num-btn:last-child{border-radius:0 var(--radius-sm) var(--radius-sm) 0;border-left:none}
.num-btn:active{background:var(--gray-200)}
.num-input-wrap .form-input{
  border-radius:0;text-align:center;width:100px;
  -moz-appearance:textfield;
}
.num-input-wrap .form-input::-webkit-outer-spin-button,
.num-input-wrap .form-input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}

/* Product picker */
.product-grid{display:flex;flex-direction:column;gap:10px}
.product-option{
  padding:14px;border:2px solid var(--gray-200);border-radius:var(--radius-sm);
  cursor:pointer;transition:border-color 200ms,background 200ms;
  display:flex;justify-content:space-between;align-items:center;
}
.product-option:hover{border-color:var(--gray-300)}
.product-option.selected{border-color:var(--green-hex);background:rgba(45,90,61,0.04)}
.product-name{font-size:14px;font-weight:600;color:var(--gray-800)}
.product-detail{font-size:12px;color:var(--gray-500);margin-top:2px}
.product-price{font-size:16px;font-weight:800;color:var(--green-hex)}
.product-price-unit{font-size:11px;font-weight:500;color:var(--gray-500)}

/* Photo capture */
.photo-area{
  border:2px dashed var(--gray-300);border-radius:var(--radius);
  padding:32px 20px;text-align:center;
  cursor:pointer;transition:border-color 200ms,background 200ms;
}
.photo-area:hover{border-color:var(--green-hex);background:rgba(45,90,61,0.02)}
.photo-area svg{width:40px;height:40px;color:var(--gray-400);margin:0 auto 12px}
.photo-area-title{font-size:14px;font-weight:600;color:var(--gray-600)}
.photo-area-hint{font-size:12px;color:var(--gray-400);margin-top:4px}
.photo-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:12px}
.photo-thumb{
  aspect-ratio:1;border-radius:var(--radius-sm);overflow:hidden;
  position:relative;background:var(--gray-100);
}
.photo-thumb img{width:100%;height:100%;object-fit:cover}
.photo-remove{
  position:absolute;top:4px;right:4px;
  width:24px;height:24px;border-radius:50%;
  background:rgba(0,0,0,0.6);color:var(--white);
  display:flex;align-items:center;justify-content:center;
}
.photo-remove svg{width:14px;height:14px}

/* Line items */
.line-items{margin-bottom:16px}
.line-item{
  display:flex;justify-content:space-between;align-items:center;
  padding:10px 0;border-bottom:1px solid var(--gray-100);
}
.line-item:last-child{border-bottom:none}
.line-item-name{font-size:14px;color:var(--gray-700)}
.line-item-val{font-size:14px;font-weight:700;color:var(--gray-800)}
.line-total{
  display:flex;justify-content:space-between;align-items:center;
  padding:14px 0;border-top:2px solid var(--gray-200);margin-top:8px;
}
.line-total-label{font-size:16px;font-weight:700;color:var(--deep-hex)}
.line-total-val{font-size:22px;font-weight:800;color:var(--deep-hex)}

/* Buttons */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:14px 24px;border-radius:var(--radius-sm);
  font-size:15px;font-weight:700;
  transition:background 200ms,transform 100ms,box-shadow 200ms;
  min-height:48px;
}
.btn:active{transform:scale(0.97)}
.btn-primary{background:var(--green-hex);color:var(--white);box-shadow:var(--shadow-sm)}
.btn-primary:hover{background:var(--deep-hex);box-shadow:var(--shadow-md)}
.btn-orange{background:var(--orange-hex);color:var(--white);box-shadow:var(--shadow-sm)}
.btn-orange:hover{background:#C05A3B;box-shadow:var(--shadow-md)}
.btn-outline{
  background:var(--white);color:var(--gray-700);
  border:2px solid var(--gray-200);
}
.btn-outline:hover{border-color:var(--gray-300);background:var(--gray-50)}
.btn-ghost{background:transparent;color:var(--gray-600);padding:10px 16px}
.btn-ghost:hover{background:var(--gray-100)}
.btn-full{width:100%}
.btn-disabled{opacity:0.5;pointer-events:none}
.btn svg{width:18px;height:18px}

.btn-group{display:flex;gap:10px;margin-top:16px}
.btn-group .btn{flex:1}

/* ============ PIPELINE ============ */
.pipeline-header{
  display:flex;justify-content:space-between;align-items:center;
  margin-bottom:20px;
}
.pipeline-title{font-size:22px;font-weight:800;color:var(--deep-hex)}

.pipeline-cols{
  display:flex;gap:12px;overflow-x:auto;
  padding-bottom:16px;
  -webkit-overflow-scrolling:touch;
  scroll-snap-type:x mandatory;
}
.pipeline-col{
  min-width:280px;width:280px;flex-shrink:0;
  scroll-snap-align:start;
}
.col-header{
  display:flex;align-items:center;justify-content:space-between;
  margin-bottom:12px;padding:0 4px;
}
.col-title{
  font-size:13px;font-weight:700;color:var(--gray-500);
  text-transform:uppercase;letter-spacing:0.5px;
  display:flex;align-items:center;gap:8px;
}
.col-count{
  width:22px;height:22px;border-radius:6px;
  background:var(--gray-100);color:var(--gray-500);
  font-size:12px;font-weight:700;
  display:flex;align-items:center;justify-content:center;
}
.col-dot{width:8px;height:8px;border-radius:50%}
.col-dot.blue{background:var(--blue)}
.col-dot.orange{background:var(--orange-hex)}
.col-dot.green{background:var(--green-hex)}
.col-dot.purple{background:#8B5CF6}
.col-dot.gray{background:var(--gray-400)}

.pipeline-card{
  background:var(--white);border-radius:var(--radius);padding:14px;
  box-shadow:var(--shadow-sm);border:1px solid var(--gray-100);
  margin-bottom:10px;cursor:pointer;
  transition:transform 200ms,box-shadow 200ms;
}
.pipeline-card:hover{box-shadow:var(--shadow-md);transform:translateY(-1px)}
.pipeline-card:active{transform:scale(0.98)}
.pipe-name{font-size:14px;font-weight:700;color:var(--gray-800);margin-bottom:4px}
.pipe-addr{font-size:12px;color:var(--gray-500);margin-bottom:8px;display:flex;align-items:center;gap:4px}
.pipe-addr svg{width:12px;height:12px;flex-shrink:0}
.pipe-footer{display:flex;justify-content:space-between;align-items:center}
.pipe-sqft{font-size:12px;color:var(--gray-500)}
.pipe-price{font-size:14px;font-weight:700;color:var(--deep-hex)}
.pipe-move{
  display:flex;gap:4px;margin-top:10px;padding-top:10px;
  border-top:1px solid var(--gray-100);
}
.pipe-move-btn{
  flex:1;padding:8px;border-radius:6px;
  font-size:11px;font-weight:600;
  background:var(--gray-50);color:var(--gray-500);
  transition:background 150ms,color 150ms;
  display:flex;align-items:center;justify-content:center;gap:4px;
}
.pipe-move-btn:hover{background:var(--green-hex);color:var(--white)}
.pipe-move-btn svg{width:14px;height:14px}

/* ============ CUSTOMERS ============ */
.customer-list{display:flex;flex-direction:column;gap:8px}
.customer-card{
  background:var(--white);border-radius:var(--radius);padding:16px;
  box-shadow:var(--shadow-sm);border:1px solid var(--gray-100);
  display:flex;align-items:center;gap:14px;cursor:pointer;
  transition:transform 200ms,box-shadow 200ms;
}
.customer-card:hover{box-shadow:var(--shadow-md)}
.customer-card:active{transform:scale(0.98)}
.customer-avatar{
  width:44px;height:44px;border-radius:50%;
  background:var(--green-hex);color:var(--white);
  display:flex;align-items:center;justify-content:center;
  font-size:16px;font-weight:700;flex-shrink:0;
}
.customer-info{flex:1;min-width:0}
.customer-name{font-size:15px;font-weight:700;color:var(--gray-800)}
.customer-detail{font-size:13px;color:var(--gray-500);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.customer-jobs{
  font-size:12px;font-weight:600;color:var(--gray-400);
  background:var(--gray-100);padding:4px 10px;border-radius:20px;
  white-space:nowrap;
}

/* ============ JOB DETAIL ============ */
.detail-back{
  display:flex;align-items:center;gap:6px;
  font-size:14px;font-weight:600;color:var(--gray-500);
  margin-bottom:16px;padding:8px 0;
}
.detail-back svg{width:18px;height:18px}
.detail-hero{
  background:var(--white);border-radius:var(--radius);padding:20px;
  box-shadow:var(--shadow-sm);border:1px solid var(--gray-100);
  margin-bottom:16px;
}
.detail-name{font-size:22px;font-weight:800;color:var(--deep-hex);margin-bottom:4px}
.detail-customer{font-size:14px;color:var(--gray-500);margin-bottom:12px}
.detail-info{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:16px}
.detail-tag{
  display:flex;align-items:center;gap:6px;
  font-size:13px;color:var(--gray-600);
  background:var(--gray-50);padding:6px 12px;border-radius:20px;
}
.detail-tag svg{width:14px;height:14px}
.detail-actions{display:flex;gap:8px;flex-wrap:wrap}

.detail-section{
  background:var(--white);border-radius:var(--radius);padding:20px;
  box-shadow:var(--shadow-sm);border:1px solid var(--gray-100);
  margin-bottom:16px;
}
.detail-section-title{
  font-size:15px;font-weight:700;color:var(--deep-hex);margin-bottom:14px;
  display:flex;align-items:center;gap:8px;
}
.detail-section-title svg{width:18px;height:18px;color:var(--green-hex)}

.detail-photos{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.detail-photo{
  aspect-ratio:4/3;border-radius:var(--radius-sm);
  overflow:hidden;background:var(--gray-100);
}
.detail-photo img{width:100%;height:100%;object-fit:cover}

/* ============ MODAL ============ */
.modal-overlay{
  position:fixed;inset:0;z-index:200;
  background:rgba(0,0,0,0.5);
  display:none;align-items:flex-end;justify-content:center;
  padding:0;
}
.modal-overlay.open{display:flex}
.modal-sheet{
  background:var(--white);
  border-radius:var(--radius-lg) var(--radius-lg) 0 0;
  width:100%;max-width:500px;max-height:90vh;
  overflow-y:auto;padding:24px;
  animation:slideUp 300ms ease-out;
}
.modal-handle{
  width:40px;height:4px;border-radius:2px;
  background:var(--gray-300);margin:0 auto 20px;
}
.modal-title{font-size:20px;font-weight:800;color:var(--deep-hex);margin-bottom:20px}

/* Upsell banner */
.upsell-banner{
  background:linear-gradient(135deg,var(--gray-50) 0%,var(--gray-100) 100%);
  border:2px dashed var(--gray-300);border-radius:var(--radius);
  padding:20px;text-align:center;margin-top:16px;
  opacity:0.7;
}
.upsell-title{font-size:14px;font-weight:700;color:var(--gray-500);margin-bottom:4px}
.upsell-desc{font-size:12px;color:var(--gray-400)}

/* Toast */
.toast{
  position:fixed;bottom:140px;left:50%;transform:translateX(-50%);
  background:var(--gray-800);color:var(--white);
  padding:12px 24px;border-radius:var(--radius-sm);
  font-size:14px;font-weight:600;
  box-shadow:var(--shadow-lg);z-index:300;
  display:none;
}
.toast.show{display:block;animation:fadeUp 300ms ease-out}

/* Camera view */
#camera-view{
  position:fixed;inset:0;z-index:250;
  background:#000;display:none;
  flex-direction:column;
}
#camera-view.open{display:flex}
#camera-video{flex:1;object-fit:cover;width:100%}
#camera-canvas{display:none}
.camera-controls{
  position:absolute;bottom:0;left:0;right:0;
  padding:24px;display:flex;justify-content:center;align-items:center;gap:24px;
  background:linear-gradient(transparent,rgba(0,0,0,0.7));
}
.camera-shutter{
  width:72px;height:72px;border-radius:50%;
  background:var(--white);
  border:4px solid rgba(255,255,255,0.5);
  transition:transform 100ms;
}
.camera-shutter:active{transform:scale(0.9)}
.camera-close{
  width:48px;height:48px;border-radius:50%;
  background:rgba(255,255,255,0.2);
  display:flex;align-items:center;justify-content:center;
}
.camera-close svg{width:24px;height:24px;color:var(--white)}

/* Legal disclaimer */
.legal-footer{
  position:fixed;bottom:0;left:0;right:0;z-index:999;
  background:var(--gray-900);color:rgba(255,255,255,0.6);
  font-size:11px;text-align:center;
  padding:10px 16px;line-height:1.4;
}
.legal-footer a{color:var(--orange-hex);text-decoration:underline}

/* Responsive - tablet+ */
@media(min-width:768px){
  .view{padding:24px 32px}
  .stat-row{grid-template-columns:repeat(4,1fr)}
  .action-grid{grid-template-columns:repeat(4,1fr)}
  .pipeline-col{min-width:260px;width:260px}
  .form-row{grid-template-columns:1fr 1fr}
  .photo-grid{grid-template-columns:repeat(4,1fr)}
  .detail-photos{grid-template-columns:repeat(3,1fr)}
}

@media(min-width:1024px){
  .topbar{padding:16px 32px}
  .view{max-width:1200px;margin:0 auto;padding:32px}
  .pipeline-cols{flex-wrap:nowrap}
  .pipeline-col{min-width:0;width:auto;flex:1}
  .bottom-nav{max-width:500px;left:50%;transform:translateX(-50%);border-radius:var(--radius-lg) var(--radius-lg) 0 0}
}

/* High contrast for outdoor use */
@media(prefers-contrast:more){
  .job-name,.pipe-name,.customer-name{color:#000}
  .form-input,.form-select{border-width:3px}
}

/* Skip Link */
.skip-link{
  position:absolute;
  top:-40px;
  left:0;
  background:var(--deep-hex);
  color:var(--white);
  padding:10px 16px;
  text-decoration:none;
  z-index:10000;
  border-radius:0 0 var(--radius-sm) 0;
  font-weight:600;
  font-size:0.875rem;
  transition:top 0.2s;
}
.skip-link:focus{
  top:0;
  outline:3px solid var(--orange-hex);
  outline-offset:2px;
}
</style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>

<!-- ============ AUTH GATE ============ -->
<div id="auth-gate">
  <div class="auth-card">
    <div class="auth-logo" aria-hidden="true">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    </div>
    <h1 class="auth-title">TurfQuote Pro</h1>
    <p class="auth-sub">Memorial Green Turf Inc</p>
    <form id="auth-form" autocomplete="off">
      <div class="auth-input-wrap">
        <label for="auth-key">Access Key</label>
        <input type="text" id="auth-key" class="auth-input" placeholder="Enter your key" aria-required="true" autocomplete="off">
        <p id="auth-error" class="auth-error" role="alert">Wrong key. Check your email for the right one.</p>
      </div>
      <button type="submit" class="auth-btn">Open Tool</button>
    </form>
  </div>
</div>

<!-- ============ MAIN APP ============ -->
<div id="app">

  <!-- Top Bar -->
  <header class="topbar" role="banner">
    <div class="topbar-brand">
      <div class="topbar-logo" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      </div>
      <div>
        <div class="topbar-title">TurfQuote Pro</div>
        <div class="topbar-sub">Memorial Green Turf</div>
      </div>
    </div>
    <button class="topbar-action" id="btn-new-quote-top" aria-label="Create new quote">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    </button>
  </header>

  <!-- ============ DASHBOARD VIEW ============ -->
  <main id="main-content" class="view active" role="main">
    <h2 class="dash-greeting animate-in">Good morning.</h2>
    <p class="dash-date animate-in" id="dash-date"></p>

    <div class="stat-row animate-in" id="dash-stats">
      <div class="stat-card highlight">
        <div class="stat-num" id="stat-pipeline">0</div>
        <div class="stat-label">Active Jobs</div>
      </div>
      <div class="stat-card">
        <div class="stat-num" id="stat-quoted">$0</div>
        <div class="stat-label">Quotes Out</div>
      </div>
      <div class="stat-card">
        <div class="stat-num" id="stat-accepted">$0</div>
        <div class="stat-label">Accepted</div>
      </div>
      <div class="stat-card">
        <div class="stat-num" id="stat-done">0</div>
        <div class="stat-label">Completed</div>
      </div>
    </div>

    <div class="action-grid animate-in">
      <div class="action-card" onclick="switchView('quote')" role="button" tabindex="0" aria-label="Start a new quote">
        <div class="action-icon orange">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
        </div>
        <div class="action-title">New Quote</div>
        <div class="action-desc">Measure, price, send</div>
      </div>
      <div class="action-card" onclick="openCamera()" role="button" tabindex="0" aria-label="Take site photos">
        <div class="action-icon green">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
        </div>
        <div class="action-title">Site Photos</div>
        <div class="action-desc">Snap the yard</div>
      </div>
      <div class="action-card" onclick="switchView('pipeline')" role="button" tabindex="0" aria-label="View job pipeline">
        <div class="action-icon brown">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="9" rx="1"/><rect x="14" y="3" width="7" height="5" rx="1"/><rect x="14" y="12" width="7" height="9" rx="1"/><rect x="3" y="16" width="7" height="5" rx="1"/></svg>
        </div>
        <div class="action-title">Pipeline</div>
        <div class="action-desc">Track every job</div>
      </div>
      <div class="action-card" onclick="switchView('customers')" role="button" tabindex="0" aria-label="View customers">
        <div class="action-icon blue">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
        </div>
        <div class="action-title">Customers</div>
        <div class="action-desc">Everyone you've quoted</div>
      </div>
    </div>

    <div class="section-label animate-in">Needs Follow-Up</div>
    <div id="dash-followup" class="animate-in"></div>

    <div class="section-label animate-in" style="margin-top:24px">Recent Jobs</div>
    <div id="dash-recent" class="animate-in"></div>
  </main>

  <!-- ============ QUOTE VIEW ============ -->
  <section class="view" id="view-quote" role="region" aria-label="Quote builder">
    <h2 style="font-size:22px;font-weight:800;color:var(--deep-hex);margin-bottom:4px" class="animate-in">Build a Quote</h2>
    <p style="font-size:14px;color:var(--gray-500);margin-bottom:20px" class="animate-in">Fill in the job details. Takes about two minutes.</p>

    <!-- Customer Info -->
    <div class="quote-section animate-in">
      <div class="quote-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        Customer Info
      </div>
      <div class="form-group">
        <label class="form-label" for="q-name">Customer Name</label>
        <input type="text" id="q-name" class="form-input" placeholder="e.g. Mike Johnson">
      </div>
      <div class="form-group">
        <label class="form-label" for="q-phone">Phone</label>
        <input type="tel" id="q-phone" class="form-input" placeholder="(713) 555-0123">
      </div>
      <div class="form-group">
        <label class="form-label" for="q-email">Email</label>
        <input type="email" id="q-email" class="form-input" placeholder="mike@email.com">
      </div>
      <div class="form-group">
        <label class="form-label" for="q-address">Job Site Address</label>
        <input type="text" id="q-address" class="form-input" placeholder="1234 Memorial Dr, Houston TX">
      </div>
      <div class="form-group">
        <label class="form-label" for="q-job-name">Job Name</label>
        <input type="text" id="q-job-name" class="form-input" placeholder="e.g. Backyard Turf Install">
      </div>
    </div>

    <!-- Measurements -->
    <div class="quote-section animate-in">
      <div class="quote-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 3H3v7h18V3z"/><path d="M21 14H3v7h18v-7z"/><path d="M12 3v7"/><path d="M12 14v7"/></svg>
        Measurements
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="q-length">Length (ft)</label>
          <input type="number" id="q-length" class="form-input" placeholder="0" min="0" step="0.5" inputmode="decimal">
        </div>
        <div class="form-group">
          <label class="form-label" for="q-width">Width (ft)</label>
          <input type="number" id="q-width" class="form-input" placeholder="0" min="0" step="0.5" inputmode="decimal">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Total Square Feet</label>
        <div style="font-size:28px;font-weight:800;color:var(--deep-hex)" id="q-sqft">0 sq ft</div>
        <p class="form-hint">Auto-calculated. Or type a custom number below.</p>
      </div>
      <div class="form-group">
        <label class="form-label" for="q-sqft-custom">Custom Sq Ft (if not rectangular)</label>
        <input type="number" id="q-sqft-custom" class="form-input" placeholder="Leave blank to use L x W" min="0" inputmode="numeric">
      </div>
    </div>

    <!-- Turf Selection -->
    <div class="quote-section animate-in">
      <div class="quote-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        Pick the Turf
      </div>
      <div class="product-grid" id="product-grid" role="radiogroup" aria-label="Turf product selection"></div>
    </div>

    <!-- Base Materials -->
    <div class="quote-section animate-in">
      <div class="quote-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="6" width="22" height="12" rx="2"/><path d="M1 10h22"/></svg>
        Base &amp; Extras
      </div>
      <div id="extras-list"></div>
    </div>

    <!-- Labor -->
    <div class="quote-section animate-in">
      <div class="quote-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg>
        Labor
      </div>
      <div class="form-group">
        <label class="form-label" for="q-labor-rate">Labor Rate (per sq ft)</label>
        <input type="number" id="q-labor-rate" class="form-input" value="3.50" min="0" step="0.25" inputmode="decimal">
        <p class="form-hint">Base prep + install. Adjust per job.</p>
      </div>
      <div class="form-group">
        <label class="form-label" for="q-edge-ft">Edge/Border Detail (linear ft)</label>
        <input type="number" id="q-edge-ft" class="form-input" placeholder="0" min="0" inputmode="numeric">
      </div>
    </div>

    <!-- Site Photos -->
    <div class="quote-section animate-in">
      <div class="quote-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
        Site Photos
      </div>
      <div class="photo-area" onclick="openCamera()" role="button" tabindex="0" aria-label="Take a photo of the job site">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
        <div class="photo-area-title">Tap to take a photo</div>
        <div class="photo-area-hint">Snap the yard, pool area, or whatever you're covering</div>
      </div>
      <div class="photo-grid" id="quote-photos"></div>
    </div>

    <!-- Notes -->
    <div class="quote-section animate-in">
      <div class="quote-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.12 2.12 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        Notes
      </div>
      <div class="form-group">
        <label class="form-label" for="q-notes">Anything the customer should know</label>
        <textarea id="q-notes" class="form-textarea" placeholder="Drainage details, access notes, special requests..."></textarea>
      </div>
    </div>

    <!-- Quote Summary -->
    <div class="quote-section animate-in" id="quote-summary" style="display:none">
      <div class="quote-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
        Quote Summary
      </div>
      <div class="line-items" id="summary-lines"></div>
      <div class="line-total">
        <span class="line-total-label">Total</span>
        <span class="line-total-val" id="summary-total">$0</span>
      </div>
    </div>

    <!-- Actions -->
    <div class="animate-in" style="margin-top:8px">
      <button class="btn btn-primary btn-full" id="btn-calc-quote" onclick="calculateQuote()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:18px;height:18px"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
        Calculate Quote
      </button>
    </div>
    <div id="quote-action-btns" style="display:none;margin-top:12px" class="animate-in">
      <div class="btn-group">
        <button class="btn btn-orange" onclick="generatePDF()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:18px;height:18px"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
          Save as PDF
        </button>
        <button class="btn btn-primary" onclick="saveQuoteAsJob()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:18px;height:18px"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
          Save Job
        </button>
      </div>
      <div class="upsell-banner" style="margin-top:16px">
        <div class="upsell-title">Send quote to customer by text or email</div>
        <div class="upsell-desc">Available in the full version</div>
      </div>
    </div>
  </section>

  <!-- ============ PIPELINE VIEW ============ -->
  <section class="view" id="view-pipeline" role="region" aria-label="Job pipeline">
    <div class="pipeline-header animate-in">
      <h2 class="pipeline-title">Pipeline</h2>
      <button class="btn btn-primary" onclick="switchView('quote')" style="padding:10px 16px;font-size:13px">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        New
      </button>
    </div>
    <div class="pipeline-cols" id="pipeline-cols"></div>
  </section>

  <!-- ============ CUSTOMERS VIEW ============ -->
  <section class="view" id="view-customers" role="region" aria-label="Customers">
    <h2 style="font-size:22px;font-weight:800;color:var(--deep-hex);margin-bottom:4px" class="animate-in">Customers</h2>
    <p style="font-size:14px;color:var(--gray-500);margin-bottom:20px" class="animate-in">Everyone you've quoted or worked with.</p>
    <div class="customer-list animate-in" id="customer-list"></div>
  </section>

  <!-- ============ JOB DETAIL VIEW ============ -->
  <section class="view" id="view-detail" role="region" aria-label="Job details">
    <div id="detail-content"></div>
  </section>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav" role="navigation" aria-label="Main navigation">
    <button class="nav-item active" data-view="dashboard" aria-label="Dashboard" aria-current="page">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      Home
    </button>
    <button class="nav-item" data-view="quote" aria-label="New quote">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
      Quote
    </button>
    <button class="nav-item" data-view="pipeline" aria-label="Pipeline">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="9" rx="1"/><rect x="14" y="3" width="7" height="5" rx="1"/><rect x="14" y="12" width="7" height="9" rx="1"/><rect x="3" y="16" width="7" height="5" rx="1"/></svg>
      Pipeline
      <span class="nav-badge" id="pipeline-badge" style="display:none">0</span>
    </button>
    <button class="nav-item" data-view="customers" aria-label="Customers">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
      Clients
    </button>
  </nav>
</div>

<!-- ============ CAMERA VIEW ============ -->
<div id="camera-view">
  <video id="camera-video" autoplay playsinline></video>
  <canvas id="camera-canvas"></canvas>
  <div class="camera-controls">
    <button class="camera-close" onclick="closeCamera()" aria-label="Close camera">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </button>
    <button class="camera-shutter" onclick="capturePhoto()" aria-label="Take photo"></button>
    <div style="width:48px"></div>
  </div>
</div>

<!-- ============ JOB DETAIL MODAL ============ -->
<div class="modal-overlay" id="modal-move" role="dialog" aria-modal="true" aria-label="Move job">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <h3 class="modal-title">Move Job</h3>
    <div id="modal-move-content"></div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast" role="status" aria-live="polite"></div>

<!-- Legal Disclaimer -->
<!-- Demo Disclaimer - Compact -->
<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer" style="position:fixed;bottom:0;left:0;right:0;background:var(--deep-hex,#1A3D2A);padding:8px 12px;font-size:11px;line-height:1.3;color:var(--sand-hex,#D4C5B5);z-index:99999;display:flex;align-items:center;justify-content:center;gap:12px;">
  <span style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:calc(100% - 100px);"><strong style="color:#fff;">DEMO:</strong> Not affiliated with Memorial Green Turf Inc</span>
  <a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20Memorial%20Green%20Turf%20Inc&body=I%20am%20the%20owner%20and%20I%20request%20permanent%20deletion%20of%20this%20demo." style="display:inline-flex;align-items:center;gap:4px;background:var(--orange-hex,#D4694A);color:#fff;padding:4px 10px;border-radius:4px;text-decoration:none;font-size:10px;font-weight:600;white-space:nowrap;flex-shrink:0;">Delete Demo</a>
</div>

<script>
// ============ CONSTANTS & CONFIG ============
const ACCESS_KEY = 'mgti2026';
const ACCESS_HASH = 1330852625;
const DB_NAME = 'turfquote_pro';
const DB_VERSION = 1;

// Products database
const PRODUCTS = [
  { id: 'premium', name: 'Premium Pro Turf', detail: '70oz face weight, 1.75" pile', price: 4.50 },
  { id: 'pet', name: 'Pet-Friendly Turf', detail: 'Antimicrobial, drainage built in', price: 3.75 },
  { id: 'putting', name: 'Putting Green Turf', detail: 'Short pile, tournament roll', price: 5.25 },
  { id: 'value', name: 'Landscape Value Turf', detail: '50oz face weight, budget pick', price: 2.95 },
  { id: 'playground', name: 'Playground Safe Turf', detail: 'ASTM certified, shock rated', price: 4.00 }
];

const EXTRAS = [
  { id: 'dg-base', name: 'Decomposed Granite Base', price: 0.85, checked: true },
  { id: 'weed', name: 'Weed Barrier Fabric', price: 0.30, checked: true },
  { id: 'infill', name: 'Sand Infill', price: 0.45, checked: false },
  { id: 'seam', name: 'Seam Tape & Adhesive', price: 0.25, checked: true },
  { id: 'drain', name: 'Drainage Layer', price: 0.55, checked: false }
];

const STATUSES = ['new', 'quoted', 'accepted', 'scheduled', 'complete'];
const STATUS_LABELS = { new: 'New Lead', quoted: 'Quote Sent', accepted: 'Accepted', scheduled: 'Scheduled', complete: 'Done' };
const STATUS_COLORS = { new: 'blue', quoted: 'orange', accepted: 'green', scheduled: 'purple', complete: 'gray' };

// Demo data
const DEMO_JOBS = [
  {
    id: 'demo-1',
    jobName: 'Martinez Backyard Turf',
    customerName: 'Carlos Martinez',
    phone: '(713) 555-2847',
    email: 'carlos.m@gmail.com',
    address: '14502 Memorial Dr, Houston TX 77079',
    sqft: 1200,
    length: 40, width: 30,
    product: 'premium',
    extras: ['dg-base', 'weed', 'seam'],
    laborRate: 3.50,
    edgeFt: 140,
    notes: 'Big backyard, needs old sod removed first. Two dogs, so drainage matters.',
    status: 'complete',
    total: 11130,
    photos: [],
    createdAt: '2025-11-15T10:00:00Z',
    updatedAt: '2025-12-20T14:00:00Z'
  },
  {
    id: 'demo-2',
    jobName: 'Thompson Pet Turf',
    customerName: 'Rachel Thompson',
    phone: '(713) 555-9134',
    email: 'rthompson@outlook.com',
    address: '866 Bunker Hill Rd, Houston TX 77024',
    sqft: 850,
    length: 34, width: 25,
    product: 'pet',
    extras: ['dg-base', 'weed', 'infill', 'seam'],
    laborRate: 3.50,
    edgeFt: 118,
    notes: 'Three goldendoodles. Wants pet-friendly turf with extra drainage. Side yard gets muddy.',
    status: 'scheduled',
    total: 7434,
    photos: [],
    createdAt: '2026-01-22T09:00:00Z',
    updatedAt: '2026-02-05T11:00:00Z'
  },
  {
    id: 'demo-3',
    jobName: 'Nguyen Pool Surround',
    customerName: 'David Nguyen',
    phone: '(832) 555-6710',
    email: 'dnguyen@gmail.com',
    address: '12435 Kingsride Ln, Houston TX 77024',
    sqft: 480,
    length: 24, width: 20,
    product: 'premium',
    extras: ['dg-base', 'weed', 'drain', 'seam'],
    laborRate: 4.00,
    edgeFt: 88,
    notes: 'Pool deck area. Needs seamless transition from concrete to turf. Customer particular about edges.',
    status: 'quoted',
    total: 4876,
    photos: [],
    createdAt: '2026-02-03T14:00:00Z',
    updatedAt: '2026-02-03T15:30:00Z'
  },
  {
    id: 'demo-4',
    jobName: 'Williams Front Yard',
    customerName: 'Terrence Williams',
    phone: '(713) 555-0412',
    email: 'twilliams22@yahoo.com',
    address: '1103 Gessner Dr, Houston TX 77055',
    sqft: 2100,
    length: 70, width: 30,
    product: 'value',
    extras: ['dg-base', 'weed', 'seam'],
    laborRate: 3.25,
    edgeFt: 200,
    notes: 'Full front yard replacement. HOA approved artificial turf. Wants it done before spring.',
    status: 'new',
    total: 0,
    photos: [],
    createdAt: '2026-02-09T16:00:00Z',
    updatedAt: '2026-02-09T16:00:00Z'
  },
  {
    id: 'demo-5',
    jobName: 'Jackson Patio',
    customerName: 'Angela Jackson',
    phone: '(281) 555-8823',
    email: 'ajackson@gmail.com',
    address: '515 Dairy Ashford Rd, Houston TX 77079',
    sqft: 350,
    length: 17.5, width: 20,
    product: 'playground',
    extras: ['dg-base', 'weed', 'infill', 'seam'],
    laborRate: 3.75,
    edgeFt: 75,
    notes: 'Small kids play area on patio. Needs shock-absorbing turf. Wants bright green look.',
    status: 'accepted',
    total: 3368,
    photos: [],
    createdAt: '2026-01-28T11:00:00Z',
    updatedAt: '2026-02-07T09:00:00Z'
  }
];

// ============ STATE ============
let db = null;
let currentView = 'dashboard';
let quotePhotos = []; // base64 strings
let cameraStream = null;
let selectedProduct = null;

// ============ UTILITY ============
function hashKey(s) {
  let h = 0;
  for (let i = 0; i < s.length; i++) {
    h = ((h << 5) - h) + s.charCodeAt(i);
    h |= 0;
  }
  return h;
}

function formatMoney(n) {
  return '$' + Number(n).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
}

function formatDate(d) {
  const dt = new Date(d);
  return dt.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast show';
  setTimeout(() => { t.className = 'toast'; }, 2500);
}

function generateId() {
  return 'job-' + Date.now() + '-' + Math.random().toString(36).substr(2, 6);
}

// ============ AUTH ============
function checkAuth() {
  const params = new URLSearchParams(window.location.search);
  const urlKey = params.get('key');
  if (urlKey && hashKey(urlKey) === ACCESS_HASH) {
    grantAccess();
    return;
  }
  if (localStorage.getItem('tqp_auth') === '1') {
    grantAccess();
    return;
  }
  document.getElementById('auth-gate').classList.remove('hidden');
}

function grantAccess() {
  localStorage.setItem('tqp_auth', '1');
  document.getElementById('auth-gate').classList.add('hidden');
  document.getElementById('app').classList.add('active');
  initApp().catch(e => {console.error('initApp failed:', e); const t=document.createElement('div');t.style.cssText='position:fixed;top:80px;left:50%;transform:translateX(-50%);background:#b91c1c;color:#fff;padding:12px 20px;border-radius:8px;z-index:9999';t.textContent='Error loading data. Please refresh.';document.body.appendChild(t);setTimeout(()=>t.remove(),3000);});
}

document.getElementById('auth-form').addEventListener('submit', function(e) {
  e.preventDefault();
  const inp = document.getElementById('auth-key');
  const err = document.getElementById('auth-error');
  if (hashKey(inp.value.trim()) === ACCESS_HASH) {
    grantAccess();
  } else {
    inp.classList.add('error');
    err.classList.add('show');
    inp.focus();
  }
});

// ============ INDEXEDDB ============
function openDB() {
  return new Promise((resolve, reject) => {
    const req = indexedDB.open(DB_NAME, DB_VERSION);
    req.onupgradeneeded = (e) => {
      const d = e.target.result;
      if (!d.objectStoreNames.contains('jobs')) {
        const store = d.createObjectStore('jobs', { keyPath: 'id' });
        store.createIndex('status', 'status', { unique: false });
        store.createIndex('customerName', 'customerName', { unique: false });
      }
    };
    req.onsuccess = (e) => { db = e.target.result; resolve(db); };
    req.onerror = (e) => reject(e);
  });
}

function dbGetAll() {
  return new Promise((resolve, reject) => {
    const tx = db.transaction('jobs', 'readonly');
    const store = tx.objectStore('jobs');
    const req = store.getAll();
    req.onsuccess = () => resolve(req.result);
    req.onerror = () => reject(req.error);
  });
}

function dbPut(job) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction('jobs', 'readwrite');
    const store = tx.objectStore('jobs');
    const req = store.put(job);
    req.onsuccess = () => resolve();
    req.onerror = () => reject(req.error);
  });
}

function dbDelete(id) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction('jobs', 'readwrite');
    const store = tx.objectStore('jobs');
    const req = store.delete(id);
    req.onsuccess = () => resolve();
    req.onerror = () => reject(req.error);
  });
}

async function loadDemoData() {
  const existing = await dbGetAll();
  if (existing.length === 0) {
    for (const job of DEMO_JOBS) {
      await dbPut(job);
    }
  }
}

// ============ APP INIT ============
async function initApp() {
  await openDB();
  await loadDemoData();
  updateGreeting();
  renderProducts();
  renderExtras();
  refreshAll();
}

function updateGreeting() {
  const now = new Date();
  const h = now.getHours();
  let greeting = 'Good morning.';
  if (h >= 12 && h < 17) greeting = 'Good afternoon.';
  if (h >= 17) greeting = 'Good evening.';
  document.querySelector('.dash-greeting').textContent = greeting;

  const opts = { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' };
  document.getElementById('dash-date').textContent = now.toLocaleDateString('en-US', opts);
}

async function refreshAll() {
  const jobs = await dbGetAll();
  renderDashboard(jobs);
  renderPipeline(jobs);
  renderCustomers(jobs);
  updateBadges(jobs);
}

// ============ NAVIGATION ============
function switchView(name) {
  currentView = name;
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById('view-' + name).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => {
    n.classList.toggle('active', n.dataset.view === name);
    n.setAttribute('aria-current', n.dataset.view === name ? 'page' : 'false');
  });
  window.scrollTo(0, 0);
}

document.querySelectorAll('.nav-item').forEach(n => {
  n.addEventListener('click', () => switchView(n.dataset.view));
});

document.getElementById('btn-new-quote-top').addEventListener('click', () => switchView('quote'));

// ============ DASHBOARD ============
function renderDashboard(jobs) {
  // Stats
  const active = jobs.filter(j => j.status !== 'complete');
  const quoted = jobs.filter(j => j.status === 'quoted');
  const accepted = jobs.filter(j => ['accepted', 'scheduled'].includes(j.status));
  const done = jobs.filter(j => j.status === 'complete');

  document.getElementById('stat-pipeline').textContent = active.length;
  document.getElementById('stat-quoted').textContent = formatMoney(quoted.reduce((s, j) => s + (j.total || 0), 0));
  document.getElementById('stat-accepted').textContent = formatMoney(accepted.reduce((s, j) => s + (j.total || 0), 0));
  document.getElementById('stat-done').textContent = done.length;

  // Follow-up (new leads without quotes)
  const followup = jobs.filter(j => j.status === 'new').sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
  const fDiv = document.getElementById('dash-followup');
  if (followup.length === 0) {
    fDiv.innerHTML = '<p style="color:var(--gray-400);font-size:14px;padding:16px 0">No leads waiting. Nice.</p>';
  } else {
    fDiv.innerHTML = followup.map(j => jobCardHTML(j)).join('');
  }

  // Recent
  const recent = jobs.filter(j => j.status !== 'new').sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt)).slice(0, 4);
  const rDiv = document.getElementById('dash-recent');
  if (recent.length === 0) {
    rDiv.innerHTML = '<p style="color:var(--gray-400);font-size:14px;padding:16px 0">No jobs yet. Start with a quote.</p>';
  } else {
    rDiv.innerHTML = recent.map(j => jobCardHTML(j)).join('');
  }
}

function jobCardHTML(job) {
  const product = PRODUCTS.find(p => p.id === job.product);
  return `
    <article class="job-card status-${job.status}" onclick="showJobDetail('${job.id}')" tabindex="0" role="button" aria-label="View ${job.jobName}">
      <div class="job-header">
        <span class="job-name">${esc(job.jobName)}</span>
        <span class="job-status status-${job.status}">${STATUS_LABELS[job.status]}</span>
      </div>
      <div class="job-address">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>
        ${esc(job.address)}
      </div>
      <div class="job-meta">
        <span class="job-meta-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/></svg>
          ${job.sqft.toLocaleString()} sq ft
        </span>
        ${product ? `<span class="job-meta-item">${esc(product.name)}</span>` : ''}
        ${job.total ? `<span class="job-meta-item job-price">${formatMoney(job.total)}</span>` : ''}
      </div>
    </article>`;
}

function esc(s) {
  const d = document.createElement('div');
  d.textContent = s || '';
  return d.innerHTML;
}

function updateBadges(jobs) {
  const active = jobs.filter(j => j.status !== 'complete').length;
  const badge = document.getElementById('pipeline-badge');
  if (active > 0) {
    badge.textContent = active;
    badge.style.display = 'flex';
  } else {
    badge.style.display = 'none';
  }
}

// ============ PIPELINE ============
function renderPipeline(jobs) {
  const cols = document.getElementById('pipeline-cols');
  cols.innerHTML = STATUSES.map(status => {
    const sJobs = jobs.filter(j => j.status === status).sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
    return `
      <div class="pipeline-col">
        <div class="col-header">
          <span class="col-title">
            <span class="col-dot ${STATUS_COLORS[status]}"></span>
            ${STATUS_LABELS[status]}
          </span>
          <span class="col-count">${sJobs.length}</span>
        </div>
        ${sJobs.map(j => pipelineCardHTML(j)).join('')}
        ${sJobs.length === 0 ? '<p style="color:var(--gray-300);font-size:13px;text-align:center;padding:24px 0">Empty</p>' : ''}
      </div>`;
  }).join('');
}

function pipelineCardHTML(job) {
  const si = STATUSES.indexOf(job.status);
  const canBack = si > 0;
  const canForward = si < STATUSES.length - 1;
  return `
    <div class="pipeline-card" tabindex="0" role="button" aria-label="${esc(job.jobName)} - ${STATUS_LABELS[job.status]}">
      <div class="pipe-name">${esc(job.jobName)}</div>
      <div class="pipe-addr">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>
        ${esc(job.address.split(',')[0])}
      </div>
      <div class="pipe-footer">
        <span class="pipe-sqft">${job.sqft.toLocaleString()} sq ft</span>
        ${job.total ? `<span class="pipe-price">${formatMoney(job.total)}</span>` : '<span class="pipe-price" style="color:var(--gray-400)">No quote yet</span>'}
      </div>
      <div class="pipe-move">
        ${canBack ? `<button class="pipe-move-btn" onclick="event.stopPropagation();moveJob('${job.id}','${STATUSES[si-1]}')" aria-label="Move ${esc(job.jobName)} back to ${STATUS_LABELS[STATUSES[si-1]]}">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
          ${STATUS_LABELS[STATUSES[si-1]]}
        </button>` : ''}
        ${canForward ? `<button class="pipe-move-btn" onclick="event.stopPropagation();moveJob('${job.id}','${STATUSES[si+1]}')" aria-label="Move ${esc(job.jobName)} to ${STATUS_LABELS[STATUSES[si+1]]}">
          ${STATUS_LABELS[STATUSES[si+1]]}
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
        </button>` : ''}
        <button class="pipe-move-btn" onclick="event.stopPropagation();showJobDetail('${job.id}')" aria-label="View details for ${esc(job.jobName)}">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
          Details
        </button>
      </div>
    </div>`;
}

async function moveJob(id, newStatus) {
  const jobs = await dbGetAll();
  const job = jobs.find(j => j.id === id);
  if (!job) return;
  job.status = newStatus;
  job.updatedAt = new Date().toISOString();
  await dbPut(job);
  showToast('Moved to ' + STATUS_LABELS[newStatus]);
  refreshAll();
}

// ============ CUSTOMERS ============
function renderCustomers(jobs) {
  const custMap = {};
  jobs.forEach(j => {
    if (!custMap[j.customerName]) {
      custMap[j.customerName] = { name: j.customerName, phone: j.phone, email: j.email, jobs: [] };
    }
    custMap[j.customerName].jobs.push(j);
  });
  const custs = Object.values(custMap).sort((a, b) => a.name.localeCompare(b.name));
  const list = document.getElementById('customer-list');
  if (custs.length === 0) {
    list.innerHTML = '<p style="color:var(--gray-400);font-size:14px;padding:24px 0;text-align:center">No customers yet. Build your first quote to get started.</p>';
    return;
  }
  list.innerHTML = custs.map(c => {
    const initials = c.name.split(' ').map(w => w[0]).join('').toUpperCase().substring(0, 2);
    const totalVal = c.jobs.reduce((s, j) => s + (j.total || 0), 0);
    return `
      <div class="customer-card" onclick="showJobDetail('${c.jobs[0].id}')" tabindex="0" role="button" aria-label="View ${esc(c.name)}'s jobs">
        <div class="customer-avatar">${initials}</div>
        <div class="customer-info">
          <div class="customer-name">${esc(c.name)}</div>
          <div class="customer-detail">${esc(c.phone)} ${totalVal ? ' &middot; ' + formatMoney(totalVal) + ' total' : ''}</div>
        </div>
        <span class="customer-jobs">${c.jobs.length} job${c.jobs.length !== 1 ? 's' : ''}</span>
      </div>`;
  }).join('');
}

// ============ JOB DETAIL ============
async function showJobDetail(id) {
  const jobs = await dbGetAll();
  const job = jobs.find(j => j.id === id);
  if (!job) return;

  const product = PRODUCTS.find(p => p.id === job.product);
  const extraNames = (job.extras || []).map(eid => {
    const e = EXTRAS.find(x => x.id === eid);
    return e ? e.name : eid;
  });

  const content = document.getElementById('detail-content');
  content.innerHTML = `
    <button class="detail-back" onclick="switchView('${currentView === 'detail' ? 'dashboard' : currentView}')" aria-label="Go back">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
      Back
    </button>

    <div class="detail-hero animate-in">
      <h2 class="detail-name">${esc(job.jobName)}</h2>
      <p class="detail-customer">${esc(job.customerName)} &middot; ${esc(job.phone)}</p>
      <div class="detail-info">
        <span class="detail-tag">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>
          ${esc(job.address)}
        </span>
        <span class="detail-tag">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/></svg>
          ${job.sqft.toLocaleString()} sq ft
        </span>
        <span class="detail-tag job-status status-${job.status}">${STATUS_LABELS[job.status]}</span>
      </div>
      <div class="detail-actions">
        ${job.status !== 'complete' ? `
          <button class="btn btn-primary" onclick="openMoveModal('${job.id}')" style="padding:10px 16px;font-size:13px">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px"><polyline points="9 18 15 12 9 6"/></svg>
            Move Stage
          </button>` : ''}
        <button class="btn btn-outline" onclick="deleteJob('${job.id}')" style="padding:10px 16px;font-size:13px">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
          Delete
        </button>
      </div>
    </div>

    <div class="detail-section animate-in">
      <div class="detail-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
        Quote Breakdown
      </div>
      ${product ? `
        <div class="line-item">
          <span class="line-item-name">${esc(product.name)} (${job.sqft.toLocaleString()} sq ft x $${product.price.toFixed(2)})</span>
          <span class="line-item-val">${formatMoney(job.sqft * product.price)}</span>
        </div>` : ''}
      ${extraNames.map((name, i) => {
        const extra = EXTRAS.find(x => x.name === name) || EXTRAS[i];
        const cost = extra ? job.sqft * extra.price : 0;
        return `<div class="line-item"><span class="line-item-name">${esc(name)}</span><span class="line-item-val">${formatMoney(cost)}</span></div>`;
      }).join('')}
      ${job.laborRate ? `
        <div class="line-item">
          <span class="line-item-name">Labor (${job.sqft.toLocaleString()} sq ft x $${Number(job.laborRate).toFixed(2)})</span>
          <span class="line-item-val">${formatMoney(job.sqft * job.laborRate)}</span>
        </div>` : ''}
      ${job.edgeFt ? `
        <div class="line-item">
          <span class="line-item-name">Edge Detail (${job.edgeFt} linear ft x $0.50)</span>
          <span class="line-item-val">${formatMoney(job.edgeFt * 0.50)}</span>
        </div>` : ''}
      <div class="line-total">
        <span class="line-total-label">Total</span>
        <span class="line-total-val">${job.total ? formatMoney(job.total) : 'Not quoted'}</span>
      </div>
    </div>

    ${job.notes ? `
    <div class="detail-section animate-in">
      <div class="detail-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.12 2.12 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        Notes
      </div>
      <p style="font-size:14px;color:var(--gray-600);line-height:1.6">${esc(job.notes)}</p>
    </div>` : ''}

    ${job.photos && job.photos.length > 0 ? `
    <div class="detail-section animate-in">
      <div class="detail-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
        Site Photos
      </div>
      <div class="detail-photos">
        ${job.photos.map(p => `<div class="detail-photo"><img src="${p}" alt="Job site photo"></div>`).join('')}
      </div>
    </div>` : ''}

    <div class="detail-section animate-in">
      <div class="detail-section-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        Timeline
      </div>
      <div class="line-item">
        <span class="line-item-name">Created</span>
        <span class="line-item-val">${formatDate(job.createdAt)}</span>
      </div>
      <div class="line-item">
        <span class="line-item-name">Last Updated</span>
        <span class="line-item-val">${formatDate(job.updatedAt)}</span>
      </div>
    </div>

    <div class="animate-in" style="margin-top:12px">
      <button class="btn btn-orange btn-full" onclick="regeneratePDFForJob('${job.id}')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:18px;height:18px"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        Download PDF Quote
      </button>
      <div class="upsell-banner" style="margin-top:12px">
        <div class="upsell-title">Text or email this quote to the customer</div>
        <div class="upsell-desc">Available in the full version</div>
      </div>
    </div>`;

  switchView('detail');
}

function openMoveModal(jobId) {
  const modal = document.getElementById('modal-move');
  const content = document.getElementById('modal-move-content');
  content.innerHTML = STATUSES.map(s => `
    <button class="btn btn-outline btn-full" style="margin-bottom:8px" onclick="moveJob('${jobId}','${s}');closeMoveModal()">
      <span class="col-dot ${STATUS_COLORS[s]}" style="display:inline-block"></span>
      ${STATUS_LABELS[s]}
    </button>`).join('');
  modal.classList.add('open');
}

function closeMoveModal() {
  document.getElementById('modal-move').classList.remove('open');
}

document.getElementById('modal-move').addEventListener('click', function(e) {
  if (e.target === this) closeMoveModal();
});

async function deleteJob(id) {
  if (!confirm('Delete this job? This can\'t be undone.')) return;
  await dbDelete(id);
  showToast('Job deleted');
  switchView('dashboard');
  refreshAll();
}

// ============ QUOTE BUILDER ============
function renderProducts() {
  const grid = document.getElementById('product-grid');
  grid.innerHTML = PRODUCTS.map(p => `
    <div class="product-option" data-id="${p.id}" onclick="selectProduct('${p.id}')" role="radio" tabindex="0" aria-checked="false" aria-label="${p.name} at $${p.price.toFixed(2)} per square foot">
      <div>
        <div class="product-name">${p.name}</div>
        <div class="product-detail">${p.detail}</div>
      </div>
      <div style="text-align:right">
        <div class="product-price">$${p.price.toFixed(2)}</div>
        <div class="product-price-unit">per sq ft</div>
      </div>
    </div>`).join('');
}

function selectProduct(id) {
  selectedProduct = id;
  document.querySelectorAll('.product-option').forEach(el => {
    const sel = el.dataset.id === id;
    el.classList.toggle('selected', sel);
    el.setAttribute('aria-checked', sel ? 'true' : 'false');
  });
  recalcSqft();
}

function renderExtras() {
  const list = document.getElementById('extras-list');
  list.innerHTML = EXTRAS.map(e => `
    <label style="display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--gray-100);cursor:pointer" for="extra-${e.id}">
      <input type="checkbox" id="extra-${e.id}" data-id="${e.id}" ${e.checked ? 'checked' : ''} style="width:20px;height:20px;accent-color:var(--green-hex)" onchange="recalcSqft()">
      <span style="flex:1">
        <span style="font-size:14px;font-weight:600;color:var(--gray-700)">${e.name}</span>
      </span>
      <span style="font-size:14px;font-weight:700;color:var(--gray-600)">$${e.price.toFixed(2)}/ft</span>
    </label>`).join('');
}

// Auto-calc sq ft
document.getElementById('q-length').addEventListener('input', recalcSqft);
document.getElementById('q-width').addEventListener('input', recalcSqft);
document.getElementById('q-sqft-custom').addEventListener('input', recalcSqft);

function recalcSqft() {
  const custom = parseFloat(document.getElementById('q-sqft-custom').value);
  if (custom > 0) {
    document.getElementById('q-sqft').textContent = custom.toLocaleString() + ' sq ft';
    return;
  }
  const l = parseFloat(document.getElementById('q-length').value) || 0;
  const w = parseFloat(document.getElementById('q-width').value) || 0;
  const sqft = Math.round(l * w);
  document.getElementById('q-sqft').textContent = sqft.toLocaleString() + ' sq ft';
}

function getSqft() {
  const custom = parseFloat(document.getElementById('q-sqft-custom').value);
  if (custom > 0) return custom;
  const l = parseFloat(document.getElementById('q-length').value) || 0;
  const w = parseFloat(document.getElementById('q-width').value) || 0;
  return Math.round(l * w);
}

function getSelectedExtras() {
  return EXTRAS.filter(e => {
    const cb = document.getElementById('extra-' + e.id);
    return cb && cb.checked;
  });
}

function calculateQuote() {
  const sqft = getSqft();
  if (sqft <= 0) { showToast('Enter measurements first'); return; }
  if (!selectedProduct) { showToast('Pick a turf product'); return; }

  const product = PRODUCTS.find(p => p.id === selectedProduct);
  const extras = getSelectedExtras();
  const laborRate = parseFloat(document.getElementById('q-labor-rate').value) || 0;
  const edgeFt = parseFloat(document.getElementById('q-edge-ft').value) || 0;

  let lines = [];
  const turfCost = sqft * product.price;
  lines.push({ name: product.name + ' (' + sqft.toLocaleString() + ' sq ft)', val: turfCost });

  extras.forEach(e => {
    const cost = sqft * e.price;
    lines.push({ name: e.name, val: cost });
  });

  if (laborRate > 0) {
    lines.push({ name: 'Labor (' + sqft.toLocaleString() + ' sq ft x $' + laborRate.toFixed(2) + ')', val: sqft * laborRate });
  }
  if (edgeFt > 0) {
    lines.push({ name: 'Edge Detail (' + edgeFt + ' linear ft)', val: edgeFt * 0.50 });
  }

  const total = lines.reduce((s, l) => s + l.val, 0);

  const sumDiv = document.getElementById('summary-lines');
  sumDiv.innerHTML = lines.map(l => `
    <div class="line-item">
      <span class="line-item-name">${esc(l.name)}</span>
      <span class="line-item-val">${formatMoney(l.val)}</span>
    </div>`).join('');
  document.getElementById('summary-total').textContent = formatMoney(total);
  document.getElementById('quote-summary').style.display = 'block';
  document.getElementById('quote-action-btns').style.display = 'block';
  document.getElementById('quote-summary').scrollIntoView({ behavior: 'smooth', block: 'center' });
}

async function saveQuoteAsJob() {
  const name = document.getElementById('q-name').value.trim();
  const jobName = document.getElementById('q-job-name').value.trim();
  if (!name) { showToast('Enter a customer name'); return; }
  if (!jobName) { showToast('Give this job a name'); return; }

  const sqft = getSqft();
  const product = PRODUCTS.find(p => p.id === selectedProduct);
  const extras = getSelectedExtras();
  const laborRate = parseFloat(document.getElementById('q-labor-rate').value) || 0;
  const edgeFt = parseFloat(document.getElementById('q-edge-ft').value) || 0;

  let total = sqft * (product ? product.price : 0);
  extras.forEach(e => { total += sqft * e.price; });
  total += sqft * laborRate;
  total += edgeFt * 0.50;

  const job = {
    id: generateId(),
    jobName: jobName,
    customerName: name,
    phone: document.getElementById('q-phone').value.trim(),
    email: document.getElementById('q-email').value.trim(),
    address: document.getElementById('q-address').value.trim(),
    sqft: sqft,
    length: parseFloat(document.getElementById('q-length').value) || 0,
    width: parseFloat(document.getElementById('q-width').value) || 0,
    product: selectedProduct,
    extras: extras.map(e => e.id),
    laborRate: laborRate,
    edgeFt: edgeFt,
    notes: document.getElementById('q-notes').value.trim(),
    status: 'quoted',
    total: Math.round(total),
    photos: quotePhotos.slice(0, 6),
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString()
  };

  await dbPut(job);
  showToast('Job saved to pipeline');
  resetQuoteForm();
  refreshAll();
  switchView('pipeline');
}

function resetQuoteForm() {
  document.getElementById('q-name').value = '';
  document.getElementById('q-phone').value = '';
  document.getElementById('q-email').value = '';
  document.getElementById('q-address').value = '';
  document.getElementById('q-job-name').value = '';
  document.getElementById('q-length').value = '';
  document.getElementById('q-width').value = '';
  document.getElementById('q-sqft-custom').value = '';
  document.getElementById('q-labor-rate').value = '3.50';
  document.getElementById('q-edge-ft').value = '';
  document.getElementById('q-notes').value = '';
  document.getElementById('q-sqft').textContent = '0 sq ft';
  document.getElementById('quote-summary').style.display = 'none';
  document.getElementById('quote-action-btns').style.display = 'none';
  quotePhotos = [];
  renderQuotePhotos();
  selectedProduct = null;
  document.querySelectorAll('.product-option').forEach(el => {
    el.classList.remove('selected');
    el.setAttribute('aria-checked', 'false');
  });
  renderExtras();
}

// ============ CAMERA ============
async function openCamera() {
  try {
    const constraints = { video: { facingMode: 'environment', width: { ideal: 1920 }, height: { ideal: 1080 } } };
    cameraStream = await navigator.mediaDevices.getUserMedia(constraints);
    const video = document.getElementById('camera-video');
    video.srcObject = cameraStream;
    document.getElementById('camera-view').classList.add('open');
  } catch (err) {
    // Fallback: file input
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.capture = 'environment';
    input.multiple = true;
    input.onchange = (e) => {
      Array.from(e.target.files).forEach(file => {
        const reader = new FileReader();
        reader.onload = (ev) => {
          quotePhotos.push(ev.target.result);
          renderQuotePhotos();
        };
        reader.readAsDataURL(file);
      });
    };
    input.click();
  }
}

function capturePhoto() {
  const video = document.getElementById('camera-video');
  const canvas = document.getElementById('camera-canvas');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, 0, 0);
  const dataUrl = canvas.toDataURL('image/jpeg', 0.8);
  quotePhotos.push(dataUrl);
  renderQuotePhotos();
  showToast('Photo captured');
}

function closeCamera() {
  if (cameraStream) {
    cameraStream.getTracks().forEach(t => t.stop());
    cameraStream = null;
  }
  document.getElementById('camera-view').classList.remove('open');
}

function renderQuotePhotos() {
  const grid = document.getElementById('quote-photos');
  if (quotePhotos.length === 0) {
    grid.innerHTML = '';
    return;
  }
  grid.innerHTML = quotePhotos.map((p, i) => `
    <div class="photo-thumb">
      <img src="${p}" alt="Site photo ${i + 1}">
      <button class="photo-remove" onclick="removeQuotePhoto(${i})" aria-label="Remove photo ${i + 1}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>`).join('');
}

function removeQuotePhoto(i) {
  quotePhotos.splice(i, 1);
  renderQuotePhotos();
}

// ============ PDF GENERATION ============
function generatePDF() {
  const name = document.getElementById('q-name').value.trim() || 'Customer';
  const jobName = document.getElementById('q-job-name').value.trim() || 'Turf Installation';
  const address = document.getElementById('q-address').value.trim() || '';
  const sqft = getSqft();
  const product = PRODUCTS.find(p => p.id === selectedProduct);
  const extras = getSelectedExtras();
  const laborRate = parseFloat(document.getElementById('q-labor-rate').value) || 0;
  const edgeFt = parseFloat(document.getElementById('q-edge-ft').value) || 0;
  const notes = document.getElementById('q-notes').value.trim();

  buildPDF({ name, jobName, address, sqft, product, extras, laborRate, edgeFt, notes, photos: quotePhotos });
}

async function regeneratePDFForJob(id) {
  const jobs = await dbGetAll();
  const job = jobs.find(j => j.id === id);
  if (!job) return;
  const product = PRODUCTS.find(p => p.id === job.product);
  const extras = (job.extras || []).map(eid => EXTRAS.find(x => x.id === eid)).filter(Boolean);
  buildPDF({
    name: job.customerName,
    jobName: job.jobName,
    address: job.address,
    sqft: job.sqft,
    product: product,
    extras: extras,
    laborRate: job.laborRate,
    edgeFt: job.edgeFt,
    notes: job.notes,
    photos: job.photos || []
  });
}

function buildPDF(data) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('p', 'mm', 'letter');
  const pw = 215.9;
  const margin = 20;
  const cw = pw - margin * 2;
  let y = margin;

  // Header bar
  doc.setFillColor(26, 61, 42);
  doc.rect(0, 0, pw, 35, 'F');
  doc.setTextColor(255, 255, 255);
  doc.setFontSize(18);
  doc.setFont('helvetica', 'bold');
  doc.text('Memorial Green Turf Inc', margin, 16);
  doc.setFontSize(10);
  doc.setFont('helvetica', 'normal');
  doc.text('Houston, TX  |  (713) 364-2081  |  info@memorialgreenturf.com', margin, 26);

  y = 45;

  // Quote title
  doc.setTextColor(26, 61, 42);
  doc.setFontSize(22);
  doc.setFont('helvetica', 'bold');
  doc.text('Quote', margin, y);
  y += 4;

  // Date & number
  doc.setTextColor(107, 114, 128);
  doc.setFontSize(10);
  doc.setFont('helvetica', 'normal');
  const today = new Date();
  const quoteNum = 'Q-' + today.getFullYear() + String(today.getMonth()+1).padStart(2,'0') + String(today.getDate()).padStart(2,'0') + '-' + Math.floor(Math.random()*900+100);
  doc.text(quoteNum + '  |  ' + today.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }), margin, y + 6);
  y += 16;

  // Customer info
  doc.setFillColor(248, 246, 243);
  doc.roundedRect(margin, y, cw, 28, 3, 3, 'F');
  doc.setTextColor(55, 65, 81);
  doc.setFontSize(10);
  doc.setFont('helvetica', 'bold');
  doc.text('Prepared for:', margin + 6, y + 8);
  doc.setFont('helvetica', 'normal');
  doc.text(data.name, margin + 6, y + 14);
  if (data.address) doc.text(data.address, margin + 6, y + 20);
  y += 36;

  // Job name
  doc.setTextColor(26, 61, 42);
  doc.setFontSize(14);
  doc.setFont('helvetica', 'bold');
  doc.text(data.jobName, margin, y);
  y += 4;
  doc.setTextColor(107, 114, 128);
  doc.setFontSize(10);
  doc.setFont('helvetica', 'normal');
  doc.text(data.sqft.toLocaleString() + ' square feet', margin, y + 5);
  y += 14;

  // Table header
  doc.setFillColor(26, 61, 42);
  doc.rect(margin, y, cw, 8, 'F');
  doc.setTextColor(255, 255, 255);
  doc.setFontSize(9);
  doc.setFont('helvetica', 'bold');
  doc.text('Item', margin + 4, y + 5.5);
  doc.text('Amount', margin + cw - 30, y + 5.5);
  y += 8;

  // Lines
  let lines = [];
  if (data.product) {
    lines.push([data.product.name + ' (' + data.sqft.toLocaleString() + ' sq ft x $' + data.product.price.toFixed(2) + ')', data.sqft * data.product.price]);
  }
  data.extras.forEach(e => {
    lines.push([e.name + ' (' + data.sqft.toLocaleString() + ' sq ft x $' + e.price.toFixed(2) + ')', data.sqft * e.price]);
  });
  if (data.laborRate > 0) {
    lines.push(['Labor (' + data.sqft.toLocaleString() + ' sq ft x $' + data.laborRate.toFixed(2) + ')', data.sqft * data.laborRate]);
  }
  if (data.edgeFt > 0) {
    lines.push(['Edge/Border Detail (' + data.edgeFt + ' linear ft x $0.50)', data.edgeFt * 0.50]);
  }

  doc.setTextColor(55, 65, 81);
  doc.setFont('helvetica', 'normal');
  lines.forEach((line, i) => {
    if (i % 2 === 0) {
      doc.setFillColor(248, 248, 248);
      doc.rect(margin, y, cw, 8, 'F');
    }
    doc.setFontSize(9);
    doc.text(line[0], margin + 4, y + 5.5);
    doc.setFont('helvetica', 'bold');
    doc.text('$' + line[1].toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 }), margin + cw - 30, y + 5.5);
    doc.setFont('helvetica', 'normal');
    y += 8;
  });

  // Total
  const total = lines.reduce((s, l) => s + l[1], 0);
  y += 2;
  doc.setFillColor(45, 90, 61);
  doc.roundedRect(margin + cw - 70, y, 70, 12, 2, 2, 'F');
  doc.setTextColor(255, 255, 255);
  doc.setFontSize(12);
  doc.setFont('helvetica', 'bold');
  doc.text('Total: $' + Math.round(total).toLocaleString(), margin + cw - 65, y + 8.5);
  y += 20;

  // Notes
  if (data.notes) {
    doc.setTextColor(107, 114, 128);
    doc.setFontSize(9);
    doc.setFont('helvetica', 'bold');
    doc.text('Notes:', margin, y);
    y += 5;
    doc.setFont('helvetica', 'normal');
    const noteLines = doc.splitTextToSize(data.notes, cw);
    doc.text(noteLines, margin, y);
    y += noteLines.length * 4.5 + 6;
  }

  // Photos
  if (data.photos && data.photos.length > 0) {
    if (y > 200) { doc.addPage(); y = margin; }
    doc.setTextColor(26, 61, 42);
    doc.setFontSize(11);
    doc.setFont('helvetica', 'bold');
    doc.text('Site Photos', margin, y);
    y += 8;
    let px = margin;
    const photoW = 55;
    const photoH = 41;
    data.photos.slice(0, 4).forEach((photo, i) => {
      try {
        doc.addImage(photo, 'JPEG', px, y, photoW, photoH);
      } catch(e) {}
      px += photoW + 4;
      if (px + photoW > pw - margin) {
        px = margin;
        y += photoH + 4;
      }
    });
    y += photoH + 10;
  }

  // Terms
  if (y > 230) { doc.addPage(); y = margin; }
  doc.setDrawColor(200, 200, 200);
  doc.line(margin, y, margin + cw, y);
  y += 6;
  doc.setTextColor(156, 163, 175);
  doc.setFontSize(8);
  doc.setFont('helvetica', 'normal');
  const terms = [
    'Quote valid for 30 days from date above.',
    '50% deposit required to schedule installation. Balance due on completion.',
    'Price does not include removal of existing materials unless noted.',
    'Warranty: Turf product warranty per manufacturer. 1-year labor warranty.'
  ];
  terms.forEach(t => {
    doc.text(t, margin, y);
    y += 4;
  });

  // Footer
  y += 8;
  doc.setFillColor(248, 246, 243);
  doc.roundedRect(margin, y, cw, 16, 3, 3, 'F');
  doc.setTextColor(107, 114, 128);
  doc.setFontSize(9);
  doc.text('Memorial Green Turf Inc  |  Houston, TX  |  (713) 364-2081', margin + 6, y + 7);
  doc.text('info@memorialgreenturf.com', margin + 6, y + 12);

  // Save or share
  const filename = 'Quote-' + data.name.replace(/\s+/g, '-') + '-' + data.jobName.replace(/\s+/g, '-') + '.pdf';
  const blob = doc.output('blob');

  if (navigator.share && navigator.canShare) {
    const file = new File([blob], filename, { type: 'application/pdf' });
    const shareData = { title: 'Quote from Memorial Green Turf', files: [file] };
    if (navigator.canShare(shareData)) {
      navigator.share(shareData).catch(() => {
        doc.save(filename);
      });
      showToast('PDF ready to share');
      return;
    }
  }
  doc.save(filename);
  showToast('PDF downloaded');
}

// ============ KEYBOARD SUPPORT ============
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    if (document.getElementById('camera-view').classList.contains('open')) {
      closeCamera();
    }
    if (document.getElementById('modal-move').classList.contains('open')) {
      closeMoveModal();
    }
  }
});

// Make cards keyboard-activatable
document.addEventListener('keydown', function(e) {
  if (e.key === 'Enter' || e.key === ' ') {
    const el = document.activeElement;
    if (el && (el.classList.contains('action-card') || el.classList.contains('product-option'))) {
      e.preventDefault();
      el.click();
    }
  }
});

// ============ INIT ============
checkAuth();
</script>
<script src="https://book.bennycutools.com/tracker.js" async></script>
</body>
</html>