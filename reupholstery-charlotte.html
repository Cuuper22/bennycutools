<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>FabricFlow - Reupholstery Charlotte</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Nunito+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #5C4033;
  --primary-light: #7B5B4A;
  --primary-dark: #3D2A21;
  --accent: #C4956A;
  --accent-light: #D4A87D;
  --cream: #F5E6D3;
  --warm-white: #FAFAF7;
  --bg: #FAFAF7;
  --bg-card: #FFFFFF;
  --surface: #F0EBE3;
  --text: #2B1D14;
  --text-muted: #8B7B6F;
  --success: #3D8B5F;
  --success-bg: rgba(61,139,95,0.1);
  --warning: #C4956A;
  --warning-bg: rgba(196,149,106,0.1);
  --error: #C0392B;
  --info: #5B7FA5;
  --info-bg: rgba(91,127,165,0.1);
  --radius: 14px;
  --radius-sm: 10px;
  --shadow-1: 0 1px 4px rgba(92,64,51,0.08);
  --shadow-2: 0 4px 16px rgba(92,64,51,0.1), 0 1px 4px rgba(92,64,51,0.06);
  --shadow-3: 0 8px 32px rgba(92,64,51,0.12), 0 2px 8px rgba(92,64,51,0.08);
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Nunito Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  padding-bottom: 130px !important;
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
}
h1, h2, h3, h4 { font-family: 'Playfair Display', serif; }

.skip-link {
  position: absolute; left: -999px; top: 0; z-index: 10000;
  padding: 8px 16px; background: var(--primary); color: #fff; font-size: 14px; text-decoration: none;
}
.skip-link:focus { left: 0; }
*:focus-visible { outline: 2px solid var(--primary); outline-offset: 2px; }

/* Header */
.top-bar {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  padding: 16px 20px;
  display: flex; align-items: center; gap: 12px;
  position: sticky; top: 0; z-index: 100;
}
.top-bar h1 { color: var(--cream); font-size: 1.25rem; font-weight: 600; }
.top-bar .logo {
  width: 34px; height: 34px; border-radius: 8px;
  background: rgba(255,255,255,0.15); display: flex; align-items: center; justify-content: center;
}

/* Demo banner */
.demo-banner {
  background: var(--accent); color: var(--primary-dark); padding: 10px 16px;
  font-size: 13px; display: flex; align-items: center; justify-content: space-between;
  font-weight: 600;
}
.demo-banner button {
  background: rgba(0,0,0,0.12); border: none; color: var(--primary-dark);
  padding: 4px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 700;
}

/* Main */
main { padding: 16px; max-width: 600px; margin: 0 auto; }

/* Pipeline columns */
.pipeline-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.pipeline-header h2 { font-size: 1rem; color: var(--text-muted); }

.pipeline-cols {
  display: flex; gap: 10px; overflow-x: auto; padding-bottom: 8px;
  scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch;
}
.pipeline-col {
  min-width: 260px; flex-shrink: 0; scroll-snap-align: start;
}
.col-header {
  font-family: 'Nunito Sans', sans-serif; font-size: 11px; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted);
  padding: 8px 12px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;
}
.col-count {
  background: var(--surface); padding: 2px 8px; border-radius: 10px;
  font-size: 10px; font-weight: 700;
}

/* Project cards */
.project-card {
  background: var(--bg-card); border-radius: var(--radius);
  padding: 14px; margin-bottom: 10px;
  border: 1px solid rgba(92,64,51,0.08);
  box-shadow: var(--shadow-1);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  cursor: pointer; position: relative;
  animation: cardFadeUp 0.3s ease-out backwards;
}
.project-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-2); }
.project-card:active { transform: scale(0.98); }
@keyframes cardFadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

.project-photo {
  width: 100%; height: 120px; border-radius: var(--radius-sm);
  object-fit: cover; margin-bottom: 10px;
  background: var(--surface);
}
.project-photo-placeholder {
  width: 100%; height: 80px; border-radius: var(--radius-sm);
  background: linear-gradient(135deg, var(--surface), var(--cream));
  display: flex; align-items: center; justify-content: center;
  margin-bottom: 10px;
}
.project-name { font-family: 'Playfair Display', serif; font-size: 0.95rem; font-weight: 600; margin-bottom: 4px; }
.project-fabric {
  display: inline-flex; align-items: center; gap: 6px;
  font-size: 12px; color: var(--text-muted); margin-bottom: 6px;
}
.fabric-swatch {
  width: 14px; height: 14px; border-radius: 4px;
  border: 1px solid rgba(92,64,51,0.15); display: inline-block;
}
.project-price { font-family: 'Playfair Display', serif; font-weight: 700; font-size: 1.05rem; color: var(--primary); }
.project-meta { display: flex; gap: 10px; font-size: 11px; color: var(--text-muted); margin-top: 6px; }
.project-meta span { display: flex; align-items: center; gap: 3px; }

.status-dot {
  width: 8px; height: 8px; border-radius: 50%; display: inline-block;
}
.status-dot.quoted { background: var(--accent); }
.status-dot.scheduled { background: var(--info); }
.status-dot.inprogress { background: var(--warning); }
.status-dot.ready { background: var(--success); }

/* List view (for mobile) */
.list-view { display: none; }
.list-card {
  background: var(--bg-card); border-radius: var(--radius); padding: 14px;
  margin-bottom: 10px; border: 1px solid rgba(92,64,51,0.08);
  box-shadow: var(--shadow-1); display: flex; gap: 12px;
  cursor: pointer; transition: transform 0.15s; align-items: center;
  animation: cardFadeUp 0.3s ease-out backwards;
}
.list-card:hover { transform: translateY(-1px); }
.list-card:active { transform: scale(0.98); }
.list-thumb { width: 56px; height: 56px; border-radius: var(--radius-sm); object-fit: cover; background: var(--surface); flex-shrink: 0; }
.list-info { flex: 1; min-width: 0; }
.list-name { font-family: 'Playfair Display', serif; font-weight: 600; font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.list-detail { font-size: 12px; color: var(--text-muted); margin-top: 2px; }
.list-right { text-align: right; flex-shrink: 0; }
.list-price { font-family: 'Playfair Display', serif; font-weight: 700; color: var(--primary); }
.list-status { font-size: 10px; font-weight: 700; text-transform: uppercase; margin-top: 2px; }

/* View toggle */
.view-toggle {
  display: flex; gap: 4px; background: var(--surface); border-radius: 8px; padding: 3px;
}
.view-btn {
  padding: 6px 12px; border: none; background: transparent; border-radius: 6px;
  cursor: pointer; color: var(--text-muted); font-size: 12px; font-weight: 600;
  transition: all 0.15s;
}
.view-btn.active { background: var(--bg-card); color: var(--primary); box-shadow: var(--shadow-1); }

/* FAB */
.fab {
  position: fixed; bottom: 140px; right: 20px; z-index: 90;
  width: 56px; height: 56px; border-radius: 50%;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  border: none; color: var(--cream); cursor: pointer;
  box-shadow: 0 4px 16px rgba(92,64,51,0.3);
  display: flex; align-items: center; justify-content: center;
  transition: transform 0.15s, box-shadow 0.15s;
}
.fab:hover { transform: scale(1.08); }
.fab:active { transform: scale(0.95); }

/* Modal */
.modal-overlay {
  position: fixed; inset: 0; background: rgba(43,29,20,0.6); z-index: 200;
  display: none; align-items: flex-end; justify-content: center;
  backdrop-filter: blur(4px);
}
.modal-overlay.active { display: flex; }
.modal {
  background: var(--bg-card); border-radius: 20px 20px 0 0; width: 100%; max-width: 500px;
  max-height: 85vh; overflow-y: auto; padding: 24px 20px;
  animation: slideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
.modal h2 { font-size: 1.15rem; margin-bottom: 20px; }

/* Form */
.form-group { margin-bottom: 14px; }
.form-group label {
  display: block; font-size: 12px; font-weight: 700; color: var(--text-muted);
  text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 5px;
}
.form-group input, .form-group select, .form-group textarea {
  width: 100%; padding: 11px 13px; background: var(--surface);
  border: 1px solid rgba(92,64,51,0.12); border-radius: var(--radius-sm);
  color: var(--text); font-family: inherit; font-size: 16px;
  transition: border-color 0.15s, box-shadow 0.15s;
}
.form-group input:focus, .form-group select:focus, .form-group textarea:focus {
  border-color: var(--primary); box-shadow: 0 0 0 3px rgba(92,64,51,0.1); outline: none;
}
.form-group textarea { resize: vertical; min-height: 50px; }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

.btn {
  display: flex; align-items: center; justify-content: center; gap: 8px;
  padding: 13px 20px; border: none; border-radius: var(--radius-sm);
  font-family: 'Nunito Sans', sans-serif; font-size: 0.95rem; font-weight: 700;
  cursor: pointer; transition: transform 0.1s, background 0.15s; width: 100%;
}
.btn:active { transform: scale(0.97); }
.btn-primary { background: var(--primary); color: var(--cream); }
.btn-primary:hover { background: var(--primary-light); }
.btn-secondary { background: var(--surface); color: var(--text); }
.btn-danger { background: var(--error); color: #fff; }

.btn-camera {
  background: var(--surface); border: 2px dashed rgba(92,64,51,0.2);
  color: var(--text-muted); padding: 16px; border-radius: var(--radius);
  cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 6px;
  transition: border-color 0.15s;
}
.btn-camera:hover { border-color: var(--primary); }

.photo-grid { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 6px; }
.photo-thumb { width: 52px; height: 52px; border-radius: 8px; object-fit: cover; border: 2px solid var(--surface); }

/* Bottom nav */
.bottom-nav {
  position: fixed; bottom: 60px; left: 0; right: 0;
  background: var(--bg-card); border-top: 1px solid rgba(92,64,51,0.08);
  display: flex; z-index: 100; padding: 8px 0 12px;
}
.nav-item {
  flex: 1; display: flex; flex-direction: column; align-items: center; gap: 3px;
  padding: 6px 0; background: none; border: none; color: var(--text-muted);
  cursor: pointer; font-size: 10px; font-weight: 600; text-transform: uppercase;
  letter-spacing: 0.03em; transition: color 0.15s;
}
.nav-item.active { color: var(--primary); }
.nav-item svg { width: 22px; height: 22px; }

/* Toast */
.toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 300; }
.toast {
  background: var(--success); color: #fff; padding: 12px 20px;
  border-radius: var(--radius-sm); font-size: 14px; font-weight: 600;
  box-shadow: var(--shadow-3); animation: toastIn 0.3s ease-out;
}
.toast.error { background: var(--error); }
@keyframes toastIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

/* Sections */
.section { display: none; }
.section.active { display: block; animation: fadeIn 0.2s ease; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* Upsell */
.upsell-card {
  background: linear-gradient(135deg, rgba(92,64,51,0.05), rgba(196,149,106,0.1));
  border: 1px dashed rgba(92,64,51,0.2); border-radius: var(--radius); padding: 16px;
  text-align: center; margin-top: 16px; opacity: 0.8;
}
.upsell-card h3 { color: var(--primary); font-size: 0.9rem; margin-bottom: 4px; }
.upsell-card p { font-size: 12px; color: var(--text-muted); }
.upsell-badge { display: inline-block; background: rgba(92,64,51,0.1); color: var(--primary); padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 700; text-transform: uppercase; }

/* Empty state */
.empty-state { text-align: center; padding: 40px 20px; }
.empty-state p { color: var(--text-muted); font-size: 14px; margin-top: 12px; }

@media print {
  .bottom-nav, .fab, .top-bar, .demo-banner, .toast-container, #bct-demo-disclaimer { display: none !important; }
  body { background: #fff; color: #000; padding: 0 !important; }
  .project-card, .list-card { break-inside: avoid; box-shadow: none; border: 1px solid #ddd; }
}
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
}
@media (min-width: 768px) {
  .list-view { display: none !important; }
  .pipeline-cols { display: flex !important; }
}
@media (max-width: 767px) {
  .pipeline-cols { display: none; }
  .list-view { display: block; }
  .view-toggle { display: none; }
}
</style>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>

<header class="top-bar" role="banner">
  <div class="logo">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--cream)" stroke-width="2" stroke-linecap="round"><path d="M20.38 3.46L16 2 12 5.32 8 2 3.62 3.46a2 2 0 00-1.34 2.23l.58 3.47a1 1 0 00.99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 002-2V10h2.15a1 1 0 00.99-.84l.58-3.47a2 2 0 00-1.34-2.23z"/></svg>
  </div>
  <h1>FabricFlow</h1>
</header>

<div class="demo-banner" id="demoBanner" role="alert" style="display:none;">
  <span>Sample Charlotte projects loaded. Clear to start fresh.</span>
  <button onclick="clearDemoData()" aria-label="Clear sample data">Clear</button>
</div>

<div class="toast-container" id="toastContainer" aria-live="polite" role="status"></div>

<main id="main-content">
  <!-- PROJECTS SECTION -->
  <section class="section active" id="sec-projects" aria-label="Projects">
    <div class="pipeline-header">
      <h2>Project Pipeline</h2>
    </div>

    <!-- Kanban (desktop) -->
    <div class="pipeline-cols" id="pipelineCols"></div>

    <!-- List view (mobile) -->
    <div class="list-view" id="listView"></div>
  </section>

  <!-- QUOTES SECTION -->
  <section class="section" id="sec-quotes" aria-label="Quotes">
    <div class="pipeline-header">
      <h2>Pending Quotes</h2>
    </div>
    <div id="quotesList"></div>
  </section>

  <!-- GALLERY SECTION -->
  <section class="section" id="sec-gallery" aria-label="Gallery">
    <div class="pipeline-header"><h2>Before / After</h2></div>
    <div id="galleryGrid"></div>
    <div class="upsell-card">
      <span class="upsell-badge">Full Version</span>
      <h3>Customer Gallery Website</h3>
      <p>Auto-generate a portfolio site from your completed projects. Turns every finished piece into a marketing tool.</p>
    </div>
  </section>

  <!-- SETTINGS SECTION -->
  <section class="section" id="sec-settings" aria-label="Settings">
    <div class="pipeline-header"><h2>Settings</h2></div>
    <div style="margin-bottom:16px;">
      <button class="btn btn-secondary" style="margin-bottom:8px;" onclick="exportData()">Export All Data (JSON)</button>
      <label for="importInput" class="btn btn-secondary" style="margin-bottom:8px;cursor:pointer;">Import Data</label>
      <input type="file" id="importInput" accept=".json" style="display:none" onchange="importData(event)">
      <button class="btn btn-secondary" onclick="exportCSV()">Export Projects (CSV)</button>
    </div>
  </section>
</main>

<!-- FAB -->
<button class="fab" id="fabBtn" onclick="showNewProject()" aria-label="New project">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
</button>

<!-- Bottom Nav -->
<nav class="bottom-nav" role="navigation" aria-label="Main navigation">
  <button class="nav-item active" data-section="sec-projects" aria-label="Projects">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
    Projects
  </button>
  <button class="nav-item" data-section="sec-quotes" aria-label="Quotes">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
    Quotes
  </button>
  <button class="nav-item" data-section="sec-gallery" aria-label="Gallery">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
    Gallery
  </button>
  <button class="nav-item" data-section="sec-settings" aria-label="Settings">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
    Settings
  </button>
</nav>

<!-- Project Modal -->
<div class="modal-overlay" id="projectModal">
  <div class="modal" role="dialog" aria-label="Project details">
    <h2 id="modalTitle">New Project</h2>
    <form id="projectForm" onsubmit="saveProject(event)">
      <input type="hidden" id="editId">
      <div class="form-group">
        <label for="projName">Project Name</label>
        <input type="text" id="projName" required placeholder="Henderson Sectional">
      </div>
      <div class="form-group">
        <label for="custName">Customer</label>
        <input type="text" id="custName" required placeholder="Sarah Henderson">
      </div>
      <div class="form-group">
        <label for="custPhone">Phone</label>
        <input type="tel" id="custPhone" placeholder="980-555-0123">
      </div>
      <div class="form-group">
        <label for="pieceType">Piece Type</label>
        <select id="pieceType">
          <option value="sofa">Sofa / Sectional</option>
          <option value="chair">Chair</option>
          <option value="headboard">Headboard</option>
          <option value="dining">Dining Chairs</option>
          <option value="ottoman">Ottoman</option>
          <option value="antique">Antique / Restoration</option>
          <option value="other">Other</option>
        </select>
      </div>
      <div class="form-group">
        <label for="fabricChoice">Fabric</label>
        <input type="text" id="fabricChoice" placeholder="Cream boucle, Crypton performance">
      </div>
      <div class="form-group">
        <label for="fabricColor">Fabric Color (for card)</label>
        <input type="color" id="fabricColor" value="#C4956A" style="height:40px;padding:4px;">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="price">Price ($)</label>
          <input type="number" id="price" placeholder="1800" min="0" step="0.01">
        </div>
        <div class="form-group">
          <label for="status">Stage</label>
          <select id="status">
            <option value="quoted">Quoted</option>
            <option value="scheduled">Scheduled</option>
            <option value="inprogress">In Progress</option>
            <option value="ready">Ready for Delivery</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label for="estDate">Estimated Completion</label>
        <input type="date" id="estDate">
      </div>
      <div class="form-group">
        <label for="notes">Notes</label>
        <textarea id="notes" rows="2" placeholder="Fabric ordered from distributor, 2 week lead time..."></textarea>
      </div>
      <div class="form-group">
        <label>Before Photo</label>
        <button type="button" class="btn-camera" onclick="takePhoto('before')">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
          Tap to snap before photo
        </button>
        <input type="file" id="photoBeforeInput" accept="image/*" capture="environment" style="display:none" onchange="handlePhoto(event,'before')">
        <div class="photo-grid" id="beforePreview"></div>
      </div>
      <div class="form-group">
        <label>After Photo</label>
        <button type="button" class="btn-camera" onclick="takePhoto('after')">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
          Tap to snap after photo
        </button>
        <input type="file" id="photoAfterInput" accept="image/*" capture="environment" style="display:none" onchange="handlePhoto(event,'after')">
        <div class="photo-grid" id="afterPreview"></div>
      </div>
      <div style="display:flex;gap:10px;margin-top:16px;">
        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        <button type="submit" class="btn btn-primary" id="saveBtn">Save Project</button>
      </div>
      <div id="deleteRow" style="display:none;margin-top:10px;">
        <button type="button" class="btn btn-danger" onclick="deleteProject()">Delete Project</button>
      </div>
      <div id="shareRow" style="display:none;margin-top:8px;">
        <button type="button" class="btn btn-secondary" onclick="shareProject()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
          Share with Customer
        </button>
      </div>
    </form>
  </div>
</div>

<!-- DEMO DISCLAIMER -->
<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer" style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:10px 16px;font-size:12px;line-height:1.4;color:#666;z-index:99999;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:8px 16px;text-align:center;">
  <p style="margin:0;max-width:700px;"><strong style="color:#333;">Demo:</strong> Free demo. Not affiliated with this business.</p>
  <a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20Reupholstery%20Charlotte&body=I%20am%20the%20owner%20and%20I%20request%20permanent%20deletion%20of%20this%20demo." style="display:inline-flex;align-items:center;gap:4px;background:#dc3545;color:#fff;padding:5px 12px;border-radius:4px;text-decoration:none;font-size:11px;font-weight:500;white-space:nowrap;">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
    Request Permanent Deletion
  </a>
</div>

<script>
// Access key gate
function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
const _V=-1922385066;
const _k=new URLSearchParams(window.location.search).get('key');
if(!_k||_h(_k)!==_V){
  document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;background:#f5e6d3;color:#2b1d14;text-align:center;padding:20px"><div><h1 style="font-size:2rem;margin-bottom:1rem;font-family:serif">Access Required</h1><p style="color:#8b7b6f">This tool needs a valid access key.</p><p style="margin-top:1rem"><a href="mailto:ben@bennycutools.com" style="color:#5C4033">ben@bennycutools.com</a></p></div></div>';
  throw new Error('Invalid key');
}
document.addEventListener('contextmenu',e=>e.preventDefault());

// IndexedDB
const DB_NAME='fabricflow_db'; const DB_VERSION=1; let db;
function openDB(){
  return new Promise((resolve,reject)=>{
    const req=indexedDB.open(DB_NAME,DB_VERSION);
    req.onupgradeneeded=e=>{
      const d=e.target.result;
      if(!d.objectStoreNames.contains('projects')) d.createObjectStore('projects',{keyPath:'id'});
    };
    req.onsuccess=e=>{db=e.target.result;resolve(db);};
    req.onerror=e=>reject(e);
  });
}
function dbPut(store,data){return new Promise((r,j)=>{const tx=db.transaction(store,'readwrite');tx.objectStore(store).put(data);tx.oncomplete=()=>r();tx.onerror=e=>j(e);});}
function dbGetAll(store){return new Promise((r,j)=>{const tx=db.transaction(store,'readonly');const req=tx.objectStore(store).getAll();req.onsuccess=()=>r(req.result);req.onerror=e=>j(e);});}
function dbDelete(store,id){return new Promise((r,j)=>{const tx=db.transaction(store,'readwrite');tx.objectStore(store).delete(id);tx.oncomplete=()=>r();tx.onerror=e=>j(e);});}

let allProjects=[];
let currentBeforePhotos=[];
let currentAfterPhotos=[];

const DEMO_PROJECTS=[
  {id:'demo-1',projName:'Henderson Sectional',custName:'Sarah Henderson',custPhone:'980-555-0123',pieceType:'sofa',fabricChoice:'Cream boucle, performance rated',fabricColor:'#F5E6D3',price:1800,status:'inprogress',estDate:'2026-03-01',notes:'Week 4 of 5. Re-foam done, new fabric being cut today.',beforePhotos:[],afterPhotos:[],created:Date.now()-2592000000,isDemo:true},
  {id:'demo-2',projName:'Davis Wingback Chair',custName:'Robert Davis',custPhone:'704-555-0456',pieceType:'chair',fabricChoice:'Navy velvet, cotton blend',fabricColor:'#1B2A4A',price:950,status:'scheduled',estDate:'2026-02-20',notes:'Pickup Thursday. Family heirloom from the 1960s.',beforePhotos:[],afterPhotos:[],created:Date.now()-1209600000,isDemo:true},
  {id:'demo-3',projName:'Martin Dining Set (6 chairs)',custName:'Angela Martin',custPhone:'980-555-0789',pieceType:'dining',fabricChoice:'Sage green Crypton fabric',fabricColor:'#8B9F7B',price:2400,status:'quoted',estDate:'',notes:'Quoted Feb 3. Waiting on customer to pick fabric. Sent 3 samples.',beforePhotos:[],afterPhotos:[],created:Date.now()-604800000,isDemo:true},
  {id:'demo-4',projName:'Parker Headboard King',custName:'Joy Parker',custPhone:'704-555-0234',pieceType:'headboard',fabricChoice:'Blush pink linen',fabricColor:'#E8C4C4',price:1200,status:'ready',estDate:'2026-02-14',notes:'Done! Delivery scheduled for Valentine\'s Day.',beforePhotos:[],afterPhotos:[],created:Date.now()-3456000000,isDemo:true}
];

async function init(){
  const isFirst=!localStorage.getItem('ff_visited');
  if(isFirst){
    allProjects=[...DEMO_PROJECTS];
    document.getElementById('demoBanner').style.display='flex';
    render();
  }
  setupNav();

  try{
    await openDB();
    if(isFirst){
      localStorage.setItem('ff_visited','1');
      for(const p of DEMO_PROJECTS) await dbPut('projects',p);
    } else {
      allProjects=await dbGetAll('projects');
      if(allProjects.some(p=>p.isDemo)) document.getElementById('demoBanner').style.display='flex';
      render();
    }
  }catch(e){console.warn('IDB error:',e);}
}

const STAGES=['quoted','scheduled','inprogress','ready'];
const STAGE_LABELS={quoted:'Quoted',scheduled:'Scheduled',inprogress:'In Progress',ready:'Ready for Delivery'};
const STAGE_COLORS={quoted:'var(--accent)',scheduled:'var(--info)',inprogress:'var(--warning)',ready:'var(--success)'};

function render(){
  renderPipeline();
  renderListView();
  renderQuotes();
  renderGallery();
}

function renderPipeline(){
  const container=document.getElementById('pipelineCols');
  container.innerHTML=STAGES.map(stage=>{
    const items=allProjects.filter(p=>p.status===stage).sort((a,b)=>b.created-a.created);
    return `<div class="pipeline-col">
      <div class="col-header"><span class="status-dot ${stage}"></span> ${STAGE_LABELS[stage]} <span class="col-count">${items.length}</span></div>
      ${items.map((p,i)=>`
        <div class="project-card" onclick="editProject('${p.id}')" style="animation-delay:${i*60}ms" tabindex="0" role="button" aria-label="Edit ${p.projName}">
          <div class="project-photo-placeholder">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1"><path d="M20.38 3.46L16 2 12 5.32 8 2 3.62 3.46a2 2 0 00-1.34 2.23l.58 3.47a1 1 0 00.99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 002-2V10h2.15a1 1 0 00.99-.84l.58-3.47a2 2 0 00-1.34-2.23z"/></svg>
          </div>
          <div class="project-name">${p.projName}</div>
          <div class="project-fabric"><span class="fabric-swatch" style="background:${p.fabricColor||'#ccc'}"></span> ${p.fabricChoice||'No fabric selected'}</div>
          ${p.price?`<div class="project-price">$${Number(p.price).toLocaleString()}</div>`:''}
          <div class="project-meta">
            <span>${p.custName}</span>
            ${p.estDate?`<span>Due ${new Date(p.estDate+'T12:00:00').toLocaleDateString('en-US',{month:'short',day:'numeric'})}</span>`:''}
          </div>
        </div>
      `).join('')}
      ${items.length===0?'<div class="empty-state"><p style="font-size:12px;">No projects here yet</p></div>':''}
    </div>`;
  }).join('');
}

function renderListView(){
  const container=document.getElementById('listView');
  const sorted=[...allProjects].sort((a,b)=>{
    const order={inprogress:0,scheduled:1,quoted:2,ready:3};
    return (order[a.status]||4)-(order[b.status]||4);
  });
  if(sorted.length===0){
    container.innerHTML='<div class="empty-state"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1"><path d="M20.38 3.46L16 2 12 5.32 8 2 3.62 3.46a2 2 0 00-1.34 2.23l.58 3.47a1 1 0 00.99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 002-2V10h2.15a1 1 0 00.99-.84l.58-3.47a2 2 0 00-1.34-2.23z"/></svg><p>No projects yet. Tap + to add your first piece.</p></div>';
    return;
  }
  container.innerHTML=sorted.map((p,i)=>`
    <div class="list-card" onclick="editProject('${p.id}')" style="animation-delay:${i*40}ms" tabindex="0" role="button" aria-label="Edit ${p.projName}">
      <div class="list-thumb" style="background:linear-gradient(135deg, ${p.fabricColor||'#ccc'}33, ${p.fabricColor||'#ccc'}66);display:flex;align-items:center;justify-content:center;">
        <span class="status-dot ${p.status}" style="width:12px;height:12px;"></span>
      </div>
      <div class="list-info">
        <div class="list-name">${p.projName}</div>
        <div class="list-detail">${p.custName} -- ${p.fabricChoice||'No fabric'}</div>
      </div>
      <div class="list-right">
        ${p.price?`<div class="list-price">$${Number(p.price).toLocaleString()}</div>`:''}
        <div class="list-status" style="color:${STAGE_COLORS[p.status]}">${STAGE_LABELS[p.status]}</div>
      </div>
    </div>
  `).join('');
}

function renderQuotes(){
  const container=document.getElementById('quotesList');
  const quotes=allProjects.filter(p=>p.status==='quoted').sort((a,b)=>b.created-a.created);
  if(quotes.length===0){
    container.innerHTML='<div class="empty-state"><p>No pending quotes. All caught up.</p></div>';
    return;
  }
  container.innerHTML=quotes.map(p=>`
    <div class="list-card" onclick="editProject('${p.id}')" tabindex="0" role="button" aria-label="Edit quote ${p.projName}">
      <div class="list-thumb" style="background:linear-gradient(135deg, ${p.fabricColor||'#ccc'}33, ${p.fabricColor||'#ccc'}66);display:flex;align-items:center;justify-content:center;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      </div>
      <div class="list-info">
        <div class="list-name">${p.projName}</div>
        <div class="list-detail">${p.custName} -- ${timeAgo(p.created)}</div>
      </div>
      <div class="list-right">
        ${p.price?`<div class="list-price">$${Number(p.price).toLocaleString()}</div>`:''}
      </div>
    </div>
  `).join('');
}

function renderGallery(){
  const container=document.getElementById('galleryGrid');
  const completed=allProjects.filter(p=>p.status==='ready');
  if(completed.length===0){
    container.innerHTML='<div class="empty-state"><p>Completed projects will show here with before/after photos.</p></div>';
    return;
  }
  container.innerHTML=completed.map(p=>`
    <div class="list-card" style="flex-direction:column;align-items:stretch;">
      <div class="list-name" style="margin-bottom:8px;">${p.projName} -- ${p.custName}</div>
      <div style="display:flex;gap:8px;">
        <div style="flex:1;text-align:center;padding:16px;background:var(--surface);border-radius:8px;">
          <div style="font-size:11px;color:var(--text-muted);margin-bottom:4px;">BEFORE</div>
          ${p.beforePhotos&&p.beforePhotos.length?`<img src="${p.beforePhotos[0]}" style="width:100%;border-radius:6px;max-height:100px;object-fit:cover;" alt="Before photo">`:'<p style="font-size:12px;color:var(--text-muted)">No photo</p>'}
        </div>
        <div style="flex:1;text-align:center;padding:16px;background:var(--surface);border-radius:8px;">
          <div style="font-size:11px;color:var(--text-muted);margin-bottom:4px;">AFTER</div>
          ${p.afterPhotos&&p.afterPhotos.length?`<img src="${p.afterPhotos[0]}" style="width:100%;border-radius:6px;max-height:100px;object-fit:cover;" alt="After photo">`:'<p style="font-size:12px;color:var(--text-muted)">No photo</p>'}
        </div>
      </div>
    </div>
  `).join('');
}

function timeAgo(ts){const d=Date.now()-ts;const m=Math.floor(d/60000);if(m<60)return m+'m ago';const h=Math.floor(m/60);if(h<24)return h+'h ago';return Math.floor(h/24)+'d ago';}

function setupNav(){
  document.querySelectorAll('.nav-item').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.nav-item').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
      document.getElementById(btn.dataset.section).classList.add('active');
    });
  });
}

function showNewProject(){
  document.getElementById('modalTitle').textContent='New Project';
  document.getElementById('projectForm').reset();
  document.getElementById('editId').value='';
  document.getElementById('deleteRow').style.display='none';
  document.getElementById('shareRow').style.display='none';
  document.getElementById('saveBtn').textContent='Save Project';
  document.getElementById('fabricColor').value='#C4956A';
  currentBeforePhotos=[];currentAfterPhotos=[];
  document.getElementById('beforePreview').innerHTML='';
  document.getElementById('afterPreview').innerHTML='';
  document.getElementById('projectModal').classList.add('active');
}

function editProject(id){
  const p=allProjects.find(x=>x.id===id);
  if(!p)return;
  document.getElementById('modalTitle').textContent='Edit Project';
  document.getElementById('editId').value=p.id;
  document.getElementById('projName').value=p.projName||'';
  document.getElementById('custName').value=p.custName||'';
  document.getElementById('custPhone').value=p.custPhone||'';
  document.getElementById('pieceType').value=p.pieceType||'sofa';
  document.getElementById('fabricChoice').value=p.fabricChoice||'';
  document.getElementById('fabricColor').value=p.fabricColor||'#C4956A';
  document.getElementById('price').value=p.price||'';
  document.getElementById('status').value=p.status||'quoted';
  document.getElementById('estDate').value=p.estDate||'';
  document.getElementById('notes').value=p.notes||'';
  document.getElementById('deleteRow').style.display='block';
  document.getElementById('shareRow').style.display='block';
  document.getElementById('saveBtn').textContent='Update';
  currentBeforePhotos=p.beforePhotos||[];
  currentAfterPhotos=p.afterPhotos||[];
  renderPhotoPreviews();
  document.getElementById('projectModal').classList.add('active');
}

function closeModal(){document.getElementById('projectModal').classList.remove('active');}

async function saveProject(e){
  e.preventDefault();
  const eid=document.getElementById('editId').value;
  const proj={
    id:eid||'proj-'+Date.now()+'-'+Math.random().toString(36).slice(2,5),
    projName:document.getElementById('projName').value,
    custName:document.getElementById('custName').value,
    custPhone:document.getElementById('custPhone').value,
    pieceType:document.getElementById('pieceType').value,
    fabricChoice:document.getElementById('fabricChoice').value,
    fabricColor:document.getElementById('fabricColor').value,
    price:parseFloat(document.getElementById('price').value)||0,
    status:document.getElementById('status').value,
    estDate:document.getElementById('estDate').value,
    notes:document.getElementById('notes').value,
    beforePhotos:currentBeforePhotos,
    afterPhotos:currentAfterPhotos,
    created:eid?(allProjects.find(x=>x.id===eid)||{}).created||Date.now():Date.now(),
    isDemo:false
  };
  await dbPut('projects',proj);
  allProjects=await dbGetAll('projects');
  render();closeModal();showToast(eid?'Project updated':'Project saved');
}

async function deleteProject(){
  const id=document.getElementById('editId').value;
  if(!id)return;
  await dbDelete('projects',id);
  allProjects=await dbGetAll('projects');
  render();closeModal();showToast('Project deleted','error');
}

function takePhoto(type){
  document.getElementById(type==='before'?'photoBeforeInput':'photoAfterInput').click();
}
function handlePhoto(e,type){
  const file=e.target.files[0];if(!file)return;
  const reader=new FileReader();
  reader.onload=ev=>{
    const img=new Image();
    img.onload=()=>{
      const c=document.createElement('canvas');
      const s=Math.min(800/img.width,1);
      c.width=img.width*s;c.height=img.height*s;
      c.getContext('2d').drawImage(img,0,0,c.width,c.height);
      const compressed=c.toDataURL('image/jpeg',0.7);
      if(type==='before')currentBeforePhotos.push(compressed);
      else currentAfterPhotos.push(compressed);
      renderPhotoPreviews();
    };
    img.src=ev.target.result;
  };
  reader.readAsDataURL(file);e.target.value='';
}
function renderPhotoPreviews(){
  document.getElementById('beforePreview').innerHTML=currentBeforePhotos.map((p,i)=>`<img src="${p}" class="photo-thumb" alt="Before photo ${i+1}">`).join('');
  document.getElementById('afterPreview').innerHTML=currentAfterPhotos.map((p,i)=>`<img src="${p}" class="photo-thumb" alt="After photo ${i+1}">`).join('');
}

async function shareProject(){
  const id=document.getElementById('editId').value;
  const p=allProjects.find(x=>x.id===id);
  if(!p)return;
  const text=`Project update from Reupholstery Charlotte:\n${p.projName}\nFabric: ${p.fabricChoice||'TBD'}\nStatus: ${STAGE_LABELS[p.status]}\n${p.estDate?'Est. completion: '+p.estDate:''}\nPrice: $${p.price||'TBD'}\n\nQuestions? Call (980) 475-0566`;
  if(navigator.share){try{await navigator.share({title:'Project Update',text});}catch(e){}}
  else{await navigator.clipboard.writeText(text);showToast('Copied to clipboard');}
}

async function clearDemoData(){
  const demos=allProjects.filter(p=>p.isDemo);
  for(const p of demos) await dbDelete('projects',p.id);
  allProjects=await dbGetAll('projects');
  document.getElementById('demoBanner').style.display='none';
  render();showToast('Sample data cleared');
}

async function exportData(){
  const data={projects:allProjects,exported:new Date().toISOString()};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);
  a.download='fabricflow-backup-'+new Date().toISOString().slice(0,10)+'.json';
  a.click();
}
async function importData(e){
  const file=e.target.files[0];if(!file)return;
  try{const d=JSON.parse(await file.text());
    if(d.projects){for(const p of d.projects)await dbPut('projects',p);}
    allProjects=await dbGetAll('projects');render();showToast('Data imported');
  }catch(err){showToast('Import failed','error');}
}
function exportCSV(){
  const h=['Name','Customer','Phone','Type','Fabric','Price','Status','Est. Date','Notes'];
  const rows=allProjects.map(p=>[p.projName,p.custName,p.custPhone,p.pieceType,p.fabricChoice,p.price,STAGE_LABELS[p.status],p.estDate,p.notes]);
  const csv=[h,...rows].map(r=>r.map(c=>'"'+(c||'').toString().replace(/"/g,'""')+'"').join(',')).join('\n');
  const blob=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);a.download='fabricflow-projects.csv';a.click();
}

function showToast(msg,type='success'){
  const c=document.getElementById('toastContainer');
  const t=document.createElement('div');t.className='toast'+(type==='error'?' error':'');
  t.textContent=msg;c.appendChild(t);
  setTimeout(()=>{t.style.opacity='0';t.style.transition='opacity 0.3s';setTimeout(()=>t.remove(),300);},3000);
}

init();
</script>
</body>
</html>
