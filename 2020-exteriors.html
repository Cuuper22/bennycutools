<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex,nofollow">
    <title>Roof Replacement Cost Estimator | 20/20 Exteriors ‚Äî Spokane, WA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 50:'#eff6ff', 100:'#dbeafe', 200:'#bfdbfe', 300:'#93c5fd', 400:'#60a5fa', 500:'#3b82f6', 600:'#1e40af', 700:'#1e3a5f', 800:'#0f2440', 900:'#0a1628' },
                        accent: { 400:'#f59e0b', 500:'#d97706', 600:'#b45309' }
                    },
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .step-enter { animation: stepIn 0.4s ease-out; }
        @keyframes stepIn { from { opacity:0; transform:translateY(16px); } to { opacity:1; transform:translateY(0); } }
        .pulse-glow { animation: glow 2s ease-in-out infinite alternate; }
        @keyframes glow { from { box-shadow:0 0 8px rgba(59,130,246,.3); } to { box-shadow:0 0 24px rgba(59,130,246,.6); } }
        .material-card { transition: all 0.2s; }
        .material-card:hover { transform: translateY(-2px); }
        .material-card.selected { ring: 2px; }
        input[type="range"] { -webkit-appearance:none; height:8px; border-radius:4px; background:#1e3a5f; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance:none; width:22px; height:22px; border-radius:50%; background:#3b82f6; cursor:pointer; border:2px solid #fff; }
    </style>

    <style>
    /* Kimi UI/UX Improvements */
    .fade-in-up { animation: fadeInUp 0.4s ease-out forwards; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    .radio-option, [class*="option"], [class*="choice"] { 
        min-height: 52px; transition: all 0.15s ease !important; 
    }
    .radio-option:active, [class*="option"]:active { transform: scale(0.98); }
    .btn-primary:active, [class*="btn"]:active { transform: translateY(1px); }
    /* Better progress bar */
    [class*="progress"] { height: 6px !important; border-radius: 3px; }
    </style>
    
</head>
<body class="bg-brand-900 text-white font-sans min-h-screen">

    <!-- Header -->
    <header class="bg-brand-800/80 backdrop-blur border-b border-brand-700/50">
        <div class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-brand-500 rounded-lg flex items-center justify-center font-bold text-sm">20/20</div>
                <div>
                    <h1 class="font-bold text-lg leading-tight">20/20 Exteriors</h1>
                    <p class="text-xs text-brand-300">Spokane, WA ‚Ä¢ (509) 688-4480</p>
                </div>
            </div>
            <span class="text-xs bg-accent-500/20 text-accent-400 px-3 py-1 rounded-full font-medium">IKO Craftsman Elite</span>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-8">
        <!-- Hero -->
        <div class="text-center mb-10">
            <div class="inline-flex items-center gap-2 bg-brand-800 rounded-full px-4 py-2 mb-4">
                <i data-lucide="calculator" class="w-4 h-4 text-brand-400"></i>
                <span class="text-sm text-brand-300">Free Instant Estimate</span>
            </div>
            <h2 class="text-3xl md:text-4xl font-extrabold mb-3">Roof Replacement<br><span class="text-brand-400">Cost Estimator</span></h2>
            <p class="text-brand-300 max-w-lg mx-auto">Get a ballpark cost in 60 seconds. Compare materials. See what fits your budget ‚Äî then schedule your free in-person estimate.</p>
        </div>

        <!-- Progress Bar -->
        <div class="max-w-md mx-auto mb-8">
            <div class="flex justify-between text-xs text-brand-400 mb-2">
                <span id="stepLabel">Step 1 of 4</span>
                <span id="stepPercent">25%</span>
            </div>
            <div class="h-2 bg-brand-800 rounded-full overflow-hidden">
                <div id="progressBar" class="h-full bg-gradient-to-r from-brand-500 to-brand-400 rounded-full transition-all duration-500" style="width:25%"></div>
            </div>
        </div>

        <!-- Step 1: Roof Size -->
        <div id="step1" class="step-enter">
            <div class="bg-brand-800/60 border border-brand-700/50 rounded-2xl p-6 md:p-8 mb-6">
                <h3 class="text-xl font-bold mb-1 flex items-center gap-2"><i data-lucide="home" class="w-5 h-5 text-brand-400"></i> Your Roof Size</h3>
                <p class="text-sm text-brand-400 mb-6">Select what best describes your home.</p>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-brand-300 mb-3">Home Type</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="homeTypeGrid">
                        <button onclick="selectHomeType(this,'ranch')" data-val="ranch" class="home-type-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-4 text-center hover:border-brand-400 transition-all">
                            <div class="text-2xl mb-1">üè†</div>
                            <div class="text-sm font-medium">Ranch</div>
                            <div class="text-xs text-brand-400">1 story</div>
                        </button>
                        <button onclick="selectHomeType(this,'twostory')" data-val="twostory" class="home-type-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-4 text-center hover:border-brand-400 transition-all">
                            <div class="text-2xl mb-1">üè°</div>
                            <div class="text-sm font-medium">Two-Story</div>
                            <div class="text-xs text-brand-400">2 stories</div>
                        </button>
                        <button onclick="selectHomeType(this,'split')" data-val="split" class="home-type-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-4 text-center hover:border-brand-400 transition-all">
                            <div class="text-2xl mb-1">üèòÔ∏è</div>
                            <div class="text-sm font-medium">Split Level</div>
                            <div class="text-xs text-brand-400">Multi-level</div>
                        </button>
                        <button onclick="selectHomeType(this,'large')" data-val="large" class="home-type-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-4 text-center hover:border-brand-400 transition-all">
                            <div class="text-2xl mb-1">üè∞</div>
                            <div class="text-sm font-medium">Large Home</div>
                            <div class="text-xs text-brand-400">3000+ sq ft</div>
                        </button>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-brand-300 mb-3">Approximate Roof Area: <span id="sqftLabel" class="text-brand-400">1,500 sq ft</span></label>
                    <input type="range" id="sqftSlider" min="800" max="5000" value="1500" step="100" class="w-full" oninput="updateSqft()">
                    <div class="flex justify-between text-xs text-brand-500 mt-1">
                        <span>800 sq ft</span>
                        <span>5,000 sq ft</span>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-brand-300 mb-3">Roof Complexity</label>
                    <div class="grid grid-cols-3 gap-3" id="complexityGrid">
                        <button onclick="selectComplexity(this,'simple')" data-val="simple" class="complexity-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-3 text-center hover:border-brand-400 transition-all">
                            <div class="text-sm font-medium">Simple</div>
                            <div class="text-xs text-brand-400">Few angles</div>
                        </button>
                        <button onclick="selectComplexity(this,'moderate')" data-val="moderate" class="complexity-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-3 text-center hover:border-brand-400 transition-all">
                            <div class="text-sm font-medium">Moderate</div>
                            <div class="text-xs text-brand-400">Multiple slopes</div>
                        </button>
                        <button onclick="selectComplexity(this,'complex')" data-val="complex" class="complexity-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-3 text-center hover:border-brand-400 transition-all">
                            <div class="text-sm font-medium">Complex</div>
                            <div class="text-xs text-brand-400">Many valleys/dormers</div>
                        </button>
                    </div>
                </div>
            </div>
            <div class="text-center">
                <button onclick="goStep(2)" class="bg-brand-500 hover:bg-brand-400 text-white font-semibold px-8 py-3 rounded-xl transition-all pulse-glow">Choose Material ‚Üí</button>
            </div>
        </div>

        <!-- Step 2: Material -->
        <div id="step2" class="hidden step-enter">
            <div class="bg-brand-800/60 border border-brand-700/50 rounded-2xl p-6 md:p-8 mb-6">
                <h3 class="text-xl font-bold mb-1 flex items-center gap-2"><i data-lucide="layers" class="w-5 h-5 text-brand-400"></i> Roofing Material</h3>
                <p class="text-sm text-brand-400 mb-6">Compare cost, lifespan, and warranty. 20/20 Exteriors is an IKO Craftsman Elite contractor.</p>

                <div class="space-y-3" id="materialGrid">
                    <button onclick="selectMaterial(this,'cambridge')" class="material-card w-full text-left bg-brand-700/50 border border-brand-600/50 rounded-xl p-4 hover:border-brand-400 transition-all">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="font-semibold">IKO Cambridge</div>
                                <div class="text-xs text-brand-400">Architectural shingle ‚Ä¢ Lifetime warranty (40-yr transferable)</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-bold text-green-400">$$</div>
                                <div class="text-xs text-brand-400">Most Popular</div>
                            </div>
                        </div>
                    </button>
                    <button onclick="selectMaterial(this,'dynasty')" class="material-card w-full text-left bg-brand-700/50 border border-brand-600/50 rounded-xl p-4 hover:border-brand-400 transition-all">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="font-semibold">IKO Dynasty</div>
                                <div class="text-xs text-brand-400">Premium architectural ‚Ä¢ Performance shingle ‚Ä¢ ArmourZone</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-bold text-amber-400">$$$</div>
                                <div class="text-xs text-brand-400">Best Value</div>
                            </div>
                        </div>
                    </button>
                    <button onclick="selectMaterial(this,'nordic')" class="material-card w-full text-left bg-brand-700/50 border border-brand-600/50 rounded-xl p-4 hover:border-brand-400 transition-all">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="font-semibold">IKO Nordic</div>
                                <div class="text-xs text-brand-400">Ultra-premium ‚Ä¢ Slate-like appearance ‚Ä¢ Superior protection</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-bold text-purple-400">$$$$</div>
                                <div class="text-xs text-brand-400">Premium</div>
                            </div>
                        </div>
                    </button>
                    <button onclick="selectMaterial(this,'3tab')" class="material-card w-full text-left bg-brand-700/50 border border-brand-600/50 rounded-xl p-4 hover:border-brand-400 transition-all">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="font-semibold">3-Tab Shingle</div>
                                <div class="text-xs text-brand-400">Traditional strip shingle ‚Ä¢ Budget-friendly option</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-bold text-blue-400">$</div>
                                <div class="text-xs text-brand-400">Economy</div>
                            </div>
                        </div>
                    </button>
                </div>
            </div>
            <div class="flex justify-between">
                <button onclick="goStep(1)" class="text-brand-400 hover:text-white font-medium px-6 py-3 transition-all">‚Üê Back</button>
                <button onclick="goStep(3)" class="bg-brand-500 hover:bg-brand-400 text-white font-semibold px-8 py-3 rounded-xl transition-all pulse-glow">Condition & Extras ‚Üí</button>
            </div>
        </div>

        <!-- Step 3: Condition & Extras -->
        <div id="step3" class="hidden step-enter">
            <div class="bg-brand-800/60 border border-brand-700/50 rounded-2xl p-6 md:p-8 mb-6">
                <h3 class="text-xl font-bold mb-1 flex items-center gap-2"><i data-lucide="clipboard-check" class="w-5 h-5 text-brand-400"></i> Current Condition</h3>
                <p class="text-sm text-brand-400 mb-6">Tell us about your current roof so we can estimate removal and prep costs.</p>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-brand-300 mb-3">Existing Roof Layers</label>
                    <div class="grid grid-cols-3 gap-3" id="layersGrid">
                        <button onclick="selectLayers(this,1)" class="layers-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-3 text-center hover:border-brand-400 transition-all">
                            <div class="text-lg font-bold">1</div>
                            <div class="text-xs text-brand-400">Single layer</div>
                        </button>
                        <button onclick="selectLayers(this,2)" class="layers-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-3 text-center hover:border-brand-400 transition-all">
                            <div class="text-lg font-bold">2</div>
                            <div class="text-xs text-brand-400">Double layer</div>
                        </button>
                        <button onclick="selectLayers(this,3)" class="layers-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-3 text-center hover:border-brand-400 transition-all">
                            <div class="text-lg font-bold">3+</div>
                            <div class="text-xs text-brand-400">Triple+</div>
                        </button>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-brand-300 mb-3">Visible Damage</label>
                    <div class="grid grid-cols-2 gap-3" id="damageGrid">
                        <button onclick="toggleDamage(this,'missing')" class="damage-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-3 text-center hover:border-brand-400 transition-all">
                            <div class="text-sm font-medium">Missing Shingles</div>
                        </button>
                        <button onclick="toggleDamage(this,'leaks')" class="damage-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-3 text-center hover:border-brand-400 transition-all">
                            <div class="text-sm font-medium">Active Leaks</div>
                        </button>
                        <button onclick="toggleDamage(this,'sagging')" class="damage-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-3 text-center hover:border-brand-400 transition-all">
                            <div class="text-sm font-medium">Sagging Areas</div>
                        </button>
                        <button onclick="toggleDamage(this,'storm')" class="damage-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-3 text-center hover:border-brand-400 transition-all">
                            <div class="text-sm font-medium">Storm/Hail Damage</div>
                        </button>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-brand-300 mb-3">Insurance Claim?</label>
                    <div class="grid grid-cols-2 gap-3" id="insuranceGrid">
                        <button onclick="selectInsurance(this,true)" class="ins-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-3 text-center hover:border-brand-400 transition-all">
                            <div class="text-sm font-medium">Yes ‚Äî Filing a Claim</div>
                            <div class="text-xs text-brand-400">We help with the process</div>
                        </button>
                        <button onclick="selectInsurance(this,false)" class="ins-btn bg-brand-700/50 border border-brand-600/50 rounded-xl p-3 text-center hover:border-brand-400 transition-all">
                            <div class="text-sm font-medium">No ‚Äî Paying Out of Pocket</div>
                            <div class="text-xs text-brand-400">Standard pricing</div>
                        </button>
                    </div>
                </div>
            </div>
            <div class="flex justify-between">
                <button onclick="goStep(2)" class="text-brand-400 hover:text-white font-medium px-6 py-3 transition-all">‚Üê Back</button>
                <button onclick="calculateEstimate()" class="bg-accent-500 hover:bg-accent-400 text-white font-semibold px-8 py-3 rounded-xl transition-all pulse-glow">See My Estimate ‚Üí</button>
            </div>
        </div>

        <!-- Step 4: Results -->
        <div id="step4" class="hidden step-enter">
            <div class="bg-brand-800/60 border border-brand-700/50 rounded-2xl p-6 md:p-8 mb-6">
                <div class="text-center mb-6">
                    <div class="inline-flex items-center gap-2 bg-green-500/20 text-green-400 rounded-full px-4 py-2 text-sm font-medium mb-3">
                        <i data-lucide="check-circle" class="w-4 h-4"></i> Estimate Ready
                    </div>
                    <h3 class="text-2xl font-bold">Your Roof Replacement Estimate</h3>
                </div>

                <!-- Cost Display -->
                <div class="bg-brand-900/60 rounded-xl p-6 mb-6 text-center">
                    <div class="text-sm text-brand-400 mb-1">Estimated Total Cost</div>
                    <div class="text-4xl md:text-5xl font-extrabold text-brand-400" id="costRange">$8,500 ‚Äì $12,200</div>
                    <div class="text-sm text-brand-400 mt-2" id="costPerSqft">~$5.67 ‚Äì $8.13 per sq ft</div>
                </div>

                <!-- Breakdown -->
                <div class="space-y-3 mb-6" id="breakdownList">
                    <!-- Filled by JS -->
                </div>

                <!-- Material Comparison -->
                <div class="bg-brand-700/30 rounded-xl p-5 mb-6">
                    <h4 class="font-semibold text-sm mb-3 flex items-center gap-2"><i data-lucide="bar-chart-3" class="w-4 h-4 text-brand-400"></i> Material Comparison for Your Roof</h4>
                    <div class="space-y-2" id="comparisonTable">
                        <!-- Filled by JS -->
                    </div>
                </div>

                <!-- Insurance Note -->
                <div id="insuranceNote" class="hidden bg-amber-500/10 border border-amber-500/30 rounded-xl p-4 mb-6">
                    <div class="flex items-start gap-3">
                        <i data-lucide="shield-check" class="w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"></i>
                        <div>
                            <div class="font-semibold text-amber-400 text-sm">Insurance Claim Assistance</div>
                            <p class="text-xs text-brand-300 mt-1">20/20 Exteriors has experience working with insurance companies on storm and hail damage claims. They can meet with your adjuster and help ensure your claim covers the full scope of work needed.</p>
                        </div>
                    </div>
                </div>

                <!-- Spokane Weather Note -->
                <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4 mb-6">
                    <div class="flex items-start gap-3">
                        <i data-lucide="snowflake" class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"></i>
                        <div>
                            <div class="font-semibold text-blue-400 text-sm">Spokane Weather Consideration</div>
                            <p class="text-xs text-brand-300 mt-1">With Spokane's heavy snow loads, ice dams, and freeze-thaw cycles, proper underlayment and ice & water shield are critical. 20/20 Exteriors installs to manufacturer specs for our local climate.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lead Capture -->
            <div class="bg-gradient-to-br from-brand-600/40 to-brand-800/60 border border-brand-500/30 rounded-2xl p-6 md:p-8 mb-6">
                <h3 class="text-xl font-bold mb-2 text-center">Get Your Free On-Site Estimate</h3>
                <p class="text-sm text-brand-300 text-center mb-6">An online estimate is a starting point. Let Tim or Jeremy come out for an accurate, no-obligation assessment.</p>
                <div class="space-y-4 max-w-md mx-auto">
                    <div>
                        <label class="block text-xs font-medium text-brand-300 mb-1">Full Name *</label>
                        <input type="text" id="leadName" class="w-full bg-brand-900/60 border border-brand-600/50 rounded-lg px-4 py-2.5 text-sm text-white placeholder-brand-500 focus:border-brand-400 focus:outline-none" placeholder="Your name">
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-brand-300 mb-1">Phone *</label>
                            <input type="tel" id="leadPhone" class="w-full bg-brand-900/60 border border-brand-600/50 rounded-lg px-4 py-2.5 text-sm text-white placeholder-brand-500 focus:border-brand-400 focus:outline-none" placeholder="(509) 555-0000">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-brand-300 mb-1">Email</label>
                            <input type="email" id="leadEmail" class="w-full bg-brand-900/60 border border-brand-600/50 rounded-lg px-4 py-2.5 text-sm text-white placeholder-brand-500 focus:border-brand-400 focus:outline-none" placeholder="you@email.com">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-brand-300 mb-1">Address (for on-site visit)</label>
                        <input type="text" id="leadAddress" class="w-full bg-brand-900/60 border border-brand-600/50 rounded-lg px-4 py-2.5 text-sm text-white placeholder-brand-500 focus:border-brand-400 focus:outline-none" placeholder="123 Main St, Spokane, WA">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-brand-300 mb-1">Preferred Timing</label>
                        <select id="leadTiming" class="w-full bg-brand-900/60 border border-brand-600/50 rounded-lg px-4 py-2.5 text-sm text-white focus:border-brand-400 focus:outline-none">
                            <option value="asap">ASAP ‚Äî Urgent Need</option>
                            <option value="month" selected>Within the Next Month</option>
                            <option value="quarter">Next 1-3 Months</option>
                            <option value="planning">Just Planning / Getting Quotes</option>
                        </select>
                    </div>
                    <button onclick="submitLead()" id="submitBtn" class="w-full bg-accent-500 hover:bg-accent-400 text-white font-bold py-3 rounded-xl transition-all text-lg">Request Free Estimate</button>
                </div>
            </div>

            <div id="successMsg" class="hidden bg-green-500/20 border border-green-500/40 rounded-2xl p-8 text-center mb-6">
                <div class="text-4xl mb-3">‚úÖ</div>
                <h3 class="text-xl font-bold text-green-400 mb-2">Estimate Request Submitted!</h3>
                <p class="text-brand-300">Tim or Jeremy from 20/20 Exteriors will reach out within 1 business day to schedule your free on-site assessment.</p>
                <p class="text-brand-400 text-sm mt-3">üìû Need immediate help? Call <a href="tel:5096884480" class="text-brand-400 underline">(509) 688-4480</a></p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="border-t border-brand-800 py-6 text-center text-xs text-brand-500">
        <p>Built for 20/20 Exteriors ‚Ä¢ 124 E. Rowan Suite 202B, Spokane, WA 99207</p>
        <p class="mt-1">Estimates are approximate. Final pricing requires on-site inspection.</p>
    </footer>

    <script>
        // State
        let state = {
            homeType: null,
            sqft: 1500,
            complexity: null,
            material: null,
            layers: 1,
            damage: [],
            insurance: null
        };

        // Pricing per sq ft (low, high) for Spokane market
        const MATERIAL_PRICING = {
            '3tab':      { low: 3.50, high: 5.00, label: '3-Tab Shingle',  lifespan: '15-20 yrs', warranty: '25 years' },
            'cambridge': { low: 4.50, high: 6.50, label: 'IKO Cambridge',  lifespan: '25-30 yrs', warranty: 'Lifetime (40-yr transfer)' },
            'dynasty':   { low: 5.50, high: 8.00, label: 'IKO Dynasty',    lifespan: '30-35 yrs', warranty: 'Lifetime + Wind' },
            'nordic':    { low: 7.00, high: 10.50, label: 'IKO Nordic',    lifespan: '35-50 yrs', warranty: 'Lifetime Premium' }
        };

        const COMPLEXITY_MULT = { simple: 1.0, moderate: 1.12, complex: 1.28 };
        const LAYER_ADD = { 1: 0, 2: 0.60, 3: 1.20 };

        function selectHomeType(el, val) {
            state.homeType = val;
            document.querySelectorAll('.home-type-btn').forEach(b => {
                b.classList.remove('border-brand-400','bg-brand-600/30');
                b.classList.add('border-brand-600/50');
            });
            el.classList.add('border-brand-400','bg-brand-600/30');
            el.classList.remove('border-brand-600/50');
            // Auto-adjust slider
            const defaults = { ranch:1400, twostory:2000, split:1800, large:3200 };
            document.getElementById('sqftSlider').value = defaults[val];
            updateSqft();
        }

        function updateSqft() {
            state.sqft = parseInt(document.getElementById('sqftSlider').value);
            document.getElementById('sqftLabel').textContent = state.sqft.toLocaleString() + ' sq ft';
        }

        function selectComplexity(el, val) {
            state.complexity = val;
            document.querySelectorAll('.complexity-btn').forEach(b => {
                b.classList.remove('border-brand-400','bg-brand-600/30');
                b.classList.add('border-brand-600/50');
            });
            el.classList.add('border-brand-400','bg-brand-600/30');
            el.classList.remove('border-brand-600/50');
        }

        function selectMaterial(el, val) {
            state.material = val;
            document.querySelectorAll('.material-card').forEach(b => {
                b.classList.remove('border-brand-400','bg-brand-600/30');
                b.classList.add('border-brand-600/50');
            });
            el.classList.add('border-brand-400','bg-brand-600/30');
            el.classList.remove('border-brand-600/50');
        }

        function selectLayers(el, val) {
            state.layers = val;
            document.querySelectorAll('.layers-btn').forEach(b => {
                b.classList.remove('border-brand-400','bg-brand-600/30');
                b.classList.add('border-brand-600/50');
            });
            el.classList.add('border-brand-400','bg-brand-600/30');
            el.classList.remove('border-brand-600/50');
        }

        function toggleDamage(el, val) {
            const idx = state.damage.indexOf(val);
            if (idx > -1) {
                state.damage.splice(idx, 1);
                el.classList.remove('border-amber-400','bg-amber-500/10');
                el.classList.add('border-brand-600/50');
            } else {
                state.damage.push(val);
                el.classList.add('border-amber-400','bg-amber-500/10');
                el.classList.remove('border-brand-600/50');
            }
        }

        function selectInsurance(el, val) {
            state.insurance = val;
            document.querySelectorAll('.ins-btn').forEach(b => {
                b.classList.remove('border-brand-400','bg-brand-600/30');
                b.classList.add('border-brand-600/50');
            });
            el.classList.add('border-brand-400','bg-brand-600/30');
            el.classList.remove('border-brand-600/50');
        }

        function goStep(n) {
            for (let i = 1; i <= 4; i++) {
                document.getElementById('step' + i).classList.add('hidden');
            }
            document.getElementById('step' + n).classList.remove('hidden');
            document.getElementById('step' + n).classList.add('step-enter');
            document.getElementById('stepLabel').textContent = 'Step ' + n + ' of 4';
            document.getElementById('stepPercent').textContent = (n * 25) + '%';
            document.getElementById('progressBar').style.width = (n * 25) + '%';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function calculateEstimate() {
            if (!state.material) { state.material = 'cambridge'; }
            if (!state.complexity) { state.complexity = 'moderate'; }

            const mat = MATERIAL_PRICING[state.material];
            const complexMult = COMPLEXITY_MULT[state.complexity];
            const layerAdd = LAYER_ADD[state.layers] || 0;
            const damageAdd = state.damage.length * 0.40;

            const lowPerSqft = (mat.low + layerAdd + damageAdd) * complexMult;
            const highPerSqft = (mat.high + layerAdd + damageAdd) * complexMult;

            const totalLow = Math.round(lowPerSqft * state.sqft / 100) * 100;
            const totalHigh = Math.round(highPerSqft * state.sqft / 100) * 100;

            document.getElementById('costRange').textContent = '$' + totalLow.toLocaleString() + ' ‚Äì $' + totalHigh.toLocaleString();
            document.getElementById('costPerSqft').textContent = '~$' + lowPerSqft.toFixed(2) + ' ‚Äì $' + highPerSqft.toFixed(2) + ' per sq ft';

            // Breakdown
            const breakdown = document.getElementById('breakdownList');
            breakdown.innerHTML = `
                <div class="flex justify-between items-center bg-brand-700/30 rounded-lg px-4 py-3">
                    <span class="text-sm text-brand-300">Roof Area</span>
                    <span class="text-sm font-medium">${state.sqft.toLocaleString()} sq ft</span>
                </div>
                <div class="flex justify-between items-center bg-brand-700/30 rounded-lg px-4 py-3">
                    <span class="text-sm text-brand-300">Material</span>
                    <span class="text-sm font-medium">${mat.label}</span>
                </div>
                <div class="flex justify-between items-center bg-brand-700/30 rounded-lg px-4 py-3">
                    <span class="text-sm text-brand-300">Warranty</span>
                    <span class="text-sm font-medium">${mat.warranty}</span>
                </div>
                <div class="flex justify-between items-center bg-brand-700/30 rounded-lg px-4 py-3">
                    <span class="text-sm text-brand-300">Expected Lifespan</span>
                    <span class="text-sm font-medium">${mat.lifespan}</span>
                </div>
                <div class="flex justify-between items-center bg-brand-700/30 rounded-lg px-4 py-3">
                    <span class="text-sm text-brand-300">Complexity</span>
                    <span class="text-sm font-medium capitalize">${state.complexity}</span>
                </div>
                ${state.layers > 1 ? `<div class="flex justify-between items-center bg-brand-700/30 rounded-lg px-4 py-3">
                    <span class="text-sm text-brand-300">Tear-off (${state.layers} layers)</span>
                    <span class="text-sm font-medium text-amber-400">+$${(layerAdd * state.sqft).toLocaleString()} est.</span>
                </div>` : ''}
                ${state.damage.length ? `<div class="flex justify-between items-center bg-brand-700/30 rounded-lg px-4 py-3">
                    <span class="text-sm text-brand-300">Damage Repair (${state.damage.length} issue${state.damage.length>1?'s':''})</span>
                    <span class="text-sm font-medium text-amber-400">Included in estimate</span>
                </div>` : ''}
            `;

            // Comparison table
            const comparison = document.getElementById('comparisonTable');
            comparison.innerHTML = '';
            Object.entries(MATERIAL_PRICING).forEach(([key, m]) => {
                const isSelected = key === state.material;
                const low = Math.round((m.low + layerAdd + damageAdd) * COMPLEXITY_MULT[state.complexity] * state.sqft / 100) * 100;
                const high = Math.round((m.high + layerAdd + damageAdd) * COMPLEXITY_MULT[state.complexity] * state.sqft / 100) * 100;
                comparison.innerHTML += `
                    <div class="flex items-center justify-between ${isSelected ? 'bg-brand-500/20 border border-brand-500/40' : 'bg-brand-800/40'} rounded-lg px-4 py-3">
                        <div>
                            <div class="text-sm font-medium ${isSelected ? 'text-brand-400' : ''}">${m.label} ${isSelected ? '‚úì' : ''}</div>
                            <div class="text-xs text-brand-400">${m.lifespan} ‚Ä¢ ${m.warranty}</div>
                        </div>
                        <div class="text-sm font-bold ${isSelected ? 'text-brand-400' : 'text-brand-300'}">$${low.toLocaleString()} ‚Äì $${high.toLocaleString()}</div>
                    </div>
                `;
            });

            // Insurance note
            if (state.insurance) {
                document.getElementById('insuranceNote').classList.remove('hidden');
            }

            // Save to localStorage
            localStorage.setItem('2020ext_estimate', JSON.stringify({
                ...state,
                totalLow,
                totalHigh,
                timestamp: new Date().toISOString()
            }));

            goStep(4);
        }

        function submitLead() {
            const name = document.getElementById('leadName').value.trim();
            const phone = document.getElementById('leadPhone').value.trim();
            if (!name || !phone) {
                alert('Please enter your name and phone number.');
                return;
            }
            const lead = {
                name,
                phone,
                email: document.getElementById('leadEmail').value.trim(),
                address: document.getElementById('leadAddress').value.trim(),
                timing: document.getElementById('leadTiming').value,
                estimate: JSON.parse(localStorage.getItem('2020ext_estimate') || '{}'),
                submitted: new Date().toISOString()
            };
            localStorage.setItem('2020ext_lead', JSON.stringify(lead));

            document.getElementById('submitBtn').closest('.bg-gradient-to-br').classList.add('hidden');
            document.getElementById('successMsg').classList.remove('hidden');
        }

        // Init icons
        lucide.createIcons();
    </script>
</body>
</html>
