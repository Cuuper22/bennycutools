<!DOCTYPE html>
<html lang="en">
<head>
<meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Repair Pro - Premium Shop Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #c0392b;
            --secondary: #2c3e50;
            --bg-dark: #1a1a1a;
            --bg-card: #2d2d2d;
            --bg-hover: #3a3a3a;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #3498db;
            --border: #404040;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--secondary);
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar.mobile-hidden {
            transform: translateX(-100%);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary);
        }

        .brand-logo {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .brand-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .brand-info h1 {
            font-size: 18px;
            margin-bottom: 2px;
        }

        .brand-info p {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: var(--text-primary);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.1);
        }

        .nav-link.active {
            background: var(--primary);
        }

        .nav-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 30px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .mobile-header {
            display: none;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg-card);
            border-radius: 8px;
        }

        .menu-toggle {
            background: var(--primary);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
        }

        .page-header {
            margin-bottom: 30px;
        }

        .page-header h2 {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .page-header p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            border: 1px solid var(--border);
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Bay Grid */
        .bay-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .bay-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--border);
            position: relative;
        }

        .bay-card.occupied {
            border-color: var(--primary);
        }

        .bay-card.empty {
            border-color: var(--border);
            opacity: 0.6;
        }

        .bay-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .bay-number {
            font-size: 20px;
            font-weight: bold;
        }

        .bay-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .bay-status.occupied {
            background: var(--primary);
        }

        .bay-status.empty {
            background: var(--border);
        }

        .vehicle-info {
            margin-top: 12px;
        }

        .vehicle-make {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .customer-name {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .service-type {
            margin-top: 10px;
            padding: 8px;
            background: var(--bg-hover);
            border-radius: 6px;
            font-size: 13px;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #a02919;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        /* Table */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--bg-hover);
        }

        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border);
        }

        td {
            padding: 14px 12px;
            border-bottom: 1px solid var(--border);
        }

        tr:hover {
            background: var(--bg-hover);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: var(--success);
            color: white;
        }

        .badge-warning {
            background: var(--warning);
            color: white;
        }

        .badge-danger {
            background: var(--danger);
            color: white;
        }

        .badge-info {
            background: var(--info);
            color: white;
        }

        .badge-secondary {
            background: var(--secondary);
            color: white;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        select.form-control {
            cursor: pointer;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 12px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 28px;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }

        .modal-close:hover {
            background: var(--bg-hover);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Search */
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 45px;
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* Invoice Print Styles */
        @media print {
            .sidebar, .mobile-header, .btn, .page-header, .nav-menu {
                display: none !important;
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .invoice-print {
                background: white;
                color: black;
            }

            .card {
                border: 1px solid #ddd;
                box-shadow: none;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-visible {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 15px;
            }

            .mobile-header {
                display: flex;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .bay-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 20px;
            }
        }

        /* Service Items List */
        .service-items {
            margin-top: 20px;
        }

        .service-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-hover);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .service-item-info {
            flex: 1;
        }

        .service-item-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .service-item-details {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .service-item-price {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
        }

        .service-item-actions {
            display: flex;
            gap: 8px;
        }

        /* Quick Add Service */
        .service-catalog {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .service-catalog-item {
            padding: 16px;
            background: var(--bg-hover);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .service-catalog-item:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .service-catalog-item.selected {
            border-color: var(--primary);
            background: rgba(192, 57, 43, 0.1);
        }

        .service-catalog-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .service-catalog-price {
            color: var(--primary);
            font-size: 14px;
        }

        /* Invoice */
        .invoice-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .invoice-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .invoice-logo-img {
            width: 80px;
            height: 80px;
            background: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }

        .invoice-company h2 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .invoice-company p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .invoice-details {
            text-align: right;
        }

        .invoice-number {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
        }

        .invoice-summary {
            background: var(--bg-hover);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .invoice-summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 16px;
        }

        .invoice-summary-row.total {
            border-top: 2px solid var(--border);
            margin-top: 10px;
            padding-top: 15px;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            background: var(--bg-hover);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-icon:hover {
            background: var(--primary);
            border-color: var(--primary);
        }

        /* Customer Card */
        .customer-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--bg-hover);
            border-radius: 8px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .customer-card:hover {
            background: var(--bg-card);
            border: 1px solid var(--primary);
        }

        .customer-avatar {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
        }

        .customer-info {
            flex: 1;
        }

        .customer-info h4 {
            margin-bottom: 4px;
        }

        .customer-meta {
            font-size: 13px;
            color: var(--text-secondary);
        }
    </style>

    <style>
    /* Kimi UI/UX Improvements */
    .fade-in-up { animation: fadeInUp 0.4s ease-out forwards; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    .radio-option, [class*="option"], [class*="choice"] { 
        min-height: 52px; transition: all 0.15s ease !important; 
    }
    .radio-option:active, [class*="option"]:active { transform: scale(0.98); }
    .btn-primary:active, [class*="btn"]:active { transform: translateY(1px); }
    /* Better progress bar */
    [class*="progress"] { height: 6px !important; border-radius: 3px; }
    </style>
    
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="brand">
                <div class="brand-logo" id="brandLogo">
                    🔧
                </div>
                <div class="brand-info">
                    <h1 id="businessName">Auto Repair Pro</h1>
                    <p id="businessTagline">Professional Management</p>
                </div>
            </div>
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a class="nav-link active" data-page="dashboard">
                            <span class="nav-icon">📊</span>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="repair-orders">
                            <span class="nav-icon">📋</span>
                            <span>Repair Orders</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="customers">
                            <span class="nav-icon">👥</span>
                            <span>Customers</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="vehicle-history">
                            <span class="nav-icon">🚗</span>
                            <span>Vehicle History</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="estimates">
                            <span class="nav-icon">💰</span>
                            <span>Estimates</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="invoices">
                            <span class="nav-icon">🧾</span>
                            <span>Invoices</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="parts">
                            <span class="nav-icon">🔩</span>
                            <span>Parts Tracker</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="bays">
                            <span class="nav-icon">🏭</span>
                            <span>Bay Management</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <div class="mobile-header">
                <button class="menu-toggle" onclick="toggleMobileMenu()">☰</button>
                <h2 id="mobileTitle">Dashboard</h2>
            </div>

            <!-- Pages will be dynamically loaded here -->
            <div id="pageContent"></div>
        </main>
    </div>

    <script>
        // Configuration & State
        const config = {
            business: 'Auto Repair Pro',
            tagline: 'Professional Management',
            phone: '',
            city: '',
            logo: '',
            color1: '#c0392b',
            color2: '#2c3e50'
        };

        let currentPage = 'dashboard';
        let data = {
            repairOrders: [],
            customers: [],
            vehicles: [],
            invoices: [],
            estimates: [],
            parts: [],
            bays: [],
            services: []
        };

        // Parse URL parameters
        function parseUrlParams() {
            const params = new URLSearchParams(window.location.search);
            if (params.has('business')) config.business = params.get('business');
            if (params.has('tagline')) config.tagline = params.get('tagline');
            if (params.has('phone')) config.phone = params.get('phone');
            if (params.has('city')) config.city = params.get('city');
            if (params.has('logo')) config.logo = params.get('logo');
            if (params.has('color1')) {
                config.color1 = params.get('color1');
                document.documentElement.style.setProperty('--primary', config.color1);
            }
            if (params.has('color2')) {
                config.color2 = params.get('color2');
                document.documentElement.style.setProperty('--secondary', config.color2);
            }

            // Update branding
            document.getElementById('businessName').textContent = config.business;
            document.getElementById('businessTagline').textContent = config.tagline;
            if (config.logo) {
                document.getElementById('brandLogo').innerHTML = `<img src="${config.logo}" alt="Logo">`;
            }
        }

        // Initialize with sample data
        function initializeSampleData() {
            data.services = [
                { id: 's1', name: 'Oil Change', category: 'Maintenance', laborHours: 0.5, laborRate: 90, partsMin: 25, partsMax: 45 },
                { id: 's2', name: 'Brake Pads Replacement', category: 'Brakes', laborHours: 2, laborRate: 95, partsMin: 150, partsMax: 300 },
                { id: 's3', name: 'Wheel Alignment', category: 'Suspension', laborHours: 1, laborRate: 100, partsMin: 0, partsMax: 0 },
                { id: 's4', name: 'Transmission Flush', category: 'Transmission', laborHours: 1.5, laborRate: 110, partsMin: 150, partsMax: 250 },
                { id: 's5', name: 'Engine Diagnostic', category: 'Diagnostic', laborHours: 1, laborRate: 120, partsMin: 0, partsMax: 0 },
                { id: 's6', name: 'Battery Replacement', category: 'Electrical', laborHours: 0.5, laborRate: 85, partsMin: 100, partsMax: 200 },
                { id: 's7', name: 'Tire Rotation', category: 'Tires', laborHours: 0.5, laborRate: 70, partsMin: 0, partsMax: 0 },
                { id: 's8', name: 'Air Filter Replacement', category: 'Maintenance', laborHours: 0.25, laborRate: 80, partsMin: 25, partsMax: 50 },
                { id: 's9', name: 'Coolant Flush', category: 'Cooling', laborHours: 1, laborRate: 95, partsMin: 50, partsMax: 80 },
                { id: 's10', name: 'Spark Plug Replacement', category: 'Ignition', laborHours: 1.5, laborRate: 100, partsMin: 60, partsMax: 150 }
            ];

            data.customers = [
                { id: 'c1', name: 'John Smith', email: 'john.smith@email.com', phone: '(903) 555-0101', address: '123 Main St, Tyler, TX', type: 'Individual', vehicles: ['v1'] },
                { id: 'c2', name: 'Sarah Davis', email: 'sarah.davis@email.com', phone: '(903) 555-0102', address: '456 Oak Ave, Tyler, TX', type: 'Individual', vehicles: ['v2'] },
                { id: 'c3', name: 'Mike Johnson', email: 'mike.j@email.com', phone: '(903) 555-0103', address: '789 Pine Rd, Tyler, TX', type: 'Individual', vehicles: ['v3'] },
                { id: 'c4', name: 'Tyler Delivery Co', email: 'fleet@tylerdelivery.com', phone: '(903) 555-0200', address: '1000 Industrial Blvd, Tyler, TX', type: 'Fleet', vehicles: ['v4', 'v5'] },
                { id: 'c5', name: 'Emma Wilson', email: 'emma.wilson@email.com', phone: '(903) 555-0104', address: '321 Elm St, Tyler, TX', type: 'Individual', vehicles: ['v6'] }
            ];

            data.vehicles = [
                { id: 'v1', customerId: 'c1', year: 2019, make: 'Honda', model: 'Accord', vin: '1HGCV1F30JA012345', mileage: 45230, color: 'Silver' },
                { id: 'v2', customerId: 'c2', year: 2021, make: 'Ford', model: 'F-150', vin: '1FTFW1E84MFA12345', mileage: 28450, color: 'Blue' },
                { id: 'v3', customerId: 'c3', year: 2018, make: 'Toyota', model: 'Camry', vin: '4T1BF1FK5JU012345', mileage: 62100, color: 'White' },
                { id: 'v4', customerId: 'c4', year: 2020, make: 'Ford', model: 'Transit', vin: '1FTBW3XM8LKA12345', mileage: 85000, color: 'White' },
                { id: 'v5', customerId: 'c4', year: 2020, make: 'Ford', model: 'Transit', vin: '1FTBW3XM8LKA67890', mileage: 78500, color: 'White' },
                { id: 'v6', customerId: 'c5', year: 2022, make: 'Tesla', model: 'Model 3', vin: '5YJ3E1EB1MF012345', mileage: 12500, color: 'Black' }
            ];

            data.bays = [
                { id: 'b1', number: 1, name: 'Bay 1', status: 'occupied', vehicleId: 'v1', roId: 'ro1' },
                { id: 'b2', number: 2, name: 'Bay 2', status: 'occupied', vehicleId: 'v2', roId: 'ro2' },
                { id: 'b3', number: 3, name: 'Bay 3', status: 'empty', vehicleId: null, roId: null },
                { id: 'b4', number: 4, name: 'Bay 4', status: 'occupied', vehicleId: 'v3', roId: 'ro3' },
                { id: 'b5', number: 5, name: 'Bay 5', status: 'empty', vehicleId: null, roId: null }
            ];

            data.repairOrders = [
                {
                    id: 'ro1',
                    number: 'RO-2024-001',
                    customerId: 'c1',
                    vehicleId: 'v1',
                    date: '2024-01-15',
                    status: 'In Progress',
                    complaint: 'Check engine light on, rough idle',
                    diagnosis: 'Faulty oxygen sensor, needs replacement',
                    tech: 'Carlos Martinez',
                    services: [
                        { serviceId: 's5', name: 'Engine Diagnostic', laborHours: 1, laborRate: 120, parts: 0 },
                        { serviceId: 's10', name: 'Spark Plug Replacement', laborHours: 1.5, laborRate: 100, parts: 120 }
                    ],
                    bayId: 'b1'
                },
                {
                    id: 'ro2',
                    number: 'RO-2024-002',
                    customerId: 'c2',
                    vehicleId: 'v2',
                    date: '2024-01-15',
                    status: 'Waiting Parts',
                    complaint: 'Squeaking brakes, soft pedal',
                    diagnosis: 'Brake pads worn, rotors need resurfacing',
                    tech: 'Marcus Johnson',
                    services: [
                        { serviceId: 's2', name: 'Brake Pads Replacement', laborHours: 2, laborRate: 95, parts: 275 }
                    ],
                    bayId: 'b2'
                },
                {
                    id: 'ro3',
                    number: 'RO-2024-003',
                    customerId: 'c3',
                    vehicleId: 'v3',
                    date: '2024-01-15',
                    status: 'In Progress',
                    complaint: 'Regular maintenance',
                    diagnosis: 'Oil change and tire rotation needed',
                    tech: 'Carlos Martinez',
                    services: [
                        { serviceId: 's1', name: 'Oil Change', laborHours: 0.5, laborRate: 90, parts: 35 },
                        { serviceId: 's7', name: 'Tire Rotation', laborHours: 0.5, laborRate: 70, parts: 0 }
                    ],
                    bayId: 'b4'
                }
            ];

            data.parts = [
                { id: 'p1', name: 'Brake Pads (Front)', partNumber: 'BP-1234-F', supplier: 'AutoZone', cost: 85, status: 'Ordered', orderedDate: '2024-01-14', expectedDate: '2024-01-16', roId: 'ro2' },
                { id: 'p2', name: 'Brake Rotors (Front)', partNumber: 'BR-5678-F', supplier: 'AutoZone', cost: 120, status: 'Ordered', orderedDate: '2024-01-14', expectedDate: '2024-01-16', roId: 'ro2' },
                { id: 'p3', name: 'Oil Filter', partNumber: 'OF-9012', supplier: 'NAPA', cost: 8, status: 'In Stock', orderedDate: '2024-01-10', expectedDate: '2024-01-12', roId: null },
                { id: 'p4', name: 'Air Filter', partNumber: 'AF-3456', supplier: 'NAPA', cost: 15, status: 'In Stock', orderedDate: '2024-01-10', expectedDate: '2024-01-12', roId: null },
                { id: 'p5', name: 'Spark Plugs (Set of 4)', partNumber: 'SP-7890-4', supplier: "O'Reilly", cost: 32, status: 'Installed', orderedDate: '2024-01-13', expectedDate: '2024-01-14', roId: 'ro1' }
            ];

            data.estimates = [
                {
                    id: 'est1',
                    number: 'EST-2024-001',
                    customerId: 'c5',
                    vehicleId: 'v6',
                    date: '2024-01-14',
                    status: 'Pending',
                    services: [
                        { serviceId: 's6', name: 'Battery Replacement', laborHours: 0.5, laborRate: 85, parts: 180 }
                    ],
                    notes: 'Customer will call back to schedule'
                }
            ];

            saveData();
        }

        // Data persistence
        function saveData() {
            localStorage.setItem('autoRepairData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('autoRepairData');
            if (saved) {
                data = JSON.parse(saved);
            } else {
                initializeSampleData();
            }
        }

        // Navigation
        function navigateTo(page) {
            currentPage = page;
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`[data-page="${page}"]`).classList.add('active');
            renderPage(page);
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('mobile-visible');
            }
        }

        function toggleMobileMenu() {
            document.getElementById('sidebar').classList.toggle('mobile-visible');
        }

        // Page Rendering
        function renderPage(page) {
            const content = document.getElementById('pageContent');
            switch(page) {
                case 'dashboard':
                    content.innerHTML = renderDashboard();
                    break;
                case 'repair-orders':
                    content.innerHTML = renderRepairOrders();
                    break;
                case 'customers':
                    content.innerHTML = renderCustomers();
                    break;
                case 'vehicle-history':
                    content.innerHTML = renderVehicleHistory();
                    break;
                case 'estimates':
                    content.innerHTML = renderEstimates();
                    break;
                case 'invoices':
                    content.innerHTML = renderInvoices();
                    break;
                case 'parts':
                    content.innerHTML = renderParts();
                    break;
                case 'bays':
                    content.innerHTML = renderBays();
                    break;
            }
        }

        // Dashboard
        function renderDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const todayROs = data.repairOrders.filter(ro => ro.date === today);
            const inProgress = data.repairOrders.filter(ro => ro.status === 'In Progress').length;
            const waitingParts = data.repairOrders.filter(ro => ro.status === 'Waiting Parts').length;
            const partsOrdered = data.parts.filter(p => p.status === 'Ordered').length;
            
            const todayRevenue = todayROs.reduce((sum, ro) => {
                return sum + ro.services.reduce((s, svc) => s + (svc.laborHours * svc.laborRate) + svc.parts, 0);
            }, 0);

            return `
                <div class="page-header">
                    <h2>Dashboard</h2>
                    <p>Real-time shop overview</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${inProgress}</div>
                        <div class="stat-label">Cars In Shop</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">$${todayRevenue.toFixed(2)}</div>
                        <div class="stat-label">Today's Revenue</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${waitingParts}</div>
                        <div class="stat-label">Waiting on Parts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${partsOrdered}</div>
                        <div class="stat-label">Parts on Order</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Bay Status</h3>
                    </div>
                    <div class="bay-grid">
                        ${data.bays.map(bay => renderBayCard(bay)).join('')}
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Active Repair Orders</h3>
                        <button class="btn btn-primary" onclick="openNewRepairOrderModal()">+ New RO</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>RO Number</th>
                                    <th>Customer</th>
                                    <th>Vehicle</th>
                                    <th>Status</th>
                                    <th>Tech</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.repairOrders.map(ro => {
                                    const customer = data.customers.find(c => c.id === ro.customerId);
                                    const vehicle = data.vehicles.find(v => v.id === ro.vehicleId);
                                    return `
                                        <tr>
                                            <td><strong>${ro.number}</strong></td>
                                            <td>${customer?.name || 'Unknown'}</td>
                                            <td>${vehicle ? `${vehicle.year} ${vehicle.make} ${vehicle.model}` : 'Unknown'}</td>
                                            <td><span class="badge badge-${ro.status === 'In Progress' ? 'info' : ro.status === 'Waiting Parts' ? 'warning' : 'success'}">${ro.status}</span></td>
                                            <td>${ro.tech}</td>
                                            <td>
                                                <button class="btn-icon" onclick="viewRepairOrder('${ro.id}')" title="View">👁️</button>
                                                <button class="btn-icon" onclick="editRepairOrder('${ro.id}')" title="Edit">✏️</button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function renderBayCard(bay) {
            if (bay.status === 'empty') {
                return `
                    <div class="bay-card empty">
                        <div class="bay-header">
                            <div class="bay-number">${bay.name}</div>
                            <span class="bay-status empty">Empty</span>
                        </div>
                        <p style="text-align:center; color: var(--text-secondary); margin-top: 20px;">Available</p>
                    </div>
                `;
            }

            const ro = data.repairOrders.find(r => r.id === bay.roId);
            const vehicle = data.vehicles.find(v => v.id === bay.vehicleId);
            const customer = data.customers.find(c => c.id === ro?.customerId);

            return `
                <div class="bay-card occupied">
                    <div class="bay-header">
                        <div class="bay-number">${bay.name}</div>
                        <span class="bay-status occupied">Occupied</span>
                    </div>
                    <div class="vehicle-info">
                        <div class="vehicle-make">${vehicle ? `${vehicle.year} ${vehicle.make} ${vehicle.model}` : 'Unknown Vehicle'}</div>
                        <div class="customer-name">${customer?.name || 'Unknown Customer'}</div>
                        <div class="service-type">${ro?.services[0]?.name || 'Service'} • ${ro?.tech}</div>
                    </div>
                </div>
            `;
        }

        // Repair Orders
        function renderRepairOrders() {
            return `
                <div class="page-header">
                    <h2>Repair Orders</h2>
                    <p>Manage all repair orders</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">All Repair Orders</h3>
                        <button class="btn btn-primary" onclick="openNewRepairOrderModal()">+ New Repair Order</button>
                    </div>
                    <div class="search-box">
                        <span class="search-icon">🔍</span>
                        <input type="text" class="search-input" placeholder="Search by RO number, customer, or vehicle..." oninput="filterRepairOrders(this.value)">
                    </div>
                    <div class="table-container" id="repairOrdersTable">
                        <table>
                            <thead>
                                <tr>
                                    <th>RO Number</th>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Vehicle</th>
                                    <th>Status</th>
                                    <th>Tech</th>
                                    <th>Total</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.repairOrders.map(ro => renderRepairOrderRow(ro)).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function renderRepairOrderRow(ro) {
            const customer = data.customers.find(c => c.id === ro.customerId);
            const vehicle = data.vehicles.find(v => v.id === ro.vehicleId);
            const total = ro.services.reduce((sum, svc) => sum + (svc.laborHours * svc.laborRate) + svc.parts, 0);
            
            return `
                <tr>
                    <td><strong>${ro.number}</strong></td>
                    <td>${ro.date}</td>
                    <td>${customer?.name || 'Unknown'}</td>
                    <td>${vehicle ? `${vehicle.year} ${vehicle.make} ${vehicle.model}` : 'Unknown'}</td>
                    <td><span class="badge badge-${ro.status === 'In Progress' ? 'info' : ro.status === 'Waiting Parts' ? 'warning' : 'success'}">${ro.status}</span></td>
                    <td>${ro.tech}</td>
                    <td><strong>$${total.toFixed(2)}</strong></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon" onclick="viewRepairOrder('${ro.id}')" title="View">👁️</button>
                            <button class="btn-icon" onclick="editRepairOrder('${ro.id}')" title="Edit">✏️</button>
                            <button class="btn-icon" onclick="deleteRepairOrder('${ro.id}')" title="Delete">🗑️</button>
                        </div>
                    </td>
                </tr>
            `;
        }

        function openNewRepairOrderModal() {
            showModal('New Repair Order', `
                <form onsubmit="saveNewRepairOrder(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Customer</label>
                            <select class="form-control" id="roCustomer" required onchange="updateVehicleOptions()">
                                <option value="">Select Customer</option>
                                ${data.customers.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Vehicle</label>
                            <select class="form-control" id="roVehicle" required>
                                <option value="">Select Vehicle</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Customer Complaint</label>
                        <textarea class="form-control" id="roComplaint" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Diagnosis</label>
                        <textarea class="form-control" id="roDiagnosis"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Assigned Technician</label>
                        <select class="form-control" id="roTech" required>
                            <option value="Carlos Martinez">Carlos Martinez</option>
                            <option value="Marcus Johnson">Marcus Johnson</option>
                            <option value="David Lee">David Lee</option>
                            <option value="James Wilson">James Wilson</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Services</label>
                        <div class="service-catalog">
                            ${data.services.map(s => `
                                <div class="service-catalog-item" onclick="toggleService('${s.id}', this)">
                                    <div class="service-catalog-name">${s.name}</div>
                                    <div class="service-catalog-price">$${(s.laborHours * s.laborRate + s.partsMin).toFixed(2)}+</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Repair Order</button>
                    </div>
                </form>
            `);
        }

        let selectedServices = [];

        function toggleService(serviceId, element) {
            element.classList.toggle('selected');
            const index = selectedServices.indexOf(serviceId);
            if (index > -1) {
                selectedServices.splice(index, 1);
            } else {
                selectedServices.push(serviceId);
            }
        }

        function updateVehicleOptions() {
            const customerId = document.getElementById('roCustomer').value;
            const vehicleSelect = document.getElementById('roVehicle');
            const customer = data.customers.find(c => c.id === customerId);
            
            if (customer) {
                const vehicles = data.vehicles.filter(v => customer.vehicles.includes(v.id));
                vehicleSelect.innerHTML = '<option value="">Select Vehicle</option>' + 
                    vehicles.map(v => `<option value="${v.id}">${v.year} ${v.make} ${v.model}</option>`).join('');
            }
        }

        function saveNewRepairOrder(event) {
            event.preventDefault();
            const customerId = document.getElementById('roCustomer').value;
            const vehicleId = document.getElementById('roVehicle').value;
            const complaint = document.getElementById('roComplaint').value;
            const diagnosis = document.getElementById('roDiagnosis').value;
            const tech = document.getElementById('roTech').value;

            const roNumber = `RO-${new Date().getFullYear()}-${String(data.repairOrders.length + 1).padStart(3, '0')}`;
            
            const services = selectedServices.map(sid => {
                const service = data.services.find(s => s.id === sid);
                return {
                    serviceId: service.id,
                    name: service.name,
                    laborHours: service.laborHours,
                    laborRate: service.laborRate,
                    parts: service.partsMin
                };
            });

            const newRO = {
                id: `ro${Date.now()}`,
                number: roNumber,
                customerId,
                vehicleId,
                date: new Date().toISOString().split('T')[0],
                status: 'In Progress',
                complaint,
                diagnosis,
                tech,
                services,
                bayId: null
            };

            data.repairOrders.push(newRO);
            saveData();
            selectedServices = [];
            closeModal();
            navigateTo('repair-orders');
        }

        function viewRepairOrder(id) {
            const ro = data.repairOrders.find(r => r.id === id);
            const customer = data.customers.find(c => c.id === ro.customerId);
            const vehicle = data.vehicles.find(v => v.id === ro.vehicleId);
            const total = ro.services.reduce((sum, svc) => sum + (svc.laborHours * svc.laborRate) + svc.parts, 0);
            
            showModal('Repair Order Details', `
                <div style="line-height: 2;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">${ro.number}</h3>
                    <p><strong>Date:</strong> ${ro.date}</p>
                    <p><strong>Status:</strong> <span class="badge badge-info">${ro.status}</span></p>
                    <p><strong>Customer:</strong> ${customer?.name}</p>
                    <p><strong>Vehicle:</strong> ${vehicle ? `${vehicle.year} ${vehicle.make} ${vehicle.model}` : 'Unknown'}</p>
                    <p><strong>VIN:</strong> ${vehicle?.vin}</p>
                    <p><strong>Mileage:</strong> ${vehicle?.mileage.toLocaleString()}</p>
                    <p><strong>Technician:</strong> ${ro.tech}</p>
                    <hr style="margin: 20px 0; border-color: var(--border);">
                    <p><strong>Customer Complaint:</strong></p>
                    <p style="color: var(--text-secondary);">${ro.complaint}</p>
                    <p><strong>Diagnosis:</strong></p>
                    <p style="color: var(--text-secondary);">${ro.diagnosis}</p>
                    <hr style="margin: 20px 0; border-color: var(--border);">
                    <h4>Services</h4>
                    ${ro.services.map(svc => `
                        <div class="service-item">
                            <div class="service-item-info">
                                <div class="service-item-name">${svc.name}</div>
                                <div class="service-item-details">Labor: ${svc.laborHours}h @ $${svc.laborRate}/h | Parts: $${svc.parts.toFixed(2)}</div>
                            </div>
                            <div class="service-item-price">$${((svc.laborHours * svc.laborRate) + svc.parts).toFixed(2)}</div>
                        </div>
                    `).join('')}
                    <div style="text-align: right; margin-top: 20px; font-size: 24px; color: var(--primary);">
                        <strong>Total: $${total.toFixed(2)}</strong>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal()">Close</button>
                    <button class="btn btn-primary" onclick="generateInvoice('${ro.id}')">Generate Invoice</button>
                </div>
            `);
        }

        function editRepairOrder(id) {
            // Simplified - in production would have full edit form
            alert('Edit functionality - would open edit form');
        }

        function deleteRepairOrder(id) {
            if (confirm('Are you sure you want to delete this repair order?')) {
                data.repairOrders = data.repairOrders.filter(ro => ro.id !== id);
                saveData();
                navigateTo('repair-orders');
            }
        }

        // Customers
        function renderCustomers() {
            return `
                <div class="page-header">
                    <h2>Customer Database</h2>
                    <p>Manage customer information and vehicles</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">All Customers</h3>
                        <button class="btn btn-primary" onclick="openNewCustomerModal()">+ New Customer</button>
                    </div>
                    <div class="search-box">
                        <span class="search-icon">🔍</span>
                        <input type="text" class="search-input" placeholder="Search customers...">
                    </div>
                    <div>
                        ${data.customers.map(customer => {
                            const vehicles = data.vehicles.filter(v => customer.vehicles.includes(v.id));
                            return `
                                <div class="customer-card">
                                    <div class="customer-avatar">${customer.name.charAt(0)}</div>
                                    <div class="customer-info">
                                        <h4>${customer.name}</h4>
                                        <div class="customer-meta">
                                            ${customer.phone} • ${customer.email}<br>
                                            ${customer.type} • ${vehicles.length} vehicle(s)
                                        </div>
                                    </div>
                                    <div class="action-buttons">
                                        <button class="btn-icon" onclick="viewCustomer('${customer.id}')">👁️</button>
                                        <button class="btn-icon" onclick="editCustomer('${customer.id}')">✏️</button>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function openNewCustomerModal() {
            showModal('New Customer', `
                <form onsubmit="saveNewCustomer(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Name</label>
                            <input type="text" class="form-control" id="custName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Type</label>
                            <select class="form-control" id="custType" required>
                                <option value="Individual">Individual</option>
                                <option value="Fleet">Fleet/Business</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="custEmail" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="custPhone" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Address</label>
                        <textarea class="form-control" id="custAddress" required></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Customer</button>
                    </div>
                </form>
            `);
        }

        function saveNewCustomer(event) {
            event.preventDefault();
            const newCustomer = {
                id: `c${Date.now()}`,
                name: document.getElementById('custName').value,
                email: document.getElementById('custEmail').value,
                phone: document.getElementById('custPhone').value,
                address: document.getElementById('custAddress').value,
                type: document.getElementById('custType').value,
                vehicles: []
            };
            data.customers.push(newCustomer);
            saveData();
            closeModal();
            navigateTo('customers');
        }

        function viewCustomer(id) {
            const customer = data.customers.find(c => c.id === id);
            const vehicles = data.vehicles.filter(v => customer.vehicles.includes(v.id));
            const customerROs = data.repairOrders.filter(ro => ro.customerId === id);
            
            showModal('Customer Details', `
                <div style="line-height: 2;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">${customer.name}</h3>
                    <p><strong>Type:</strong> <span class="badge badge-secondary">${customer.type}</span></p>
                    <p><strong>Email:</strong> ${customer.email}</p>
                    <p><strong>Phone:</strong> ${customer.phone}</p>
                    <p><strong>Address:</strong> ${customer.address}</p>
                    <hr style="margin: 20px 0; border-color: var(--border);">
                    <h4>Vehicles (${vehicles.length})</h4>
                    ${vehicles.map(v => `
                        <div class="service-item">
                            <div class="service-item-info">
                                <div class="service-item-name">${v.year} ${v.make} ${v.model}</div>
                                <div class="service-item-details">VIN: ${v.vin} • Mileage: ${v.mileage.toLocaleString()}</div>
                            </div>
                        </div>
                    `).join('')}
                    <hr style="margin: 20px 0; border-color: var(--border);">
                    <h4>Service History (${customerROs.length} orders)</h4>
                    ${customerROs.slice(0, 5).map(ro => {
                        const vehicle = data.vehicles.find(v => v.id === ro.vehicleId);
                        return `<p>• ${ro.number} - ${vehicle ? vehicle.make + ' ' + vehicle.model : 'Unknown'} - ${ro.date}</p>`;
                    }).join('')}
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal()">Close</button>
                    <button class="btn btn-primary" onclick="addVehicle('${customer.id}')">+ Add Vehicle</button>
                </div>
            `);
        }

        function editCustomer(id) {
            alert('Edit customer functionality');
        }

        function addVehicle(customerId) {
            showModal('Add Vehicle', `
                <form onsubmit="saveNewVehicle(event, '${customerId}')">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Year</label>
                            <input type="number" class="form-control" id="vehYear" min="1900" max="2025" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Make</label>
                            <input type="text" class="form-control" id="vehMake" required>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Model</label>
                            <input type="text" class="form-control" id="vehModel" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Color</label>
                            <input type="text" class="form-control" id="vehColor" required>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">VIN</label>
                            <input type="text" class="form-control" id="vehVin" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Current Mileage</label>
                            <input type="number" class="form-control" id="vehMileage" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Vehicle</button>
                    </div>
                </form>
            `);
        }

        function saveNewVehicle(event, customerId) {
            event.preventDefault();
            const newVehicle = {
                id: `v${Date.now()}`,
                customerId: customerId,
                year: parseInt(document.getElementById('vehYear').value),
                make: document.getElementById('vehMake').value,
                model: document.getElementById('vehModel').value,
                vin: document.getElementById('vehVin').value,
                mileage: parseInt(document.getElementById('vehMileage').value),
                color: document.getElementById('vehColor').value
            };
            data.vehicles.push(newVehicle);
            const customer = data.customers.find(c => c.id === customerId);
            customer.vehicles.push(newVehicle.id);
            saveData();
            closeModal();
            viewCustomer(customerId);
        }

        // Vehicle History
        function renderVehicleHistory() {
            return `
                <div class="page-header">
                    <h2>Vehicle History</h2>
                    <p>Complete service history for all vehicles</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Search Vehicle History</h3>
                    </div>
                    <div class="search-box">
                        <span class="search-icon">🔍</span>
                        <input type="text" class="search-input" placeholder="Search by VIN, customer name, or vehicle..." oninput="searchVehicleHistory(this.value)">
                    </div>
                    <div id="vehicleHistoryResults">
                        ${data.vehicles.map(vehicle => {
                            const customer = data.customers.find(c => c.vehicles.includes(vehicle.id));
                            const serviceHistory = data.repairOrders.filter(ro => ro.vehicleId === vehicle.id);
                            return `
                                <div class="card" style="margin-bottom: 20px;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                        <div>
                                            <h3 style="color: var(--primary); margin-bottom: 8px;">${vehicle.year} ${vehicle.make} ${vehicle.model}</h3>
                                            <p style="color: var(--text-secondary);">Owner: ${customer?.name || 'Unknown'}</p>
                                            <p style="color: var(--text-secondary);">VIN: ${vehicle.vin} • Mileage: ${vehicle.mileage.toLocaleString()}</p>
                                        </div>
                                        <span class="badge badge-info">${serviceHistory.length} Services</span>
                                    </div>
                                    ${serviceHistory.length > 0 ? `
                                        <div style="margin-top: 15px;">
                                            <h4 style="margin-bottom: 10px;">Service History</h4>
                                            ${serviceHistory.map(ro => `
                                                <div class="service-item">
                                                    <div class="service-item-info">
                                                        <div class="service-item-name">${ro.number} - ${ro.date}</div>
                                                        <div class="service-item-details">${ro.services.map(s => s.name).join(', ')}</div>
                                                    </div>
                                                    <button class="btn btn-outline" onclick="viewRepairOrder('${ro.id}')">View</button>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">No service history</p>'}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function searchVehicleHistory(query) {
            // Simple search implementation
            const results = document.getElementById('vehicleHistoryResults');
            if (!query) {
                navigateTo('vehicle-history');
                return;
            }
            // Filter logic would go here
        }

        // Estimates
        function renderEstimates() {
            return `
                <div class="page-header">
                    <h2>Estimates</h2>
                    <p>Build and manage customer estimates</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">All Estimates</h3>
                        <button class="btn btn-primary" onclick="openNewEstimateModal()">+ New Estimate</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Estimate #</th>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Vehicle</th>
                                    <th>Status</th>
                                    <th>Total</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.estimates.map(est => {
                                    const customer = data.customers.find(c => c.id === est.customerId);
                                    const vehicle = data.vehicles.find(v => v.id === est.vehicleId);
                                    const total = est.services.reduce((sum, svc) => sum + (svc.laborHours * svc.laborRate) + svc.parts, 0);
                                    return `
                                        <tr>
                                            <td><strong>${est.number}</strong></td>
                                            <td>${est.date}</td>
                                            <td>${customer?.name || 'Unknown'}</td>
                                            <td>${vehicle ? `${vehicle.year} ${vehicle.make} ${vehicle.model}` : 'Unknown'}</td>
                                            <td><span class="badge badge-warning">${est.status}</span></td>
                                            <td><strong>$${total.toFixed(2)}</strong></td>
                                            <td>
                                                <div class="action-buttons">
                                                    <button class="btn-icon" onclick="viewEstimate('${est.id}')">👁️</button>
                                                    <button class="btn-icon" onclick="convertToRO('${est.id}')">✓</button>
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function openNewEstimateModal() {
            alert('New estimate builder - similar to RO creation');
        }

        function viewEstimate(id) {
            alert('View estimate details');
        }

        function convertToRO(id) {
            if (confirm('Convert this estimate to a repair order?')) {
                // Convert logic
                alert('Would convert estimate to RO');
            }
        }

        // Invoices
        function renderInvoices() {
            return `
                <div class="page-header">
                    <h2>Invoices</h2>
                    <p>Generate and manage invoices</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">All Invoices</h3>
                    </div>
                    ${data.invoices.length === 0 ? `
                        <div class="empty-state">
                            <div class="empty-state-icon">🧾</div>
                            <h3>No Invoices Yet</h3>
                            <p>Invoices will appear here when you generate them from completed repair orders.</p>
                        </div>
                    ` : `
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Invoice #</th>
                                        <th>Date</th>
                                        <th>Customer</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.invoices.map(inv => {
                                        const customer = data.customers.find(c => c.id === inv.customerId);
                                        return `
                                            <tr>
                                                <td><strong>${inv.number}</strong></td>
                                                <td>${inv.date}</td>
                                                <td>${customer?.name || 'Unknown'}</td>
                                                <td><strong>$${inv.total.toFixed(2)}</strong></td>
                                                <td><span class="badge badge-${inv.paid ? 'success' : 'warning'}">${inv.paid ? 'Paid' : 'Unpaid'}</span></td>
                                                <td>
                                                    <button class="btn-icon" onclick="viewInvoice('${inv.id}')">👁️</button>
                                                    <button class="btn-icon" onclick="printInvoice('${inv.id}')">🖨️</button>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    `}
                </div>
            `;
        }

        function generateInvoice(roId) {
            const ro = data.repairOrders.find(r => r.id === roId);
            const customer = data.customers.find(c => c.id === ro.customerId);
            const vehicle = data.vehicles.find(v => v.id === ro.vehicleId);
            
            const subtotal = ro.services.reduce((sum, svc) => sum + (svc.laborHours * svc.laborRate) + svc.parts, 0);
            const tax = subtotal * 0.0825; // 8.25% Texas sales tax
            const total = subtotal + tax;

            const invoice = {
                id: `inv${Date.now()}`,
                number: `INV-${new Date().getFullYear()}-${String(data.invoices.length + 1).padStart(3, '0')}`,
                date: new Date().toISOString().split('T')[0],
                roId: ro.id,
                customerId: ro.customerId,
                vehicleId: ro.vehicleId,
                services: ro.services,
                subtotal,
                tax,
                total,
                paid: false
            };

            data.invoices.push(invoice);
            saveData();
            
            closeModal();
            viewInvoice(invoice.id);
        }

        function viewInvoice(id) {
            const invoice = data.invoices.find(inv => inv.id === id);
            const customer = data.customers.find(c => c.id === invoice.customerId);
            const vehicle = data.vehicles.find(v => v.id === invoice.vehicleId);
            
            showModal('Invoice', `
                <div class="invoice-print">
                    <div class="invoice-header">
                        <div class="invoice-logo">
                            <div class="invoice-logo-img">${config.logo ? `<img src="${config.logo}" style="width:100%; height:100%; object-fit:cover; border-radius:8px;">` : '🔧'}</div>
                            <div class="invoice-company">
                                <h2>${config.business}</h2>
                                <p>${config.tagline}</p>
                                <p>${config.phone ? config.phone : ''} ${config.city ? '• ' + config.city : ''}</p>
                            </div>
                        </div>
                        <div class="invoice-details">
                            <div class="invoice-number">${invoice.number}</div>
                            <p>Date: ${invoice.date}</p>
                            <p>RO: ${data.repairOrders.find(ro => ro.id === invoice.roId)?.number}</p>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                        <div>
                            <h4 style="margin-bottom: 10px;">Bill To:</h4>
                            <p><strong>${customer.name}</strong></p>
                            <p>${customer.phone}</p>
                            <p>${customer.email}</p>
                            <p>${customer.address}</p>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 10px;">Vehicle:</h4>
                            <p><strong>${vehicle.year} ${vehicle.make} ${vehicle.model}</strong></p>
                            <p>VIN: ${vehicle.vin}</p>
                            <p>Mileage: ${vehicle.mileage.toLocaleString()}</p>
                        </div>
                    </div>

                    <table style="margin-bottom: 20px;">
                        <thead>
                            <tr>
                                <th>Service</th>
                                <th>Labor Hours</th>
                                <th>Rate</th>
                                <th>Parts</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${invoice.services.map(svc => `
                                <tr>
                                    <td>${svc.name}</td>
                                    <td>${svc.laborHours}h</td>
                                    <td>$${svc.laborRate.toFixed(2)}</td>
                                    <td>$${svc.parts.toFixed(2)}</td>
                                    <td><strong>$${((svc.laborHours * svc.laborRate) + svc.parts).toFixed(2)}</strong></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>

                    <div class="invoice-summary">
                        <div class="invoice-summary-row">
                            <span>Subtotal:</span>
                            <span>$${invoice.subtotal.toFixed(2)}</span>
                        </div>
                        <div class="invoice-summary-row">
                            <span>Tax (8.25%):</span>
                            <span>$${invoice.tax.toFixed(2)}</span>
                        </div>
                        <div class="invoice-summary-row total">
                            <span>Total:</span>
                            <span>$${invoice.total.toFixed(2)}</span>
                        </div>
                    </div>

                    <div style="margin-top: 30px; padding: 15px; background: var(--bg-hover); border-radius: 8px;">
                        <p style="font-size: 12px; color: var(--text-secondary);">
                            <strong>Warranty:</strong> All parts and labor are warranted for 90 days or 3,000 miles, whichever comes first.
                            Thank you for your business!
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal()">Close</button>
                    <button class="btn btn-primary" onclick="printInvoice('${invoice.id}')">🖨️ Print</button>
                </div>
            `);
        }

        function printInvoice(id) {
            window.print();
        }

        // Parts Tracker
        function renderParts() {
            return `
                <div class="page-header">
                    <h2>Parts Tracker</h2>
                    <p>Track parts orders and inventory</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Parts Inventory</h3>
                        <button class="btn btn-primary" onclick="openNewPartModal()">+ Order Part</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Part Name</th>
                                    <th>Part Number</th>
                                    <th>Supplier</th>
                                    <th>Cost</th>
                                    <th>Status</th>
                                    <th>Ordered</th>
                                    <th>Expected</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.parts.map(part => `
                                    <tr>
                                        <td><strong>${part.name}</strong></td>
                                        <td>${part.partNumber}</td>
                                        <td>${part.supplier}</td>
                                        <td>$${part.cost.toFixed(2)}</td>
                                        <td><span class="badge badge-${part.status === 'Ordered' ? 'warning' : part.status === 'In Stock' ? 'success' : 'info'}">${part.status}</span></td>
                                        <td>${part.orderedDate}</td>
                                        <td>${part.expectedDate || '-'}</td>
                                        <td>
                                            <button class="btn-icon" onclick="updatePartStatus('${part.id}')">✏️</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function openNewPartModal() {
            showModal('Order New Part', `
                <form onsubmit="saveNewPart(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Part Name</label>
                            <input type="text" class="form-control" id="partName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Part Number</label>
                            <input type="text" class="form-control" id="partNumber" required>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Supplier</label>
                            <select class="form-control" id="partSupplier" required>
                                <option value="AutoZone">AutoZone</option>
                                <option value="NAPA">NAPA</option>
                                <option value="O'Reilly">O'Reilly</option>
                                <option value="Advance Auto">Advance Auto</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Cost</label>
                            <input type="number" step="0.01" class="form-control" id="partCost" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Expected Delivery Date</label>
                        <input type="date" class="form-control" id="partExpected" required>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Order Part</button>
                    </div>
                </form>
            `);
        }

        function saveNewPart(event) {
            event.preventDefault();
            const newPart = {
                id: `p${Date.now()}`,
                name: document.getElementById('partName').value,
                partNumber: document.getElementById('partNumber').value,
                supplier: document.getElementById('partSupplier').value,
                cost: parseFloat(document.getElementById('partCost').value),
                status: 'Ordered',
                orderedDate: new Date().toISOString().split('T')[0],
                expectedDate: document.getElementById('partExpected').value,
                roId: null
            };
            data.parts.push(newPart);
            saveData();
            closeModal();
            navigateTo('parts');
        }

        function updatePartStatus(id) {
            const part = data.parts.find(p => p.id === id);
            const newStatus = prompt('Update status:\n1. Ordered\n2. In Stock\n3. Installed', part.status);
            if (newStatus) {
                part.status = newStatus;
                saveData();
                navigateTo('parts');
            }
        }

        // Bay Management
        function renderBays() {
            return `
                <div class="page-header">
                    <h2>Bay Management</h2>
                    <p>Visual shop floor management</p>
                </div>

                <div class="bay-grid">
                    ${data.bays.map(bay => renderBayCard(bay)).join('')}
                </div>
            `;
        }

        // Modal System
        function showModal(title, content) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'activeModal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title">${title}</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        ${content}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeModal() {
            const modal = document.getElementById('activeModal');
            if (modal) {
                modal.remove();
            }
            selectedServices = [];
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            parseUrlParams();
            loadData();
            
            // Setup navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    navigateTo(page);
                });
            });

            // Initial render
            renderPage('dashboard');
        });

        // Close modal on background click
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                closeModal();
            }
        });
    </script>
<script>// Anti-scrape protection — injected into all tool pages
(function(){
  // Disable right-click context menu

  
  
  // Disable text selection on body (forms still selectable)
  
  
  // Re-enable for inputs/textareas
  document.querySelectorAll('input,textarea,select').forEach(function(el){
    el.style.userSelect = 'auto'; el.style.webkitUserSelect = 'auto';
  });
  
  // Disable drag
  document.addEventListener('dragstart', function(e){ e.preventDefault(); });
  
  // Disable print
  var style = document.createElement('style');
  style.textContent = '@media print { body { display: none !important; } }';
  document.head.appendChild(style);
  
  // Add invisible watermark
  var wm = document.createElement('div');
  wm.style.cssText = 'position:fixed;bottom:0;right:0;opacity:0.03;font-size:10px;pointer-events:none;z-index:99999;color:#000;';
  wm.textContent = 'Licensed demo — bennycutools.com — ' + new Date().toISOString().slice(0,10);
  document.body.appendChild(wm);
  
  // Detect devtools (basic)
  var threshold = 160;
  setInterval(function(){
    if (window.outerWidth - window.innerWidth > threshold || window.outerHeight - window.innerHeight > threshold) {
      document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;"><h1>This demo is proprietary. Please contact ben@bennycutools.com for licensing.</h1></div>';
    }
  }, 1000);
})();
</script>

<!-- BennyCuTools Purchase CTA — injected by inject-cta.py -->
<style>
#bct-cta-bar {
  position: fixed;
  bottom: 48px;
  left: 0;
  right: 0;
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  border-top: 2px solid #6366f1;
  padding: 10px 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  z-index: 99998;
  flex-wrap: wrap;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
}
#bct-cta-bar .bct-cta-text {
  color: #e4e4e7;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 14px;
  font-weight: 500;
}
#bct-cta-bar .bct-cta-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 20px;
  background: #6366f1;
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 14px;
  font-weight: 600;
  border: none;
  border-radius: 6px;
  text-decoration: none;
  cursor: pointer;
  transition: background 0.2s, transform 0.1s;
}
#bct-cta-bar .bct-cta-btn:hover {
  background: #4f46e5;
  transform: translateY(-1px);
}
#bct-cta-bar .bct-cta-btn-secondary {
  background: transparent;
  border: 1px solid #6366f1;
  color: #a5b4fc;
}
#bct-cta-bar .bct-cta-btn-secondary:hover {
  background: rgba(99,102,241,0.15);
}
@media (max-width: 600px) {
  #bct-cta-bar {
    flex-direction: column;
    gap: 8px;
    padding: 8px 12px;
    bottom: 44px;
  }
  #bct-cta-bar .bct-cta-text { font-size: 12px; }
  #bct-cta-bar .bct-cta-btn { font-size: 13px; padding: 7px 16px; width: 100%; justify-content: center; }
}
</style>
<div id="bct-cta-bar" role="banner" aria-label="Purchase this tool">
  <span class="bct-cta-text">Like this tool? Make it yours.</span>
  <a class="bct-cta-btn" id="bct-buy-btn" href="https://bennycutools.com/buy.html">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
    Get It — $200 One-Time
  </a>
  <a class="bct-cta-btn bct-cta-btn-secondary" href="mailto:cuuper225@gmail.com?subject=Question%20about%20my%20custom%20tool">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
    Questions? Email Ben
  </a>
</div>
<script>
// Auto-fill the buy link with the current tool's page name
(function(){
  try {
    var pg = location.pathname.replace(/.*\//, '').replace('.html','');
    var buyBtn = document.getElementById('bct-buy-btn');
    if (buyBtn && pg) {
      buyBtn.href = 'https://bennycutools.com/buy.html?tool=' + encodeURIComponent(pg);
    }
  } catch(e){}
})();
</script>
<!-- End BennyCuTools Purchase CTA -->

</body>
</html>