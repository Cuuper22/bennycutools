<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Chimney Log — Clean Sweep Chimney Sweep</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --black: #000000;
            --white: #FFFFFF;
            --gray-100: #F8F9FA;
            --gray-200: #E9ECEF;
            --gray-300: #DEE2E6;
            --gray-400: #CED4DA;
            --gray-500: #ADB5BD;
            --gray-600: #6C757D;
            --gray-700: #495057;
            --gray-800: #343A40;
            --gray-900: #212529;
            --chimney-orange: #D4694A;
            --chimney-orange-light: #E8A08D;
            --chimney-orange-dark: #B5543A;
            --safety-blue: #2C5282;
            --safety-blue-light: #4A7AB8;
            --success: #28A745;
            --warning: #FFC107;
            --danger: #DC3545;
            --bg-primary: var(--white);
            --bg-secondary: var(--gray-100);
            --bg-card: var(--white);
            --text-primary: var(--gray-900);
            --text-secondary: var(--gray-600);
            --text-muted: var(--gray-500);
            --border-color: var(--gray-200);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --font-family: 'Work Sans', system-ui, -apple-system, sans-serif;
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
        }

        [data-theme="dark"] {
            --bg-primary: #121212;
            --bg-secondary: #1E1E1E;
            --bg-card: #252525;
            --text-primary: #F5F5F5;
            --text-secondary: #A0A0A0;
            --text-muted: #707070;
            --border-color: #333333;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.5);
            --gray-100: #1E1E1E;
            --gray-200: #2D2D2D;
            --gray-300: #404040;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body { padding-bottom: 80px;
            height: 100%;
            overflow: hidden;
        }

        body { padding-bottom: 80px;
            font-family: var(--font-family);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
        }

        /* App Container */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: 100dvh;
            max-width: 100%;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .app-container {
                max-width: 480px;
                border-left: 1px solid var(--border-color);
                border-right: 1px solid var(--border-color);
            }
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
            min-height: 60px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--black);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 20px;
        }

        [data-theme="dark"] .logo-icon {
            background: var(--chimney-orange);
        }

        .header-title {
            font-weight: 600;
            font-size: 18px;
            letter-spacing: -0.3px;
        }

        .header-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 44px;
            height: 44px;
            border: none;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 20px;
            transition: all var(--transition-fast);
        }

        .icon-btn:hover {
            background: var(--gray-200);
        }

        .icon-btn:active {
            transform: scale(0.95);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 16px;
            padding-bottom: 100px;
            -webkit-overflow-scrolling: touch;
        }

        /* View Containers */
        .view {
            display: none;
            animation: fadeIn 0.2s ease;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Bottom Navigation */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 12px;
            padding-bottom: max(8px, env(safe-area-inset-bottom));
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }

        @media (min-width: 768px) {
            .bottom-nav {
                left: 50%;
                transform: translateX(-50%);
                max-width: 480px;
            }
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            border: none;
            background: none;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 11px;
            font-weight: 500;
            font-family: var(--font-family);
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            min-width: 64px;
        }

        .nav-item:active {
            transform: scale(0.95);
        }

        .nav-item.active {
            color: var(--chimney-orange);
        }

        .nav-item .nav-icon {
            font-size: 24px;
            line-height: 1;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-badge {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 100px;
            background: var(--chimney-orange-light);
            color: var(--chimney-orange-dark);
        }

        [data-theme="dark"] .card-badge {
            background: rgba(212, 105, 74, 0.2);
            color: var(--chimney-orange);
        }

        /* Welcome Card */
        .welcome-card {
            background: linear-gradient(135deg, var(--black) 0%, var(--gray-800) 100%);
            color: var(--white);
            padding: 24px;
            border-radius: var(--radius-xl);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .welcome-card {
            background: linear-gradient(135deg, var(--chimney-orange-dark) 0%, var(--chimney-orange) 100%);
        }

        .welcome-card::before {
            content: '<svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>';
            position: absolute;
            right: -10px;
            bottom: -10px;
            font-size: 100px;
            opacity: 0.1;
        }

        .welcome-greeting {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 4px;
        }

        .welcome-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .welcome-subtitle {
            font-size: 14px;
            opacity: 0.8;
            line-height: 1.4;
        }

        .welcome-stats {
            display: flex;
            gap: 24px;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .stat-item {
            text-align: left;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            line-height: 1;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 4px;
        }

        /* Demo Banner */
        .demo-banner {
            background: linear-gradient(135deg, var(--safety-blue) 0%, var(--safety-blue-light) 100%);
            color: var(--white);
            padding: 14px 16px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .demo-banner-text {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .demo-banner button {
            background: rgba(255,255,255,0.2);
            border: none;
            color: var(--white);
            padding: 8px 14px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            font-family: var(--font-family);
            transition: background var(--transition-fast);
        }

        .demo-banner button:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .quick-action {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-family: var(--font-family);
        }

        .quick-action:hover {
            border-color: var(--chimney-orange);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .quick-action:active {
            transform: scale(0.98);
        }

        .quick-action-icon {
            width: 52px;
            height: 52px;
            background: var(--gray-100);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
        }

        .quick-action-primary .quick-action-icon {
            background: var(--chimney-orange);
            color: var(--white);
        }

        .quick-action-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            text-align: center;
        }

        /* Customer List */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.3px;
        }

        .section-link {
            font-size: 14px;
            font-weight: 600;
            color: var(--chimney-orange);
            text-decoration: none;
            cursor: pointer;
        }

        .customer-item {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 16px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 14px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .customer-item:hover {
            border-color: var(--chimney-orange);
            box-shadow: var(--shadow-sm);
        }

        .customer-item:active {
            transform: scale(0.99);
        }

        .customer-avatar {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            background: var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .customer-overdue .customer-avatar {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }

        .customer-due .customer-avatar {
            background: rgba(255, 193, 7, 0.15);
            color: #B38600;
        }

        .customer-info {
            flex: 1;
            min-width: 0;
        }

        .customer-name {
            font-weight: 600;
            font-size: 15px;
            color: var(--text-primary);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .customer-address {
            font-size: 13px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .customer-status {
            font-size: 11px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 100px;
            background: var(--gray-200);
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .customer-status.overdue {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }

        .customer-status.due-soon {
            background: rgba(255, 193, 7, 0.15);
            color: #B38600;
        }

        .customer-status.ok {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 14px 16px;
            font-size: 16px;
            font-family: var(--font-family);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: border-color var(--transition-fast);
            -webkit-appearance: none;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--chimney-orange);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%236C757D' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 44px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .form-hint {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 6px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 24px;
            font-size: 16px;
            font-weight: 600;
            font-family: var(--font-family);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            min-height: 52px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: var(--chimney-orange);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--chimney-orange-dark);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--text-primary);
        }

        .btn-outline:hover {
            border-color: var(--chimney-orange);
            color: var(--chimney-orange);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-block {
            width: 100%;
        }

        .btn-sm {
            padding: 10px 16px;
            font-size: 14px;
            min-height: 40px;
        }

        /* Inspection Form */
        .inspection-section {
            margin-bottom: 24px;
        }

        .inspection-section-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--chimney-orange);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--chimney-orange);
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: 8px;
        }

        .checklist-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--gray-400);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            flex-shrink: 0;
            margin-top: 2px;
        }

        .checklist-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
            color: var(--white);
        }

        .checklist-checkbox.issue {
            background: var(--warning);
            border-color: var(--warning);
            color: var(--black);
        }

        .checklist-content {
            flex: 1;
        }

        .checklist-label {
            font-weight: 600;
            font-size: 15px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .checklist-description {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .checklist-actions {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }

        .checklist-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            transition: all var(--transition-fast);
        }

        .checklist-btn-ok {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }

        .checklist-btn-ok:hover, .checklist-btn-ok.active {
            background: var(--success);
            color: var(--white);
        }

        .checklist-btn-issue {
            background: rgba(255, 193, 7, 0.1);
            color: #B38600;
        }

        .checklist-btn-issue:hover, .checklist-btn-issue.active {
            background: var(--warning);
            color: var(--black);
        }

        /* Photos */
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
        }

        .photo-item {
            aspect-ratio: 1;
            border-radius: var(--radius-md);
            overflow: hidden;
            position: relative;
            background: var(--gray-200);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-item-delete {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            border: none;
            background: var(--danger);
            color: var(--white);
            border-radius: 50%;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .photo-add {
            aspect-ratio: 1;
            border: 2px dashed var(--gray-400);
            border-radius: var(--radius-md);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 500;
            transition: all var(--transition-fast);
        }

        .photo-add:hover {
            border-color: var(--chimney-orange);
            color: var(--chimney-orange);
        }

        .photo-add-icon {
            font-size: 28px;
        }

        /* Recommendations */
        .recommendation-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .recommendation-chip {
            padding: 10px 14px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 100px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-family: var(--font-family);
        }

        .recommendation-chip:hover, .recommendation-chip.selected {
            background: var(--chimney-orange);
            border-color: var(--chimney-orange);
            color: var(--white);
        }

        /* Customer Detail */
        .detail-header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-avatar {
            width: 80px;
            height: 80px;
            border-radius: var(--radius-lg);
            background: var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 700;
            color: var(--text-secondary);
            margin: 0 auto 16px;
        }

        .detail-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .detail-address {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .detail-actions {
            display: flex;
            gap: 10px;
            margin-top: 16px;
            justify-content: center;
        }

        .detail-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 20px;
            background: var(--bg-secondary);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-family: var(--font-family);
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }

        .detail-btn:hover {
            background: var(--gray-200);
        }

        .detail-btn-icon {
            font-size: 20px;
        }

        .detail-btn-label {
            font-size: 12px;
            font-weight: 500;
        }

        /* Service History */
        .history-item {
            display: flex;
            gap: 14px;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-icon {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-md);
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .history-content {
            flex: 1;
        }

        .history-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .history-date {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .history-findings {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 8px;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.6;
        }

        .empty-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .empty-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .empty-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            pointer-events: none;
        }

        .toast {
            background: var(--gray-900);
            color: var(--white);
            padding: 14px 20px;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 500;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: toastIn 0.3s ease;
            pointer-events: auto;
            max-width: 340px;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        .toast-undo {
            background: rgba(255,255,255,0.2);
            border: none;
            color: var(--white);
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            font-family: var(--font-family);
        }

        @keyframes toastIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: flex-end;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-card);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            width: 100%;
            max-width: 480px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform var(--transition-normal);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 1;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--gray-200);
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
        }

        .modal-content {
            padding: 20px;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
        }

        /* Settings */
        .settings-section {
            margin-bottom: 24px;
        }

        .settings-section-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            margin-bottom: 8px;
        }

        .settings-item-label {
            font-weight: 500;
        }

        .settings-item-description {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        /* Toggle Switch */
        .toggle {
            position: relative;
            width: 52px;
            height: 32px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: var(--gray-300);
            border-radius: 100px;
            transition: var(--transition-fast);
        }

        .toggle-slider::before {
            position: absolute;
            content: "";
            width: 26px;
            height: 26px;
            left: 3px;
            bottom: 3px;
            background: var(--white);
            border-radius: 50%;
            transition: var(--transition-fast);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle input:checked + .toggle-slider {
            background: var(--chimney-orange);
        }

        .toggle input:checked + .toggle-slider::before {
            transform: translateX(20px);
        }

        /* Search */
        .search-container {
            position: relative;
            margin-bottom: 16px;
        }

        .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-muted);
        }

        .search-input {
            width: 100%;
            padding: 14px 16px 14px 44px;
            font-size: 16px;
            font-family: var(--font-family);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--chimney-orange);
            background: var(--bg-primary);
        }

        /* Filter Tabs */
        .filter-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .filter-tab {
            padding: 10px 16px;
            border: none;
            background: var(--bg-secondary);
            border-radius: 100px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            color: var(--text-secondary);
            font-family: var(--font-family);
            transition: all var(--transition-fast);
        }

        .filter-tab.active {
            background: var(--chimney-orange);
            color: var(--white);
        }

        /* Back Button */
        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 0;
            border: none;
            background: none;
            font-size: 15px;
            font-weight: 600;
            color: var(--chimney-orange);
            cursor: pointer;
            font-family: var(--font-family);
            margin-bottom: 16px;
        }

        /* Signature Pad */
        .signature-pad-container {
            background: var(--bg-secondary);
            border: 2px dashed var(--gray-400);
            border-radius: var(--radius-md);
            padding: 12px;
            text-align: center;
        }

        .signature-pad {
            width: 100%;
            height: 150px;
            background: var(--white);
            border-radius: var(--radius-sm);
            cursor: crosshair;
            touch-action: none;
        }

        .signature-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        /* Print Styles */
        @media print {
            .header, .bottom-nav, .toast-container, .modal-overlay,
            .btn, .quick-actions, .search-container, .filter-tabs {
                display: none !important;
            }

            .app-container {
                max-width: 100% !important;
                border: none !important;
            }

            .main-content {
                padding: 0 !important;
                overflow: visible !important;
            }

            .view {
                display: block !important;
            }

            body { padding-bottom: 80px;
                background: white !important;
                color: black !important;
            }

            .card {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
                page-break-inside: avoid;
            }

            .customer-item {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
            }

            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 20px;
                padding-bottom: 20px;
                border-bottom: 2px solid #000;
            }

            .print-header h1 {
                font-size: 24px;
                margin-bottom: 4px;
            }

            .print-header p {
                font-size: 14px;
                color: #666;
            }
        }

        .print-header {
            display: none;
        }

        /* Loading State */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--chimney-orange);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 40px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Skip Link Accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #c8a96e;
            color: #fff;
            padding: 8px 16px;
            z-index: 9999;
            font-weight: 600;
            transition: top .15s;
            text-decoration: none;
        }
        .skip-link:focus {
            top: 0;
        }

        /* Reports View */
        .report-preview {
            background: var(--white);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 24px;
            margin-bottom: 16px;
        }

        [data-theme="dark"] .report-preview {
            background: var(--gray-100);
        }

        .report-header {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--black);
        }

        .report-logo {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .report-company {
            font-size: 20px;
            font-weight: 700;
        }

        .report-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .report-section {
            margin-bottom: 20px;
        }

        .report-section-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--chimney-orange);
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .report-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        .report-row:last-child {
            border-bottom: none;
        }

        .report-label {
            color: var(--text-secondary);
        }

        .report-value {
            font-weight: 500;
        }

        .report-findings {
            background: var(--bg-secondary);
            padding: 12px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            line-height: 1.6;
        }

        .report-signature {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            gap: 40px;
        }

        .report-sig-block {
            flex: 1;
        }

        .report-sig-line {
            border-bottom: 1px solid var(--black);
            height: 40px;
            margin-bottom: 4px;
        }

        .report-sig-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Creosote Level Indicator */
        .creosote-indicator {
            display: flex;
            gap: 4px;
            margin-top: 8px;
        }

        .creosote-bar {
            flex: 1;
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
        }

        .creosote-bar.level-1 { background: var(--success); }
        .creosote-bar.level-2 { background: var(--warning); }
        .creosote-bar.level-3 { background: var(--danger); }

        /* Notes Input Voice */
        .voice-input-container {
            position: relative;
        }

        .voice-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 36px;
            height: 36px;
            border: none;
            background: var(--gray-200);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: var(--text-secondary);
            transition: all var(--transition-fast);
        }

        .voice-btn.recording {
            background: var(--danger);
            color: var(--white);
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.1); }
        }

        /* Pricing Quick Select */
        .price-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .price-option {
            padding: 8px 14px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 100px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            font-family: var(--font-family);
            transition: all var(--transition-fast);
        }

        .price-option:hover, .price-option.selected {
            border-color: var(--chimney-orange);
            background: var(--chimney-orange);
            color: var(--white);
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></div>
                <div>
                    <div class="header-title">The Chimney Log</div>
                    <div class="header-subtitle">Clean Sweep Chimney Sweep</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-btn" onclick="toggleTheme()" title="Toggle dark mode"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></button>
                <button class="icon-btn" onclick="showSettings()" title="Settings"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82V9a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>️</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content" id="main-content">
            <!-- Print Header (only visible when printing) -->
            <div class="print-header">
                <h1>Clean Sweep Chimney Sweep</h1>
                <p>CSIA Certified • 453 Fire Tower Rd, Prosperity, SC 29127 • (803) 364-0962</p>
            </div>

            <!-- Home View -->
            <div id="home-view" class="view active">
                <!-- Demo Banner -->
                <div class="demo-banner" id="demo-banner" style="display: none;">
                    <div class="demo-banner-text">
                        <span><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg></span>
                        <span>Viewing demo data</span>
                    </div>
                    <button onclick="clearDemoData()">Clear Demo</button>
                </div>

                <!-- Welcome Card -->
                <div class="welcome-card">
                    <div class="welcome-greeting" id="greeting">Good morning, Ashley</div>
                    <div class="welcome-title">Ready for inspections?</div>
                    <div class="welcome-subtitle">Keep your customers' homes safe and warm</div>
                    <div class="welcome-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="stat-customers">0</div>
                            <div class="stat-label">Customers</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="stat-due">0</div>
                            <div class="stat-label">Due Soon</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="stat-inspections">0</div>
                            <div class="stat-label">This Year</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button class="quick-action quick-action-primary" onclick="startNewInspection()">
                        <div class="quick-action-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg></div>
                        <div class="quick-action-label">New Inspection</div>
                    </button>
                    <button class="quick-action" onclick="showAddCustomer()">
                        <div class="quick-action-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
                        <div class="quick-action-label">Add Customer</div>
                    </button>
                </div>

                <!-- Due for Service -->
                <div class="section-header">
                    <h2 class="section-title"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0"/></svg> Due for Service</h2>
                    <a class="section-link" onclick="showCustomers('due')">See All</a>
                </div>
                <div id="due-customers-list">
                    <!-- Populated by JS -->
                </div>

                <!-- Recent Customers -->
                <div class="section-header" style="margin-top: 24px;">
                    <h2 class="section-title">Recent Customers</h2>
                    <a class="section-link" onclick="showCustomers()">See All</a>
                </div>
                <div id="recent-customers-list">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Customers View -->
            <div id="customers-view" class="view">
                <div class="search-container">
                    <span class="search-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg></span>
                    <input type="text" class="search-input" id="customer-search" placeholder="Search customers..." oninput="filterCustomers()">
                </div>
                <div class="filter-tabs">
                    <button class="filter-tab active" data-filter="all" onclick="setCustomerFilter('all')">All</button>
                    <button class="filter-tab" data-filter="overdue" onclick="setCustomerFilter('overdue')"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0zM12 9v4M12 17h.01"/></svg> Overdue</button>
                    <button class="filter-tab" data-filter="due" onclick="setCustomerFilter('due')"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg> Due Soon</button>
                    <button class="filter-tab" data-filter="ok" onclick="setCustomerFilter('ok')"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Up to Date</button>
                </div>
                <div id="customers-list">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Customer Detail View -->
            <div id="customer-detail-view" class="view">
                <button class="back-btn" onclick="goBack()">← Back</button>
                <div id="customer-detail-content">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Inspection View -->
            <div id="inspection-view" class="view">
                <button class="back-btn" onclick="cancelInspection()">← Cancel</button>
                <div id="inspection-content">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Reports View -->
            <div id="reports-view" class="view">
                <h2 class="section-title" style="margin-bottom: 16px;">Inspection Reports</h2>
                <div id="reports-list">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Settings View -->
            <div id="settings-view" class="view">
                <h2 class="section-title" style="margin-bottom: 20px;">Settings</h2>

                <div class="settings-section">
                    <div class="settings-section-title">Appearance</div>
                    <div class="settings-item">
                        <div>
                            <div class="settings-item-label">Dark Mode</div>
                            <div class="settings-item-description">For low-light inspections</div>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="dark-mode-toggle" onchange="toggleTheme()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">Default Pricing</div>
                    <div class="card">
                        <div class="form-group">
                            <label class="form-label">Level 1 Inspection</label>
                            <input type="number" class="form-input" id="price-inspection" value="150" placeholder="150">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Chimney Cleaning</label>
                            <input type="number" class="form-input" id="price-cleaning" value="175" placeholder="175">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Dryer Vent Cleaning</label>
                            <input type="number" class="form-input" id="price-dryer" value="125" placeholder="125">
                        </div>
                        <button class="btn btn-secondary btn-block" onclick="savePricing()">Save Pricing</button>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">Data Management</div>
                    <div class="settings-item" style="flex-direction: column; gap: 12px; align-items: stretch;">
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-outline" style="flex: 1;" onclick="exportData('csv')"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg> Export CSV</button>
                            <button class="btn btn-outline" style="flex: 1;" onclick="exportData('json')"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg> Export JSON</button>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-secondary" style="flex: 1;" onclick="showImportModal()"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg> Import Data</button>
                            <button class="btn btn-secondary" style="flex: 1;" onclick="loadDemoData()"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a10 10 0 0110 10 10 10 0 01-10 10A10 10 0 012 12 10 10 0 0112 2z"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><path d="M9 9h.01M15 9h.01"/></svg> Load Demo</button>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">About</div>
                    <div class="card">
                        <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;">
                            <strong>The Chimney Log</strong> v1.0<br>
                            Custom-built for Clean Sweep Chimney Sweep
                        </p>
                        <p style="font-size: 13px; color: var(--text-muted);">
                            CSIA Certified • Prosperity, SC<br>
                            (803) 364-0962
                        </p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-view="home" onclick="showView('home')">
                <span class="nav-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></span>
                <span>Home</span>
            </button>
            <button class="nav-item" data-view="customers" onclick="showView('customers')">
                <span class="nav-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg></span>
                <span>Customers</span>
            </button>
            <button class="nav-item" data-view="inspection" onclick="startNewInspection()">
                <span class="nav-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg></span>
                <span>Inspect</span>
            </button>
            <button class="nav-item" data-view="reports" onclick="showView('reports')">
                <span class="nav-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg></span>
                <span>Reports</span>
            </button>
        </nav>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Modal: Add Customer -->
    <div class="modal-overlay" id="add-customer-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Add Customer</h3>
                <button class="modal-close" onclick="closeModal('add-customer-modal')"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label class="form-label">Customer Name *</label>
                    <input type="text" class="form-input" id="new-customer-name" placeholder="John Smith">
                </div>
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-input" id="new-customer-phone" placeholder="(803) 555-0123">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="new-customer-email" placeholder="john@example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Street Address *</label>
                    <input type="text" class="form-input" id="new-customer-address" placeholder="123 Main Street">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">City *</label>
                        <input type="text" class="form-input" id="new-customer-city" placeholder="Prosperity">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ZIP</label>
                        <input type="text" class="form-input" id="new-customer-zip" placeholder="29127">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="new-customer-notes" placeholder="Any special notes about this property..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeModal('add-customer-modal')">Cancel</button>
                <button class="btn btn-primary" style="flex: 1;" onclick="saveNewCustomer()">Add Customer</button>
            </div>
        </div>
    </div>

    <!-- Modal: Import Data -->
    <div class="modal-overlay" id="import-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Import Data</h3>
                <button class="modal-close" onclick="closeModal('import-modal')"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label class="form-label">Import from JSON File</label>
                    <input type="file" class="form-input" id="import-file" accept=".json" style="padding: 10px;">
                </div>
                <p class="form-hint">Or paste JSON data below:</p>
                <div class="form-group">
                    <textarea class="form-textarea" id="import-text" placeholder='{"customers": [...], "inspections": [...]}' style="min-height: 150px; font-family: monospace;"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeModal('import-modal')">Cancel</button>
                <button class="btn btn-primary" style="flex: 1;" onclick="importData()">Import</button>
            </div>
        </div>
    </div>

    <script>
        // Security Layer - Access Control
        function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
        const _V=-1059887157;
        const _k=new URLSearchParams(window.location.search).get('key');
        if(!_k||_h(_k)!==_V){document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;background:#111;color:#fff;text-align:center;padding:20px"><div><h1 style="font-size:2rem;margin-bottom:1rem">Access Denied</h1><p style="color:#999">This tool requires a valid access key.</p><p style="margin-top:1rem"><a href="mailto:ben@bennycutools.com" style="color:#4da6ff">ben@bennycutools.com</a></p></div></div>';throw new Error('Invalid key');}

        // Anti-tampering
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', e => { if(e.key==='F12'||(e.ctrlKey&&e.shiftKey&&e.key==='I')||(e.ctrlKey&&e.key==='u')) e.preventDefault(); });
        document.addEventListener('selectstart', e => { if(e.target.closest('.app-container')) e.preventDefault(); });

        // ============================================
        // THE CHIMNEY LOG - Clean Sweep Chimney Sweep
        // ============================================

        const DB_NAME = 'ChimneyLogDB';
        const DB_VERSION = 1;
        let db = null;
        let currentCustomerId = null;
        let currentInspection = null;
        let deletedItem = null;
        let undoTimeout = null;

        // NFPA 211 Inspection Checklist Items
        const INSPECTION_CHECKLIST = {
            flue: [
                { id: 'flue_liner', label: 'Flue Liner Condition', description: 'Check for cracks, gaps, or deterioration' },
                { id: 'flue_blockage', label: 'Blockage Check', description: 'Clear of debris, nests, or obstructions' },
                { id: 'creosote_level', label: 'Creosote Buildup', description: 'Measure creosote accumulation level' }
            ],
            firebox: [
                { id: 'firebox_walls', label: 'Firebox Walls', description: 'Check refractory panels and mortar joints' },
                { id: 'firebox_floor', label: 'Firebox Floor', description: 'Inspect hearth extension condition' },
                { id: 'grate', label: 'Grate Condition', description: 'Check for damage or warping' }
            ],
            damper: [
                { id: 'damper_operation', label: 'Damper Operation', description: 'Opens and closes smoothly' },
                { id: 'damper_seal', label: 'Damper Seal', description: 'Seals properly when closed' }
            ],
            exterior: [
                { id: 'crown', label: 'Chimney Crown', description: 'Check for cracks and wear' },
                { id: 'cap', label: 'Chimney Cap', description: 'Secure and undamaged' },
                { id: 'flashing', label: 'Flashing', description: 'Properly sealed at roof intersection' },
                { id: 'masonry', label: 'Exterior Masonry', description: 'Check for spalling or deterioration' }
            ],
            safety: [
                { id: 'smoke_alarm', label: 'Smoke Detector Nearby', description: 'Working detector within 15 feet' },
                { id: 'co_detector', label: 'CO Detector Present', description: 'Carbon monoxide detector installed' },
                { id: 'clearance', label: 'Combustible Clearance', description: 'Proper clearance from combustibles' }
            ]
        };

        const RECOMMENDATIONS = [
            'Schedule chimney cleaning',
            'Level 2 inspection recommended',
            'Flue liner replacement needed',
            'Crown repair recommended',
            'Install chimney cap',
            'Flashing repair needed',
            'Masonry tuckpointing required',
            'Damper replacement recommended',
            'Add CO detector',
            'Clearance modification needed'
        ];

        // Demo Data - Realistic SC customers
        const DEMO_CUSTOMERS = [
            {
                id: 'demo-1',
                name: 'Martha Jenkins',
                phone: '(803) 555-1234',
                email: 'martha.jenkins@email.com',
                address: '1847 Macedonia Church Rd',
                city: 'Prosperity',
                zip: '29127',
                notes: 'Historic farmhouse, built 1920s. Original brick chimney.',
                isDemo: true,
                createdAt: new Date('2024-03-15').toISOString(),
                lastService: new Date('2024-11-10').toISOString()
            },
            {
                id: 'demo-2',
                name: 'Robert & Linda Thompson',
                phone: '(803) 555-2345',
                email: 'thompson.family@gmail.com',
                address: '234 Old Prosperity Rd',
                city: 'Newberry',
                zip: '29108',
                notes: 'Two fireplaces - living room and master bedroom. Prefers appointments after 2pm.',
                isDemo: true,
                createdAt: new Date('2023-09-20').toISOString(),
                lastService: new Date('2024-01-15').toISOString()
            },
            {
                id: 'demo-3',
                name: 'James Derrick III',
                phone: '(803) 555-3456',
                email: '',
                address: '567 Main Street',
                city: 'Prosperity',
                zip: '29127',
                notes: 'Wyche-Derrick House - historic property. Handle with extra care.',
                isDemo: true,
                createdAt: new Date('2022-10-01').toISOString(),
                lastService: new Date('2023-10-22').toISOString()
            },
            {
                id: 'demo-4',
                name: 'Newberry Property Management',
                phone: '(803) 555-4567',
                email: 'service@newberrypm.com',
                address: '890 Boundary St',
                city: 'Newberry',
                zip: '29108',
                notes: 'Commercial account - manages 12 rental properties. Invoice net 30.',
                isDemo: true,
                createdAt: new Date('2023-01-10').toISOString(),
                lastService: new Date('2025-01-05').toISOString()
            },
            {
                id: 'demo-5',
                name: 'Patricia Collins',
                phone: '(803) 555-5678',
                email: 'patcollins@outlook.com',
                address: '123 Lake Murray Blvd',
                city: 'Chapin',
                zip: '29036',
                notes: 'New customer referral from Martha Jenkins. Wood stove insert.',
                isDemo: true,
                createdAt: new Date('2025-01-20').toISOString(),
                lastService: null
            }
        ];

        const DEMO_INSPECTIONS = [
            {
                id: 'demo-insp-1',
                customerId: 'demo-1',
                date: '2024-11-10',
                type: 'Level 1 Inspection + Cleaning',
                findings: {
                    flue_liner: 'ok',
                    flue_blockage: 'ok',
                    creosote_level: 'ok',
                    firebox_walls: 'ok',
                    firebox_floor: 'ok',
                    grate: 'issue',
                    damper_operation: 'ok',
                    damper_seal: 'ok',
                    crown: 'issue',
                    cap: 'ok',
                    flashing: 'ok',
                    masonry: 'ok',
                    smoke_alarm: 'ok',
                    co_detector: 'ok',
                    clearance: 'ok'
                },
                creosoteLevel: 1,
                notes: 'Light creosote buildup (1/8"). Cleaned successfully. Grate showing wear - recommend replacement within 2 years. Minor crown cracking observed.',
                recommendations: ['Crown repair recommended'],
                price: 175,
                isDemo: true
            },
            {
                id: 'demo-insp-2',
                customerId: 'demo-2',
                date: '2024-01-15',
                type: 'Level 1 Inspection',
                findings: {
                    flue_liner: 'ok',
                    flue_blockage: 'ok',
                    creosote_level: 'issue',
                    firebox_walls: 'ok',
                    firebox_floor: 'ok',
                    grate: 'ok',
                    damper_operation: 'ok',
                    damper_seal: 'ok',
                    crown: 'ok',
                    cap: 'ok',
                    flashing: 'ok',
                    masonry: 'ok',
                    smoke_alarm: 'ok',
                    co_detector: 'issue',
                    clearance: 'ok'
                },
                creosoteLevel: 2,
                notes: 'Moderate creosote buildup (1/4") in living room fireplace. Bedroom unit in good condition. No CO detector present.',
                recommendations: ['Schedule chimney cleaning', 'Add CO detector'],
                price: 150,
                isDemo: true
            },
            {
                id: 'demo-insp-3',
                customerId: 'demo-3',
                date: '2023-10-22',
                type: 'Level 1 Inspection + Cleaning',
                findings: {
                    flue_liner: 'issue',
                    flue_blockage: 'ok',
                    creosote_level: 'ok',
                    firebox_walls: 'ok',
                    firebox_floor: 'ok',
                    grate: 'ok',
                    damper_operation: 'issue',
                    damper_seal: 'issue',
                    crown: 'issue',
                    cap: 'issue',
                    flashing: 'ok',
                    masonry: 'issue',
                    smoke_alarm: 'ok',
                    co_detector: 'ok',
                    clearance: 'ok'
                },
                creosoteLevel: 1,
                notes: 'Historic chimney showing age-appropriate wear. Flue liner has minor cracks - recommend Level 2 video inspection. Damper difficult to operate. Crown deteriorating. Cap missing.',
                recommendations: ['Level 2 inspection recommended', 'Install chimney cap', 'Damper replacement recommended', 'Crown repair recommended'],
                price: 200,
                isDemo: true
            }
        ];

        // ============================================
        // DATABASE FUNCTIONS
        // ============================================

        async function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = () => {
                    console.error('IndexedDB error:', request.error);
                    // Fallback to localStorage
                    resolve(null);
                };

                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };

                request.onupgradeneeded = (event) => {
                    const database = event.target.result;

                    // Customers store
                    if (!database.objectStoreNames.contains('customers')) {
                        const customerStore = database.createObjectStore('customers', { keyPath: 'id' });
                        customerStore.createIndex('name', 'name', { unique: false });
                        customerStore.createIndex('lastService', 'lastService', { unique: false });
                    }

                    // Inspections store
                    if (!database.objectStoreNames.contains('inspections')) {
                        const inspectionStore = database.createObjectStore('inspections', { keyPath: 'id' });
                        inspectionStore.createIndex('customerId', 'customerId', { unique: false });
                        inspectionStore.createIndex('date', 'date', { unique: false });
                    }

                    // Settings store
                    if (!database.objectStoreNames.contains('settings')) {
                        database.createObjectStore('settings', { keyPath: 'key' });
                    }
                };
            });
        }

        async function dbGet(storeName) {
            if (!db) {
                const data = localStorage.getItem(`chimney_${storeName}`);
                return data ? JSON.parse(data) : [];
            }

            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();

                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        async function dbPut(storeName, data) {
            if (!db) {
                const existing = JSON.parse(localStorage.getItem(`chimney_${storeName}`) || '[]');
                const index = existing.findIndex(item => item.id === data.id);
                if (index >= 0) {
                    existing[index] = data;
                } else {
                    existing.push(data);
                }
                localStorage.setItem(`chimney_${storeName}`, JSON.stringify(existing));
                return;
            }

            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.put(data);

                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        async function dbDelete(storeName, id) {
            if (!db) {
                const existing = JSON.parse(localStorage.getItem(`chimney_${storeName}`) || '[]');
                const filtered = existing.filter(item => item.id !== id);
                localStorage.setItem(`chimney_${storeName}`, JSON.stringify(filtered));
                return;
            }

            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.delete(id);

                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        async function dbClear(storeName) {
            if (!db) {
                localStorage.removeItem(`chimney_${storeName}`);
                return;
            }

            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.clear();

                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'Never';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function formatDateInput(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toISOString().split('T')[0];
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        }

        function getServiceStatus(lastService) {
            if (!lastService) return { status: 'overdue', label: 'Never Serviced', class: 'overdue' };

            const lastDate = new Date(lastService);
            const now = new Date();
            const monthsSince = (now - lastDate) / (1000 * 60 * 60 * 24 * 30);

            if (monthsSince > 12) {
                return { status: 'overdue', label: 'Overdue', class: 'overdue' };
            } else if (monthsSince > 10) {
                return { status: 'due', label: 'Due Soon', class: 'due-soon' };
            } else {
                return { status: 'ok', label: 'Up to Date', class: 'ok' };
            }
        }

        function getGreeting() {
            const hour = new Date().getHours();
            if (hour < 12) return 'Good morning';
            if (hour < 17) return 'Good afternoon';
            return 'Good evening';
        }

        // ============================================
        // TOAST NOTIFICATIONS
        // ============================================

        function showToast(message, type = 'default', undoCallback = null) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            if (undoCallback) {
                toast.innerHTML = `
                    <span>${message}</span>
                    <button class="toast-undo" onclick="undoDelete()">Undo</button>
                `;
            } else {
                toast.textContent = message;
            }

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(20px)';
                setTimeout(() => toast.remove(), 300);
            }, undoCallback ? 5000 : 3000);
        }

        // ============================================
        // VIEW MANAGEMENT
        // ============================================

        function showView(viewName) {
            // Hide all views
            document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));

            // Show selected view
            document.getElementById(`${viewName}-view`).classList.add('active');

            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.view === viewName) {
                    item.classList.add('active');
                }
            });

            // Load view-specific content
            if (viewName === 'home') {
                refreshHome();
            } else if (viewName === 'customers') {
                refreshCustomersList();
            } else if (viewName === 'reports') {
                refreshReportsList();
            }
        }

        function goBack() {
            showView('customers');
        }

        function showSettings() {
            showView('settings');
            loadSettings();
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // ============================================
        // HOME VIEW
        // ============================================

        async function refreshHome() {
            const customers = await dbGet('customers');
            const inspections = await dbGet('inspections');

            // Update greeting
            document.getElementById('greeting').textContent = `${getGreeting()}, Ashley`;

            // Update stats
            document.getElementById('stat-customers').textContent = customers.length;

            const dueCount = customers.filter(c => {
                const status = getServiceStatus(c.lastService);
                return status.status === 'overdue' || status.status === 'due';
            }).length;
            document.getElementById('stat-due').textContent = dueCount;

            const thisYear = new Date().getFullYear();
            const yearInspections = inspections.filter(i => new Date(i.date).getFullYear() === thisYear).length;
            document.getElementById('stat-inspections').textContent = yearInspections;

            // Check for demo data
            const hasDemo = customers.some(c => c.isDemo);
            document.getElementById('demo-banner').style.display = hasDemo ? 'flex' : 'none';

            // Due customers
            const dueCustomers = customers
                .filter(c => {
                    const status = getServiceStatus(c.lastService);
                    return status.status === 'overdue' || status.status === 'due';
                })
                .sort((a, b) => new Date(a.lastService || 0) - new Date(b.lastService || 0))
                .slice(0, 3);

            const dueList = document.getElementById('due-customers-list');
            if (dueCustomers.length === 0) {
                dueList.innerHTML = `
                    <div class="card" style="text-align: center; padding: 30px;">
                        <div style="font-size: 32px; margin-bottom: 10px;"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l2.4 7.2h7.6l-6 4.8 2.4 7.2-6-4.8-6 4.8 2.4-7.2-6-4.8h7.6z"/></svg></div>
                        <p style="color: var(--text-secondary);">All customers are up to date!</p>
                    </div>
                `;
            } else {
                dueList.innerHTML = dueCustomers.map(c => renderCustomerItem(c)).join('');
            }

            // Recent customers
            const recentCustomers = customers
                .sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0))
                .slice(0, 3);

            const recentList = document.getElementById('recent-customers-list');
            if (recentCustomers.length === 0) {
                recentList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg></div>
                        <h3 class="empty-title">Welcome to The Chimney Log</h3>
                        <p class="empty-description">Start by adding your first customer or load demo data to explore.</p>
                        <div class="empty-actions">
                            <button class="btn btn-primary" onclick="showAddCustomer()">Add First Customer</button>
                            <button class="btn btn-outline" onclick="loadDemoData()">Load Demo Data</button>
                        </div>
                    </div>
                `;
            } else {
                recentList.innerHTML = recentCustomers.map(c => renderCustomerItem(c)).join('');
            }
        }

        function renderCustomerItem(customer) {
            const status = getServiceStatus(customer.lastService);
            const statusClass = status.status === 'overdue' ? 'customer-overdue' : (status.status === 'due' ? 'customer-due' : '');

            return `
                <div class="customer-item ${statusClass}" onclick="viewCustomer('${customer.id}')">
                    <div class="customer-avatar">${getInitials(customer.name)}</div>
                    <div class="customer-info">
                        <div class="customer-name">${customer.name}</div>
                        <div class="customer-address">${customer.address}, ${customer.city}</div>
                    </div>
                    <span class="customer-status ${status.class}">${status.label}</span>
                </div>
            `;
        }

        // ============================================
        // CUSTOMERS VIEW
        // ============================================

        let customerFilter = 'all';

        async function refreshCustomersList() {
            const customers = await dbGet('customers');
            const searchTerm = document.getElementById('customer-search').value.toLowerCase();

            let filtered = customers.filter(c => {
                const matchesSearch = !searchTerm || 
                    c.name.toLowerCase().includes(searchTerm) ||
                    c.address.toLowerCase().includes(searchTerm) ||
                    c.city.toLowerCase().includes(searchTerm);

                const status = getServiceStatus(c.lastService);
                const matchesFilter = customerFilter === 'all' ||
                    (customerFilter === 'overdue' && status.status === 'overdue') ||
                    (customerFilter === 'due' && status.status === 'due') ||
                    (customerFilter === 'ok' && status.status === 'ok');

                return matchesSearch && matchesFilter;
            });

            filtered.sort((a, b) => a.name.localeCompare(b.name));

            const list = document.getElementById('customers-list');
            if (filtered.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg></div>
                        <h3 class="empty-title">No customers found</h3>
                        <p class="empty-description">${searchTerm ? 'Try a different search term.' : 'Add your first customer to get started.'}</p>
                        ${!searchTerm ? '<button class="btn btn-primary" onclick="showAddCustomer()">Add Customer</button>' : ''}
                    </div>
                `;
            } else {
                list.innerHTML = filtered.map(c => renderCustomerItem(c)).join('');
            }
        }

        function filterCustomers() {
            refreshCustomersList();
        }

        function setCustomerFilter(filter) {
            customerFilter = filter;
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.filter === filter);
            });
            refreshCustomersList();
        }

        function showCustomers(filter = 'all') {
            customerFilter = filter;
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.filter === filter);
            });
            showView('customers');
        }

        function showAddCustomer() {
            // Clear form
            document.getElementById('new-customer-name').value = '';
            document.getElementById('new-customer-phone').value = '';
            document.getElementById('new-customer-email').value = '';
            document.getElementById('new-customer-address').value = '';
            document.getElementById('new-customer-city').value = 'Prosperity';
            document.getElementById('new-customer-zip').value = '29127';
            document.getElementById('new-customer-notes').value = '';

            showModal('add-customer-modal');
        }

        async function saveNewCustomer() {
            const name = document.getElementById('new-customer-name').value.trim();
            const address = document.getElementById('new-customer-address').value.trim();
            const city = document.getElementById('new-customer-city').value.trim();

            if (!name || !address || !city) {
                showToast('Please fill in required fields', 'error');
                return;
            }

            const customer = {
                id: generateId(),
                name: name,
                phone: document.getElementById('new-customer-phone').value.trim(),
                email: document.getElementById('new-customer-email').value.trim(),
                address: address,
                city: city,
                zip: document.getElementById('new-customer-zip').value.trim(),
                notes: document.getElementById('new-customer-notes').value.trim(),
                isDemo: false,
                createdAt: new Date().toISOString(),
                lastService: null
            };

            await dbPut('customers', customer);
            closeModal('add-customer-modal');
            showToast('Customer added successfully', 'success');
            refreshHome();
        }

        // ============================================
        // CUSTOMER DETAIL VIEW
        // ============================================

        async function viewCustomer(customerId) {
            currentCustomerId = customerId;
            const customers = await dbGet('customers');
            const customer = customers.find(c => c.id === customerId);

            if (!customer) {
                showToast('Customer not found', 'error');
                return;
            }

            const inspections = await dbGet('inspections');
            const customerInspections = inspections
                .filter(i => i.customerId === customerId)
                .sort((a, b) => new Date(b.date) - new Date(a.date));

            const status = getServiceStatus(customer.lastService);

            const content = document.getElementById('customer-detail-content');
            content.innerHTML = `
                <div class="detail-header">
                    <div class="detail-avatar">${getInitials(customer.name)}</div>
                    <h2 class="detail-name">${customer.name}</h2>
                    <p class="detail-address">${customer.address}, ${customer.city} ${customer.zip}</p>
                    <span class="customer-status ${status.class}" style="margin-top: 8px; display: inline-block;">${status.label}</span>
                    <div class="detail-actions">
                        ${customer.phone ? `<a href="tel:${customer.phone}" class="detail-btn"><span class="detail-btn-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg></span><span class="detail-btn-label">Call</span></a>` : ''}
                        ${customer.email ? `<a href="mailto:${customer.email}" class="detail-btn"><span class="detail-btn-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"</span><span class="detail-btn-label">Email</span></a>` : ''}
                        <button class="detail-btn" onclick="startInspectionFor('${customer.id}')"><span class="detail-btn-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg></span><span class="detail-btn-label">Inspect</span></button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Customer Info</h3>
                        <button class="btn btn-sm btn-outline" onclick="editCustomer('${customer.id}')">Edit</button>
                    </div>
                    ${customer.phone ? `<p style="margin-bottom: 8px;"><strong>Phone:</strong> ${customer.phone}</p>` : ''}
                    ${customer.email ? `<p style="margin-bottom: 8px;"><strong>Email:</strong> ${customer.email}</p>` : ''}
                    <p style="margin-bottom: 8px;"><strong>Last Service:</strong> ${formatDate(customer.lastService)}</p>
                    ${customer.notes ? `<p style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); font-size: 14px; color: var(--text-secondary);"><strong>Notes:</strong> ${customer.notes}</p>` : ''}
                </div>

                <div class="section-header">
                    <h3 class="section-title">Service History</h3>
                </div>

                ${customerInspections.length === 0 ? `
                    <div class="card" style="text-align: center;">
                        <div style="font-size: 32px; margin-bottom: 10px;"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg></div>
                        <p style="color: var(--text-secondary); margin-bottom: 16px;">No inspection history yet</p>
                        <button class="btn btn-primary btn-sm" onclick="startInspectionFor('${customer.id}')">Start First Inspection</button>
                    </div>
                ` : `
                    <div class="card">
                        ${customerInspections.map(insp => `
                            <div class="history-item">
                                <div class="history-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg></div>
                                <div class="history-content">
                                    <div class="history-title">${insp.type}</div>
                                    <div class="history-date">${formatDate(insp.date)} • $${insp.price || 0}</div>
                                    ${insp.notes ? `<div class="history-findings">${insp.notes}</div>` : ''}
                                    ${insp.recommendations && insp.recommendations.length > 0 ? `
                                        <div style="margin-top: 8px;">
                                            ${insp.recommendations.map(r => `<span class="card-badge" style="margin-right: 4px; margin-bottom: 4px; display: inline-block;">${r}</span>`).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `}

                <button class="btn btn-danger btn-block" style="margin-top: 24px;" onclick="deleteCustomer('${customer.id}')">Delete Customer</button>
            `;

            // Hide all views and show detail
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('customer-detail-view').classList.add('active');
        }

        async function editCustomer(customerId) {
            const customers = await dbGet('customers');
            const customer = customers.find(c => c.id === customerId);

            if (!customer) return;

            document.getElementById('new-customer-name').value = customer.name;
            document.getElementById('new-customer-phone').value = customer.phone || '';
            document.getElementById('new-customer-email').value = customer.email || '';
            document.getElementById('new-customer-address').value = customer.address;
            document.getElementById('new-customer-city').value = customer.city;
            document.getElementById('new-customer-zip').value = customer.zip || '';
            document.getElementById('new-customer-notes').value = customer.notes || '';

            // Modify modal for edit mode
            const modal = document.getElementById('add-customer-modal');
            modal.querySelector('.modal-title').textContent = 'Edit Customer';
            const saveBtn = modal.querySelector('.btn-primary');
            saveBtn.textContent = 'Save Changes';
            saveBtn.onclick = async () => {
                customer.name = document.getElementById('new-customer-name').value.trim();
                customer.phone = document.getElementById('new-customer-phone').value.trim();
                customer.email = document.getElementById('new-customer-email').value.trim();
                customer.address = document.getElementById('new-customer-address').value.trim();
                customer.city = document.getElementById('new-customer-city').value.trim();
                customer.zip = document.getElementById('new-customer-zip').value.trim();
                customer.notes = document.getElementById('new-customer-notes').value.trim();

                await dbPut('customers', customer);
                closeModal('add-customer-modal');

                // Reset modal
                modal.querySelector('.modal-title').textContent = 'Add Customer';
                saveBtn.textContent = 'Add Customer';
                saveBtn.onclick = saveNewCustomer;

                showToast('Customer updated', 'success');
                viewCustomer(customerId);
            };

            showModal('add-customer-modal');
        }

        async function deleteCustomer(customerId) {
            if (!confirm('Delete this customer and all their inspection history?')) return;

            const customers = await dbGet('customers');
            const customer = customers.find(c => c.id === customerId);

            deletedItem = { type: 'customer', data: customer };

            await dbDelete('customers', customerId);

            // Also delete their inspections
            const inspections = await dbGet('inspections');
            const customerInspections = inspections.filter(i => i.customerId === customerId);
            for (const insp of customerInspections) {
                await dbDelete('inspections', insp.id);
            }
            deletedItem.inspections = customerInspections;

            showToast('Customer deleted', 'default', true);

            if (undoTimeout) clearTimeout(undoTimeout);
            undoTimeout = setTimeout(() => {
                deletedItem = null;
            }, 5000);

            showView('customers');
        }

        async function undoDelete() {
            if (!deletedItem) return;

            if (deletedItem.type === 'customer') {
                await dbPut('customers', deletedItem.data);
                if (deletedItem.inspections) {
                    for (const insp of deletedItem.inspections) {
                        await dbPut('inspections', insp);
                    }
                }
                showToast('Customer restored', 'success');
            } else if (deletedItem.type === 'inspection') {
                await dbPut('inspections', deletedItem.data);
                showToast('Inspection restored', 'success');
            }

            deletedItem = null;
            if (undoTimeout) {
                clearTimeout(undoTimeout);
                undoTimeout = null;
            }

            refreshHome();
            refreshCustomersList();
        }

        // ============================================
        // INSPECTION FORM
        // ============================================

        async function startNewInspection() {
            const customers = await dbGet('customers');
            if (customers.length === 0) {
                showToast('Add a customer first', 'error');
                showAddCustomer();
                return;
            }

            // Show customer selection
            showInspectionForm(null);
        }

        async function startInspectionFor(customerId) {
            currentCustomerId = customerId;
            showInspectionForm(customerId);
        }

        async function showInspectionForm(customerId) {
            const customers = await dbGet('customers');
            const customer = customerId ? customers.find(c => c.id === customerId) : null;

            currentInspection = {
                id: generateId(),
                customerId: customerId,
                date: new Date().toISOString().split('T')[0],
                type: 'Level 1 Inspection',
                findings: {},
                creosoteLevel: 1,
                notes: '',
                recommendations: [],
                photos: [],
                price: 150,
                isDemo: false
            };

            const content = document.getElementById('inspection-content');
            content.innerHTML = `
                <h2 class="section-title" style="margin-bottom: 20px;">New Inspection</h2>

                <div class="card">
                    <div class="form-group">
                        <label class="form-label">Customer</label>
                        <select class="form-select" id="insp-customer" onchange="updateInspectionCustomer(this.value)">
                            <option value="">Select customer...</option>
                            ${customers.map(c => `<option value="${c.id}" ${c.id === customerId ? 'selected' : ''}>${c.name} - ${c.address}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-input" id="insp-date" value="${currentInspection.date}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Type</label>
                            <select class="form-select" id="insp-type">
                                <option value="Level 1 Inspection">Level 1 Inspection</option>
                                <option value="Level 1 Inspection + Cleaning">Level 1 + Cleaning</option>
                                <option value="Level 2 Inspection">Level 2 Inspection</option>
                                <option value="Chimney Cleaning">Chimney Cleaning</option>
                                <option value="Dryer Vent Cleaning">Dryer Vent Cleaning</option>
                            </select>
                        </div>
                    </div>
                </div>

                ${Object.entries(INSPECTION_CHECKLIST).map(([section, items]) => `
                    <div class="inspection-section">
                        <h4 class="inspection-section-title">${section.replace('_', ' ')}</h4>
                        ${items.map(item => `
                            <div class="checklist-item" data-item="${item.id}">
                                <div class="checklist-content">
                                    <div class="checklist-label">${item.label}</div>
                                    <div class="checklist-description">${item.description}</div>
                                </div>
                                <div class="checklist-actions">
                                    <button class="checklist-btn checklist-btn-ok" onclick="setFinding('${item.id}', 'ok', this)" title="OK"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg></button>
                                    <button class="checklist-btn checklist-btn-issue" onclick="setFinding('${item.id}', 'issue', this)" title="Issue"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `).join('')}

                <div class="inspection-section">
                    <h4 class="inspection-section-title">Creosote Level</h4>
                    <div class="card">
                        <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;">Select buildup level (1/8" increments)</p>
                        <div class="price-options">
                            <button class="price-option selected" data-level="1" onclick="setCreosoteLevel(1)">Stage 1<br><small>Light</small></button>
                            <button class="price-option" data-level="2" onclick="setCreosoteLevel(2)">Stage 2<br><small>Moderate</small></button>
                            <button class="price-option" data-level="3" onclick="setCreosoteLevel(3)">Stage 3<br><small>Heavy</small></button>
                        </div>
                        <div class="creosote-indicator">
                            <div class="creosote-bar level-1" id="creosote-1"></div>
                            <div class="creosote-bar" id="creosote-2"></div>
                            <div class="creosote-bar" id="creosote-3"></div>
                        </div>
                    </div>
                </div>

                <div class="inspection-section">
                    <h4 class="inspection-section-title">Notes</h4>
                    <div class="voice-input-container">
                        <textarea class="form-textarea" id="insp-notes" placeholder="Detailed findings and observations..." style="padding-right: 50px;"></textarea>
                        <button class="voice-btn" id="voice-btn" onclick="toggleVoiceInput()" title="Voice input"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a3 3 0 00-3 3v7a3 3 0 006 0V5a3 3 0 00-3-3zM19 10v2a7 7 0 01-14 0v-2M12 19v4"/></svg></button>
                    </div>
                </div>

                <div class="inspection-section">
                    <h4 class="inspection-section-title">Recommendations</h4>
                    <div class="recommendation-chips">
                        ${RECOMMENDATIONS.map(r => `<button class="recommendation-chip" onclick="toggleRecommendation(this, '${r}')">${r}</button>`).join('')}
                    </div>
                </div>

                <div class="inspection-section">
                    <h4 class="inspection-section-title">Price</h4>
                    <div class="form-group">
                        <input type="number" class="form-input" id="insp-price" value="150" placeholder="150">
                        <div class="price-options" style="margin-top: 8px;">
                            <button class="price-option" onclick="setPrice(125)">$125</button>
                            <button class="price-option selected" onclick="setPrice(150)">$150</button>
                            <button class="price-option" onclick="setPrice(175)">$175</button>
                            <button class="price-option" onclick="setPrice(200)">$200</button>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button class="btn btn-secondary" style="flex: 1;" onclick="cancelInspection()">Cancel</button>
                    <button class="btn btn-primary" style="flex: 1;" onclick="saveInspection()">Save Inspection</button>
                </div>
            `;

            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('inspection-view').classList.add('active');
        }

        function updateInspectionCustomer(customerId) {
            if (currentInspection) {
                currentInspection.customerId = customerId;
            }
        }

        function setFinding(itemId, value, btn) {
            if (!currentInspection) return;

            currentInspection.findings[itemId] = value;

            // Update UI
            const item = btn.closest('.checklist-item');
            item.querySelectorAll('.checklist-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function setCreosoteLevel(level) {
            if (!currentInspection) return;
            currentInspection.creosoteLevel = level;

            // Update UI
            document.querySelectorAll('[data-level]').forEach(btn => {
                btn.classList.toggle('selected', parseInt(btn.dataset.level) === level);
            });

            // Update indicator
            document.querySelectorAll('.creosote-bar').forEach((bar, i) => {
                bar.className = 'creosote-bar';
                if (i < level) {
                    bar.classList.add(`level-${level}`);
                }
            });
        }

        function toggleRecommendation(btn, rec) {
            if (!currentInspection) return;

            btn.classList.toggle('selected');

            const index = currentInspection.recommendations.indexOf(rec);
            if (index >= 0) {
                currentInspection.recommendations.splice(index, 1);
            } else {
                currentInspection.recommendations.push(rec);
            }
        }

        function setPrice(price) {
            document.getElementById('insp-price').value = price;
            document.querySelectorAll('.price-options .price-option').forEach(btn => {
                btn.classList.toggle('selected', btn.textContent.includes(price.toString()));
            });
        }

        let recognition = null;

        function toggleVoiceInput() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showToast('Voice input not supported', 'error');
                return;
            }

            const voiceBtn = document.getElementById('voice-btn');

            if (recognition && recognition.running) {
                recognition.stop();
                voiceBtn.classList.remove('recording');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onstart = () => {
                voiceBtn.classList.add('recording');
                recognition.running = true;
            };

            recognition.onend = () => {
                voiceBtn.classList.remove('recording');
                recognition.running = false;
            };

            recognition.onresult = (event) => {
                const textarea = document.getElementById('insp-notes');
                let transcript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                textarea.value = textarea.value + ' ' + transcript;
            };

            recognition.onerror = () => {
                voiceBtn.classList.remove('recording');
                showToast('Voice input error', 'error');
            };

            recognition.start();
        }

        async function saveInspection() {
            if (!currentInspection) return;

            const customerId = document.getElementById('insp-customer').value;
            if (!customerId) {
                showToast('Please select a customer', 'error');
                return;
            }

            currentInspection.customerId = customerId;
            currentInspection.date = document.getElementById('insp-date').value;
            currentInspection.type = document.getElementById('insp-type').value;
            currentInspection.notes = document.getElementById('insp-notes').value;
            currentInspection.price = parseInt(document.getElementById('insp-price').value) || 0;

            await dbPut('inspections', currentInspection);

            // Update customer's last service date
            const customers = await dbGet('customers');
            const customer = customers.find(c => c.id === customerId);
            if (customer) {
                customer.lastService = currentInspection.date;
                await dbPut('customers', customer);
            }

            showToast('Inspection saved!', 'success');
            currentInspection = null;
            showView('home');
        }

        function cancelInspection() {
            if (currentInspection && Object.keys(currentInspection.findings).length > 0) {
                if (!confirm('Discard this inspection?')) return;
            }
            currentInspection = null;
            showView('home');
        }

        // ============================================
        // REPORTS VIEW
        // ============================================

        async function refreshReportsList() {
            const inspections = await dbGet('inspections');
            const customers = await dbGet('customers');

            const sorted = inspections.sort((a, b) => new Date(b.date) - new Date(a.date));

            const list = document.getElementById('reports-list');

            if (sorted.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg></div>
                        <h3 class="empty-title">No inspection reports yet</h3>
                        <p class="empty-description">Complete your first inspection to generate a report.</p>
                        <button class="btn btn-primary" onclick="startNewInspection()">Start Inspection</button>
                    </div>
                `;
                return;
            }

            list.innerHTML = sorted.map(insp => {
                const customer = customers.find(c => c.id === insp.customerId);
                if (!customer) return '';

                const issueCount = Object.values(insp.findings || {}).filter(v => v === 'issue').length;

                return `
                    <div class="card" style="cursor: pointer;" onclick="viewReport('${insp.id}')">
                        <div class="card-header">
                            <div>
                                <div class="card-title">${customer.name}</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">${formatDate(insp.date)} • ${insp.type}</div>
                            </div>
                            ${issueCount > 0 ? `<span class="card-badge">${issueCount} issue${issueCount !== 1 ? 's' : ''}</span>` : ''}
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 14px; color: var(--text-secondary);">${customer.address}</span>
                            <span style="font-weight: 600;">$${insp.price || 0}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function viewReport(inspectionId) {
            const inspections = await dbGet('inspections');
            const customers = await dbGet('customers');

            const inspection = inspections.find(i => i.id === inspectionId);
            if (!inspection) return;

            const customer = customers.find(c => c.id === inspection.customerId);
            if (!customer) return;

            const okCount = Object.values(inspection.findings || {}).filter(v => v === 'ok').length;
            const issueCount = Object.values(inspection.findings || {}).filter(v => v === 'issue').length;

            const reportHtml = `
                <button class="back-btn" onclick="showView('reports')">← Back to Reports</button>
                
                <div class="report-preview">
                    <div class="report-header">
                        <div class="report-logo"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></div>
                        <div class="report-company">Clean Sweep Chimney Sweep</div>
                        <div class="report-subtitle">CSIA Certified • (803) 364-0962</div>
                    </div>

                    <div class="report-section">
                        <div class="report-section-title">Inspection Details</div>
                        <div class="report-row">
                            <span class="report-label">Customer</span>
                            <span class="report-value">${customer.name}</span>
                        </div>
                        <div class="report-row">
                            <span class="report-label">Address</span>
                            <span class="report-value">${customer.address}, ${customer.city} ${customer.zip}</span>
                        </div>
                        <div class="report-row">
                            <span class="report-label">Date</span>
                            <span class="report-value">${formatDate(inspection.date)}</span>
                        </div>
                        <div class="report-row">
                            <span class="report-label">Service Type</span>
                            <span class="report-value">${inspection.type}</span>
                        </div>
                    </div>

                    <div class="report-section">
                        <div class="report-section-title">Inspection Summary</div>
                        <div class="report-row">
                            <span class="report-label">Items Checked</span>
                            <span class="report-value">${okCount + issueCount} items</span>
                        </div>
                        <div class="report-row">
                            <span class="report-label">Passed</span>
                            <span class="report-value" style="color: var(--success);"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> ${okCount}</span>
                        </div>
                        <div class="report-row">
                            <span class="report-label">Issues Found</span>
                            <span class="report-value" style="color: ${issueCount > 0 ? 'var(--warning)' : 'var(--success)'};"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg> ${issueCount}</span>
                        </div>
                        <div class="report-row">
                            <span class="report-label">Creosote Level</span>
                            <span class="report-value">Stage ${inspection.creosoteLevel || 1}</span>
                        </div>
                    </div>

                    ${inspection.notes ? `
                        <div class="report-section">
                            <div class="report-section-title">Findings & Notes</div>
                            <div class="report-findings">${inspection.notes}</div>
                        </div>
                    ` : ''}

                    ${inspection.recommendations && inspection.recommendations.length > 0 ? `
                        <div class="report-section">
                            <div class="report-section-title">Recommendations</div>
                            <ul style="margin: 0; padding-left: 20px; font-size: 14px;">
                                ${inspection.recommendations.map(r => `<li style="margin-bottom: 6px;">${r}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}

                    <div class="report-section">
                        <div class="report-section-title">Service Total</div>
                        <div style="font-size: 28px; font-weight: 700;">$${inspection.price || 0}</div>
                    </div>

                    <div class="report-signature">
                        <div class="report-sig-block">
                            <div class="report-sig-line"></div>
                            <div class="report-sig-label">Technician Signature</div>
                        </div>
                        <div class="report-sig-block">
                            <div class="report-sig-line"></div>
                            <div class="report-sig-label">Customer Signature</div>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 16px;">
                    <button class="btn btn-secondary" style="flex: 1;" onclick="window.print()"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>️ Print Report</button>
                    <button class="btn btn-danger" style="flex: 1;" onclick="deleteInspection('${inspection.id}')"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>️ Delete</button>
                </div>
            `;

            document.getElementById('reports-list').innerHTML = reportHtml;
        }

        async function deleteInspection(inspectionId) {
            if (!confirm('Delete this inspection report?')) return;

            const inspections = await dbGet('inspections');
            const inspection = inspections.find(i => i.id === inspectionId);

            deletedItem = { type: 'inspection', data: inspection };

            await dbDelete('inspections', inspectionId);

            showToast('Inspection deleted', 'default', true);

            if (undoTimeout) clearTimeout(undoTimeout);
            undoTimeout = setTimeout(() => {
                deletedItem = null;
            }, 5000);

            refreshReportsList();
        }

        // ============================================
        // SETTINGS & DATA MANAGEMENT
        // ============================================

        function loadSettings() {
            const darkMode = localStorage.getItem('chimney_darkMode') === 'true';
            document.getElementById('dark-mode-toggle').checked = darkMode;

            const pricing = JSON.parse(localStorage.getItem('chimney_pricing') || '{}');
            document.getElementById('price-inspection').value = pricing.inspection || 150;
            document.getElementById('price-cleaning').value = pricing.cleaning || 175;
            document.getElementById('price-dryer').value = pricing.dryer || 125;
        }

        function savePricing() {
            const pricing = {
                inspection: parseInt(document.getElementById('price-inspection').value) || 150,
                cleaning: parseInt(document.getElementById('price-cleaning').value) || 175,
                dryer: parseInt(document.getElementById('price-dryer').value) || 125
            };
            localStorage.setItem('chimney_pricing', JSON.stringify(pricing));
            showToast('Pricing saved', 'success');
        }

        function toggleTheme() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            document.body.setAttribute('data-theme', isDark ? '' : 'dark');
            localStorage.setItem('chimney_darkMode', !isDark);

            const toggle = document.getElementById('dark-mode-toggle');
            if (toggle) toggle.checked = !isDark;
        }

        async function loadDemoData() {
            for (const customer of DEMO_CUSTOMERS) {
                await dbPut('customers', { ...customer });
            }
            for (const inspection of DEMO_INSPECTIONS) {
                await dbPut('inspections', { ...inspection });
            }
            showToast('Demo data loaded', 'success');
            refreshHome();
        }

        async function clearDemoData() {
            const customers = await dbGet('customers');
            const inspections = await dbGet('inspections');

            for (const c of customers.filter(c => c.isDemo)) {
                await dbDelete('customers', c.id);
            }
            for (const i of inspections.filter(i => i.isDemo)) {
                await dbDelete('inspections', i.id);
            }

            showToast('Demo data cleared', 'success');
            refreshHome();
        }

        async function exportData(format) {
            const customers = await dbGet('customers');
            const inspections = await dbGet('inspections');

            let content, filename, type;

            if (format === 'json') {
                content = JSON.stringify({ customers, inspections }, null, 2);
                filename = 'chimney-log-backup.json';
                type = 'application/json';
            } else {
                // CSV export (customers)
                const headers = ['Name', 'Phone', 'Email', 'Address', 'City', 'ZIP', 'Last Service', 'Notes'];
                const rows = customers.map(c => [
                    c.name,
                    c.phone || '',
                    c.email || '',
                    c.address,
                    c.city,
                    c.zip || '',
                    c.lastService ? formatDate(c.lastService) : 'Never',
                    (c.notes || '').replace(/"/g, '""')
                ].map(v => `"${v}"`).join(','));

                content = [headers.join(','), ...rows].join('\n');
                filename = 'chimney-log-customers.csv';
                type = 'text/csv';
            }

            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);

            showToast(`Exported as ${format.toUpperCase()}`, 'success');
        }

        function showImportModal() {
            document.getElementById('import-file').value = '';
            document.getElementById('import-text').value = '';
            showModal('import-modal');
        }

        async function importData() {
            const fileInput = document.getElementById('import-file');
            const textInput = document.getElementById('import-text');

            let data;

            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const text = await file.text();
                try {
                    data = JSON.parse(text);
                } catch (e) {
                    showToast('Invalid JSON file', 'error');
                    return;
                }
            } else if (textInput.value.trim()) {
                try {
                    data = JSON.parse(textInput.value.trim());
                } catch (e) {
                    showToast('Invalid JSON data', 'error');
                    return;
                }
            } else {
                showToast('No data to import', 'error');
                return;
            }

            if (data.customers) {
                for (const customer of data.customers) {
                    customer.id = customer.id || generateId();
                    customer.isDemo = false;
                    await dbPut('customers', customer);
                }
            }

            if (data.inspections) {
                for (const inspection of data.inspections) {
                    inspection.id = inspection.id || generateId();
                    inspection.isDemo = false;
                    await dbPut('inspections', inspection);
                }
            }

            closeModal('import-modal');
            showToast('Data imported successfully', 'success');
            refreshHome();
        }

        // ============================================
        // INITIALIZATION
        // ============================================

        async function init() {
            // Load theme
            const darkMode = localStorage.getItem('chimney_darkMode') === 'true';
            if (darkMode) {
                document.body.setAttribute('data-theme', 'dark');
            }

            // Initialize database
            await initDB();

            // Load initial view
            refreshHome();
        }

        // Close modals on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });

        // Initialize on load
        init();
    </script>
</body>
</html>
