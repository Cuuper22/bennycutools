<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data: blob:; connect-src 'self';">
  <meta name="robots" content="noindex, nofollow, noarchive">
  <title>Keller QuickQuote — Job Site Estimates in 90 Seconds</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      /* Concrete & Earth Tones */
      --concrete-wet: oklch(0.55 0.04 55);
      --concrete-dry: oklch(0.68 0.05 70);
      --earth-brown: oklch(0.45 0.04 50);
      --wheat-gold: oklch(0.75 0.08 75);
      
      /* Functional */
      --primary: oklch(0.50 0.12 250);
      --primary-hover: oklch(0.45 0.14 250);
      --success: oklch(0.55 0.15 145);
      --warning: oklch(0.65 0.16 55);
      --error: oklch(0.55 0.18 25);
      
      /* Neutrals */
      --bg: oklch(0.98 0.005 80);
      --surface: oklch(1 0 0);
      --surface-raised: oklch(0.99 0.003 80);
      --text: oklch(0.20 0.02 50);
      --text-secondary: oklch(0.45 0.02 50);
      --text-muted: oklch(0.60 0.01 50);
      --border: oklch(0.88 0.01 80);
      --border-light: oklch(0.92 0.005 80);
      
      /* Spacing */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 24px;
      --space-6: 32px;
      --space-7: 48px;
      --space-8: 64px;
      
      /* Typography */
      --font-sans: 'Inter', system-ui, sans-serif;
      --font-display: 'Montserrat', system-ui, sans-serif;
      
      /* Shadows */
      --shadow-sm: 0 1px 2px oklch(0.2 0 0 / 0.05);
      --shadow-md: 0 4px 6px oklch(0.2 0 0 / 0.07), 0 2px 4px oklch(0.2 0 0 / 0.05);
      --shadow-lg: 0 10px 15px oklch(0.2 0 0 / 0.08), 0 4px 6px oklch(0.2 0 0 / 0.04);
      
      /* Radius */
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
    }

    html { font-size: 16px; -webkit-tap-highlight-color: transparent; }
    
    body {
      font-family: var(--font-sans);
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      min-height: 100vh;
      min-height: 100dvh;
      overflow-x: hidden;
    }

    /* Typography */
    h1, h2, h3 { font-family: var(--font-display); font-weight: 700; line-height: 1.2; }
    h1 { font-size: 1.75rem; }
    h2 { font-size: 1.25rem; }
    h3 { font-size: 1rem; }

    /* Demo Banner */
    .demo-banner {
      background: linear-gradient(135deg, var(--concrete-wet), var(--earth-brown));
      color: white;
      padding: var(--space-3) var(--space-4);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-3);
      font-size: 0.875rem;
    }
    .demo-banner p { flex: 1; }
    .demo-banner button {
      background: oklch(1 0 0 / 0.2);
      border: none;
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s ease;
    }
    .demo-banner button:hover { background: oklch(1 0 0 / 0.3); }
    .demo-banner button:focus-visible {
      outline: 2px solid white;
      outline-offset: 2px;
    }
    .demo-banner.hidden { display: none; }

    /* App Shell */
    .app-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      min-height: 100dvh;
    }

    /* Header */
    .app-header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: var(--space-4);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-content {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      max-width: 1200px;
      margin: 0 auto;
    }
    .logo {
      font-family: var(--font-display);
      font-weight: 700;
      font-size: 1.125rem;
      color: var(--earth-brown);
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }
    .logo-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--concrete-wet), var(--earth-brown));
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }

    /* Desktop Nav */
    .desktop-nav {
      display: none;
      margin-left: auto;
      gap: var(--space-1);
    }
    @media (min-width: 1024px) {
      .desktop-nav { display: flex; }
    }
    .nav-btn {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-4);
      background: transparent;
      border: 2px solid transparent;
      border-radius: var(--radius-md);
      font-family: var(--font-sans);
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .nav-btn:hover { background: var(--surface-raised); color: var(--text); }
    .nav-btn:focus-visible {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px oklch(0.50 0.12 250 / 0.15);
    }
    .nav-btn.active {
      background: var(--primary);
      color: white;
    }
    .nav-btn.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .nav-btn .badge {
      font-size: 0.625rem;
      background: var(--warning);
      color: var(--text);
      padding: 2px 6px;
      border-radius: 10px;
      font-weight: 600;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: var(--space-4);
      padding-bottom: calc(80px + var(--space-4));
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }
    @media (min-width: 1024px) {
      .main-content { padding-bottom: var(--space-6); }
    }

    /* Screen */
    .screen { display: none; }
    .screen.active { display: block; animation: fadeIn 0.25s ease; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Bottom Nav (Mobile) */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--surface);
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-around;
      padding: var(--space-2) 0;
      padding-bottom: max(var(--space-2), env(safe-area-inset-bottom));
      z-index: 100;
    }
    @media (min-width: 1024px) {
      .bottom-nav { display: none; }
    }
    .bottom-nav-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-1);
      padding: var(--space-2);
      background: transparent;
      border: none;
      color: var(--text-muted);
      font-size: 0.625rem;
      font-weight: 500;
      cursor: pointer;
      transition: color 0.15s ease;
      min-width: 64px;
    }
    .bottom-nav-btn:focus-visible {
      outline: 2px solid var(--primary);
      outline-offset: -2px;
      border-radius: var(--radius-sm);
    }
    .bottom-nav-btn.active { color: var(--primary); }
    .bottom-nav-btn.disabled { opacity: 0.4; cursor: not-allowed; }
    .bottom-nav-btn svg { width: 24px; height: 24px; }

    /* Cards */
    .card {
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: var(--space-5);
      box-shadow: var(--shadow-sm);
    }

    /* Project Card */
    .project-card {
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      transition: box-shadow 0.2s ease, transform 0.2s ease, border-color 0.2s ease;
      cursor: pointer;
    }
    .project-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
      border-color: var(--concrete-wet);
    }
    .project-card:focus-visible {
      outline: 3px solid var(--primary);
      outline-offset: 2px;
      border-color: var(--primary);
      box-shadow: var(--shadow-md);
    }
    .project-card-image {
      height: 140px;
      background: var(--border-light);
      overflow: hidden;
      position: relative;
    }
    .project-card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .project-card-status {
      position: absolute;
      top: var(--space-2);
      right: var(--space-2);
      padding: var(--space-1) var(--space-2);
      border-radius: 20px;
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .status-complete { background: var(--success); color: white; }
    .status-progress { background: var(--warning); color: var(--text); }
    .status-pending { background: var(--primary); color: white; }
    .status-lead { background: var(--text-muted); color: white; }
    .project-card-body { padding: var(--space-4); }
    .project-card-title {
      font-weight: 600;
      margin-bottom: var(--space-1);
    }
    .project-card-type {
      font-size: 0.8125rem;
      color: var(--text-secondary);
      margin-bottom: var(--space-2);
    }
    .project-card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8125rem;
    }
    .project-card-price {
      font-weight: 600;
      color: var(--earth-brown);
    }
    .project-card-sqft { color: var(--text-muted); }

    /* Form Elements */
    .form-group { margin-bottom: var(--space-4); }
    .form-label {
      display: block;
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: var(--space-2);
    }
    .form-input {
      width: 100%;
      padding: var(--space-3) var(--space-4);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 1rem;
      font-family: var(--font-sans);
      background: var(--surface);
      color: var(--text);
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }
    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px oklch(0.50 0.12 250 / 0.15);
    }
    .form-input::placeholder { color: var(--text-muted); }
    .form-input-lg {
      font-size: 1.5rem;
      text-align: center;
      font-weight: 600;
      padding: var(--space-4);
    }

    /* Dimension Grid */
    .dimension-grid {
      display: grid;
      grid-template-columns: 1fr auto 1fr auto 1fr;
      gap: var(--space-3);
      align-items: center;
      margin-bottom: var(--space-4);
    }
    .dimension-grid .separator {
      font-size: 1.25rem;
      color: var(--text-muted);
      font-weight: 600;
    }
    .dimension-input {
      padding: var(--space-4);
      font-size: 1.25rem;
      text-align: center;
      font-weight: 600;
    }
    .dimension-label {
      text-align: center;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: var(--space-1);
    }

    /* Type Selector */
    .type-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-3);
      margin-bottom: var(--space-5);
    }
    @media (min-width: 640px) {
      .type-grid { grid-template-columns: repeat(3, 1fr); }
    }
    .type-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-4);
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .type-btn:hover { border-color: var(--concrete-wet); background: var(--surface-raised); }
    .type-btn:focus-visible {
      outline: 3px solid var(--primary);
      outline-offset: 2px;
      box-shadow: 0 0 0 4px oklch(0.50 0.12 250 / 0.15);
    }
    .type-btn.selected {
      border-color: var(--primary);
      background: oklch(0.50 0.12 250 / 0.08);
      box-shadow: inset 0 0 0 1px var(--primary);
    }
    .type-btn svg { width: 32px; height: 32px; color: var(--concrete-wet); }
    .type-btn-label { font-weight: 500; font-size: 0.875rem; }
    .type-btn-price { font-size: 0.75rem; color: var(--text-muted); }

    /* Estimate Result */
    .estimate-result {
      background: linear-gradient(135deg, var(--concrete-wet), var(--earth-brown));
      border-radius: var(--radius-lg);
      padding: var(--space-6);
      color: white;
      text-align: center;
      margin-bottom: var(--space-5);
    }
    .estimate-label {
      font-size: 0.875rem;
      opacity: 0.85;
      margin-bottom: var(--space-2);
    }
    .estimate-price {
      font-family: var(--font-display);
      font-size: 3rem;
      font-weight: 700;
      line-height: 1;
      margin-bottom: var(--space-3);
    }
    .estimate-breakdown {
      font-size: 0.875rem;
      opacity: 0.85;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      padding: var(--space-3) var(--space-5);
      border: none;
      border-radius: var(--radius-md);
      font-family: var(--font-sans);
      font-size: 0.9375rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s ease;
      text-decoration: none;
    }
    .btn:focus-visible {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    .btn-primary:hover { background: var(--primary-hover); }
    .btn-primary:active { transform: scale(0.98); }
    .btn-secondary {
      background: var(--surface);
      color: var(--text);
      border: 1px solid var(--border);
    }
    .btn-secondary:hover { background: var(--surface-raised); border-color: var(--concrete-wet); }
    .btn-lg {
      padding: var(--space-4) var(--space-6);
      font-size: 1rem;
      width: 100%;
    }
    .btn-icon {
      width: 44px;
      height: 44px;
      padding: 0;
      border-radius: 50%;
    }

    /* Photo Capture */
    .photo-capture-area {
      border: 2px dashed var(--border);
      border-radius: var(--radius-lg);
      padding: var(--space-7);
      text-align: center;
      background: var(--surface-raised);
      cursor: pointer;
      transition: border-color 0.15s ease, background 0.15s ease;
    }
    .photo-capture-area:hover {
      border-color: var(--concrete-wet);
      background: oklch(0.55 0.04 55 / 0.05);
    }
    .photo-capture-area:focus-visible {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
    .photo-capture-area svg {
      width: 48px;
      height: 48px;
      color: var(--concrete-wet);
      margin-bottom: var(--space-3);
    }
    .photo-capture-text { color: var(--text-secondary); }

    .photo-preview {
      position: relative;
      border-radius: var(--radius-lg);
      overflow: hidden;
      margin-bottom: var(--space-4);
    }
    .photo-preview img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    .photo-preview-remove {
      position: absolute;
      top: var(--space-2);
      right: var(--space-2);
      width: 32px;
      height: 32px;
      background: oklch(0 0 0 / 0.6);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .photo-preview-remove:focus-visible {
      outline: 2px solid white;
      outline-offset: 2px;
    }

    /* Send Options */
    .send-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-3);
      margin-top: var(--space-5);
    }
    .send-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-4);
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .send-option:hover { border-color: var(--primary); background: var(--surface-raised); }
    .send-option:focus-visible {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px oklch(0.50 0.12 250 / 0.15);
    }
    .send-option svg { width: 28px; height: 28px; color: var(--primary); }
    .send-option-label { font-weight: 500; font-size: 0.875rem; }

    /* Project List */
    .project-list { margin-top: var(--space-5); }
    .project-grid {
      display: grid;
      gap: var(--space-4);
    }
    @media (min-width: 640px) {
      .project-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (min-width: 1024px) {
      .project-grid { grid-template-columns: repeat(3, 1fr); }
    }

    /* Filter Tabs */
    .filter-tabs {
      display: flex;
      gap: var(--space-2);
      overflow-x: auto;
      padding-bottom: var(--space-2);
      margin-bottom: var(--space-4);
      -webkit-overflow-scrolling: touch;
    }
    .filter-tab {
      padding: var(--space-2) var(--space-4);
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.15s ease;
    }
    .filter-tab:hover { border-color: var(--concrete-wet); }
    .filter-tab:focus-visible {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
    .filter-tab.active {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }

    /* Price List */
    .price-table {
      width: 100%;
      border-collapse: collapse;
    }
    .price-table th,
    .price-table td {
      padding: var(--space-3) var(--space-4);
      text-align: left;
      border-bottom: 1px solid var(--border-light);
    }
    .price-table th {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .price-table td { font-size: 0.9375rem; }
    .price-table .price { font-weight: 600; color: var(--earth-brown); }
    .price-table .editable {
      background: var(--surface-raised);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: var(--space-2);
      text-align: right;
      width: 80px;
      font-family: var(--font-sans);
      font-weight: 600;
    }
    .price-table .editable:focus {
      outline: none;
      border-color: var(--primary);
    }

    /* Step Indicator */
    .step-indicator {
      display: flex;
      justify-content: center;
      gap: var(--space-3);
      margin-bottom: var(--space-5);
    }
    .step-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--border);
    }
    .step-dot.active { background: var(--primary); }
    .step-dot.done { background: var(--success); }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: var(--space-8) var(--space-4);
    }
    .empty-state svg {
      width: 64px;
      height: 64px;
      color: var(--border);
      margin-bottom: var(--space-4);
    }
    .empty-state h3 {
      color: var(--text-secondary);
      margin-bottom: var(--space-2);
    }
    .empty-state p { color: var(--text-muted); }

    /* Toast */
    .toast-container {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
    }
    @media (min-width: 1024px) {
      .toast-container { bottom: 32px; }
    }
    .toast {
      background: var(--text);
      color: white;
      padding: var(--space-3) var(--space-5);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      font-size: 0.875rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: var(--space-2);
      animation: toastIn 0.3s ease;
    }
    .toast.hiding { animation: toastOut 0.2s ease forwards; }
    @keyframes toastIn {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes toastOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(16px); }
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: oklch(0 0 0 / 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-4);
      z-index: 200;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease, visibility 0.2s ease;
    }
    .modal-overlay.open { opacity: 1; visibility: visible; }
    .modal {
      background: var(--surface);
      border-radius: var(--radius-lg);
      max-width: 400px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      transform: scale(0.95);
      transition: transform 0.2s ease;
    }
    .modal-overlay.open .modal { transform: scale(1); }
    .modal-header {
      padding: var(--space-4) var(--space-5);
      border-bottom: 1px solid var(--border-light);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .modal-header h2 { font-size: 1.125rem; }
    .modal-close {
      width: 32px;
      height: 32px;
      background: transparent;
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      transition: background 0.15s ease;
    }
    .modal-close:hover { background: var(--surface-raised); }
    .modal-close:focus-visible {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
    .modal-body { padding: var(--space-5); }

    /* Auth Screen */
    .auth-screen {
      min-height: 100vh;
      min-height: 100dvh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--space-6);
      background: linear-gradient(180deg, var(--bg) 0%, oklch(0.92 0.02 80) 100%);
    }
    .auth-card {
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: var(--space-6);
      width: 100%;
      max-width: 360px;
      box-shadow: var(--shadow-lg);
      text-align: center;
    }
    .auth-logo {
      width: 64px;
      height: 64px;
      background: linear-gradient(135deg, var(--concrete-wet), var(--earth-brown));
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      margin: 0 auto var(--space-5);
    }
    .auth-title {
      font-size: 1.375rem;
      margin-bottom: var(--space-2);
    }
    .auth-subtitle {
      color: var(--text-secondary);
      font-size: 0.9375rem;
      margin-bottom: var(--space-6);
    }
    .auth-error {
      background: oklch(0.55 0.18 25 / 0.1);
      color: var(--error);
      padding: var(--space-3);
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      margin-bottom: var(--space-4);
      display: none;
    }
    .auth-error.show { display: block; }

    /* Print Styles */
    @media print {
      .demo-banner, .bottom-nav, .desktop-nav, .app-header { display: none !important; }
      .main-content { padding: 0; }
      .project-card { break-inside: avoid; box-shadow: none; border: 1px solid #ccc; }
      .estimate-result { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }

    /* Project Detail */
    .detail-header {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      margin-bottom: var(--space-5);
    }
    .detail-back {
      width: 40px;
      height: 40px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.15s ease;
    }
    .detail-back:hover { background: var(--surface-raised); }
    .detail-back:focus-visible {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
    .detail-hero {
      height: 200px;
      border-radius: var(--radius-lg);
      overflow: hidden;
      margin-bottom: var(--space-5);
    }
    .detail-hero img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .detail-status {
      display: inline-flex;
      padding: var(--space-1) var(--space-3);
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: var(--space-3);
    }
    .detail-info { margin-bottom: var(--space-5); }
    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: var(--space-3) 0;
      border-bottom: 1px solid var(--border-light);
    }
    .detail-label { color: var(--text-secondary); }
    .detail-value { font-weight: 500; }
    .detail-actions {
      display: flex;
      gap: var(--space-3);
      margin-top: var(--space-5);
    }
    .detail-actions .btn { flex: 1; }

    /* Live Region for A11y */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      white-space: nowrap;
      border: 0;
    }

    /* Skip Link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--primary);
      color: white;
      padding: 8px 16px;
      z-index: 10000;
      text-decoration: none;
      font-weight: 500;
      border-radius: 0 0 4px 0;
      transition: top 0.2s ease;
    }
    .skip-link:focus {
      top: 0;
      outline: 3px solid white;
      outline-offset: -3px;
    }
  </style>
</head>
<body>
  <!-- Live Region for Screen Readers -->
  <div id="liveRegion" class="sr-only" aria-live="polite" aria-atomic="true"></div>

  <!-- Skip Link for Keyboard Users -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Auth Screen -->
  <div id="authScreen" class="auth-screen">
    <div class="auth-card">
      <div class="auth-logo">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="6" width="20" height="12" rx="2"/>
          <path d="M12 12h.01"/>
          <path d="M17 12h.01"/>
          <path d="M7 12h.01"/>
        </svg>
      </div>
      <h1 class="auth-title">Keller QuickQuote</h1>
      <p class="auth-subtitle">Built for Keller Concrete Company — quick estimates on the job site</p>
      <div id="authError" class="auth-error" role="alert">Invalid access key. Please try again.</div>
      <form id="authForm">
        <div class="form-group">
          <label for="accessKey" class="form-label">Access Key</label>
          <input type="password" id="accessKey" class="form-input" placeholder="Enter your key" autocomplete="off" required>
        </div>
        <button type="submit" class="btn btn-primary btn-lg">Unlock Tool</button>
      </form>
    </div>
  </div>

  <!-- Main App -->
  <div id="mainApp" class="app-container" style="display: none;">
    <!-- Demo Banner -->
    <div id="demoBanner" class="demo-banner">
      <p>Sample jobs from around Keller, TX — tap X to start fresh with your own.</p>
      <button id="clearDemoBtn" aria-label="Clear demo data">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <!-- Header -->
    <header class="app-header">
      <div class="header-content">
        <div class="logo">
          <div class="logo-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="6" width="20" height="12" rx="2"/>
              <path d="M12 12h.01"/>
            </svg>
          </div>
          <span>QuickQuote</span>
        </div>
        <nav class="desktop-nav" role="navigation" aria-label="Main navigation">
          <button class="nav-btn active" data-screen="estimate" aria-current="page">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
              <polyline points="14 2 14 8 20 8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <line x1="10" y1="9" x2="8" y2="9"/>
            </svg>
            New Estimate
          </button>
          <button class="nav-btn" data-screen="projects">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
            </svg>
            My Projects
          </button>
          <button class="nav-btn" data-screen="prices">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="1" x2="12" y2="23"/>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
            Price List
          </button>
          <button class="nav-btn disabled" aria-disabled="true" title="Coming soon with full version">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            Crew
            <span class="badge">PRO</span>
          </button>
        </nav>
      </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="main-content" role="main" tabindex="-1">
      <!-- Estimate Screen -->
      <section id="estimateScreen" class="screen active" aria-labelledby="estimateHeading">
        <h1 id="estimateHeading" class="sr-only">Create New Estimate</h1>
        
        <!-- Step Indicator -->
        <div class="step-indicator" role="group" aria-label="Estimate progress">
          <div class="step-dot active" aria-label="Step 1: Take photo"></div>
          <div class="step-dot" aria-label="Step 2: Select type"></div>
          <div class="step-dot" aria-label="Step 3: Enter dimensions"></div>
          <div class="step-dot" aria-label="Step 4: Review and send"></div>
        </div>

        <!-- Step 1: Photo -->
        <div id="step1" class="estimate-step">
          <h2 style="margin-bottom: var(--space-4);">Take a Photo of the Work Area</h2>
          <div id="photoCapture" class="photo-capture-area" tabindex="0" role="button" aria-label="Tap to take photo">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
              <circle cx="12" cy="13" r="4"/>
            </svg>
            <p class="photo-capture-text">Snap a photo of the work area</p>
          </div>
          <input type="file" id="photoInput" accept="image/*" capture="environment" hidden>
          <div id="photoPreviewContainer" class="photo-preview" style="display: none;">
            <img id="photoPreview" src="" alt="Captured job site photo">
            <button id="removePhoto" class="photo-preview-remove" aria-label="Remove photo">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
          <button id="skipPhoto" class="btn btn-secondary" style="width: 100%; margin-top: var(--space-4);">Skip Photo</button>
        </div>

        <!-- Step 2: Type -->
        <div id="step2" class="estimate-step" style="display: none;">
          <h2 style="margin-bottom: var(--space-4);">What Type of Project?</h2>
          <div class="type-grid" role="radiogroup" aria-label="Project type selection">
            <button class="type-btn" data-type="driveway" data-price="6" role="radio" aria-checked="false">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <path d="M3 9h18"/>
                <path d="M9 21V9"/>
              </svg>
              <span class="type-btn-label">Driveway</span>
              <span class="type-btn-price">$6/sqft</span>
            </button>
            <button class="type-btn" data-type="patio" data-price="7" role="radio" aria-checked="false">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="2" y="6" width="20" height="12" rx="2"/>
                <path d="M6 12h.01"/>
                <path d="M12 12h.01"/>
                <path d="M18 12h.01"/>
              </svg>
              <span class="type-btn-label">Patio</span>
              <span class="type-btn-price">$7/sqft</span>
            </button>
            <button class="type-btn" data-type="stamped" data-price="14" role="radio" aria-checked="false">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <path d="M3 9h18"/>
                <path d="M3 15h18"/>
                <path d="M9 3v18"/>
                <path d="M15 3v18"/>
              </svg>
              <span class="type-btn-label">Stamped</span>
              <span class="type-btn-price">$14/sqft</span>
            </button>
            <button class="type-btn" data-type="slab" data-price="5" role="radio" aria-checked="false">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="2" y="6" width="20" height="12" rx="1"/>
              </svg>
              <span class="type-btn-label">Slab</span>
              <span class="type-btn-price">$5/sqft</span>
            </button>
            <button class="type-btn" data-type="pool" data-price="10" role="radio" aria-checked="false">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M2 12c1.5 1.5 3 2 4.5 2s3-0.5 4.5-2c1.5 1.5 3 2 4.5 2s3-0.5 4.5-2"/>
                <path d="M2 17c1.5 1.5 3 2 4.5 2s3-0.5 4.5-2c1.5 1.5 3 2 4.5 2s3-0.5 4.5-2"/>
                <rect x="4" y="4" width="16" height="8" rx="2"/>
              </svg>
              <span class="type-btn-label">Pool Deck</span>
              <span class="type-btn-price">$10/sqft</span>
            </button>
            <button class="type-btn" data-type="wall" data-price="25" role="radio" aria-checked="false">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M4 4h16v16H4z"/>
                <path d="M4 10h16"/>
                <path d="M10 4v6"/>
                <path d="M16 10v10"/>
                <path d="M10 16h6"/>
              </svg>
              <span class="type-btn-label">Retaining Wall</span>
              <span class="type-btn-price">$25/linear ft</span>
            </button>
          </div>
        </div>

        <!-- Step 3: Dimensions -->
        <div id="step3" class="estimate-step" style="display: none;">
          <h2 style="margin-bottom: var(--space-4);">Enter Dimensions</h2>
          <div class="dimension-grid">
            <div>
              <input type="number" id="dimLength" class="form-input dimension-input" placeholder="20" min="1" max="999" aria-label="Length in feet">
              <div class="dimension-label">Length (ft)</div>
            </div>
            <span class="separator">x</span>
            <div>
              <input type="number" id="dimWidth" class="form-input dimension-input" placeholder="20" min="1" max="999" aria-label="Width in feet">
              <div class="dimension-label">Width (ft)</div>
            </div>
            <span class="separator">x</span>
            <div>
              <input type="number" id="dimDepth" class="form-input dimension-input" placeholder="4" min="1" max="24" value="4" aria-label="Depth in inches">
              <div class="dimension-label">Depth (in)</div>
            </div>
          </div>
          <button id="calculateBtn" class="btn btn-primary btn-lg">Calculate Estimate</button>
        </div>

        <!-- Step 4: Result -->
        <div id="step4" class="estimate-step" style="display: none;">
          <div class="estimate-result">
            <div class="estimate-label">Your Estimate</div>
            <div id="estimatePrice" class="estimate-price">$0</div>
            <div id="estimateBreakdown" class="estimate-breakdown">0 sq ft | 0 cubic yards</div>
          </div>
          
          <div class="form-group">
            <label for="customerName" class="form-label">Customer Name <span aria-label="optional">(optional)</span></label>
            <input type="text" id="customerName" class="form-input" placeholder="e.g. Johnson Residence" autocomplete="name">
          </div>
          
          <div class="form-group">
            <label for="customerPhone" class="form-label">Phone Number <span aria-label="required">*</span></label>
            <input type="tel" id="customerPhone" class="form-input" placeholder="(817) 555-0123" autocomplete="tel" aria-required="true" required>
          </div>

          <div class="form-group">
            <label for="estimateNotes" class="form-label">Notes <span aria-label="optional">(optional)</span></label>
            <textarea id="estimateNotes" class="form-input" rows="2" placeholder="Access issues, color preferences, etc."></textarea>
          </div>

          <div class="send-options">
            <button id="sendText" class="send-option" aria-label="Send via text message">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
              </svg>
              <span class="send-option-label">Text</span>
            </button>
            <button id="sendShare" class="send-option" aria-label="Share via other apps">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="18" cy="5" r="3"/>
                <circle cx="6" cy="12" r="3"/>
                <circle cx="18" cy="19" r="3"/>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
              </svg>
              <span class="send-option-label">Share</span>
            </button>
          </div>
          
          <button id="saveProject" class="btn btn-secondary btn-lg" style="margin-top: var(--space-4);">Save Without Sending</button>
          <button id="newEstimate" class="btn btn-secondary" style="width: 100%; margin-top: var(--space-3);">Start New Estimate</button>
        </div>
      </section>

      <!-- Projects Screen -->
      <section id="projectsScreen" class="screen" aria-labelledby="projectsHeading">
        <h1 id="projectsHeading" style="margin-bottom: var(--space-4);">My Projects</h1>
        
        <div class="filter-tabs" role="tablist" aria-label="Filter projects by status">
          <button class="filter-tab active" data-filter="all" role="tab" aria-selected="true">All</button>
          <button class="filter-tab" data-filter="lead" role="tab" aria-selected="false">Leads</button>
          <button class="filter-tab" data-filter="pending" role="tab" aria-selected="false">Pending</button>
          <button class="filter-tab" data-filter="progress" role="tab" aria-selected="false">In Progress</button>
          <button class="filter-tab" data-filter="complete" role="tab" aria-selected="false">Complete</button>
        </div>

        <div id="projectGrid" class="project-grid" role="list"></div>
        
        <div id="emptyProjects" class="empty-state" style="display: none;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
          </svg>
          <h3>No projects yet</h3>
          <p>Tap the camera to price your first job.</p>
        </div>
      </section>

      <!-- Project Detail Screen -->
      <section id="detailScreen" class="screen" aria-labelledby="detailHeading">
        <div class="detail-header">
          <button id="detailBack" class="detail-back" aria-label="Go back to projects">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"/>
            </svg>
          </button>
          <h1 id="detailHeading">Project Details</h1>
        </div>
        
        <div id="detailHero" class="detail-hero">
          <img src="" alt="Project photo">
        </div>
        
        <div id="detailStatus" class="detail-status"></div>
        <h2 id="detailTitle" style="margin-bottom: var(--space-2);"></h2>
        <p id="detailType" style="color: var(--text-secondary); margin-bottom: var(--space-5);"></p>
        
        <div class="card detail-info">
          <div class="detail-row">
            <span class="detail-label">Estimate</span>
            <span id="detailPrice" class="detail-value"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Dimensions</span>
            <span id="detailDims" class="detail-value"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Cubic Yards</span>
            <span id="detailYards" class="detail-value"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Phone</span>
            <span id="detailPhone" class="detail-value"></span>
          </div>
          <div class="detail-row" style="border-bottom: none;">
            <span class="detail-label">Created</span>
            <span id="detailDate" class="detail-value"></span>
          </div>
        </div>
        
        <div class="detail-actions">
          <button id="detailResend" class="btn btn-primary">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            Resend
          </button>
          <button id="detailDelete" class="btn btn-secondary" style="color: var(--error);">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"/>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
            Delete
          </button>
        </div>
      </section>

      <!-- Prices Screen -->
      <section id="pricesScreen" class="screen" aria-labelledby="pricesHeading">
        <h1 id="pricesHeading" style="margin-bottom: var(--space-2);">Price List</h1>
        <p style="color: var(--text-secondary); margin-bottom: var(--space-5);">Adjust these to match your current rates. Your changes stick automatically.</p>
        
        <div class="card">
          <table class="price-table" role="table">
            <thead>
              <tr>
                <th scope="col">Project Type</th>
                <th scope="col" style="text-align: right;">Price</th>
              </tr>
            </thead>
            <tbody id="priceTableBody">
              <!-- Filled by JS -->
            </tbody>
          </table>
        </div>
        
        <p style="margin-top: var(--space-5); font-size: 0.8125rem; color: var(--text-muted);">
          Prices are per square foot (retaining walls are per linear foot). Bump them up if concrete prices have jumped lately.
        </p>
      </section>
    </main>

    <!-- Bottom Nav (Mobile) -->
    <nav class="bottom-nav" role="navigation" aria-label="Main navigation">
      <button class="bottom-nav-btn active" data-screen="estimate" aria-current="page" aria-label="New Estimate">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
        </svg>
        Estimate
      </button>
      <button class="bottom-nav-btn" data-screen="projects" aria-label="My Projects">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
        </svg>
        Projects
      </button>
      <button class="bottom-nav-btn" data-screen="prices" aria-label="Price List">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="1" x2="12" y2="23"/>
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
        </svg>
        Prices
      </button>
      <button class="bottom-nav-btn disabled" aria-disabled="true" aria-label="Crew Management - Coming soon with Pro version">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
        Crew
      </button>
    </nav>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container" role="status" aria-live="polite"></div>

  <script>
    // Anti-scrape protection
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('selectstart', e => {
      if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
        e.preventDefault();
      }
    });
    
    // Anti-devtools detection
    (function() {
      const threshold = 160;
      const checkDevTools = () => {
        const widthThreshold = window.outerWidth - window.innerWidth > threshold;
        const heightThreshold = window.outerHeight - window.innerHeight > threshold;
        if (widthThreshold || heightThreshold) {
          document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;background:#f5f5f5;"><div style="text-align:center;padding:40px;"><h1 style="color:#6B5B4F;">Tool Locked</h1><p>Please close developer tools to continue.</p></div></div>';
        }
      };
      setInterval(checkDevTools, 2000);
      
      // Debugger trap
      setInterval(() => {
        const start = performance.now();
        debugger;
        if (performance.now() - start > 100) {
          window.location.reload();
        }
      }, 1000);
    })();

    // Access Key Auth
    const _E = [107,108,99,110,50,48,50,54];
    const _K = _E.map(c => String.fromCharCode(c)).join('');
    function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
    const _V = _h(_K);

    // IndexedDB Setup
    const DB_NAME = 'KellerQuickQuoteDB';
    const DB_VERSION = 1;
    let db;

    function openDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        request.onerror = () => reject(request.error);
        request.onsuccess = () => {
          db = request.result;
          resolve(db);
        };
        request.onupgradeneeded = (e) => {
          const database = e.target.result;
          if (!database.objectStoreNames.contains('projects')) {
            const store = database.createObjectStore('projects', { keyPath: 'id', autoIncrement: true });
            store.createIndex('status', 'status', { unique: false });
            store.createIndex('created', 'created', { unique: false });
          }
          if (!database.objectStoreNames.contains('prices')) {
            database.createObjectStore('prices', { keyPath: 'type' });
          }
          if (!database.objectStoreNames.contains('settings')) {
            database.createObjectStore('settings', { keyPath: 'key' });
          }
        };
      });
    }

    // Default Prices
    const defaultPrices = [
      { type: 'driveway', label: 'Driveway', price: 6, unit: 'sqft' },
      { type: 'patio', label: 'Patio', price: 7, unit: 'sqft' },
      { type: 'stamped', label: 'Stamped Concrete', price: 14, unit: 'sqft' },
      { type: 'slab', label: 'Concrete Slab', price: 5, unit: 'sqft' },
      { type: 'pool', label: 'Pool Deck', price: 10, unit: 'sqft' },
      { type: 'wall', label: 'Retaining Wall', price: 25, unit: 'linear ft' }
    ];

    // Demo Projects — Realistic Keller/Southlake/Colleyville area jobs
    const demoProjects = [
      {
        name: 'Walsh Ranch — Miller Residence',
        type: 'stamped',
        typeLabel: 'Stamped Patio',
        length: 22,
        width: 18,
        depth: 4,
        sqft: 396,
        yards: 4.9,
        price: 5544,
        phone: '(817) 934-2847',
        status: 'complete',
        created: Date.now() - 12 * 24 * 60 * 60 * 1000,
        photo: 'data:image/svg+xml,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="200" viewBox="0 0 400 200"><rect fill="#A0926D" width="400" height="200"/><text x="200" y="100" text-anchor="middle" fill="#6B5B4F" font-family="sans-serif" font-size="14">Stamped Patio — Colleyville</text></svg>')
      },
      {
        name: 'Pecan Square — Davis Driveway',
        type: 'driveway',
        typeLabel: 'Standard Driveway',
        length: 32,
        width: 22,
        depth: 4,
        sqft: 704,
        yards: 8.7,
        price: 4928,
        phone: '(682) 555-0192',
        status: 'progress',
        created: Date.now() - 3 * 24 * 60 * 60 * 1000,
        photo: 'data:image/svg+xml,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="200" viewBox="0 0 400 200"><rect fill="#C4A77D" width="400" height="200"/><text x="200" y="100" text-anchor="middle" fill="#6B5B4F" font-family="sans-serif" font-size="14">Driveway Pour — North Richland Hills</text></svg>')
      },
      {
        name: 'Carillon — Patel Pool Deck',
        type: 'pool',
        typeLabel: 'Pool Deck Repair',
        length: 24,
        width: 16,
        depth: 4,
        sqft: 384,
        yards: 4.7,
        price: 3840,
        phone: '(817) 503-8821',
        status: 'pending',
        created: Date.now() - 1 * 24 * 60 * 60 * 1000,
        photo: 'data:image/svg+xml,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="200" viewBox="0 0 400 200"><rect fill="#8B7355" width="400" height="200"/><text x="200" y="100" text-anchor="middle" fill="#FFF" font-family="sans-serif" font-size="14">Pool Deck — Keller</text></svg>')
      }
    ];

    // State
    let currentStep = 1;
    let currentPhoto = null;
    let selectedType = null;
    let prices = [...defaultPrices];
    let currentProject = null;
    let projectFilter = 'all';

    // DOM Elements
    const authScreen = document.getElementById('authScreen');
    const mainApp = document.getElementById('mainApp');
    const authForm = document.getElementById('authForm');
    const authError = document.getElementById('authError');
    const accessKeyInput = document.getElementById('accessKey');
    const demoBanner = document.getElementById('demoBanner');
    const clearDemoBtn = document.getElementById('clearDemoBtn');
    const liveRegion = document.getElementById('liveRegion');

    // Init
    async function init() {
      await openDB();
      
      // Check if already authed
      const settings = await getFromStore('settings', 'authed');
      if (settings && settings.value) {
        showApp();
      }
    }

    // Auth
    authForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const key = accessKeyInput.value.trim();
      if (_h(key) === _V) {
        authError.classList.remove('show');
        await putToStore('settings', { key: 'authed', value: true });
        showApp();
      } else {
        authError.classList.add('show');
        accessKeyInput.focus();
        announce('Invalid access key. Please try again.');
      }
    });

    async function showApp() {
      authScreen.style.display = 'none';
      mainApp.style.display = 'flex';
      
      // Load prices
      const storedPrices = await getAllFromStore('prices');
      if (storedPrices.length > 0) {
        prices = storedPrices;
      } else {
        // Save default prices
        for (const p of defaultPrices) {
          await putToStore('prices', p);
        }
      }
      
      // Check if demo data loaded
      const demoLoaded = await getFromStore('settings', 'demoLoaded');
      const projects = await getAllFromStore('projects');
      
      if (!demoLoaded && projects.length === 0) {
        // Load demo data
        for (const p of demoProjects) {
          await putToStore('projects', p);
        }
        await putToStore('settings', { key: 'demoLoaded', value: true });
        demoBanner.classList.remove('hidden');
      } else if (demoLoaded && demoLoaded.value && projects.length > 0) {
        demoBanner.classList.remove('hidden');
      } else {
        demoBanner.classList.add('hidden');
      }
      
      renderPriceTable();
      renderProjects();
      updateTypePrices();
    }

    // Clear Demo Data
    clearDemoBtn.addEventListener('click', async () => {
      const tx = db.transaction('projects', 'readwrite');
      tx.objectStore('projects').clear();
      await putToStore('settings', { key: 'demoLoaded', value: false });
      demoBanner.classList.add('hidden');
      renderProjects();
      showToast('Demo data cleared');
      announce('Demo data cleared. Start fresh with your own projects.');
    });

    // Navigation
    document.querySelectorAll('[data-screen]').forEach(btn => {
      btn.addEventListener('click', () => {
        if (btn.classList.contains('disabled')) {
          showToast('Coming soon with full version');
          return;
        }
        const screen = btn.getAttribute('data-screen');
        switchScreen(screen);
      });
    });

    function switchScreen(screenId) {
      // Update nav
      document.querySelectorAll('[data-screen]').forEach(b => {
        b.classList.remove('active');
        b.removeAttribute('aria-current');
      });
      document.querySelectorAll(`[data-screen="${screenId}"]`).forEach(b => {
        b.classList.add('active');
        b.setAttribute('aria-current', 'page');
      });
      
      // Update screen
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(screenId + 'Screen').classList.add('active');
      
      // Announce to screen readers
      const screenNames = {
        estimate: 'New Estimate',
        projects: 'My Projects',
        prices: 'Price List',
        detail: 'Project Details'
      };
      announce(`Navigated to ${screenNames[screenId] || screenId}`);
    }

    // Photo Capture
    const photoCapture = document.getElementById('photoCapture');
    const photoInput = document.getElementById('photoInput');
    const photoPreviewContainer = document.getElementById('photoPreviewContainer');
    const photoPreview = document.getElementById('photoPreview');
    const removePhoto = document.getElementById('removePhoto');
    const skipPhoto = document.getElementById('skipPhoto');

    photoCapture.addEventListener('click', () => photoInput.click());
    photoCapture.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        photoInput.click();
      }
    });

    photoInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (ev) => {
          currentPhoto = ev.target.result;
          photoPreview.src = currentPhoto;
          photoPreviewContainer.style.display = 'block';
          photoCapture.style.display = 'none';
          showToast('Photo captured');
          announce('Photo captured successfully');
          setTimeout(() => goToStep(2), 500);
        };
        reader.readAsDataURL(file);
      }
    });

    removePhoto.addEventListener('click', () => {
      currentPhoto = null;
      photoPreviewContainer.style.display = 'none';
      photoCapture.style.display = 'block';
      photoInput.value = '';
      announce('Photo removed');
    });

    skipPhoto.addEventListener('click', () => goToStep(2));

    // Type Selection
    document.querySelectorAll('.type-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.type-btn').forEach(b => {
          b.classList.remove('selected');
          b.setAttribute('aria-checked', 'false');
        });
        btn.classList.add('selected');
        btn.setAttribute('aria-checked', 'true');
        selectedType = {
          type: btn.dataset.type,
          price: parseFloat(btn.dataset.price),
          label: btn.querySelector('.type-btn-label').textContent
        };
        announce(`Selected ${selectedType.label}`);
        setTimeout(() => goToStep(3), 300);
      });
    });

    // Calculate
    const calculateBtn = document.getElementById('calculateBtn');
    const dimLength = document.getElementById('dimLength');
    const dimWidth = document.getElementById('dimWidth');
    const dimDepth = document.getElementById('dimDepth');

    calculateBtn.addEventListener('click', () => {
      const length = parseFloat(dimLength.value) || 0;
      const width = parseFloat(dimWidth.value) || 0;
      const depth = parseFloat(dimDepth.value) || 4;
      
      if (length === 0 || width === 0) {
        showToast('Enter length and width first');
        announce('Please enter length and width');
        return;
      }

      const sqft = length * width;
      const cubicYards = (sqft * (depth / 12)) / 27;
      const currentPrice = prices.find(p => p.type === selectedType.type)?.price || selectedType.price;
      const total = sqft * currentPrice;

      document.getElementById('estimatePrice').textContent = '$' + total.toLocaleString();
      document.getElementById('estimateBreakdown').textContent = `${sqft.toLocaleString()} sq ft | ${cubicYards.toFixed(1)} cubic yards`;

      currentProject = {
        type: selectedType.type,
        typeLabel: selectedType.label,
        length,
        width,
        depth,
        sqft,
        yards: parseFloat(cubicYards.toFixed(1)),
        price: total,
        photo: currentPhoto,
        status: 'lead',
        created: Date.now()
      };

      goToStep(4);
      announce(`Estimate calculated: $${total.toLocaleString()} for ${sqft} square feet`);
    });

    // Step Navigation
    function goToStep(step) {
      currentStep = step;
      
      document.querySelectorAll('.estimate-step').forEach(s => s.style.display = 'none');
      document.getElementById('step' + step).style.display = 'block';
      
      // Update step dots
      document.querySelectorAll('.step-dot').forEach((dot, i) => {
        dot.classList.remove('active', 'done');
        if (i + 1 < step) dot.classList.add('done');
        if (i + 1 === step) dot.classList.add('active');
      });
    }

    // Send Estimate
    document.getElementById('sendText').addEventListener('click', async () => {
      const name = document.getElementById('customerName').value.trim();
      const phone = document.getElementById('customerPhone').value.trim();
      const notes = document.getElementById('estimateNotes').value.trim();

      if (!phone) {
        showToast('Enter phone number');
        document.getElementById('customerPhone').focus();
        return;
      }

      currentProject.name = name || 'New Project';
      currentProject.phone = phone;
      currentProject.notes = notes;
      currentProject.status = 'pending';

      await putToStore('projects', currentProject);
      
      // Create SMS message
      const message = `Estimate from Keller Concrete:\n\n${currentProject.typeLabel}\n${currentProject.sqft} sq ft\nTotal: $${currentProject.price.toLocaleString()}\n\n${notes ? 'Notes: ' + notes + '\n\n' : ''}Questions? Call (817) 993-5180`;
      
      window.open(`sms:${phone}?body=${encodeURIComponent(message)}`);
      
      showToast('Estimate sent via text');
      announce('Estimate sent via text message');
      renderProjects();
      resetEstimate();
    });

    document.getElementById('sendShare').addEventListener('click', async () => {
      const name = document.getElementById('customerName').value.trim();
      const phone = document.getElementById('customerPhone').value.trim();
      const notes = document.getElementById('estimateNotes').value.trim();

      currentProject.name = name || 'New Project';
      currentProject.phone = phone || 'Not provided';
      currentProject.notes = notes;
      currentProject.status = 'pending';

      await putToStore('projects', currentProject);

      if (navigator.share) {
        try {
          await navigator.share({
            title: `Estimate: ${currentProject.name}`,
            text: `${currentProject.typeLabel}\n${currentProject.sqft} sq ft\nEstimate: $${currentProject.price.toLocaleString()}\n\nKeller Concrete Company\n(817) 993-5180`
          });
          showToast('Estimate shared');
          announce('Estimate shared successfully');
        } catch (err) {
          if (err.name !== 'AbortError') {
            showToast('Could not share');
          }
        }
      } else {
        // Fallback to clipboard
        const text = `${currentProject.typeLabel}\n${currentProject.sqft} sq ft\nEstimate: $${currentProject.price.toLocaleString()}\n\nKeller Concrete Company\n(817) 993-5180`;
        await navigator.clipboard.writeText(text);
        showToast('Estimate copied to clipboard');
        announce('Estimate copied to clipboard');
      }

      renderProjects();
      resetEstimate();
    });

    document.getElementById('saveProject').addEventListener('click', async () => {
      const name = document.getElementById('customerName').value.trim();
      const phone = document.getElementById('customerPhone').value.trim();
      const notes = document.getElementById('estimateNotes').value.trim();

      currentProject.name = name || 'Unnamed Project';
      currentProject.phone = phone || '';
      currentProject.notes = notes;
      currentProject.status = 'lead';

      await putToStore('projects', currentProject);
      
      showToast('Project saved');
      announce('Project saved to your list');
      renderProjects();
      resetEstimate();
    });

    document.getElementById('newEstimate').addEventListener('click', resetEstimate);

    function resetEstimate() {
      currentStep = 1;
      currentPhoto = null;
      selectedType = null;
      currentProject = null;
      
      document.getElementById('customerName').value = '';
      document.getElementById('customerPhone').value = '';
      document.getElementById('estimateNotes').value = '';
      dimLength.value = '';
      dimWidth.value = '';
      dimDepth.value = '4';
      
      photoPreviewContainer.style.display = 'none';
      photoCapture.style.display = 'block';
      photoInput.value = '';
      
      document.querySelectorAll('.type-btn').forEach(b => {
        b.classList.remove('selected');
        b.setAttribute('aria-checked', 'false');
      });
      
      goToStep(1);
    }

    // Projects
    document.querySelectorAll('.filter-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.filter-tab').forEach(t => {
          t.classList.remove('active');
          t.setAttribute('aria-selected', 'false');
        });
        tab.classList.add('active');
        tab.setAttribute('aria-selected', 'true');
        projectFilter = tab.dataset.filter;
        renderProjects();
      });
    });

    async function renderProjects() {
      const grid = document.getElementById('projectGrid');
      const empty = document.getElementById('emptyProjects');
      
      let projects = await getAllFromStore('projects');
      
      // Sort by created date, newest first
      projects.sort((a, b) => b.created - a.created);
      
      // Filter
      if (projectFilter !== 'all') {
        projects = projects.filter(p => p.status === projectFilter);
      }
      
      if (projects.length === 0) {
        grid.innerHTML = '';
        empty.style.display = 'block';
        return;
      }
      
      empty.style.display = 'none';
      
      grid.innerHTML = projects.map(p => `
        <article class="project-card" data-id="${p.id}" tabindex="0" role="listitem" aria-label="${p.name}, ${p.typeLabel}, $${p.price.toLocaleString()}">
          <div class="project-card-image">
            ${p.photo ? `<img src="${p.photo}" alt="Photo of ${p.name}">` : `<div style="height:100%;display:flex;align-items:center;justify-content:center;color:var(--text-muted);">No photo</div>`}
            <span class="project-card-status status-${p.status}">${statusLabel(p.status)}</span>
          </div>
          <div class="project-card-body">
            <h3 class="project-card-title">${escapeHtml(p.name)}</h3>
            <p class="project-card-type">${p.typeLabel}</p>
            <div class="project-card-meta">
              <span class="project-card-price">$${p.price.toLocaleString()}</span>
              <span class="project-card-sqft">${p.sqft} sq ft</span>
            </div>
          </div>
        </article>
      `).join('');
      
      // Add click handlers
      grid.querySelectorAll('.project-card').forEach(card => {
        card.addEventListener('click', () => openProjectDetail(parseInt(card.dataset.id)));
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openProjectDetail(parseInt(card.dataset.id));
          }
        });
      });
    }

    function statusLabel(status) {
      const labels = {
        lead: 'Lead',
        pending: 'Pending',
        progress: 'In Progress',
        complete: 'Complete'
      };
      return labels[status] || status;
    }

    async function openProjectDetail(id) {
      const project = await getFromStore('projects', id);
      if (!project) return;
      
      currentProject = project;
      
      document.getElementById('detailHero').innerHTML = project.photo 
        ? `<img src="${project.photo}" alt="Photo of ${project.name}">`
        : '<div style="height:100%;display:flex;align-items:center;justify-content:center;background:var(--border-light);color:var(--text-muted);">No photo</div>';
      
      const statusEl = document.getElementById('detailStatus');
      statusEl.className = `detail-status status-${project.status}`;
      statusEl.textContent = statusLabel(project.status);
      
      document.getElementById('detailHeading').textContent = 'Project Details';
      document.getElementById('detailTitle').textContent = project.name;
      document.getElementById('detailType').textContent = project.typeLabel;
      document.getElementById('detailPrice').textContent = '$' + project.price.toLocaleString();
      document.getElementById('detailDims').textContent = `${project.length}' x ${project.width}' x ${project.depth}"`;
      document.getElementById('detailYards').textContent = project.yards.toFixed(1);
      document.getElementById('detailPhone').textContent = project.phone || 'Not provided';
      document.getElementById('detailDate').textContent = new Date(project.created).toLocaleDateString();
      
      switchScreen('detail');
    }

    document.getElementById('detailBack').addEventListener('click', () => {
      switchScreen('projects');
    });

    document.getElementById('detailResend').addEventListener('click', async () => {
      if (!currentProject || !currentProject.phone) {
        showToast('No phone number for this project');
        return;
      }
      
      const message = `Estimate from Keller Concrete:\n\n${currentProject.typeLabel}\n${currentProject.sqft} sq ft\nTotal: $${currentProject.price.toLocaleString()}\n\nQuestions? Call (817) 993-5180`;
      window.open(`sms:${currentProject.phone}?body=${encodeURIComponent(message)}`);
      showToast('Estimate resent');
    });

    document.getElementById('detailDelete').addEventListener('click', async () => {
      if (!currentProject) return;
      
      if (confirm('Delete this project?')) {
        await deleteFromStore('projects', currentProject.id);
        showToast('Project deleted');
        announce('Project deleted');
        renderProjects();
        switchScreen('projects');
      }
    });

    // Price Table
    function renderPriceTable() {
      const tbody = document.getElementById('priceTableBody');
      tbody.innerHTML = prices.map(p => `
        <tr>
          <td>${p.label}</td>
          <td style="text-align: right;">
            $<input type="number" class="editable" data-type="${p.type}" value="${p.price}" min="1" max="999" step="0.5" aria-label="${p.label} price per ${p.unit}">
            <span style="color: var(--text-muted);">/${p.unit}</span>
          </td>
        </tr>
      `).join('');
      
      tbody.querySelectorAll('.editable').forEach(input => {
        input.addEventListener('change', async (e) => {
          const type = e.target.dataset.type;
          const newPrice = parseFloat(e.target.value) || 1;
          
          const priceObj = prices.find(p => p.type === type);
          if (priceObj) {
            priceObj.price = newPrice;
            await putToStore('prices', priceObj);
            updateTypePrices();
            showToast('Price updated');
          }
        });
      });
    }

    function updateTypePrices() {
      document.querySelectorAll('.type-btn').forEach(btn => {
        const type = btn.dataset.type;
        const priceObj = prices.find(p => p.type === type);
        if (priceObj) {
          btn.dataset.price = priceObj.price;
          btn.querySelector('.type-btn-price').textContent = `$${priceObj.price}/${priceObj.unit}`;
        }
      });
    }

    // IndexedDB Helpers
    function getFromStore(storeName, key) {
      return new Promise((resolve, reject) => {
        const tx = db.transaction(storeName, 'readonly');
        const store = tx.objectStore(storeName);
        const request = store.get(key);
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }

    function getAllFromStore(storeName) {
      return new Promise((resolve, reject) => {
        const tx = db.transaction(storeName, 'readonly');
        const store = tx.objectStore(storeName);
        const request = store.getAll();
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }

    function putToStore(storeName, data) {
      return new Promise((resolve, reject) => {
        const tx = db.transaction(storeName, 'readwrite');
        const store = tx.objectStore(storeName);
        const request = store.put(data);
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }

    function deleteFromStore(storeName, key) {
      return new Promise((resolve, reject) => {
        const tx = db.transaction(storeName, 'readwrite');
        const store = tx.objectStore(storeName);
        const request = store.delete(key);
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
      });
    }

    // Toast
    function showToast(message, type = 'success') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.setAttribute('role', 'status');
      toast.setAttribute('aria-live', 'polite');
      
      const icon = type === 'success' 
        ? '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="20 6 9 17 4 12"/></svg>'
        : '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>';
      
      toast.innerHTML = `${icon}<span>${message}</span>`;
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('hiding');
        setTimeout(() => toast.remove(), 200);
      }, 2500);
    }

    // Screen Reader Announcements
    function announce(message) {
      liveRegion.textContent = message;
      setTimeout(() => { liveRegion.textContent = ''; }, 1000);
    }

    // Escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Init on load
    init();
  </script>
</body>
</html>
