<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>SewerScope Reporter | Simon Says Plumbing</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --gray-900: oklch(0.20 0.005 260);
      --gray-800: oklch(0.28 0.005 260);
      --gray-700: oklch(0.38 0.005 260);
      --gray-600: oklch(0.48 0.005 260);
      --gray-500: oklch(0.55 0.005 260);
      --gray-400: oklch(0.65 0.005 260);
      --gray-300: oklch(0.78 0.005 260);
      --gray-200: oklch(0.88 0.005 260);
      --gray-100: oklch(0.94 0.005 260);
      --gray-50: oklch(0.97 0.005 260);
      
      --orange-500: oklch(0.65 0.19 45);
      --orange-600: oklch(0.55 0.19 45);
      --orange-100: oklch(0.92 0.06 45);
      
      --red-500: oklch(0.55 0.22 25);
      --red-100: oklch(0.92 0.06 25);
      
      --green-500: oklch(0.55 0.16 145);
      --green-100: oklch(0.92 0.06 145);
      
      --blue-500: oklch(0.55 0.16 245);
      
      --bg: var(--gray-50);
      --surface: white;
      --text: var(--gray-900);
      --text-muted: var(--gray-600);
      --border: var(--gray-200);
      --accent: var(--orange-500);
      --accent-hover: var(--orange-600);
      
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 14px;
      
      --shadow-sm: 0 1px 2px oklch(0.2 0 0 / 0.05);
      --shadow-md: 0 4px 12px oklch(0.2 0 0 / 0.08);
      --shadow-lg: 0 8px 24px oklch(0.2 0 0 / 0.12);
    }
    
    html, body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      padding-bottom: 60px !important;
    }
    
    /* Lock Screen */
    #lockScreen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, var(--gray-800), var(--gray-900));
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 24px;
    }
    
    #lockScreen.hidden { display: none; }
    
    .lock-logo {
      width: 80px;
      height: 80px;
      background: var(--accent);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 24px;
      box-shadow: 0 8px 32px oklch(0.65 0.19 45 / 0.4);
    }
    
    .lock-logo svg {
      width: 48px;
      height: 48px;
      color: white;
    }
    
    .lock-title {
      color: white;
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
      text-align: center;
    }
    
    .lock-subtitle {
      color: var(--gray-400);
      font-size: 14px;
      margin-bottom: 32px;
      text-align: center;
    }
    
    .lock-form {
      width: 100%;
      max-width: 320px;
    }
    
    .lock-input {
      width: 100%;
      padding: 16px;
      background: var(--gray-700);
      border: 2px solid var(--gray-600);
      border-radius: var(--radius-md);
      color: white;
      font-size: 16px;
      text-align: center;
      letter-spacing: 4px;
      transition: border-color 0.2s;
    }
    
    .lock-input::placeholder {
      color: var(--gray-500);
      letter-spacing: 0;
    }
    
    .lock-input:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .lock-error {
      color: var(--red-500);
      font-size: 13px;
      text-align: center;
      margin-top: 12px;
      min-height: 20px;
    }
    
    /* Grain texture overlay */
    .grain-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 9999;
      opacity: 0.03;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    }

    /* Entrance animations */
    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(16px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-up {
      animation: fadeUp 0.4s ease-out forwards;
    }

    .stagger-1 { animation-delay: 0.05s; }
    .stagger-2 { animation-delay: 0.1s; }
    .stagger-3 { animation-delay: 0.15s; }
    .stagger-4 { animation-delay: 0.2s; }

    /* Enhanced micro-interactions */
    .inspection-card {
      background: var(--surface);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border);
      overflow: hidden;
      cursor: pointer;
      transition: box-shadow 0.2s, transform 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .inspection-card:hover {
      box-shadow: var(--shadow-md), 0 2px 8px oklch(0.65 0.19 45 / 0.08);
      transform: translateY(-2px);
    }

    .inspection-card:active {
      transform: translateY(0) scale(0.995);
      transition: transform 0.08s;
    }

    .header-new {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s, transform 0.1s, box-shadow 0.2s;
    }

    .header-new:hover {
      background: var(--accent-hover);
      box-shadow: 0 4px 12px oklch(0.65 0.19 45 / 0.35);
    }

    .header-new:active {
      transform: scale(0.96);
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Anti-scrape protection */
    .lock-logo, .header-icon, .inspection-card, .section {
      user-select: none;
      -webkit-user-select: none;
    }

    .lock-demo {
      color: var(--gray-400);
      font-size: 13px;
      text-align: center;
      margin-top: 24px;
    }
    
    .lock-demo button {
      background: none;
      border: none;
      color: var(--accent);
      cursor: pointer;
      font-size: 13px;
      text-decoration: underline;
      padding: 0;
    }
    
    .lock-demo button:hover {
      color: white;
    }
    
    /* Main App */
    #app {
      display: none;
      flex-direction: column;
      min-height: 100vh;
    }
    
    #app.visible { display: flex; }
    
    /* Header */
    .header {
      background: var(--gray-900);
      color: white;
      padding: 16px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .header-brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .header-icon {
      width: 36px;
      height: 36px;
      background: var(--accent);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .header-icon svg {
      width: 20px;
      height: 20px;
      color: white;
    }
    
    .header-title {
      font-size: 16px;
      font-weight: 600;
    }
    
    .header-count {
      font-size: 11px;
      background: var(--gray-700);
      padding: 4px 8px;
      border-radius: 20px;
      color: var(--gray-300);
    }
    
    .upgrade-hint {
      font-size: 11px;
      color: var(--accent);
    }
    
    .header-new {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s, transform 0.1s;
    }
    
    .header-new:hover {
      background: var(--accent-hover);
    }
    
    .header-new:active {
      transform: scale(0.97);
    }
    
    .header-new:focus-visible {
      outline: 2px solid white;
      outline-offset: 2px;
    }
    
    .header-new svg {
      width: 16px;
      height: 16px;
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      background: var(--gray-800);
      padding: 0 16px;
    }
    
    .tab {
      flex: 1;
      padding: 12px;
      background: none;
      border: none;
      color: var(--gray-400);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: color 0.2s, border-color 0.2s;
    }
    
    .tab.active {
      color: white;
      border-bottom-color: var(--accent);
    }
    
    .tab:hover:not(.active) {
      color: var(--gray-300);
    }
    
    .tab:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: -2px;
    }
    
    .tab.disabled {
      color: var(--gray-600);
      cursor: not-allowed;
      position: relative;
    }
    
    .tab.disabled::after {
      content: 'Full Version';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--gray-700);
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 4px;
      white-space: nowrap;
    }
    
    /* Content */
    .content {
      flex: 1;
      padding: 16px;
    }
    
    .panel { display: none; }
    .panel.active { display: block; }
    
    /* Inspection List */
    .inspection-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .inspection-card {
      background: var(--surface);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border);
      overflow: hidden;
      cursor: pointer;
      transition: box-shadow 0.2s, transform 0.15s;
    }
    
    .inspection-card:hover {
      box-shadow: var(--shadow-md);
    }
    
    .inspection-card:active {
      transform: scale(0.99);
    }
    
    .inspection-card:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 16px 16px 12px;
    }
    
    .card-address {
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 4px;
    }
    
    .card-date {
      font-size: 13px;
      color: var(--text-muted);
    }
    
    .card-status {
      font-size: 11px;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 20px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .status-complete {
      background: var(--green-100);
      color: var(--green-500);
    }
    
    .status-progress {
      background: var(--orange-100);
      color: var(--orange-600);
    }
    
    .status-sent {
      background: oklch(0.92 0.06 280);
      color: oklch(0.50 0.16 280);
    }
    
    .card-body {
      padding: 0 16px 16px;
    }
    
    .card-issue {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-muted);
    }
    
    .issue-icon {
      width: 32px;
      height: 32px;
      background: var(--gray-100);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .issue-icon svg {
      width: 18px;
      height: 18px;
      color: var(--gray-600);
    }
    
    .card-photos {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }
    
    .card-photo {
      width: 56px;
      height: 56px;
      background: var(--gray-200);
      border-radius: 8px;
      object-fit: cover;
    }
    
    .card-photo-more {
      width: 56px;
      height: 56px;
      background: var(--gray-200);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-muted);
    }
    
    /* Editor View */
    .editor { display: none; }
    .editor.active { display: flex; flex-direction: column; min-height: calc(100vh - 64px); }
    
    .editor-header {
      background: var(--gray-900);
      color: white;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .editor-back {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      padding: 8px 12px;
      margin: -8px -12px;
      border-radius: var(--radius-md);
    }
    
    .editor-back:hover {
      background: var(--gray-700);
    }
    
    .editor-back:focus-visible {
      outline: 2px solid var(--accent);
    }
    
    .editor-back svg {
      width: 20px;
      height: 20px;
    }
    
    .editor-actions {
      display: flex;
      gap: 8px;
    }
    
    .btn-icon {
      background: var(--gray-700);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s;
    }
    
    .btn-icon:hover {
      background: var(--gray-600);
    }
    
    .btn-icon:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    .btn-icon svg {
      width: 20px;
      height: 20px;
    }
    
    .btn-share {
      background: var(--accent);
    }
    
    .btn-share:hover {
      background: var(--accent-hover);
    }
    
    .editor-content {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
    }
    
    .section {
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border);
    }
    
    .section-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }
    
    /* Forms */
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-group:last-child {
      margin-bottom: 0;
    }
    
    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 6px;
      color: var(--text);
    }
    
    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 15px;
      background: var(--bg);
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px oklch(0.65 0.19 45 / 0.15);
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    
    .form-select {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 15px;
      background: var(--bg);
      cursor: pointer;
    }
    
    .form-select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px oklch(0.65 0.19 45 / 0.15);
    }
    
    /* Photo Grid */
    .photo-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }
    
    .photo-slot {
      aspect-ratio: 1;
      background: var(--gray-100);
      border-radius: var(--radius-md);
      border: 2px dashed var(--gray-300);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
      position: relative;
      overflow: hidden;
    }
    
    .photo-slot:hover {
      border-color: var(--accent);
      background: var(--orange-100);
    }
    
    .photo-slot:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    .photo-slot svg {
      width: 24px;
      height: 24px;
      color: var(--gray-400);
    }
    
    .photo-slot span {
      font-size: 11px;
      color: var(--gray-500);
      margin-top: 4px;
    }
    
    .photo-slot.has-photo {
      border: none;
    }
    
    .photo-slot img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .photo-remove {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 24px;
      height: 24px;
      background: oklch(0.2 0 0 / 0.7);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .photo-remove svg {
      width: 14px;
      height: 14px;
      color: white;
    }
    
    .photo-edit {
      position: absolute;
      bottom: 4px;
      right: 4px;
      width: 28px;
      height: 28px;
      background: var(--accent);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .photo-edit svg {
      width: 14px;
      height: 14px;
    }
    
    /* Pipe Diagram Builder */
    .diagram-builder {
      background: var(--gray-100);
      border-radius: var(--radius-md);
      padding: 12px;
    }
    
    .diagram-toolbar {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    
    .pipe-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px 12px;
      background: white;
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      font-size: 10px;
      color: var(--text-muted);
      transition: border-color 0.15s, background 0.15s;
    }
    
    .pipe-btn:hover {
      border-color: var(--accent);
    }
    
    .pipe-btn:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    .pipe-btn.active {
      border-color: var(--accent);
      background: var(--orange-100);
    }
    
    .pipe-btn svg {
      width: 24px;
      height: 24px;
      color: var(--gray-700);
    }
    
    .diagram-canvas-wrap {
      background: white;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      overflow: hidden;
      touch-action: none;
    }
    
    .diagram-canvas {
      width: 100%;
      height: 200px;
      display: block;
    }
    
    .diagram-legend {
      display: flex;
      gap: 16px;
      margin-top: 12px;
      font-size: 11px;
      color: var(--text-muted);
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 3px;
    }
    
    /* Issue Selection */
    .issue-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    
    .issue-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: var(--bg);
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      text-align: left;
      transition: border-color 0.15s, background 0.15s;
    }
    
    .issue-btn:hover {
      border-color: var(--gray-400);
    }
    
    .issue-btn:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    .issue-btn.selected {
      border-color: var(--accent);
      background: var(--orange-100);
    }
    
    .issue-btn-icon {
      width: 36px;
      height: 36px;
      background: var(--gray-200);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .issue-btn.selected .issue-btn-icon {
      background: var(--accent);
    }
    
    .issue-btn-icon svg {
      width: 20px;
      height: 20px;
      color: var(--gray-600);
    }
    
    .issue-btn.selected .issue-btn-icon svg {
      color: white;
    }
    
    .issue-btn-text {
      font-size: 13px;
      font-weight: 500;
    }
    
    /* Notes */
    .form-textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 15px;
      font-family: inherit;
      background: var(--bg);
      resize: vertical;
      min-height: 100px;
    }
    
    .form-textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px oklch(0.65 0.19 45 / 0.15);
    }
    
    /* Annotation Canvas Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: oklch(0.1 0 0 / 0.85);
      z-index: 500;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    .modal {
      background: var(--surface);
      border-radius: var(--radius-lg);
      width: 100%;
      max-width: 480px;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .modal-header {
      padding: 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .modal-title {
      font-size: 16px;
      font-weight: 600;
    }
    
    .modal-close {
      background: none;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
    }
    
    .modal-close:hover {
      background: var(--gray-100);
    }
    
    .modal-close:focus-visible {
      outline: 2px solid var(--accent);
    }
    
    .modal-body {
      padding: 16px;
      overflow-y: auto;
    }
    
    .annotation-tools {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .annotation-tool {
      flex: 1;
      padding: 10px;
      background: var(--bg);
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 13px;
      font-weight: 500;
    }
    
    .annotation-tool:hover {
      border-color: var(--gray-400);
    }
    
    .annotation-tool:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    .annotation-tool.active {
      border-color: var(--accent);
      background: var(--orange-100);
    }
    
    .annotation-tool svg {
      width: 18px;
      height: 18px;
    }
    
    .annotation-canvas-wrap {
      background: var(--gray-200);
      border-radius: var(--radius-md);
      overflow: hidden;
      touch-action: none;
    }
    
    .annotation-canvas {
      width: 100%;
      display: block;
    }
    
    .modal-footer {
      padding: 16px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 12px;
    }
    
    .btn {
      flex: 1;
      padding: 14px;
      border-radius: var(--radius-md);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
    }
    
    .btn:active {
      transform: scale(0.98);
    }
    
    .btn:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    .btn-secondary {
      background: var(--gray-100);
      border: 1px solid var(--border);
      color: var(--text);
    }
    
    .btn-secondary:hover {
      background: var(--gray-200);
    }
    
    .btn-primary {
      background: var(--accent);
      border: none;
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--accent-hover);
    }
    
    /* Report Preview */
    .report-preview {
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 20px;
      font-size: 13px;
    }
    
    .report-header {
      text-align: center;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--gray-200);
      margin-bottom: 16px;
    }
    
    .report-logo {
      font-size: 18px;
      font-weight: 700;
      color: var(--gray-900);
      margin-bottom: 4px;
    }
    
    .report-tagline {
      font-size: 12px;
      color: var(--text-muted);
    }
    
    .report-section {
      margin-bottom: 16px;
    }
    
    .report-section-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 8px;
    }
    
    .report-photos {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 4px;
    }
    
    .report-photo {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: var(--radius-sm);
      flex-shrink: 0;
    }
    
    .report-diagram {
      width: 100%;
      height: 120px;
      background: var(--gray-100);
      border-radius: var(--radius-sm);
    }
    
    .report-watermark {
      text-align: center;
      padding-top: 16px;
      border-top: 1px solid var(--gray-200);
      margin-top: 16px;
      font-size: 11px;
      color: var(--gray-400);
    }
    
    /* Share Bottom Sheet */
    .bottom-sheet {
      position: fixed;
      inset: 0;
      z-index: 600;
      display: none;
    }
    
    .bottom-sheet.active {
      display: block;
    }
    
    .sheet-backdrop {
      position: absolute;
      inset: 0;
      background: oklch(0.1 0 0 / 0.5);
    }
    
    .sheet-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--surface);
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      padding: 20px;
      padding-bottom: max(20px, env(safe-area-inset-bottom));
      transform: translateY(100%);
      transition: transform 0.3s ease-out;
    }
    
    .bottom-sheet.active .sheet-content {
      transform: translateY(0);
    }
    
    .sheet-handle {
      width: 40px;
      height: 4px;
      background: var(--gray-300);
      border-radius: 2px;
      margin: 0 auto 16px;
    }
    
    .sheet-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
    }
    
    .share-options {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .share-option {
      flex: 1;
      padding: 16px;
      background: var(--bg);
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    
    .share-option:hover {
      border-color: var(--accent);
    }
    
    .share-option:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    .share-option svg {
      width: 28px;
      height: 28px;
      color: var(--gray-600);
    }
    
    .share-option span {
      font-size: 13px;
      font-weight: 500;
    }
    
    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--gray-900);
      color: white;
      padding: 12px 20px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 500;
      box-shadow: var(--shadow-lg);
      z-index: 700;
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
    }
    
    .toast.visible {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    
    /* Legal Disclaimer */
    .disclaimer {
      font-size: 11px;
      color: var(--gray-500);
      text-align: center;
      padding: 16px;
      line-height: 1.6;
    }
    
    /* Utility */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    /* Focus visible polyfill */
    *:focus:not(:focus-visible) {
      outline: none;
    }

    /* Enhanced focus indicators */
    *:focus-visible {
      outline: 3px solid var(--accent);
      outline-offset: 3px;
      border-radius: var(--radius-sm);
    }

    button:focus-visible,
    .photo-slot:focus-visible,
    .pipe-btn:focus-visible,
    .issue-btn:focus-visible {
      outline: 3px solid var(--accent);
      outline-offset: 2px;
    }

    .tab:focus-visible {
      outline-offset: -3px;
    }

    .lock-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px oklch(0.65 0.19 45 / 0.25);
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px oklch(0.65 0.19 45 / 0.15);
    }
  </style>
</head>
<body>
  <!-- Grain overlay for texture -->
  <div class="grain-overlay" aria-hidden="true"></div>

  <!-- Lock Screen -->
  <div id="lockScreen">
    <div class="lock-logo" aria-hidden="true">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="3"/>
        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
      </svg>
    </div>
    <h1 class="lock-title">SewerScope Reporter</h1>
    <p class="lock-subtitle">Built for Simon Says Plumbing & Drain</p>
    <form class="lock-form" id="lockForm">
      <label for="accessKey" class="sr-only">Access Key</label>
      <input type="text" id="accessKey" class="lock-input" placeholder="Enter access key" autocomplete="off">
      <p class="lock-error" id="lockError" role="alert" aria-live="polite"></p>
    </form>
    <p class="lock-demo">New here? <button type="button" id="loadDemoBtn">See how it works</button></p>
  </div>

  <!-- Main App -->
  <div id="app">
    <!-- List View Header -->
    <header class="header" id="listHeader">
      <div class="header-row">
        <div class="header-brand">
          <div class="header-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"/>
              <path d="M12 1v2M12 21v2"/>
            </svg>
          </div>
          <div>
            <div class="header-title">SewerScope</div>
            <div class="header-count"><span id="inspectionCount">0</span>/5 inspections</div>
          </div>
        </div>
        <button class="header-new" id="newInspectionBtn" aria-label="Start new inspection">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          New
        </button>
      </div>
    </header>
    
    <!-- Tabs -->
    <nav class="tabs" role="tablist" aria-label="Main navigation">
      <button class="tab active" role="tab" aria-selected="true" aria-controls="inspectionsPanel" id="tabInspections">Inspections</button>
      <button class="tab disabled" role="tab" aria-selected="false" aria-disabled="true" id="tabCustomers">Customers</button>
      <button class="tab disabled" role="tab" aria-selected="false" aria-disabled="true" id="tabReports">Reports</button>
    </nav>
    
    <!-- List View Content -->
    <main class="content" id="listContent">
      <div class="panel active" id="inspectionsPanel" role="tabpanel" aria-labelledby="tabInspections">
        <div class="inspection-list" id="inspectionList" role="list">
          <!-- Populated by JS -->
        </div>
      </div>
    </main>
    
    <!-- Editor View -->
    <div class="editor" id="editorView" role="region" aria-label="Inspection editor">
      <header class="editor-header">
        <button class="editor-back" id="editorBackBtn" aria-label="Back to list">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"/>
          </svg>
          Back
        </button>
        <div class="editor-actions">
          <button class="btn-icon" id="deleteBtn" aria-label="Delete inspection">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6"/>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
          </button>
          <button class="btn-icon btn-share" id="shareBtn" aria-label="Share report">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
              <polyline points="16 6 12 2 8 6"/>
              <line x1="12" y1="2" x2="12" y2="15"/>
            </svg>
          </button>
        </div>
      </header>
      
      <div class="editor-content" id="editorContent">
        <!-- Job Info -->
        <section class="section">
          <h2 class="section-title">Job Info</h2>
          <div class="form-group">
            <label class="form-label" for="customerName">Customer Name</label>
            <input type="text" id="customerName" class="form-input" placeholder="e.g., Johnson Residence">
          </div>
          <div class="form-group">
            <label class="form-label" for="address">Address</label>
            <input type="text" id="address" class="form-input" placeholder="Street address">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="city">City</label>
              <input type="text" id="city" class="form-input" placeholder="City">
            </div>
            <div class="form-group">
              <label class="form-label" for="date">Date</label>
              <input type="date" id="date" class="form-input">
            </div>
          </div>
        </section>
        
        <!-- Photos -->
        <section class="section">
          <h2 class="section-title">Photos</h2>
          <div class="photo-grid" id="photoGrid">
            <button class="photo-slot" id="photoSlot0" aria-label="Add photo 1">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <polyline points="21 15 16 10 5 21"/>
              </svg>
              <span>Add</span>
            </button>
            <button class="photo-slot" id="photoSlot1" aria-label="Add photo 2">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <polyline points="21 15 16 10 5 21"/>
              </svg>
              <span>Add</span>
            </button>
            <button class="photo-slot" id="photoSlot2" aria-label="Add photo 3">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <polyline points="21 15 16 10 5 21"/>
              </svg>
              <span>Add</span>
            </button>
          </div>
          <input type="file" id="photoInput" accept="image/*" capture="environment" class="sr-only">
        </section>
        
        <!-- Pipe Diagram -->
        <section class="section">
          <h2 class="section-title">Pipe Diagram</h2>
          <div class="diagram-builder">
            <div class="diagram-toolbar" role="toolbar" aria-label="Pipe segment tools">
              <button class="pipe-btn active" data-pipe="straight" aria-pressed="true" aria-label="Straight pipe">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <line x1="4" y1="12" x2="20" y2="12"/>
                </svg>
                Straight
              </button>
              <button class="pipe-btn" data-pipe="elbow" aria-pressed="false" aria-label="Elbow pipe">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <path d="M4 12h8a4 4 0 0 1 4 4v4"/>
                </svg>
                Elbow
              </button>
              <button class="pipe-btn" data-pipe="tee" aria-pressed="false" aria-label="T-junction">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <line x1="4" y1="12" x2="20" y2="12"/>
                  <line x1="12" y1="12" x2="12" y2="20"/>
                </svg>
                T-Joint
              </button>
              <button class="pipe-btn" data-pipe="cleanout" aria-pressed="false" aria-label="Cleanout access">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="6"/>
                  <line x1="12" y1="6" x2="12" y2="2"/>
                </svg>
                Cleanout
              </button>
              <button class="pipe-btn" data-pipe="problem" aria-pressed="false" aria-label="Mark problem area">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="8" stroke="#e53935"/>
                  <line x1="12" y1="8" x2="12" y2="12" stroke="#e53935"/>
                  <circle cx="12" cy="16" r="0.5" fill="#e53935" stroke="#e53935"/>
                </svg>
                Problem
              </button>
            </div>
            <div class="diagram-canvas-wrap">
              <canvas id="diagramCanvas" class="diagram-canvas" aria-label="Pipe diagram. Tap to place pipe segments."></canvas>
            </div>
            <div class="diagram-legend">
              <span class="legend-item"><span class="legend-color" style="background: #455a64"></span> Pipe</span>
              <span class="legend-item"><span class="legend-color" style="background: #ff6d00"></span> Cleanout</span>
              <span class="legend-item"><span class="legend-color" style="background: #e53935"></span> Problem</span>
            </div>
          </div>
        </section>
        
        <!-- Issue Type -->
        <section class="section">
          <h2 class="section-title">Issue Found</h2>
          <div class="issue-grid" role="radiogroup" aria-label="Select issue type">
            <button class="issue-btn" data-issue="roots" role="radio" aria-checked="false">
              <div class="issue-btn-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 22V8"/>
                  <path d="M5 12H2a10 10 0 0 0 20 0h-3"/>
                  <path d="M8 5l4-3 4 3"/>
                  <path d="M8 10c0-2 .5-5 4-5s4 3 4 5"/>
                </svg>
              </div>
              <span class="issue-btn-text">Root Intrusion</span>
            </button>
            <button class="issue-btn" data-issue="belly" role="radio" aria-checked="false">
              <div class="issue-btn-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M2 12h6c2 0 3 4 6 4s4-4 6-4h2"/>
                </svg>
              </div>
              <span class="issue-btn-text">Bellied Pipe</span>
            </button>
            <button class="issue-btn" data-issue="grease" role="radio" aria-checked="false">
              <div class="issue-btn-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M8 12s2-4 4-4 4 4 4 4-2 4-4 4-4-4-4-4"/>
                </svg>
              </div>
              <span class="issue-btn-text">Grease Buildup</span>
            </button>
            <button class="issue-btn" data-issue="crack" role="radio" aria-checked="false">
              <div class="issue-btn-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 2l2 7-3 4 2 6-1 3"/>
                  <path d="M7 7l3 3-2 5"/>
                </svg>
              </div>
              <span class="issue-btn-text">Cracked Pipe</span>
            </button>
            <button class="issue-btn" data-issue="offset" role="radio" aria-checked="false">
              <div class="issue-btn-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="2" y1="10" x2="10" y2="10"/>
                  <line x1="14" y1="14" x2="22" y2="14"/>
                  <path d="M10 10l4 4"/>
                </svg>
              </div>
              <span class="issue-btn-text">Offset Joint</span>
            </button>
            <button class="issue-btn" data-issue="collapse" role="radio" aria-checked="false">
              <div class="issue-btn-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M2 12h4l2-4 2 8 2-6 2 4 2-2h6"/>
                </svg>
              </div>
              <span class="issue-btn-text">Collapsed Line</span>
            </button>
          </div>
        </section>
        
        <!-- Location & Notes -->
        <section class="section">
          <h2 class="section-title">Details</h2>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="distance">Distance (ft)</label>
              <input type="number" id="distance" class="form-input" placeholder="e.g., 35">
            </div>
            <div class="form-group">
              <label class="form-label" for="pipeSize">Pipe Size</label>
              <select id="pipeSize" class="form-select">
                <option value="">Select</option>
                <option value="2">2" (sink/shower)</option>
                <option value="3">3" (toilet branch)</option>
                <option value="4">4" (main line)</option>
                <option value="6">6" (city connection)</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label" for="notes">Notes</label>
            <textarea id="notes" class="form-textarea" placeholder="What did you find? Recommended repair?"></textarea>
          </div>
        </section>
        
        <!-- Report Preview -->
        <section class="section">
          <h2 class="section-title">Report Preview</h2>
          <div class="report-preview" id="reportPreview">
            <div class="report-header">
              <div class="report-logo">Simon Says Plumbing & Drain</div>
              <div class="report-tagline">Sewer Line Camera Inspection Report</div>
            </div>
            <div class="report-section">
              <div class="report-section-title">Customer</div>
              <div id="previewCustomer">-</div>
            </div>
            <div class="report-section">
              <div class="report-section-title">Findings</div>
              <div id="previewIssue">-</div>
              <div id="previewDistance">-</div>
            </div>
            <div class="report-section">
              <div class="report-section-title">Photos</div>
              <div class="report-photos" id="previewPhotos">
                <div style="color: var(--text-muted); font-size: 12px;">No photos yet</div>
              </div>
            </div>
            <div class="report-section">
              <div class="report-section-title">Diagram</div>
              <canvas id="previewDiagram" class="report-diagram"></canvas>
            </div>
            <div class="report-watermark">
              Free Version - SewerScope Reporter
            </div>
          </div>
        </section>
        
        <!-- Disclaimer -->
        <p class="disclaimer">
          Report for reference onlyâ€”conditions can change. Simon Says Plumbing & Drain of Alvin, TX. Licensed plumber. Emergency? Call Chad at (832) 637-7192.
        </p>
      </div>
    </div>
    
    <!-- Photo Annotation Modal -->
    <div class="modal-overlay" id="annotationModal">
      <div class="modal" role="dialog" aria-labelledby="annotationTitle" aria-modal="true">
        <header class="modal-header">
          <h2 class="modal-title" id="annotationTitle">Mark the Problem</h2>
          <button class="modal-close" id="annotationClose" aria-label="Close">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </header>
        <div class="modal-body">
          <div class="annotation-tools" role="toolbar" aria-label="Drawing tools">
            <button class="annotation-tool active" data-tool="circle" aria-pressed="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
              </svg>
              Circle
            </button>
            <button class="annotation-tool" data-tool="arrow" aria-pressed="false">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="5" y1="12" x2="19" y2="12"/>
                <polyline points="12 5 19 12 12 19"/>
              </svg>
              Arrow
            </button>
            <button class="annotation-tool" data-tool="draw" aria-pressed="false">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 19l7-7 3 3-7 7-3-3z"/>
                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
              </svg>
              Draw
            </button>
          </div>
          <div class="annotation-canvas-wrap">
            <canvas id="annotationCanvas" class="annotation-canvas"></canvas>
          </div>
        </div>
        <footer class="modal-footer">
          <button class="btn btn-secondary" id="annotationClear">Clear</button>
          <button class="btn btn-primary" id="annotationSave">Save</button>
        </footer>
      </div>
    </div>
    
    <!-- Share Bottom Sheet -->
    <div class="bottom-sheet" id="shareSheet">
      <div class="sheet-backdrop" id="sheetBackdrop"></div>
      <div class="sheet-content" role="dialog" aria-labelledby="shareTitle">
        <div class="sheet-handle"></div>
        <h2 class="sheet-title" id="shareTitle">Share Report</h2>
        <div class="share-options">
          <button class="share-option" id="shareNative" aria-label="Share via phone">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="18" cy="5" r="3"/>
              <circle cx="6" cy="12" r="3"/>
              <circle cx="18" cy="19" r="3"/>
              <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
              <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
            </svg>
            <span>Share</span>
          </button>
          <button class="share-option" id="shareCopy" aria-label="Copy link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
            <span>Copy</span>
          </button>
          <button class="share-option" id="shareText" aria-label="Send as text">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            <span>Text</span>
          </button>
        </div>
        <button class="btn btn-secondary" id="shareCancel" style="width: 100%;">Cancel</button>
      </div>
    </div>
    
    <!-- Toast notification -->
    <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>
  </div>
  
  <script>
    // Hash function for access key validation
    function hashCode(s) {
      let h = 0;
      for (let i = 0; i < s.length; i++) {
        h = ((h << 5) - h) + s.charCodeAt(i);
        h |= 0;
      }
      return h;
    }
    
    // State
    let currentInspection = null;
    let inspections = [];
    let currentPhotoSlot = null;
    let annotationImage = null;
    let diagramElements = [];
    let selectedPipeTool = 'straight';
    let annotationTool = 'circle';
    let isDrawing = false;
    let drawPath = [];
    
    // DOM refs
    const lockScreen = document.getElementById('lockScreen');
    const app = document.getElementById('app');
    const lockForm = document.getElementById('lockForm');
    const accessKeyInput = document.getElementById('accessKey');
    const lockError = document.getElementById('lockError');
    const loadDemoBtn = document.getElementById('loadDemoBtn');
    const listHeader = document.getElementById('listHeader');
    const listContent = document.getElementById('listContent');
    const editorView = document.getElementById('editorView');
    const inspectionList = document.getElementById('inspectionList');
    const inspectionCount = document.getElementById('inspectionCount');
    const newInspectionBtn = document.getElementById('newInspectionBtn');
    const editorBackBtn = document.getElementById('editorBackBtn');
    const deleteBtn = document.getElementById('deleteBtn');
    const shareBtn = document.getElementById('shareBtn');
    const photoInput = document.getElementById('photoInput');
    const diagramCanvas = document.getElementById('diagramCanvas');
    const annotationModal = document.getElementById('annotationModal');
    const annotationCanvas = document.getElementById('annotationCanvas');
    const annotationClose = document.getElementById('annotationClose');
    const annotationClear = document.getElementById('annotationClear');
    const annotationSave = document.getElementById('annotationSave');
    const shareSheet = document.getElementById('shareSheet');
    const toast = document.getElementById('toast');
    const previewDiagram = document.getElementById('previewDiagram');
    
    // URL auto-auth
    function checkUrlAuth() {
      const params = new URLSearchParams(window.location.search);
      const key = params.get('key');
      if (key && hashCode(key) === 167176100) {
        unlock();
        return true;
      }
      return false;
    }
    
    // Unlock app
    function unlock() {
      lockScreen.classList.add('hidden');
      app.classList.add('visible');
      loadInspections();
    }
    
    // Lock form handler
    lockForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const key = accessKeyInput.value.trim();
      if (hashCode(key) === 167176100) {
        unlock();
      } else {
        lockError.textContent = 'Invalid access key';
        accessKeyInput.focus();
      }
    });
    
    accessKeyInput.addEventListener('input', () => {
      lockError.textContent = '';
      const key = accessKeyInput.value.trim();
      if (key.length >= 6 && hashCode(key) === 167176100) {
        unlock();
      }
    });
    
    // Demo data
    const demoInspections = [
      {
        id: 'demo1',
        customerName: 'Martinez Residence',
        address: '4521 Shadow Creek Pkwy',
        city: 'Pearland',
        date: '2026-02-08',
        issue: 'roots',
        distance: '35',
        pipeSize: '4',
        notes: 'Heavy root intrusion starting at 35ft. Roots coming in through a cracked joint. Recommend hydro jetting first, then camera again to check pipe condition. May need spot repair.',
        status: 'complete',
        photos: [],
        diagram: [
          { type: 'straight', x: 40, y: 100 },
          { type: 'straight', x: 120, y: 100 },
          { type: 'cleanout', x: 40, y: 100 },
          { type: 'straight', x: 200, y: 100 },
          { type: 'problem', x: 240, y: 100 }
        ]
      },
      {
        id: 'demo2',
        customerName: 'Thompson Property',
        address: '892 Cedar Lane',
        city: 'Alvin',
        date: '2026-02-08',
        issue: 'belly',
        distance: '22',
        pipeSize: '4',
        notes: 'Bellied pipe under driveway. Water pooling at low point. Need to finish camera work past driveway.',
        status: 'progress',
        photos: [],
        diagram: [
          { type: 'straight', x: 40, y: 100 },
          { type: 'cleanout', x: 40, y: 100 },
          { type: 'straight', x: 120, y: 100 },
          { type: 'problem', x: 160, y: 100 }
        ]
      },
      {
        id: 'demo3',
        customerName: 'Bay Area Grill',
        address: '1205 FM 518',
        city: 'League City',
        date: '2026-02-07',
        issue: 'grease',
        distance: '18',
        pipeSize: '4',
        notes: 'Grease buildup in kitchen drain line. Cleared with jetter. Recommended grease trap installation. Report sent to owner.',
        status: 'sent',
        photos: [],
        diagram: [
          { type: 'straight', x: 40, y: 100 },
          { type: 'tee', x: 100, y: 100 },
          { type: 'straight', x: 160, y: 100 },
          { type: 'cleanout', x: 100, y: 140 },
          { type: 'problem', x: 140, y: 100 }
        ]
      }
    ];
    
    // Load demo
    loadDemoBtn.addEventListener('click', () => {
      inspections = [...demoInspections];
      saveInspections();
      unlock();
      showToast('Demo data loaded');
    });
    
    // IndexedDB / localStorage fallback
    function saveInspections() {
      try {
        localStorage.setItem('sewerscope_inspections', JSON.stringify(inspections));
      } catch (e) {
        console.error('Save failed', e);
      }
    }
    
    function loadInspections() {
      try {
        const saved = localStorage.getItem('sewerscope_inspections');
        if (saved) {
          inspections = JSON.parse(saved);
        } else {
          // First visit: auto-load demo
          inspections = [...demoInspections];
          saveInspections();
        }
      } catch (e) {
        inspections = [...demoInspections];
      }
      renderList();
    }
    
    // Render inspection list
    function renderList() {
      inspectionCount.textContent = inspections.length;
      
      if (inspections.length === 0) {
        inspectionList.innerHTML = `
          <div class="animate-fade-up" style="text-align: center; padding: 48px 16px; color: var(--text-muted);">
            <svg style="width: 48px; height: 48px; margin-bottom: 12px; color: var(--gray-300);" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
              <circle cx="12" cy="12" r="3"/>
              <path d="M12 1v2M12 21v2"/>
            </svg>
            <p style="margin-bottom: 4px; font-weight: 500;">No jobs yet</p>
            <p style="font-size: 13px;">Tap New to start an inspection</p>
          </div>
        `;
        return;
      }
      
      const issueLabels = {
        roots: 'Root Intrusion',
        belly: 'Bellied Pipe',
        grease: 'Grease Buildup',
        crack: 'Cracked Pipe',
        offset: 'Offset Joint',
        collapse: 'Collapsed Line'
      };
      
      const statusLabels = {
        progress: 'In Progress',
        complete: 'Complete',
        sent: 'Report Sent'
      };
      
      inspectionList.innerHTML = inspections.map((ins, idx) => `
        <article class="inspection-card animate-fade-up stagger-${Math.min(idx + 1, 4)}" tabindex="0" role="listitem" data-id="${ins.id}" aria-label="${ins.customerName}, ${ins.address}">
          <div class="card-header">
            <div>
              <div class="card-address">${ins.address || 'No address'}</div>
              <div class="card-date">${ins.customerName || 'Unknown'} Â· ${formatDate(ins.date)}</div>
            </div>
            <span class="card-status status-${ins.status}">${statusLabels[ins.status] || 'Draft'}</span>
          </div>
          <div class="card-body">
            <div class="card-issue">
              <div class="issue-icon">
                ${getIssueIcon(ins.issue)}
              </div>
              ${issueLabels[ins.issue] || 'Issue not set'}${ins.distance ? ` at ${ins.distance}ft` : ''}
            </div>
          </div>
        </article>
      `).join('');
      
      // Click handlers
      document.querySelectorAll('.inspection-card').forEach(card => {
        card.addEventListener('click', () => openInspection(card.dataset.id));
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openInspection(card.dataset.id);
          }
        });
      });
    }
    
    function getIssueIcon(issue) {
      const icons = {
        roots: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22V8"/><path d="M5 12H2a10 10 0 0 0 20 0h-3"/></svg>',
        belly: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 12h6c2 0 3 4 6 4s4-4 6-4h2"/></svg>',
        grease: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>',
        crack: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l2 7-3 4 2 6-1 3"/></svg>',
        offset: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="2" y1="10" x2="10" y2="10"/><line x1="14" y1="14" x2="22" y2="14"/></svg>',
        collapse: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 12h4l2-4 2 8 2-6 2 4 2-2h6"/></svg>'
      };
      return icons[issue] || '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>';
    }
    
    function formatDate(dateStr) {
      if (!dateStr) return 'No date';
      const d = new Date(dateStr + 'T12:00:00');
      return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }
    
    // New inspection
    newInspectionBtn.addEventListener('click', () => {
      if (inspections.length >= 5) {
        showToast('Free version: 5 inspections max');
        return;
      }
      
      currentInspection = {
        id: 'ins_' + Date.now(),
        customerName: '',
        address: '',
        city: '',
        date: new Date().toISOString().split('T')[0],
        issue: '',
        distance: '',
        pipeSize: '',
        notes: '',
        status: 'progress',
        photos: [null, null, null],
        diagram: []
      };
      
      // Try to get geolocation
      if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            // Could reverse geocode here - for now just note it's working
            console.log('Location:', pos.coords.latitude, pos.coords.longitude);
          },
          () => {},
          { timeout: 5000 }
        );
      }
      
      openEditor();
    });
    
    // Open existing inspection
    function openInspection(id) {
      currentInspection = inspections.find(i => i.id === id);
      if (!currentInspection) return;
      openEditor();
    }
    
    // Editor
    function openEditor() {
      listHeader.style.display = 'none';
      listContent.style.display = 'none';
      document.querySelector('.tabs').style.display = 'none';
      editorView.classList.add('active');
      
      // Populate form
      document.getElementById('customerName').value = currentInspection.customerName || '';
      document.getElementById('address').value = currentInspection.address || '';
      document.getElementById('city').value = currentInspection.city || '';
      document.getElementById('date').value = currentInspection.date || '';
      document.getElementById('distance').value = currentInspection.distance || '';
      document.getElementById('pipeSize').value = currentInspection.pipeSize || '';
      document.getElementById('notes').value = currentInspection.notes || '';
      
      // Issue buttons
      document.querySelectorAll('.issue-btn').forEach(btn => {
        const selected = btn.dataset.issue === currentInspection.issue;
        btn.classList.toggle('selected', selected);
        btn.setAttribute('aria-checked', selected);
      });
      
      // Photos
      renderPhotoSlots();
      
      // Diagram
      diagramElements = currentInspection.diagram || [];
      renderDiagram();
      
      // Preview
      updatePreview();
      
      // Auto-save on input
      const inputs = editorView.querySelectorAll('input, select, textarea');
      inputs.forEach(input => {
        input.addEventListener('input', debounce(saveCurrentInspection, 500));
      });
    }
    
    function closeEditor() {
      saveCurrentInspection();
      editorView.classList.remove('active');
      listHeader.style.display = 'block';
      listContent.style.display = 'block';
      document.querySelector('.tabs').style.display = 'flex';
      currentInspection = null;
      renderList();
    }
    
    editorBackBtn.addEventListener('click', closeEditor);
    
    // Save current inspection
    function saveCurrentInspection() {
      if (!currentInspection) return;
      
      currentInspection.customerName = document.getElementById('customerName').value;
      currentInspection.address = document.getElementById('address').value;
      currentInspection.city = document.getElementById('city').value;
      currentInspection.date = document.getElementById('date').value;
      currentInspection.distance = document.getElementById('distance').value;
      currentInspection.pipeSize = document.getElementById('pipeSize').value;
      currentInspection.notes = document.getElementById('notes').value;
      currentInspection.diagram = diagramElements;
      
      // Update or add to list
      const idx = inspections.findIndex(i => i.id === currentInspection.id);
      if (idx >= 0) {
        inspections[idx] = { ...currentInspection };
      } else {
        inspections.unshift({ ...currentInspection });
      }
      
      saveInspections();
      updatePreview();
    }
    
    // Issue selection
    document.querySelectorAll('.issue-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.issue-btn').forEach(b => {
          b.classList.remove('selected');
          b.setAttribute('aria-checked', 'false');
        });
        btn.classList.add('selected');
        btn.setAttribute('aria-checked', 'true');
        currentInspection.issue = btn.dataset.issue;
        saveCurrentInspection();
      });
    });
    
    // Photo handling
    function renderPhotoSlots() {
      for (let i = 0; i < 3; i++) {
        const slot = document.getElementById(`photoSlot${i}`);
        const photo = currentInspection.photos?.[i];
        
        if (photo) {
          slot.classList.add('has-photo');
          slot.innerHTML = `
            <img src="${photo}" alt="Inspection photo ${i + 1}">
            <button class="photo-remove" data-slot="${i}" aria-label="Remove photo ${i + 1}">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
            <button class="photo-edit" data-slot="${i}" aria-label="Annotate photo ${i + 1}">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 19l7-7 3 3-7 7-3-3z"/>
                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
              </svg>
            </button>
          `;
          
          slot.querySelector('.photo-remove').addEventListener('click', (e) => {
            e.stopPropagation();
            currentInspection.photos[i] = null;
            renderPhotoSlots();
            saveCurrentInspection();
          });
          
          slot.querySelector('.photo-edit').addEventListener('click', (e) => {
            e.stopPropagation();
            openAnnotationModal(i);
          });
        } else {
          slot.classList.remove('has-photo');
          slot.innerHTML = `
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21 15 16 10 5 21"/>
            </svg>
            <span>Add</span>
          `;
        }
      }
      
      document.querySelectorAll('.photo-slot').forEach((slot, i) => {
        slot.onclick = () => {
          if (!currentInspection.photos?.[i]) {
            currentPhotoSlot = i;
            photoInput.click();
          }
        };
      });
    }
    
    photoInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (ev) => {
        if (!currentInspection.photos) currentInspection.photos = [null, null, null];
        currentInspection.photos[currentPhotoSlot] = ev.target.result;
        renderPhotoSlots();
        saveCurrentInspection();
      };
      reader.readAsDataURL(file);
      photoInput.value = '';
    });
    
    // Annotation modal
    function openAnnotationModal(slotIndex) {
      annotationImage = new Image();
      annotationImage.onload = () => {
        annotationModal.classList.add('active');
        setupAnnotationCanvas();
      };
      annotationImage.src = currentInspection.photos[slotIndex];
      currentPhotoSlot = slotIndex;
    }
    
    function setupAnnotationCanvas() {
      const canvas = annotationCanvas;
      const ctx = canvas.getContext('2d');
      const wrapper = canvas.parentElement;
      
      const maxW = wrapper.clientWidth;
      const ratio = annotationImage.height / annotationImage.width;
      canvas.width = maxW;
      canvas.height = maxW * ratio;
      
      ctx.drawImage(annotationImage, 0, 0, canvas.width, canvas.height);
      
      // Touch/mouse drawing
      let lastX, lastY;
      
      function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        const touch = e.touches ? e.touches[0] : e;
        return {
          x: touch.clientX - rect.left,
          y: touch.clientY - rect.top
        };
      }
      
      function startDraw(e) {
        e.preventDefault();
        isDrawing = true;
        const pos = getPos(e);
        lastX = pos.x;
        lastY = pos.y;
        drawPath = [pos];
      }
      
      function draw(e) {
        if (!isDrawing) return;
        e.preventDefault();
        const pos = getPos(e);
        
        if (annotationTool === 'draw') {
          ctx.strokeStyle = '#e53935';
          ctx.lineWidth = 4;
          ctx.lineCap = 'round';
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(pos.x, pos.y);
          ctx.stroke();
          lastX = pos.x;
          lastY = pos.y;
          drawPath.push(pos);
        }
      }
      
      function endDraw(e) {
        if (!isDrawing) return;
        isDrawing = false;
        const pos = e.changedTouches ? { x: lastX, y: lastY } : getPos(e);
        
        if (annotationTool === 'circle') {
          const radius = Math.max(30, Math.min(60, canvas.width * 0.1));
          ctx.strokeStyle = '#e53935';
          ctx.lineWidth = 4;
          ctx.beginPath();
          ctx.arc(pos.x, pos.y, radius, 0, Math.PI * 2);
          ctx.stroke();
        } else if (annotationTool === 'arrow') {
          ctx.strokeStyle = '#e53935';
          ctx.lineWidth = 4;
          ctx.lineCap = 'round';
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(pos.x, pos.y);
          ctx.stroke();
          
          // Arrowhead
          const angle = Math.atan2(pos.y - lastY, pos.x - lastX);
          const headLen = 15;
          ctx.beginPath();
          ctx.moveTo(pos.x, pos.y);
          ctx.lineTo(pos.x - headLen * Math.cos(angle - Math.PI/6), pos.y - headLen * Math.sin(angle - Math.PI/6));
          ctx.moveTo(pos.x, pos.y);
          ctx.lineTo(pos.x - headLen * Math.cos(angle + Math.PI/6), pos.y - headLen * Math.sin(angle + Math.PI/6));
          ctx.stroke();
        }
        drawPath = [];
      }
      
      canvas.addEventListener('mousedown', startDraw);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', endDraw);
      canvas.addEventListener('mouseleave', endDraw);
      canvas.addEventListener('touchstart', startDraw, { passive: false });
      canvas.addEventListener('touchmove', draw, { passive: false });
      canvas.addEventListener('touchend', endDraw);
    }
    
    // Annotation tools
    document.querySelectorAll('.annotation-tool').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.annotation-tool').forEach(b => {
          b.classList.remove('active');
          b.setAttribute('aria-pressed', 'false');
        });
        btn.classList.add('active');
        btn.setAttribute('aria-pressed', 'true');
        annotationTool = btn.dataset.tool;
      });
    });
    
    annotationClose.addEventListener('click', () => {
      annotationModal.classList.remove('active');
    });
    
    annotationClear.addEventListener('click', () => {
      setupAnnotationCanvas();
    });
    
    annotationSave.addEventListener('click', () => {
      currentInspection.photos[currentPhotoSlot] = annotationCanvas.toDataURL('image/jpeg', 0.9);
      renderPhotoSlots();
      saveCurrentInspection();
      annotationModal.classList.remove('active');
      showToast('Photo saved with markup');
    });
    
    // Pipe diagram
    function setupDiagramCanvas() {
      const canvas = diagramCanvas;
      const ctx = canvas.getContext('2d');
      const rect = canvas.parentElement.getBoundingClientRect();
      canvas.width = rect.width;
      canvas.height = 200;
      
      canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        diagramElements.push({
          type: selectedPipeTool,
          x: x,
          y: y
        });
        
        renderDiagram();
        saveCurrentInspection();
      });
      
      canvas.addEventListener('touchend', (e) => {
        e.preventDefault();
        const rect = canvas.getBoundingClientRect();
        const touch = e.changedTouches[0];
        const x = touch.clientX - rect.left;
        const y = touch.clientY - rect.top;
        
        diagramElements.push({
          type: selectedPipeTool,
          x: x,
          y: y
        });
        
        renderDiagram();
        saveCurrentInspection();
      });
    }
    
    function renderDiagram() {
      const canvas = diagramCanvas;
      const ctx = canvas.getContext('2d');
      const rect = canvas.parentElement.getBoundingClientRect();
      canvas.width = rect.width;
      canvas.height = 200;
      
      // Clear
      ctx.fillStyle = 'white';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Draw grid
      ctx.strokeStyle = '#e0e0e0';
      ctx.lineWidth = 1;
      for (let x = 0; x < canvas.width; x += 40) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
      }
      for (let y = 0; y < canvas.height; y += 40) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }
      
      // Draw elements
      diagramElements.forEach(el => {
        const x = el.x;
        const y = el.y;
        
        switch (el.type) {
          case 'straight':
            ctx.strokeStyle = '#455a64';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(x - 30, y);
            ctx.lineTo(x + 30, y);
            ctx.stroke();
            break;
            
          case 'elbow':
            ctx.strokeStyle = '#455a64';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(x - 25, y);
            ctx.lineTo(x, y);
            ctx.quadraticCurveTo(x + 10, y, x + 10, y + 10);
            ctx.lineTo(x + 10, y + 25);
            ctx.stroke();
            break;
            
          case 'tee':
            ctx.strokeStyle = '#455a64';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(x - 30, y);
            ctx.lineTo(x + 30, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x, y + 25);
            ctx.stroke();
            break;
            
          case 'cleanout':
            ctx.strokeStyle = '#ff6d00';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(x, y, 12, 0, Math.PI * 2);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y - 12);
            ctx.lineTo(x, y - 22);
            ctx.stroke();
            break;
            
          case 'problem':
            ctx.strokeStyle = '#e53935';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(x, y, 16, 0, Math.PI * 2);
            ctx.stroke();
            ctx.fillStyle = '#e53935';
            ctx.font = 'bold 18px Inter';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('!', x, y);
            break;
        }
      });
      
      // Update preview diagram too
      renderPreviewDiagram();
    }
    
    function renderPreviewDiagram() {
      const canvas = previewDiagram;
      const ctx = canvas.getContext('2d');
      canvas.width = canvas.parentElement.clientWidth - 2;
      canvas.height = 120;
      
      ctx.fillStyle = '#f5f5f5';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      const scale = 0.6;
      
      diagramElements.forEach(el => {
        const x = el.x * scale;
        const y = el.y * scale;
        
        switch (el.type) {
          case 'straight':
            ctx.strokeStyle = '#455a64';
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(x - 18, y);
            ctx.lineTo(x + 18, y);
            ctx.stroke();
            break;
            
          case 'elbow':
            ctx.strokeStyle = '#455a64';
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(x - 15, y);
            ctx.lineTo(x, y);
            ctx.quadraticCurveTo(x + 6, y, x + 6, y + 6);
            ctx.lineTo(x + 6, y + 15);
            ctx.stroke();
            break;
            
          case 'tee':
            ctx.strokeStyle = '#455a64';
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(x - 18, y);
            ctx.lineTo(x + 18, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x, y + 15);
            ctx.stroke();
            break;
            
          case 'cleanout':
            ctx.strokeStyle = '#ff6d00';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(x, y, 8, 0, Math.PI * 2);
            ctx.stroke();
            break;
            
          case 'problem':
            ctx.strokeStyle = '#e53935';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(x, y, 10, 0, Math.PI * 2);
            ctx.stroke();
            ctx.fillStyle = '#e53935';
            ctx.font = 'bold 12px Inter';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('!', x, y);
            break;
        }
      });
    }
    
    // Pipe tool selection
    document.querySelectorAll('.pipe-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.pipe-btn').forEach(b => {
          b.classList.remove('active');
          b.setAttribute('aria-pressed', 'false');
        });
        btn.classList.add('active');
        btn.setAttribute('aria-pressed', 'true');
        selectedPipeTool = btn.dataset.pipe;
      });
    });
    
    // Update preview
    function updatePreview() {
      const issueLabels = {
        roots: 'Root Intrusion',
        belly: 'Bellied Pipe',
        grease: 'Grease Buildup',
        crack: 'Cracked Pipe',
        offset: 'Offset Joint',
        collapse: 'Collapsed Line'
      };
      
      document.getElementById('previewCustomer').textContent = 
        `${currentInspection.customerName || 'Customer'}, ${currentInspection.address || 'Address'}, ${currentInspection.city || 'City'}`;
      
      document.getElementById('previewIssue').textContent = 
        issueLabels[currentInspection.issue] || 'Issue not specified';
      
      document.getElementById('previewDistance').textContent = 
        currentInspection.distance ? `Located at ${currentInspection.distance} feet from cleanout` : '';
      
      // Photos
      const previewPhotos = document.getElementById('previewPhotos');
      const photos = (currentInspection.photos || []).filter(p => p);
      if (photos.length > 0) {
        previewPhotos.innerHTML = photos.map(p => 
          `<img src="${p}" class="report-photo" alt="Inspection photo">`
        ).join('');
      } else {
        previewPhotos.innerHTML = '<div style="color: var(--text-muted); font-size: 12px;">No photos yet</div>';
      }
      
      renderPreviewDiagram();
    }
    
    // Delete
    deleteBtn.addEventListener('click', () => {
      if (!currentInspection) return;
      if (!confirm('Delete this inspection?')) return;
      
      inspections = inspections.filter(i => i.id !== currentInspection.id);
      saveInspections();
      closeEditor();
      showToast('Inspection deleted');
    });
    
    // Share
    shareBtn.addEventListener('click', () => {
      shareSheet.classList.add('active');
    });
    
    document.getElementById('sheetBackdrop').addEventListener('click', () => {
      shareSheet.classList.remove('active');
    });
    
    document.getElementById('shareCancel').addEventListener('click', () => {
      shareSheet.classList.remove('active');
    });
    
    document.getElementById('shareNative').addEventListener('click', async () => {
      shareSheet.classList.remove('active');
      
      if (navigator.share) {
        try {
          await navigator.share({
            title: `Sewer Inspection - ${currentInspection.address}`,
            text: `Sewer inspection report for ${currentInspection.customerName}. Issue: ${currentInspection.issue || 'See report'}. Location: ${currentInspection.distance || 'TBD'}ft.`,
            url: window.location.href
          });
          currentInspection.status = 'sent';
          saveCurrentInspection();
          showToast('Report shared');
        } catch (e) {
          if (e.name !== 'AbortError') {
            showToast('Could not share');
          }
        }
      } else {
        showToast('Share not supported on this device');
      }
    });
    
    document.getElementById('shareCopy').addEventListener('click', async () => {
      shareSheet.classList.remove('active');

      const text = `Sewer inspection report
Customer: ${currentInspection.customerName}
Address: ${currentInspection.address}, ${currentInspection.city}
Issue found: ${currentInspection.issue || 'See photos'}
Location: ${currentInspection.distance || '?'}ft from cleanout
Notes: ${currentInspection.notes || 'None'}

Simon Says Plumbing & Drain of Alvin, TX
(832) 637-7192`;
      
      try {
        await navigator.clipboard.writeText(text);
        showToast('Report copied');
      } catch (e) {
        showToast('Could not copy');
      }
    });
    
    document.getElementById('shareText').addEventListener('click', () => {
      shareSheet.classList.remove('active');

      const issueLabel = currentInspection.issue ? currentInspection.issue.replace(/roots|belly|grease|crack|offset|collapse/, m => ({roots:'roots',belly:'sagging pipe',grease:'grease buildup',crack:'cracked pipe',offset:'offset joint',collapse:'collapsed line'}[m])) : 'issue found';
      const text = `Sewer inspection at ${currentInspection.address}: ${issueLabel} at ${currentInspection.distance || '?'}ft from the cleanout. Call Chad at (832) 637-7192. Simon Says Plumbing & Drain`;

      window.location.href = `sms:?body=${encodeURIComponent(text)}`;
      currentInspection.status = 'sent';
      saveCurrentInspection();
    });
    
    // Toast notifications - announce to screen readers
    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add('visible');
      // Announce to screen readers
      toast.setAttribute('aria-label', msg);
      setTimeout(() => {
        toast.classList.remove('visible');
        toast.removeAttribute('aria-label');
      }, 2500);
    }
    
    // Debounce
    function debounce(fn, ms) {
      let timeout;
      return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => fn(...args), ms);
      };
    }
    
    // Init
    if (!checkUrlAuth()) {
      accessKeyInput.focus();
    }

    // Anti-scrape: prevent context menu on images
    document.addEventListener('contextmenu', (e) => {
      if (e.target.tagName === 'IMG' || e.target.closest('.inspection-card')) {
        e.preventDefault();
        return false;
      }
    });

    // Anti-scrape: prevent drag on images
    document.addEventListener('dragstart', (e) => {
      if (e.target.tagName === 'IMG') {
        e.preventDefault();
      }
    });
    
    // Setup diagram canvas on editor open (after DOM ready)
    const observer = new MutationObserver(() => {
      if (editorView.classList.contains('active')) {
        setupDiagramCanvas();
        renderDiagram();
      }
    });
    observer.observe(editorView, { attributes: true, attributeFilter: ['class'] });
    
    // Window resize
    window.addEventListener('resize', debounce(() => {
      if (editorView.classList.contains('active')) {
        renderDiagram();
      }
    }, 250));
  </script>

<!-- DEMO DISCLAIMER - Legal Notice -->

<!-- BennyCuTools Purchase CTA â€” injected by inject-cta.py -->
<style>
#bct-cta-bar {
  position: fixed;
  bottom: 48px;
  left: 0;
  right: 0;
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  border-top: 2px solid #6366f1;
  padding: 10px 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  z-index: 99998;
  flex-wrap: wrap;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
}
#bct-cta-bar .bct-cta-text {
  color: #e4e4e7;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 14px;
  font-weight: 500;
}
#bct-cta-bar .bct-cta-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 20px;
  background: #6366f1;
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 14px;
  font-weight: 600;
  border: none;
  border-radius: 6px;
  text-decoration: none;
  cursor: pointer;
  transition: background 0.2s, transform 0.1s;
}
#bct-cta-bar .bct-cta-btn:hover {
  background: #4f46e5;
  transform: translateY(-1px);
}
#bct-cta-bar .bct-cta-btn-secondary {
  background: transparent;
  border: 1px solid #6366f1;
  color: #a5b4fc;
}
#bct-cta-bar .bct-cta-btn-secondary:hover {
  background: rgba(99,102,241,0.15);
}
@media (max-width: 600px) {
  #bct-cta-bar {
    flex-direction: column;
    gap: 8px;
    padding: 8px 12px;
    bottom: 44px;
  }
  #bct-cta-bar .bct-cta-text { font-size: 12px; }
  #bct-cta-bar .bct-cta-btn { font-size: 13px; padding: 7px 16px; width: 100%; justify-content: center; }
}
</style>
<div id="bct-cta-bar" role="banner" aria-label="Purchase this tool">
  <span class="bct-cta-text">Like this tool? Make it yours.</span>
  <a class="bct-cta-btn" id="bct-buy-btn" href="https://bennycutools.com/buy.html">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
    Get It â€” $200 One-Time
  </a>
  <a class="bct-cta-btn bct-cta-btn-secondary" href="mailto:cuuper225@gmail.com?subject=Question%20about%20my%20custom%20tool">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
    Questions? Email Ben
  </a>
</div>
<script>
// Auto-fill the buy link with the current tool's page name
(function(){
  try {
    var pg = location.pathname.replace(/.*\//, '').replace('.html','');
    var buyBtn = document.getElementById('bct-buy-btn');
    if (buyBtn && pg) {
      buyBtn.href = 'https://bennycutools.com/buy.html?tool=' + encodeURIComponent(pg);
    }
  } catch(e){}
})();
</script>
<!-- End BennyCuTools Purchase CTA -->

<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer" style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:10px 16px;font-size:12px;line-height:1.4;color:#666;z-index:99999;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:8px 16px;text-align:center;">
  <p style="margin:0;max-width:700px;"><strong style="color:#333;">DEMO NOTICE:</strong> This tool was created by BennyCuTools as a free demonstration only. It is not affiliated with, endorsed by, or authorized by Simon Says Plumbing &amp; Drain. All brand references are used solely for demonstration purposes.</p>
  <a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20Simon%20Says%20Plumbing&body=I%20am%20the%20owner%20and%20I%20request%20permanent%20deletion%20of%20this%20demo." style="display:inline-flex;align-items:center;gap:4px;background:#dc3545;color:#fff;padding:5px 12px;border-radius:4px;text-decoration:none;font-size:11px;font-weight:500;white-space:nowrap;">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
    Request Permanent Deletion
  </a>
</div>
</body>
</html>
