<!DOCTYPE html>
<html lang="en">
<head>
<meta name="robots" content="noindex, nofollow">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>StoneMatch Pro — Legacy Countertops Charlotte</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --stone-brown: oklch(0.52 0.06 55);
      --stone-brown-dark: oklch(0.42 0.06 55);
      --warm-beige: oklch(0.88 0.03 75);
      --terracotta: oklch(0.48 0.18 28);
      --charcoal: oklch(0.28 0.02 60);
      --marble-white: oklch(0.97 0.01 90);
      --text-primary: oklch(0.25 0.02 60);
      --text-secondary: oklch(0.45 0.02 60);
      --text-muted: oklch(0.60 0.01 60);
      --border: oklch(0.85 0.02 75);
      --success: oklch(0.55 0.15 145);
      --error: oklch(0.55 0.18 28);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --shadow-sm: 0 1px 3px oklch(0.2 0 0 / 0.08);
      --shadow-md: 0 4px 12px oklch(0.2 0 0 / 0.10), 0 1px 3px oklch(0.2 0 0 / 0.06);
      --shadow-lg: 0 8px 24px oklch(0.2 0 0 / 0.12), 0 2px 6px oklch(0.2 0 0 / 0.08);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--marble-white);
      color: var(--text-primary);
      line-height: 1.5;
      min-height: 100vh;
      padding-bottom: 70px !important;
      -webkit-font-smoothing: antialiased;
    }

    /* Access Gate */
    #access-gate {
      position: fixed;
      inset: 0;
      background: linear-gradient(145deg, var(--stone-brown) 0%, var(--stone-brown-dark) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 24px;
    }

    #access-gate.hidden { display: none; }

    .gate-card {
      background: white;
      border-radius: var(--radius-lg);
      padding: 40px 32px;
      max-width: 360px;
      width: 100%;
      text-align: center;
      box-shadow: var(--shadow-lg);
    }

    .gate-logo {
      font-family: 'Playfair Display', serif;
      font-size: 28px;
      font-weight: 700;
      color: var(--stone-brown);
      margin-bottom: 8px;
    }

    .gate-tagline {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .gate-location {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 32px;
      font-weight: 500;
    }

    .gate-input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 16px;
      font-family: inherit;
      transition: border-color 0.15s ease;
      margin-bottom: 16px;
    }

    .gate-input:focus {
      outline: none;
      border-color: var(--stone-brown);
    }

    .gate-btn {
      width: 100%;
      padding: 14px 24px;
      background: var(--stone-brown);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.1s ease;
    }

    .gate-btn:hover { background: var(--stone-brown-dark); }
    .gate-btn:active { transform: scale(0.98); }
    .gate-btn:focus-visible {
      outline: 3px solid var(--terracotta);
      outline-offset: 2px;
    }

    .gate-error {
      color: var(--error);
      font-size: 14px;
      margin-top: 12px;
      display: none;
    }

    .gate-error.show { display: block; }

    /* Skip link for accessibility */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--stone-brown);
      color: white;
      padding: 8px 16px;
      z-index: 10001;
      text-decoration: none;
      font-weight: 500;
      border-radius: 0 0 4px 0;
    }

    .skip-link:focus {
      top: 0;
    }

    /* App Container */
    #app { display: none; }
    #app.visible { display: block; }

    /* Header */
    .header {
      background: white;
      border-bottom: 1px solid var(--border);
      padding: 12px 16px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-inner {
      max-width: 600px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      font-family: 'Playfair Display', serif;
      font-size: 20px;
      font-weight: 700;
      color: var(--stone-brown);
    }

    .header-actions {
      display: flex;
      gap: 8px;
    }

    .icon-btn {
      width: 40px;
      height: 40px;
      border: none;
      background: var(--warm-beige);
      border-radius: var(--radius-sm);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s ease, transform 0.1s ease;
    }

    .icon-btn:hover { background: var(--border); }
    .icon-btn:active { transform: scale(0.95); }
    .icon-btn:focus-visible {
      outline: 3px solid var(--stone-brown);
      outline-offset: 2px;
    }

    .icon-btn svg {
      width: 20px;
      height: 20px;
      color: var(--text-primary);
    }

    /* Navigation Tabs */
    .nav-tabs {
      display: flex;
      background: white;
      border-bottom: 1px solid var(--border);
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .nav-tabs::-webkit-scrollbar { display: none; }

    .nav-tab {
      flex: 1;
      min-width: 100px;
      padding: 14px 16px;
      background: none;
      border: none;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      position: relative;
      white-space: nowrap;
      transition: color 0.15s ease;
    }

    .nav-tab:hover { color: var(--text-primary); }

    .nav-tab.active {
      color: var(--stone-brown);
      font-weight: 600;
    }

    .nav-tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 16px;
      right: 16px;
      height: 3px;
      background: var(--stone-brown);
      border-radius: 2px 2px 0 0;
    }

    .nav-tab:focus-visible {
      outline: 3px solid var(--stone-brown);
      outline-offset: -3px;
    }

    .nav-tab.locked {
      color: var(--text-muted);
    }

    .lock-icon {
      width: 12px;
      height: 12px;
      margin-left: 4px;
      vertical-align: middle;
    }

    /* Screen Container */
    .screen {
      display: none;
      padding: 16px;
      max-width: 600px;
      margin: 0 auto;
      opacity: 0;
      transform: translateY(8px);
      animation: none;
    }

    .screen.active { 
      display: block;
      animation: screenEnter 0.25s ease forwards;
    }

    @keyframes screenEnter {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .screen {
        opacity: 1;
        transform: none;
      }
      .screen.active {
        animation: none;
      }
    }

    /* Visualizer Screen */
    .visualizer-container {
      position: relative;
      background: var(--charcoal);
      border-radius: var(--radius-lg);
      overflow: hidden;
      aspect-ratio: 4/3;
      margin-bottom: 16px;
    }

    .camera-preview {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .canvas-overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .camera-placeholder {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      gap: 16px;
      padding: 24px;
      text-align: center;
    }

    .camera-placeholder svg {
      width: 48px;
      height: 48px;
      opacity: 0.7;
    }

    .camera-placeholder p {
      font-size: 14px;
      opacity: 0.8;
      max-width: 240px;
    }

    .capture-btn {
      position: absolute;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: white;
      border: 4px solid var(--terracotta);
      cursor: pointer;
      box-shadow: var(--shadow-lg);
      transition: transform 0.1s ease, border-color 0.15s ease;
    }

    .capture-btn:hover { border-color: var(--stone-brown); }
    .capture-btn:active { transform: translateX(-50%) scale(0.95); }
    .capture-btn:focus-visible {
      outline: 3px solid white;
      outline-offset: 4px;
    }

    .capture-btn::after {
      content: '';
      position: absolute;
      inset: 8px;
      background: var(--terracotta);
      border-radius: 50%;
    }

    .captured-photo {
      display: none;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .captured-photo.show { display: block; }
    .camera-preview.hidden,
    .camera-placeholder.hidden { display: none; }

    /* Stone Selector */
    .stone-selector {
      background: white;
      border-radius: var(--radius-lg);
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-sm);
    }

    .section-title {
      font-family: 'Playfair Display', serif;
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 12px;
    }

    .stone-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      gap: 10px;
    }

    .stone-option {
      aspect-ratio: 1;
      border-radius: var(--radius-sm);
      border: 3px solid transparent;
      cursor: pointer;
      overflow: hidden;
      position: relative;
      transition: border-color 0.15s ease, transform 0.1s ease;
    }

    .stone-option:hover { transform: scale(1.03); }
    .stone-option.selected { border-color: var(--terracotta); }
    .stone-option:focus-visible {
      outline: 3px solid var(--stone-brown);
      outline-offset: 2px;
    }

    .stone-option img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .stone-label {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, oklch(0.2 0 0 / 0.85));
      color: white;
      font-size: 10px;
      font-weight: 500;
      padding: 16px 6px 6px;
      text-align: center;
    }

    .action-row {
      display: flex;
      gap: 10px;
    }

    .btn {
      flex: 1;
      padding: 14px 20px;
      border-radius: var(--radius-md);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: background 0.15s ease, transform 0.1s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn:active { transform: scale(0.98); }
    .btn:focus-visible {
      outline: 3px solid var(--stone-brown);
      outline-offset: 2px;
    }

    .btn-primary {
      background: var(--stone-brown);
      color: white;
    }

    .btn-primary:hover { background: var(--stone-brown-dark); }

    .btn-secondary {
      background: var(--warm-beige);
      color: var(--text-primary);
    }

    .btn-secondary:hover { background: var(--border); }

    .btn svg {
      width: 18px;
      height: 18px;
    }

    /* Quote Screen */
    .quote-card {
      background: white;
      border-radius: var(--radius-lg);
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-sm);
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 6px;
    }

    .form-input, .form-select {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 16px;
      font-family: inherit;
      background: white;
      transition: border-color 0.15s ease;
    }

    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: var(--stone-brown);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .estimate-box {
      background: linear-gradient(135deg, var(--stone-brown) 0%, var(--stone-brown-dark) 100%);
      border-radius: var(--radius-md);
      padding: 20px;
      color: white;
      text-align: center;
      margin-top: 20px;
    }

    .estimate-label {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 4px;
    }

    .estimate-amount {
      font-family: 'Playfair Display', serif;
      font-size: 36px;
      font-weight: 700;
    }

    .estimate-note {
      font-size: 12px;
      opacity: 0.75;
      margin-top: 8px;
    }

    /* Voice Notes */
    .voice-section {
      background: white;
      border-radius: var(--radius-lg);
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-sm);
    }

    .voice-btn {
      width: 100%;
      padding: 16px;
      border-radius: var(--radius-md);
      border: 2px dashed var(--border);
      background: var(--marble-white);
      font-size: 15px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: border-color 0.15s ease, background 0.15s ease;
    }

    .voice-btn:hover {
      border-color: var(--stone-brown);
      background: white;
    }

    .voice-btn.recording {
      border-color: var(--terracotta);
      background: oklch(0.55 0.18 28 / 0.08);
      color: var(--terracotta);
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      .voice-btn.recording {
        animation: none;
        border-width: 3px;
      }
    }

    .voice-btn:focus-visible {
      outline: 3px solid var(--stone-brown);
      outline-offset: 2px;
    }

    .voice-btn svg {
      width: 22px;
      height: 22px;
    }

    .transcription {
      margin-top: 12px;
      padding: 12px;
      background: var(--marble-white);
      border-radius: var(--radius-sm);
      font-size: 14px;
      color: var(--text-secondary);
      min-height: 60px;
      border: 1px solid var(--border);
    }

    .transcription:empty::before {
      content: 'Your voice notes show up here...';
      color: var(--text-muted);
    }

    /* Consultations Screen */
    .consultation-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .consultation-card {
      background: white;
      border-radius: var(--radius-lg);
      padding: 16px;
      box-shadow: var(--shadow-sm);
      cursor: pointer;
      transition: box-shadow 0.15s ease, transform 0.1s ease;
      border: 2px solid transparent;
    }

    .consultation-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .consultation-card:focus-visible {
      outline: none;
      border-color: var(--stone-brown);
    }

    .consultation-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }

    .consultation-title {
      font-weight: 600;
      font-size: 16px;
      color: var(--text-primary);
    }

    .consultation-status {
      font-size: 12px;
      font-weight: 500;
      padding: 4px 10px;
      border-radius: 20px;
    }

    .status-sent {
      background: oklch(0.55 0.15 145 / 0.12);
      color: var(--success);
    }

    .status-progress {
      background: oklch(0.65 0.18 75 / 0.15);
      color: oklch(0.45 0.15 75);
    }

    .status-scheduled {
      background: oklch(0.55 0.15 260 / 0.12);
      color: oklch(0.45 0.18 260);
    }

    .consultation-details {
      display: flex;
      gap: 16px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .consultation-detail {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .consultation-detail svg {
      width: 14px;
      height: 14px;
      color: var(--text-muted);
    }

    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--text-muted);
    }

    .empty-state svg {
      width: 56px;
      height: 56px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state p {
      font-size: 15px;
      margin-bottom: 20px;
    }

    /* Toast with reduced motion support */
    .toast {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--charcoal);
      color: white;
      padding: 12px 20px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 500;
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    @media (prefers-reduced-motion: reduce) {
      .toast {
        transition: opacity 0.1s ease;
      }
    }

    /* Upsell Banner */
    .upsell-banner {
      background: linear-gradient(135deg, var(--charcoal) 0%, oklch(0.35 0.03 55) 100%);
      border-radius: var(--radius-lg);
      padding: 20px;
      color: white;
      margin-bottom: 16px;
    }

    .upsell-title {
      font-family: 'Playfair Display', serif;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .upsell-text {
      font-size: 14px;
      opacity: 0.85;
      margin-bottom: 16px;
      line-height: 1.6;
    }

    .upsell-features {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }

    .upsell-feature {
      background: oklch(1 0 0 / 0.12);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .btn-upgrade {
      background: white;
      color: var(--charcoal);
      width: 100%;
    }

    .btn-upgrade:hover {
      background: var(--warm-beige);
    }

    /* Stone Pattern Textures (CSS patterns as fallback) */
    .stone-calacatta {
      background: linear-gradient(135deg, #f5f2ed 0%, #e8e4de 25%, #f0ece6 50%, #ddd9d3 75%, #f5f2ed 100%);
    }

    .stone-absolute-black {
      background: linear-gradient(145deg, #1a1a1a 0%, #2d2d2d 50%, #1f1f1f 100%);
    }

    .stone-mont-blanc {
      background: linear-gradient(125deg, #f8f6f3 0%, #e5e2dc 30%, #f2efea 60%, #d8d4cd 100%);
    }

    .stone-soapstone {
      background: linear-gradient(140deg, #5a5d5e 0%, #6d7072 50%, #4a4d4e 100%);
    }

    .stone-giallo-ornamental {
      background: linear-gradient(130deg, #d4c4a8 0%, #c9b896 30%, #e0d4bc 60%, #bfaf93 100%);
    }

    /* Desktop Enhancement */
    @media (min-width: 768px) {
      .screen { padding: 24px; }
      .visualizer-container { aspect-ratio: 16/10; }
      .stone-grid { grid-template-columns: repeat(5, 1fr); }
      .form-row { grid-template-columns: 1fr 1fr 1fr; }
    }

    /* Print styles for quote */
    @media print {
      body { background: white; padding-bottom: 0 !important; }
      .header, .nav-tabs, #bct-demo-disclaimer { display: none; }
      .screen { max-width: none; }
      .quote-card { box-shadow: none; border: 1px solid #ddd; }
    }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <!-- Access Gate -->
  <div id="access-gate" role="dialog" aria-labelledby="gate-title" aria-modal="true">
    <div class="gate-card">
      <div class="gate-logo" id="gate-title">StoneMatch Pro</div>
      <p class="gate-tagline">Built for Legacy Countertops</p>
      <p class="gate-location">Charlotte, NC • Est. 1982</p>
      <label for="access-key" class="visually-hidden">Access Key</label>
      <input type="text" id="access-key" class="gate-input" placeholder="Enter access key" autocomplete="off" aria-describedby="gate-error">
      <button type="button" class="gate-btn" id="gate-submit">Open Tool</button>
      <p class="gate-error" id="gate-error" role="alert">That key didn't work. Check with the office.</p>
    </div>
  </div>

  <!-- Main App -->
  <main id="app" aria-label="StoneMatch Pro Application">
    <header class="header">
      <div class="header-inner">
        <div class="logo">StoneMatch Pro</div>
        <div class="header-actions">
          <button type="button" class="icon-btn" id="btn-new" aria-label="New consultation">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
          </button>
          <button type="button" class="icon-btn" id="btn-share" aria-label="Share current view">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>
          </button>
        </div>
      </div>
    </header>

    <nav class="nav-tabs" role="tablist" aria-label="Tool sections">
      <button type="button" class="nav-tab active" role="tab" aria-selected="true" aria-controls="screen-visualize" id="tab-visualize">Visualize</button>
      <button type="button" class="nav-tab" role="tab" aria-selected="false" aria-controls="screen-quote" id="tab-quote">Quote</button>
      <button type="button" class="nav-tab" role="tab" aria-selected="false" aria-controls="screen-jobs" id="tab-jobs">Jobs</button>
      <button type="button" class="nav-tab locked" role="tab" aria-selected="false" aria-disabled="true" id="tab-remnants" aria-label="Remnants (premium feature)">
        Remnants
        <svg class="lock-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/></svg>
      </button>
    </nav>

    <!-- Visualize Screen -->
    <section id="screen-visualize" class="screen active" role="tabpanel" aria-labelledby="tab-visualize">
      <div class="visualizer-container" id="visualizer-container">
        <video id="camera-preview" class="camera-preview hidden" autoplay playsinline muted></video>
        <img id="captured-photo" class="captured-photo" alt="Captured countertop photo">
        <canvas id="canvas-overlay" class="canvas-overlay"></canvas>
        <div id="camera-placeholder" class="camera-placeholder">
          <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"/></svg>
          <p>Tap the button below to snap a photo of the counter</p>
        </div>
        <button type="button" id="capture-btn" class="capture-btn" aria-label="Start camera or take photo"></button>
      </div>

      <div class="stone-selector">
        <h2 class="section-title">Select Stone Pattern</h2>
        <div class="stone-grid" role="radiogroup" aria-label="Stone pattern options">
          <button type="button" class="stone-option stone-calacatta selected" role="radio" aria-checked="true" data-stone="calacatta" data-price="75" aria-label="Calacatta Quartz">
            <span class="stone-label">Calacatta</span>
          </button>
          <button type="button" class="stone-option stone-absolute-black" role="radio" aria-checked="false" data-stone="absolute-black" data-price="65" aria-label="Absolute Black Granite">
            <span class="stone-label">Absolute Black</span>
          </button>
          <button type="button" class="stone-option stone-mont-blanc" role="radio" aria-checked="false" data-stone="mont-blanc" data-price="80" aria-label="Mont Blanc Quartz">
            <span class="stone-label">Mont Blanc</span>
          </button>
          <button type="button" class="stone-option stone-soapstone" role="radio" aria-checked="false" data-stone="soapstone" data-price="85" aria-label="Soapstone">
            <span class="stone-label">Soapstone</span>
          </button>
          <button type="button" class="stone-option stone-giallo-ornamental" role="radio" aria-checked="false" data-stone="giallo" data-price="55" aria-label="Giallo Ornamental Granite">
            <span class="stone-label">Giallo</span>
          </button>
        </div>
      </div>

      <div class="action-row">
        <button type="button" class="btn btn-secondary" id="btn-reset">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"/></svg>
          Reset
        </button>
        <button type="button" class="btn btn-primary" id="btn-apply-overlay">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"/></svg>
          Apply Stone
        </button>
      </div>
    </section>

    <!-- Quote Screen -->
    <section id="screen-quote" class="screen" role="tabpanel" aria-labelledby="tab-quote">
      <div class="voice-section">
        <h2 class="section-title">Voice Notes</h2>
        <button type="button" class="voice-btn" id="voice-btn" aria-describedby="voice-tip">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"/></svg>
          <span id="voice-label">Hold to record measurements</span>
        </button>
        <p id="voice-tip" class="visually-hidden">Hold the button to record voice notes. Let go to stop.</p>
        <div id="transcription" class="transcription" aria-live="polite" aria-atomic="true"></div>
      </div>

      <div class="quote-card">
        <h2 class="section-title">Quick Quote</h2>
        
        <div class="form-group">
          <label class="form-label" for="customer-name">Customer Name</label>
          <input type="text" id="customer-name" class="form-input" placeholder="e.g., Smith Kitchen Remodel">
        </div>

        <div class="form-group">
          <label class="form-label" for="stone-type">Stone Type</label>
          <select id="stone-type" class="form-select">
            <option value="75">Calacatta Quartz — $75/sqft</option>
            <option value="65">Absolute Black Granite — $65/sqft</option>
            <option value="80">Mont Blanc Quartz — $80/sqft</option>
            <option value="85">Soapstone — $85/sqft</option>
            <option value="55">Giallo Ornamental — $55/sqft</option>
          </select>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="length-input">Length (in)</label>
            <input type="number" id="length-input" class="form-input" placeholder="96" min="0">
          </div>
          <div class="form-group">
            <label class="form-label" for="depth-input">Depth (in)</label>
            <input type="number" id="depth-input" class="form-input" placeholder="25" min="0">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="sinks-input">Sink Cutouts</label>
            <select id="sinks-input" class="form-select">
              <option value="0">None</option>
              <option value="1">1 sink ($150)</option>
              <option value="2">2 sinks ($300)</option>
              <option value="3">3 sinks ($450)</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="edge-input">Edge Profile</label>
            <select id="edge-input" class="form-select">
              <option value="0">Eased (included)</option>
              <option value="8">Beveled (+$8/ft)</option>
              <option value="12">Bullnose (+$12/ft)</option>
              <option value="18">Ogee (+$18/ft)</option>
            </select>
          </div>
        </div>

        <div class="estimate-box" role="region" aria-live="polite" aria-label="Estimate total">
          <p class="estimate-label">Estimated Total</p>
          <p class="estimate-amount" id="estimate-total">$0</p>
          <p class="estimate-note">Material + fabrication + basic install</p>
        </div>
      </div>

      <div class="action-row">
        <button type="button" class="btn btn-secondary" id="btn-save-quote">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0111.186 0z"/></svg>
          Save
        </button>
        <button type="button" class="btn btn-primary" id="btn-send-quote">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg>
          Send to Customer
        </button>
      </div>
    </section>

    <!-- Jobs Screen -->
    <section id="screen-jobs" class="screen" role="tabpanel" aria-labelledby="tab-jobs">
      <div class="upsell-banner">
        <h2 class="upsell-title">Get the Full Version</h2>
        <p class="upsell-text">Unlock 50+ stone patterns, branded PDF proposals, customer follow-ups, and full remnant inventory tracking.</p>
        <div class="upsell-features">
          <span class="upsell-feature">50+ Stones</span>
          <span class="upsell-feature">PDF Proposals</span>
          <span class="upsell-feature">Follow-up Reminders</span>
          <span class="upsell-feature">Remnant Tracker</span>
        </div>
        <button type="button" class="btn btn-upgrade">Get Full Version — $200</button>
      </div>

      <h2 class="section-title">Recent Consultations</h2>
      <div id="consultation-list" class="consultation-list" role="list">
        <!-- Populated by JS -->
      </div>
    </section>

    <!-- Remnants Screen (Locked) -->
    <section id="screen-remnants" class="screen" role="tabpanel" aria-labelledby="tab-remnants">
      <div class="empty-state">
        <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"/></svg>
        <p>Remnant tracking comes with the full version. Search and photo your 250+ pieces in seconds.</p>
        <button type="button" class="btn btn-primary">Upgrade to Unlock</button>
      </div>
    </section>

    <!-- Toast -->
    <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>
  </main>

  <!-- Demo Disclaimer -->
  <footer id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer" style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:10px 16px;font-size:12px;line-height:1.4;color:#666;z-index:99999;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:8px 16px;text-align:center;">
    <p style="margin:0;max-width:700px;"><strong style="color:#333;">DEMO NOTICE:</strong> This tool was created by BennyCuTools as a free demonstration only. It is not affiliated with, endorsed by, or authorized by Legacy Countertops LLC of Charlotte, NC. All brand references are used solely for demonstration purposes.</p>
    <a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20Legacy%20Countertops&body=I%20am%20the%20owner%20and%20I%20request%20permanent%20deletion%20of%20this%20demo." style="display:inline-flex;align-items:center;gap:4px;background:#dc3545;color:#fff;padding:5px 12px;border-radius:4px;text-decoration:none;font-size:11px;font-weight:500;white-space:nowrap;">Request Permanent Deletion</a>
  </footer>

  <style>
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    /* Enhanced focus styles for accessibility */
    *:focus-visible {
      outline: 2px solid var(--stone-brown);
      outline-offset: 2px;
    }
    
    button:focus-visible,
    input:focus-visible,
    select:focus-visible {
      outline: 3px solid var(--stone-brown);
      outline-offset: 2px;
    }
    
    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }
    
    @media (prefers-reduced-motion: reduce) {
      html {
        scroll-behavior: auto;
      }
    }
  </style>

  <script>

// Security: HTML entity escaping to prevent XSS
function escapeHTML(str) {
  if (str === null || str === undefined) return '';
  const s = String(str);
  const div = document.createElement('div');
  div.appendChild(document.createTextNode(s));
  return div.innerHTML;
}

// Security: Rate limiting + session expiry
(function(){
  const RL_KEY = 'bct_rl';
  const SE_KEY = 'bct_se';
  const MAX_ATTEMPTS = 5;
  const LOCKOUT_MS = 30 * 60 * 1000;
  const SESSION_MS = 24 * 60 * 60 * 1000;
  const sessionExp = localStorage.getItem(SE_KEY);
  if (sessionExp && Date.now() > parseInt(sessionExp)) {
    localStorage.removeItem('bct_auth');
    localStorage.removeItem(SE_KEY);
  }
  if (!localStorage.getItem(SE_KEY)) {
    localStorage.setItem(SE_KEY, String(Date.now() + SESSION_MS));
  }
  window._bctCheckRL = function() {
    try {
      const rl = JSON.parse(localStorage.getItem(RL_KEY) || '{"c":0,"t":0}');
      if (rl.c >= MAX_ATTEMPTS && (Date.now() - rl.t) < LOCKOUT_MS) {
        return { locked: true, mins: Math.ceil((LOCKOUT_MS - (Date.now() - rl.t)) / 60000) };
      }
      if ((Date.now() - rl.t) >= LOCKOUT_MS) {
        localStorage.setItem(RL_KEY, JSON.stringify({c: 0, t: Date.now()}));
      }
      return { locked: false };
    } catch(e) { return { locked: false }; }
  };
  window._bctRecordFail = function() {
    try {
      const rl = JSON.parse(localStorage.getItem(RL_KEY) || '{"c":0,"t":0}');
      rl.c++;
      rl.t = Date.now();
      localStorage.setItem(RL_KEY, JSON.stringify(rl));
    } catch(e) {}
  };
  window._bctResetRL = function() { localStorage.removeItem(RL_KEY); };
})();

    (function() {
      'use strict';

      // ========== Access Gate ==========
      const ACCESS_HASH = -1288325719;
      function hashKey(s) {
        let h = 0;
        for (let i = 0; i < s.length; i++) {
          h = ((h << 5) - h) + s.charCodeAt(i);
          h |= 0;
        }
        return h;
      }

      const gate = document.getElementById('access-gate');
      const app = document.getElementById('app');
      const keyInput = document.getElementById('access-key');
      const gateBtn = document.getElementById('gate-submit');
      const gateError = document.getElementById('gate-error');

      // Check URL param first
      const urlKey = new URLSearchParams(window.location.search).get('key');
      if (urlKey && hashKey(urlKey) === ACCESS_HASH) {
        gate.classList.add('hidden');
        app.classList.add('visible');
        initApp();
      }

      gateBtn.addEventListener('click', checkAccess);
      keyInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') checkAccess();
      });

      function checkAccess() {
        const val = keyInput.value.trim();
        if (hashKey(val) === ACCESS_HASH) {
          gate.classList.add('hidden');
          app.classList.add('visible');
          initApp();
        } else {
          gateError.classList.add('show');
          keyInput.focus();
        }
      }

      // ========== App State ==========
      let currentTab = 'visualize';
      let selectedStone = 'calacatta';
      let selectedPrice = 75;
      let cameraStream = null;
      let capturedImageData = null;
      let isRecording = false;
      let recognition = null;

      // Demo Data
      const demoConsultations = [
        {
          id: 1,
          title: 'Kitchen Remodel — Ballantyne',
          stone: 'Calacatta Quartz',
          sqft: 45,
          status: 'sent',
          date: '2026-02-05'
        },
        {
          id: 2,
          title: 'Bathroom Vanity — Myers Park',
          stone: 'Absolute Black Granite',
          sqft: 12,
          status: 'progress',
          date: '2026-02-07'
        },
        {
          id: 3,
          title: 'Outdoor Kitchen — Lake Norman',
          stone: 'Soapstone',
          sqft: 30,
          status: 'scheduled',
          date: '2026-02-10'
        }
      ];

      // ========== Anti-Scrape Protection ==========
      (function() {
        // Disable right-click on images/canvas
        document.addEventListener('contextmenu', function(e) {
          if (e.target.tagName === 'IMG' || e.target.tagName === 'CANVAS' || e.target.tagName === 'VIDEO') {
            e.preventDefault();
          }
        });
        // Disable drag on images
        document.addEventListener('dragstart', function(e) {
          if (e.target.tagName === 'IMG') e.preventDefault();
        });
        // Obfuscate console
        Object.defineProperty(window, '_stoneMatch', {
          get() { return 'Protected by Legacy Countertops'; }
        });
      })();

      // ========== Init ==========
      function initApp() {
        setupTabs();
        setupStoneSelector();
        setupCamera();
        setupVoice();
        setupQuoteCalc();
        setupActions();
        renderConsultations();
        
        // Focus management for accessibility
        const mainContent = document.getElementById('app');
        if (mainContent) {
          mainContent.setAttribute('tabindex', '-1');
          mainContent.focus({ preventScroll: true });
        }
      }

      // ========== Tab Navigation ==========
      function setupTabs() {
        const tabs = document.querySelectorAll('.nav-tab');
        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            if (tab.classList.contains('locked')) {
              showToast('Remnant tracking is in the full version');
              return;
            }
            tabs.forEach(t => {
              t.classList.remove('active');
              t.setAttribute('aria-selected', 'false');
            });
            tab.classList.add('active');
            tab.setAttribute('aria-selected', 'true');

            const screenId = tab.getAttribute('aria-controls');
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
          });
        });
      }

      // ========== Stone Selector ==========
      function setupStoneSelector() {
        const options = document.querySelectorAll('.stone-option');
        options.forEach(opt => {
          opt.addEventListener('click', () => {
            options.forEach(o => {
              o.classList.remove('selected');
              o.setAttribute('aria-checked', 'false');
            });
            opt.classList.add('selected');
            opt.setAttribute('aria-checked', 'true');
            selectedStone = opt.dataset.stone;
            selectedPrice = parseInt(opt.dataset.price);

            // Update quote dropdown
            const stoneSelect = document.getElementById('stone-type');
            stoneSelect.value = selectedPrice.toString();
            updateEstimate();
          });
        });
      }

      // ========== Camera ==========
      function setupCamera() {
        const captureBtn = document.getElementById('capture-btn');
        const video = document.getElementById('camera-preview');
        const placeholder = document.getElementById('camera-placeholder');
        const capturedImg = document.getElementById('captured-photo');
        const canvas = document.getElementById('canvas-overlay');
        const ctx = canvas.getContext('2d');

        let cameraActive = false;

        captureBtn.addEventListener('click', async () => {
          if (!cameraActive && !capturedImageData) {
            // Start camera
            try {
              cameraStream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } }
              });
              video.srcObject = cameraStream;
              video.classList.remove('hidden');
              placeholder.classList.add('hidden');
              cameraActive = true;
            } catch (err) {
              showToast('Need camera access to show stone previews');
              console.error('Camera error:', err);
            }
          } else if (cameraActive) {
            // Capture photo
            canvas.width = video.videoWidth || 640;
            canvas.height = video.videoHeight || 480;
            ctx.drawImage(video, 0, 0);
            capturedImageData = canvas.toDataURL('image/jpeg', 0.85);
            capturedImg.src = capturedImageData;
            capturedImg.classList.add('show');
            video.classList.add('hidden');

            // Stop camera
            if (cameraStream) {
              cameraStream.getTracks().forEach(t => t.stop());
              cameraStream = null;
            }
            cameraActive = false;
            showToast('Got the photo — pick a stone to see how it looks');
          }
        });

        // Apply overlay button
        document.getElementById('btn-apply-overlay').addEventListener('click', () => {
          if (!capturedImageData) {
            showToast('Take a photo first');
            return;
          }
          applyStoneOverlay();
        });

        // Reset button
        document.getElementById('btn-reset').addEventListener('click', () => {
          capturedImageData = null;
          capturedImg.classList.remove('show');
          capturedImg.src = '';
          video.classList.add('hidden');
          placeholder.classList.remove('hidden');

          // Clear canvas
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          if (cameraStream) {
            cameraStream.getTracks().forEach(t => t.stop());
            cameraStream = null;
          }
          showToast('Cleared — ready for your next photo');
        });
      }

      function applyStoneOverlay() {
        const canvas = document.getElementById('canvas-overlay');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('visualizer-container');

        canvas.width = container.offsetWidth;
        canvas.height = container.offsetHeight;

        // Get stone colors based on selection
        const stoneColors = {
          'calacatta': ['#f5f2ed', '#e8e4de', '#ddd9d3'],
          'absolute-black': ['#1a1a1a', '#2d2d2d', '#1f1f1f'],
          'mont-blanc': ['#f8f6f3', '#e5e2dc', '#d8d4cd'],
          'soapstone': ['#5a5d5e', '#6d7072', '#4a4d4e'],
          'giallo': ['#d4c4a8', '#c9b896', '#bfaf93']
        };

        const colors = stoneColors[selectedStone] || stoneColors['calacatta'];

        // Create gradient overlay with veining pattern
        const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
        gradient.addColorStop(0, colors[0]);
        gradient.addColorStop(0.5, colors[1]);
        gradient.addColorStop(1, colors[2]);

        ctx.globalAlpha = 0.45;
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Add veining effect for marble types
        if (selectedStone === 'calacatta' || selectedStone === 'mont-blanc') {
          ctx.globalAlpha = 0.15;
          ctx.strokeStyle = '#999';
          ctx.lineWidth = 2;
          for (let i = 0; i < 5; i++) {
            ctx.beginPath();
            ctx.moveTo(Math.random() * canvas.width, 0);
            ctx.bezierCurveTo(
              Math.random() * canvas.width, canvas.height * 0.3,
              Math.random() * canvas.width, canvas.height * 0.7,
              Math.random() * canvas.width, canvas.height
            );
            ctx.stroke();
          }
        }

        ctx.globalAlpha = 1;
        showToast('Stone preview ready — show your customer');
      }

      // ========== Voice Recognition ==========
      function setupVoice() {
        const voiceBtn = document.getElementById('voice-btn');
        const voiceLabel = document.getElementById('voice-label');
        const transcription = document.getElementById('transcription');

        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
          voiceBtn.innerHTML = '<span>Voice notes not supported in this browser</span>';
          voiceBtn.disabled = true;
          return;
        }

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = 'en-US';

        let finalTranscript = '';

        recognition.onresult = (event) => {
          let interim = '';
          for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
              finalTranscript += transcript + ' ';
            } else {
              interim += transcript;
            }
          }
          transcription.textContent = finalTranscript + interim;

          // Try to parse measurements
          parseMeasurements(finalTranscript + interim);
        };

        recognition.onerror = (event) => {
          console.error('Speech error:', event.error);
          stopRecording();
          showToast('Recording stopped');
        };

        recognition.onend = () => {
          if (isRecording) {
            recognition.start(); // Keep listening if still recording
          }
        };

        // Touch/mouse events for press-and-hold
        let pressTimer;

        voiceBtn.addEventListener('mousedown', startRecording);
        voiceBtn.addEventListener('mouseup', stopRecording);
        voiceBtn.addEventListener('mouseleave', stopRecording);
        voiceBtn.addEventListener('touchstart', (e) => {
          e.preventDefault();
          startRecording();
        });
        voiceBtn.addEventListener('touchend', stopRecording);

        function startRecording() {
          if (isRecording) return;
          isRecording = true;
          voiceBtn.classList.add('recording');
          voiceLabel.textContent = 'Recording... release to stop';
          recognition.start();
        }

        function stopRecording() {
          if (!isRecording) return;
          isRecording = false;
          voiceBtn.classList.remove('recording');
          voiceLabel.textContent = 'Hold to record measurements';
          recognition.stop();
        }
      }

      function parseMeasurements(text) {
        // Look for number patterns like "84 inches" or "36 by 25"
        const lengthMatch = text.match(/(\d+)\s*(inch|inches|in|by)/i);
        const depthMatch = text.match(/by\s*(\d+)/i);

        if (lengthMatch) {
          document.getElementById('length-input').value = lengthMatch[1];
        }
        if (depthMatch) {
          document.getElementById('depth-input').value = depthMatch[1];
        }
        updateEstimate();
      }

      // ========== Quote Calculator ==========
      function setupQuoteCalc() {
        const inputs = ['stone-type', 'length-input', 'depth-input', 'sinks-input', 'edge-input'];
        inputs.forEach(id => {
          document.getElementById(id).addEventListener('input', updateEstimate);
          document.getElementById(id).addEventListener('change', updateEstimate);
        });
      }

      function updateEstimate() {
        const pricePerSqft = parseInt(document.getElementById('stone-type').value) || 75;
        const length = parseFloat(document.getElementById('length-input').value) || 0;
        const depth = parseFloat(document.getElementById('depth-input').value) || 0;
        const sinks = parseInt(document.getElementById('sinks-input').value) || 0;
        const edgeCost = parseInt(document.getElementById('edge-input').value) || 0;

        const sqft = (length * depth) / 144;
        const materialCost = sqft * pricePerSqft;
        const sinkCost = sinks * 150;
        const edgeTotal = (length / 12) * edgeCost;
        const installCost = sqft * 15; // $15/sqft install

        const total = materialCost + sinkCost + edgeTotal + installCost;

        document.getElementById('estimate-total').textContent = 
          '$' + Math.round(total).toLocaleString();
      }

      // ========== Actions ==========
      function setupActions() {
        // Share button
        document.getElementById('btn-share').addEventListener('click', async () => {
          if (navigator.share) {
            try {
              await navigator.share({
                title: 'Stone Visualization — Legacy Countertops',
                text: `Take a look at how this stone looks on your counter!`,
                url: window.location.href
              });
            } catch (err) {
              if (err.name !== 'AbortError') {
                showToast('Share cancelled');
              }
            }
          } else {
            // Fallback: copy URL
            navigator.clipboard.writeText(window.location.href);
            showToast('Link copied');
          }
        });

        // Save quote
        document.getElementById('btn-save-quote').addEventListener('click', () => {
          const name = document.getElementById('customer-name').value || 'Unnamed Project';
          showToast('Saved quote for ' + name);
        });

        // Send quote
        document.getElementById('btn-send-quote').addEventListener('click', async () => {
          const total = document.getElementById('estimate-total').textContent;
          const name = document.getElementById('customer-name').value || 'Your Kitchen';

          if (navigator.share) {
            try {
              await navigator.share({
                title: 'Quote from Legacy Countertops',
                text: `Hi! Here's your estimate for ${name}: ${total}. This includes material, fabrication, and basic installation. Call us at (704) 504-5354 to schedule your template appointment.`
              });
        showToast('Quote shared with customer');
            } catch (err) {
              if (err.name !== 'AbortError') {
                showToast('Share cancelled');
              }
            }
          } else {
            showToast('Copy the estimate to share it');
          }
        });

        // New consultation
        document.getElementById('btn-new').addEventListener('click', () => {
          document.getElementById('customer-name').value = '';
          document.getElementById('length-input').value = '';
          document.getElementById('depth-input').value = '';
          document.getElementById('sinks-input').value = '0';
          document.getElementById('edge-input').value = '0';
          document.getElementById('transcription').textContent = '';
          document.getElementById('estimate-total').textContent = '$0';

          // Switch to visualize tab
          document.querySelector('.nav-tab.active').click();
          document.getElementById('btn-reset').click();

          showToast('New consultation started');
        });
      }

      // ========== Consultations List ==========
      function renderConsultations() {
        const list = document.getElementById('consultation-list');
        list.innerHTML = demoConsultations.map(c => `
          <article class="consultation-card" role="listitem" tabindex="0" aria-label="${c.title}">
            <div class="consultation-header">
              <h3 class="consultation-title">${c.title}</h3>
              <span class="consultation-status status-${c.status}">
                ${c.status === 'sent' ? 'Quote Sent' : c.status === 'progress' ? 'In Progress' : 'Template Scheduled'}
              </span>
            </div>
            <div class="consultation-details">
              <span class="consultation-detail">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12a7.5 7.5 0 0015 0m-15 0a7.5 7.5 0 1115 0m-15 0H3m16.5 0H21m-1.5 0H12m-8.457 3.077l1.41-.513m14.095-5.13l1.41-.513M5.106 17.785l1.15-.964m11.49-9.642l1.149-.964M7.501 19.795l.75-1.3m7.5-12.99l.75-1.3m-6.063 16.658l.26-1.477m2.605-14.772l.26-1.477m0 17.726l-.26-1.477M10.698 4.614l-.26-1.477M16.5 19.794l-.75-1.299M7.5 4.205L6.75 2.906"/></svg>
                ${c.stone}
              </span>
              <span class="consultation-detail">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z"/></svg>
                ${c.sqft} sq ft
              </span>
              <span class="consultation-detail">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"/></svg>
                ${formatDate(c.date)}
              </span>
            </div>
          </article>
        `).join('');
      }

      function formatDate(dateStr) {
        const d = new Date(dateStr);
        return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      }

      // ========== Toast ==========
      function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3000);
      }

    })();
  </script>
<script src="https://book.bennycutools.com/tracker.js" async></script>
</body>
</html>
