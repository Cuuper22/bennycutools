<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>BlowerSnap - Central Florida Blower Door Testing</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root{
  --blu:#1565C0;--blu-d:#0D47A1;--blu-l:#1E88E5;--blu-p:#E3F2FD;
  --grn:#2E7D32;--grn-p:#E8F5E9;--red:#C62828;--red-p:#FFEBEE;
  --org:#EF6C00;--org-p:#FFF3E0;
  --bg:#F5F5F5;--wh:#FFF;--tx:#212121;--tx2:#616161;--tx3:#9E9E9E;--bdr:#E0E0E0;
  --sh-s:0 1px 3px rgba(0,0,0,.06);--sh-m:0 4px 12px rgba(0,0,0,.08);--sh-l:0 8px 24px rgba(0,0,0,.1);
  --r:8px;--rm:12px;--rl:16px;
}
*{margin:0;padding:0;box-sizing:border-box}
*:focus-visible{outline:3px solid var(--blu-l);outline-offset:3px;border-radius:4px}
html{scroll-behavior:smooth}
body{font-family:'Roboto',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--tx);min-height:100vh;padding-bottom:140px;-webkit-font-smoothing:antialiased;line-height:1.5}
@media(prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:.01ms!important;transition-duration:.01ms!important;scroll-behavior:auto!important}}

/* Skip link for accessibility */
.skip-link{position:absolute;top:-40px;left:0;background:var(--blu-d);color:#fff;padding:8px 16px;z-index:10000;text-decoration:none;font-weight:500;border-radius:0 0 4px 0;transition:top .2s}
.skip-link:focus{top:0}

.hdr{background:linear-gradient(135deg,var(--blu-d),var(--blu));color:#fff;padding:16px 20px;position:sticky;top:0;z-index:100;box-shadow:var(--sh-m)}
.hdr h1{font-family:'Roboto Condensed',sans-serif;font-size:22px;font-weight:700;letter-spacing:-.3px}
.hdr .sub{font-size:12px;opacity:.9;margin-top:2px;font-weight:400}

.demo-bar{background:var(--blu-p);border-bottom:1px solid var(--blu-l);padding:12px 20px;font-size:13px;color:var(--blu-d);display:flex;align-items:center;justify-content:space-between;gap:12px}
.demo-bar button{background:none;border:1.5px solid var(--blu);color:var(--blu);padding:5px 14px;border-radius:6px;cursor:pointer;font-size:12px;font-family:inherit;font-weight:500;transition:all .15s}
.demo-bar button:hover{background:var(--blu);color:#fff}
.demo-bar button:focus-visible{outline-color:var(--blu-d)}

.wrap{padding:0 16px;max-width:500px;margin:0 auto}
.vw{display:none}.vw.on{display:block}

/* TEST CARDS */
.tcard{background:var(--wh);border-radius:var(--rl);padding:20px;margin:16px 0;box-shadow:var(--sh-m);border:1px solid var(--bdr);cursor:pointer;transition:transform .15s ease,box-shadow .2s ease;animation:sUp .4s cubic-bezier(.34,1.56,.64,1) both;position:relative}
.tcard:hover{box-shadow:0 6px 20px rgba(0,0,0,.12)}
.tcard:active{transform:scale(.98)}
.tcard:focus-visible{outline-offset:4px}
.tcard:nth-child(1){animation-delay:.05s}.tcard:nth-child(2){animation-delay:.1s}.tcard:nth-child(3){animation-delay:.15s}
.tc-addr{font-family:'Roboto Condensed',sans-serif;font-size:17px;font-weight:600;margin-bottom:4px;color:var(--tx)}
.tc-meta{font-size:13px;color:var(--tx2);margin-bottom:12px}
.tc-result{display:flex;align-items:center;gap:12px;margin-bottom:8px}
.tc-badge{padding:6px 14px;border-radius:var(--r);font-family:'Roboto Condensed',sans-serif;font-size:14px;font-weight:700;text-transform:uppercase;letter-spacing:.5px}
.tc-badge.pass{background:var(--grn-p);color:var(--grn)}.tc-badge.fail{background:var(--red-p);color:var(--red)}
.tc-ach{font-family:'Roboto Condensed',sans-serif;font-size:28px;font-weight:700}
.tc-ach.pass{color:var(--grn)}.tc-ach.fail{color:var(--red)}
.tc-ach-label{font-size:12px;color:var(--tx3)}
.tc-foot{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:var(--tx3);margin-top:8px}

.fab{position:fixed;bottom:130px;right:20px;width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,var(--blu-l),var(--blu-d));color:#fff;border:none;box-shadow:var(--sh-l);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:90;transition:transform .2s ease,box-shadow .2s ease;animation:pulse 2s ease-in-out infinite}
.fab:hover{transform:scale(1.05);box-shadow:0 8px 28px rgba(21,101,192,.35)}
.fab:active{transform:scale(.95)}.fab svg{width:26px;height:26px}
@keyframes pulse{0%,100%{box-shadow:var(--sh-l),0 0 0 0 rgba(21,101,192,.3)}50%{box-shadow:var(--sh-l),0 0 0 12px rgba(21,101,192,0)}}

.bsec{background:var(--wh);border-radius:var(--rl);padding:20px;margin:16px 0;box-shadow:var(--sh-s);border:1px solid var(--bdr);animation:sUp .3s ease-out both}
.bsec h2{font-family:'Roboto Condensed',sans-serif;font-size:15px;font-weight:600;color:var(--blu-d);margin-bottom:16px;display:flex;align-items:center;gap:8px}
.bsec h2 svg{width:20px;height:20px;flex-shrink:0}
.fg{margin-bottom:16px}.fg label{display:block;font-size:12px;font-weight:500;color:var(--tx2);margin-bottom:6px}
.fg input,.fg select{width:100%;padding:12px 14px;border:1.5px solid var(--bdr);border-radius:var(--r);font-size:16px;font-family:inherit;background:var(--wh);color:var(--tx);transition:border-color .15s,box-shadow .15s}
.fg input:hover,.fg select:hover{border-color:var(--tx3)}
.fg input:focus,.fg select:focus{border-color:var(--blu);box-shadow:0 0 0 3px rgba(21,101,192,.12);outline:none}
.fg input::placeholder{color:var(--tx3)}
.frow{display:grid;grid-template-columns:1fr 1fr;gap:12px}

/* ACH GAUGE - BIG RESULT */
.result-box{text-align:center;padding:28px 24px;border-radius:var(--rl);margin:16px 0;transition:all .4s ease;border:2px solid var(--bdr);background:var(--bg)}
.result-box.pass{background:var(--grn-p);border-color:var(--grn)}
.result-box.fail{background:var(--red-p);border-color:var(--red)}
.result-box.neutral{background:var(--bg);border-color:var(--bdr)}
.rb-status{font-family:'Roboto Condensed',sans-serif;font-size:18px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:6px}
.rb-status.pass{color:var(--grn)}.rb-status.fail{color:var(--red)}.rb-status.neutral{color:var(--tx3)}
.rb-ach{font-family:'Roboto Condensed',sans-serif;font-size:64px;font-weight:700;line-height:1;transition:transform .3s cubic-bezier(.34,1.56,.64,1);letter-spacing:-1px}
.rb-ach.pass{color:var(--grn)}.rb-ach.fail{color:var(--red)}.rb-ach.neutral{color:var(--tx3)}
.rb-ach.bump{transform:scale(1.12)}
.rb-label{font-size:13px;color:var(--tx2);margin-top:10px;font-weight:500}
.rb-bar{height:12px;background:var(--bdr);border-radius:6px;margin:18px auto 0;max-width:300px;position:relative;overflow:hidden;box-shadow:inset 0 1px 2px rgba(0,0,0,.08)}
.rb-fill{height:100%;border-radius:6px;transition:width .6s cubic-bezier(.4,0,.2,1),background .3s ease}
.rb-scale{display:flex;justify-content:space-between;font-size:11px;color:var(--tx3);max-width:300px;margin:8px auto 0;font-weight:500}
.rb-code{font-size:12px;color:var(--tx2);margin-top:10px;padding:6px 14px;display:inline-block;border-radius:6px;background:rgba(0,0,0,.05);font-weight:500}

/* PHOTO STRIP */
.photo-strip{display:flex;gap:10px;overflow-x:auto;padding:8px 0;scrollbar-width:thin;scrollbar-color:var(--tx3) transparent}
.photo-strip::-webkit-scrollbar{height:4px}
.photo-strip::-webkit-scrollbar-track{background:transparent}
.photo-strip::-webkit-scrollbar-thumb{background:var(--tx3);border-radius:2px}
.ph-thumb{width:76px;height:76px;border-radius:var(--r);overflow:hidden;background:var(--blu-p);flex-shrink:0;display:flex;align-items:center;justify-content:center;cursor:pointer;border:2px dashed var(--bdr);transition:all .15s ease}
.ph-thumb:hover{border-color:var(--blu);background:var(--blu-p)}
.ph-thumb:focus-visible{outline-offset:2px;border-color:var(--blu)}
.ph-thumb img{width:100%;height:100%;object-fit:cover}
.ph-thumb.has{border:solid;border-color:transparent}
.ph-thumb svg{color:var(--blu)}

.abr{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:20px 0}
.btn{padding:14px 20px;border-radius:var(--rm);font-family:'Roboto Condensed',sans-serif;font-size:15px;font-weight:600;cursor:pointer;transition:all .15s ease;border:none;display:flex;align-items:center;justify-content:center;gap:8px}
.btn:hover{transform:translateY(-1px)}
.btn:active{transform:translateY(1px) scale(.98)}
.btn:focus-visible{outline-offset:4px}
.btn svg{width:18px;height:18px;flex-shrink:0}
.bp{background:linear-gradient(135deg,var(--blu-l),var(--blu-d));color:#fff;box-shadow:var(--sh-m)}
.bp:hover{box-shadow:0 6px 16px rgba(21,101,192,.3)}
.bs{background:var(--wh);color:var(--blu-d);border:2px solid var(--blu)}
.bs:hover{background:var(--blu-p)}
.bf{grid-column:1/-1}

.bnav{position:fixed;bottom:60px;left:0;right:0;background:var(--wh);border-top:1px solid var(--bdr);display:flex;justify-content:space-around;padding:10px 0 14px;z-index:100;box-shadow:0 -2px 10px rgba(0,0,0,.06)}
.nb{background:none;border:none;display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer;padding:4px 16px;color:var(--tx3);transition:all .15s;font-family:inherit;border-radius:8px;position:relative}
.nb:hover{color:var(--tx2)}
.nb.on{color:var(--blu-d)}
.nb.on::after{content:'';position:absolute;bottom:-2px;width:4px;height:4px;background:var(--blu);border-radius:50%}
.nb svg{width:22px;height:22px}.nb span{font-size:11px;font-weight:500}
.nb:focus-visible{outline-offset:2px}

.tc-box{position:fixed;top:84px;left:50%;transform:translateX(-50%);z-index:9999;pointer-events:none;width:calc(100% - 32px);max-width:400px}
.tst{background:var(--tx);color:#fff;padding:14px 20px;border-radius:var(--rm);font-size:14px;box-shadow:var(--sh-l);animation:tIn .3s ease-out;margin-bottom:10px;text-align:center;font-weight:500}
.tst.ok{background:var(--grn)}.tst.err{background:var(--red)}

.empty{text-align:center;padding:56px 24px}
.empty svg{width:80px;height:80px;color:var(--tx3);opacity:.4;margin-bottom:20px}
.empty h3{font-family:'Roboto Condensed',sans-serif;font-size:20px;margin-bottom:10px;color:var(--tx)}
.empty p{font-size:14px;color:var(--tx2);max-width:280px;margin:0 auto 24px;line-height:1.6}

.sg{background:var(--wh);border-radius:var(--rl);padding:20px;margin:16px 0;box-shadow:var(--sh-s);border:1px solid var(--bdr)}
.sg h3{font-family:'Roboto Condensed',sans-serif;font-size:15px;font-weight:600;margin-bottom:14px;color:var(--blu-d)}
.locked{position:relative;opacity:.5;min-height:120px}
.lock-ov{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(255,255,255,.9);border-radius:var(--rl);z-index:10;backdrop-filter:blur(2px)}
.lock-lbl{font-family:'Roboto Condensed',sans-serif;font-size:14px;font-weight:600;color:var(--tx2);margin-top:10px}

/* STATS */
.stat-row{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:20px 0}
.stat-card{background:var(--wh);border-radius:var(--rm);padding:16px 12px;text-align:center;box-shadow:var(--sh-s);border:1px solid var(--bdr);transition:transform .15s}
.stat-card:hover{transform:translateY(-2px)}
.stat-val{font-family:'Roboto Condensed',sans-serif;font-size:26px;font-weight:700;color:var(--blu-d);line-height:1}
.stat-lbl{font-size:10px;color:var(--tx3);text-transform:uppercase;letter-spacing:.5px;margin-top:4px;font-weight:500}

/* Loading state */
.loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 24px;text-align:center}
.loading-spinner{width:40px;height:40px;border:3px solid var(--blu-p);border-top-color:var(--blu);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:16px}
@keyframes spin{to{transform:rotate(360deg)}}

@keyframes sUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes tIn{from{opacity:0;transform:translateY(-10px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}

@media print{
  .bnav,.fab,.demo-bar,.tc-box,.hdr,#bct-demo-disclaimer{display:none!important}
  body{padding:0;background:#fff}
  .wrap{max-width:100%}
  .result-box{break-inside:avoid;box-shadow:none;border:2px solid #333}
  .tcard{box-shadow:none;border:1px solid #333}
}
@media(min-width:1024px){.bnav{display:none}body{padding-bottom:80px}.wrap{max-width:600px}.fab{bottom:80px}}
body{padding-bottom:60px!important}
</style>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>
<header class="hdr" role="banner">
  <h1>BlowerSnap</h1>
  <div class="sub">Central Florida Blower Door Testing</div>
</header>
<div class="demo-bar" id="demoBanner" style="display:none" role="status" aria-live="polite" aria-atomic="true">
  <span>Sample Polk County area tests loaded. Tap Clear to start fresh.</span>
  <button onclick="clearDemo()" aria-label="Clear sample test data">Clear</button>
</div>
<div class="tc-box" id="toasts" role="status" aria-live="polite" aria-atomic="true"></div>

<main class="wrap" role="main" id="main-content" tabindex="-1">
  <section class="vw on" id="listView" aria-labelledby="testListHeading">
    <h2 id="testListHeading" class="sr-only" style="position:absolute;left:-10000px;width:1px;height:1px;overflow:hidden;">Test List</h2>
    <div class="stat-row" id="statsRow" role="region" aria-label="Test statistics summary">
      <div class="stat-card" role="status" aria-label="Total tests recorded">
        <div class="stat-val" id="stTotal">0</div>
        <div class="stat-lbl">Tests</div>
      </div>
      <div class="stat-card" role="status" aria-label="Tests that passed code requirements">
        <div class="stat-val" id="stPass">0</div>
        <div class="stat-lbl">Passed</div>
      </div>
      <div class="stat-card" role="status" aria-label="Percentage of tests passing">
        <div class="stat-val" id="stRate">0%</div>
        <div class="stat-lbl">Pass Rate</div>
      </div>
    </div>
    <div id="testList"></div>
    <div class="empty" id="emptyState" style="display:none">
      <svg viewBox="0 0 80 80" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><circle cx="40" cy="40" r="25"/><path d="M40 25v15l10 5"/><rect x="15" y="55" width="50" height="10" rx="2"/></svg>
      <h3>No tests yet</h3>
      <p>Start by logging your first blower door test. The app will calculate ACH50 and check against Florida code.</p>
      <button class="btn bp" onclick="switchVw('build')">Log First Test</button>
    </div>
  </section>

  <section class="vw" id="buildView" aria-labelledby="testEntryHeading">
    <h2 id="testEntryHeading" class="sr-only" style="position:absolute;left:-10000px;width:1px;height:1px;overflow:hidden;">Test Entry Form</h2>
    <div class="bsec" style="animation-delay:.05s">
      <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg> Property Info</h2>
      <div class="fg">
        <label for="tAddr">Property Address <span aria-label="required">*</span></label>
        <input type="text" id="tAddr" placeholder="1234 Lake View Dr, Davenport, FL" autocomplete="street-address" required aria-required="true">
      </div>
      <div class="frow">
        <div class="fg">
          <label for="tBuilder">Builder or Contact</label>
          <input type="text" id="tBuilder" placeholder="ABC Homes" autocomplete="organization">
        </div>
        <div class="fg">
          <label for="tPermit">Permit Number</label>
          <input type="text" id="tPermit" placeholder="BLD-2026-1234">
        </div>
      </div>
    </div>

    <div class="bsec" style="animation-delay:.1s">
      <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg> Test Readings</h2>
      <div class="frow">
        <div class="fg">
          <label for="tSqft">Conditioned Area (sq ft)</label>
          <input type="number" id="tSqft" placeholder="2100" inputmode="numeric" oninput="calcResult()" min="1" aria-describedby="sqftHelp">
        </div>
        <div class="fg">
          <label for="tCeil">Ceiling Height (ft)</label>
          <input type="number" id="tCeil" value="9" step="0.5" oninput="calcResult()" min="1">
        </div>
      </div>
      <div class="fg">
        <label for="tCfm">CFM50 Reading <span aria-label="required">*</span></label>
        <input type="number" id="tCfm" placeholder="1842" inputmode="numeric" oninput="calcResult()" min="1" required aria-required="true" aria-describedby="cfmHelp" style="font-size:20px;font-weight:600;text-align:center;padding:16px">
        <span id="cfmHelp" style="font-size:11px;color:var(--tx3);margin-top:4px;display:block">The air flow reading from your blower door manometer at 50 Pascals pressure</span>
      </div>
    </div>

    <div class="result-box neutral" id="resultBox" role="status" aria-live="polite" aria-atomic="true">
      <div class="rb-status neutral" id="rbStatus">Waiting for readings</div>
      <div class="rb-ach neutral" id="rbAch">--</div>
      <div class="rb-label">Air Changes per Hour at 50 Pa (ACH50)</div>
      <div class="rb-bar" role="img" aria-label="ACH50 result position on scale from 3 to 12+"><div class="rb-fill" id="rbFill" style="width:0"></div></div>
      <div class="rb-scale"><span>Tight (3)</span><span>Code (7)</span><span>Leaky (12+)</span></div>
      <div class="rb-code" id="rbCode">Florida Energy Code: 7 ACH50 max</div>
    </div>

    <div class="bsec" style="animation-delay:.2s">
      <h2><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg> Photos</h2>
      <div class="photo-strip" id="photoStrip" role="group" aria-label="Test photos">
        <div class="ph-thumb" onclick="addPh(0)" tabindex="0" role="button" aria-label="Add photo slot 1, press Enter or Space to select">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        </div>
        <div class="ph-thumb" onclick="addPh(1)" tabindex="0" role="button" aria-label="Add photo slot 2, press Enter or Space to select">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        </div>
        <div class="ph-thumb" onclick="addPh(2)" tabindex="0" role="button" aria-label="Add photo slot 3, press Enter or Space to select">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        </div>
      </div>
      <button class="btn bs bf" onclick="document.getElementById('phIn').click()" style="margin-top:10px" aria-describedby="camHelp">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
        Take Manometer Photo
      </button>
      <span id="camHelp" style="font-size:11px;color:var(--tx3);margin-top:8px;display:block;text-align:center">Capture a photo of your gauge reading for the certificate</span>
    </div>

    <div class="bsec" style="animation-delay:.25s">
      <div class="fg" style="margin-bottom:0">
        <label for="tNotes">Test Notes</label>
        <input type="text" id="tNotes" placeholder="Front door sealed, AC registers taped, exhaust fans off..." maxlength="500" aria-describedby="notesHelp">
        <span id="notesHelp" style="font-size:11px;color:var(--tx3);margin-top:4px;display:block">Add details about seals, weather, or any issues found</span>
      </div>
    </div>

    <div class="abr">
      <button class="btn bs" onclick="saveTest()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/></svg>
        Save Test
      </button>
      <button class="btn bp" onclick="shareCert()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        Share Certificate
      </button>
    </div>
    <button class="btn bs bf" onclick="resetBuild()" style="margin-bottom:24px">Discard & Start Over</button>
  </section>

  <section class="vw" id="settingsView" aria-labelledby="settingsHeading">
    <h2 id="settingsHeading" class="sr-only" style="position:absolute;left:-10000px;width:1px;height:1px;overflow:hidden;">Settings</h2>
    <div class="sg">
      <h3>Backup Your Data</h3>
      <p style="font-size:13px;color:var(--tx2);margin-bottom:14px;line-height:1.5">Export your test history as a JSON file you can store anywhere. Import it back if you switch devices.</p>
      <div style="display:flex;flex-direction:column;gap:10px">
        <button class="btn bp" onclick="exportAll()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="18" height="18" aria-hidden="true"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Export Backup
        </button>
        <button class="btn bs" onclick="document.getElementById('fileIn').click()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="18" height="18" aria-hidden="true"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
          Import Backup
        </button>
      </div>
    </div>
    <div class="sg locked" role="region" aria-label="Premium feature preview">
      <div class="lock-ov">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--tx3)" stroke-width="1.5" aria-hidden="true"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
        <span class="lock-lbl">Monthly Report - Full Version</span>
        <span style="font-size:12px;color:var(--tx3);margin-top:4px;text-align:center;padding:0 20px">Test counts, pass rates, and builder breakdowns</span>
      </div>
      <h3>Monthly Report</h3>
    </div>
  </section>
</main>

<button class="fab" id="fab" onclick="switchVw('build')" aria-label="Create new test">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
</button>

<nav class="bnav" aria-label="Main navigation">
  <button class="nb on" onclick="switchVw('list')" data-v="list" aria-label="View all tests" aria-current="page">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
    <span>Tests</span>
  </button>
  <button class="nb" onclick="switchVw('build')" data-v="build" aria-label="Create new test">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    <span>New</span>
  </button>
  <button class="nb" onclick="switchVw('settings')" data-v="settings" aria-label="Settings and backup">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
    <span>Settings</span>
  </button>
</nav>

<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer" style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:10px 16px;font-size:12px;line-height:1.4;color:#666;z-index:99999;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:8px 16px;text-align:center;">
  <p style="margin:0;max-width:700px;"><strong style="color:#333;">DEMO:</strong> Not affiliated with Central Florida Blower Door Testing LLC.</p>
  <a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20CF%20Blower%20Door&body=I%20am%20the%20owner%20and%20I%20request%20permanent%20deletion%20of%20this%20demo." style="display:inline-flex;align-items:center;gap:4px;background:#dc3545;color:#fff;padding:5px 12px;border-radius:4px;text-decoration:none;font-size:11px;font-weight:500;white-space:nowrap;">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
    Request Permanent Deletion
  </a>
</div>
<input type="file" id="phIn" accept="image/*" capture="environment" style="display:none" onchange="handlePh(event)" aria-label="Capture photo">
<input type="file" id="fileIn" accept=".json" style="display:none" onchange="handleImport(event)" aria-label="Import backup file">

<script>
// Keyboard support for photo buttons
document.addEventListener('DOMContentLoaded', function(){
  document.querySelectorAll('.ph-thumb').forEach(thumb => {
    thumb.addEventListener('keydown', function(e){
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault();
        this.click();
      }
    });
  });
});

function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
const _V=1516043698;
const _k=new URLSearchParams(window.location.search).get('key');
if(!_k||_h(_k)!==_V){
  document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;background:#111;color:#fff;text-align:center;padding:20px"><div><h1 style="font-size:2rem;margin-bottom:1rem">Access Required</h1><p style="color:#999">Valid access key needed.</p><p style="margin-top:1rem"><a href="mailto:ben@bennycutools.com" style="color:#4da6ff">ben@bennycutools.com</a></p></div></div><div id="bct-demo-disclaimer" role="contentinfo" style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:10px 16px;font-size:12px;color:#666;z-index:99999;text-align:center;"><p style="margin:0"><strong style="color:#333;">DEMO:</strong> Not affiliated with Central Florida Blower Door Testing LLC.</p></div>';throw new Error('x');
}
document.addEventListener('contextmenu',e=>e.preventDefault());

let tests=[],editId=null,photos=[null,null,null],phTarget=0,DB;
const FL_CODE=7;

function initDB(){return new Promise((r,j)=>{const q=indexedDB.open('BlowerSnapDB',1);q.onupgradeneeded=e=>{if(!e.target.result.objectStoreNames.contains('tests'))e.target.result.createObjectStore('tests',{keyPath:'id'})};q.onsuccess=e=>{DB=e.target.result;r()};q.onerror=j})}
function dbPut(t){return new Promise((r,j)=>{const x=DB.transaction('tests','readwrite');x.objectStore('tests').put(t);x.oncomplete=r;x.onerror=j})}
function dbAll(){return new Promise((r,j)=>{const x=DB.transaction('tests','readonly');const q=x.objectStore('tests').getAll();q.onsuccess=()=>r(q.result);q.onerror=j})}
function dbDel(id){return new Promise((r,j)=>{const x=DB.transaction('tests','readwrite');x.objectStore('tests').delete(id);x.oncomplete=r;x.onerror=j})}

function getDemos(){const n=Date.now();return[
  {id:'d1',isDemo:true,addr:'2847 Lakeshore Dr, Davenport, FL',builder:'Meritage Homes',permit:'BLD-2026-3847',sqft:2100,ceil:9,cfm:1842,ach:5.8,pass:true,notes:'Standard test, all windows closed, HVAC registers taped',photos:[],created:n-86400000*2},
  {id:'d2',isDemo:true,addr:'1024 Citrus Grove Rd, Winter Haven, FL',builder:'DR Horton',permit:'BLD-2026-2156',sqft:1750,ceil:9,cfm:2380,ach:9.1,pass:false,notes:'Failed - leaks around attic access, plumbing penetrations, and recessed cans. Builder notified for re-seal.',photos:[],created:n-86400000},
  {id:'d3',isDemo:true,addr:'455 Orange Blossom Trl, Clermont, FL',builder:'DR Horton',permit:'BLD-2026-2156-R',sqft:1750,ceil:9,cfm:1620,ach:6.2,pass:true,notes:'Retest after builder sealed attic access, caulked penetrations. Improved from 9.1 to 6.2. Pass.',photos:[],created:n-3600000*4}
]}

async function loadDemos(){const ex=await dbAll();if(!ex.length&&!localStorage.getItem('bs_cleared')){for(const d of getDemos())await dbPut(d);document.getElementById('demoBanner').style.display='flex';await loadTests()}}
async function clearDemo(){const all=await dbAll();for(const t of all)if(t.isDemo)await dbDel(t.id);localStorage.setItem('bs_cleared','1');document.getElementById('demoBanner').style.display='none';toast('Sample data cleared');await loadTests()}

function switchVw(v){
  document.querySelectorAll('.vw').forEach(x=>x.classList.remove('on'));
  document.getElementById(v+'View').classList.add('on');
  document.querySelectorAll('.nb').forEach(b=>{
    const isActive = b.dataset.v===v;
    b.classList.toggle('on', isActive);
    b.setAttribute('aria-current', isActive ? 'page' : 'false');
  });
  document.getElementById('fab').style.display=v==='build'?'none':'flex';
  if(v==='list')loadTests();
  if(v==='build'&&!editId)resetBuild();
  // Focus management for accessibility
  const main = document.getElementById('main-content');
  if(main) main.focus();
}

async function loadTests(){
  tests=await dbAll();tests.sort((a,b)=>(b.created||0)-(a.created||0));
  document.getElementById('demoBanner').style.display=tests.some(t=>t.isDemo)?'flex':'none';
  const total=tests.length,passed=tests.filter(t=>t.pass).length;
  document.getElementById('stTotal').textContent=total;
  document.getElementById('stPass').textContent=passed;
  document.getElementById('stRate').textContent=total?Math.round(passed/total*100)+'%':'0%';

  const list=document.getElementById('testList'),empty=document.getElementById('emptyState');
  if(!tests.length){list.innerHTML='';empty.style.display='block';return}
  empty.style.display='none';
  list.innerHTML=tests.map(t=>{
    const cls=t.pass?'pass':'fail';
    const statusText = t.pass ? 'Passed' : 'Failed';
    return`<div class="tcard" onclick="openTest('${t.id}')" tabindex="0" role="button" aria-label="${statusText}: ${esc(t.addr||'Untitled')}, ${t.ach||'--'} ACH50" onkeydown="if(event.key==='Enter'||event.key===' ')openTest('${t.id}')">
      <div class="tc-addr">${esc(t.addr||'Untitled')}</div>
      <div class="tc-meta">${esc(t.builder||'')} ${t.permit?'| '+esc(t.permit):''}</div>
      <div class="tc-result">
        <span class="tc-badge ${cls}">${t.pass?'PASS':'FAIL'}</span>
        <div><div class="tc-ach ${cls}">${t.ach||'--'}</div><div class="tc-ach-label">ACH50</div></div>
      </div>
      <div class="tc-foot"><span>${timeAgo(t.created)}</span><span>${(t.sqft||0).toLocaleString()} sqft | ${t.cfm||0} CFM50</span></div>
    </div>`}).join('');
}

function openTest(id){
  const t=tests.find(x=>x.id===id);if(!t)return;editId=id;
  document.getElementById('tAddr').value=t.addr||'';
  document.getElementById('tBuilder').value=t.builder||'';
  document.getElementById('tPermit').value=t.permit||'';
  document.getElementById('tSqft').value=t.sqft||'';
  document.getElementById('tCeil').value=t.ceil||9;
  document.getElementById('tCfm').value=t.cfm||'';
  document.getElementById('tNotes').value=t.notes||'';
  photos=t.photos?[...t.photos]:new Array(3).fill(null);while(photos.length<3)photos.push(null);
  renderPhotos();calcResult();switchVw('build');
}

function resetBuild(){
  editId=null;
  ['tAddr','tBuilder','tPermit','tSqft','tCfm','tNotes'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('tCeil').value='9';
  photos=new Array(3).fill(null);renderPhotos();
  const rb=document.getElementById('resultBox');rb.className='result-box neutral';
  document.getElementById('rbStatus').textContent='Waiting for readings';document.getElementById('rbStatus').className='rb-status neutral';
  document.getElementById('rbAch').textContent='--';document.getElementById('rbAch').className='rb-ach neutral';
  document.getElementById('rbFill').style.width='0';document.getElementById('rbFill').style.background='var(--bdr)';
}

function calcResult(){
  const cfm=parseFloat(document.getElementById('tCfm').value)||0;
  const sqft=parseFloat(document.getElementById('tSqft').value)||0;
  const ceil=parseFloat(document.getElementById('tCeil').value)||9;
  if(!cfm||!sqft){document.getElementById('rbAch').textContent='--';return}
  const vol=sqft*ceil;
  const ach=Math.round((cfm*60/vol)*10)/10;
  const pass=ach<=FL_CODE;
  const cls=pass?'pass':'fail';

  const achEl=document.getElementById('rbAch');
  const oldAch = achEl.textContent;
  achEl.textContent=ach.toFixed(1);
  achEl.className='rb-ach '+cls;
  if(oldAch !== ach.toFixed(1)){
    achEl.classList.add('bump');
    setTimeout(()=>achEl.classList.remove('bump'),300);
  }
  document.getElementById('rbStatus').textContent=pass?'PASS - Meets Code':'FAIL - Above Code Limit';
  document.getElementById('rbStatus').className='rb-status '+cls;
  document.getElementById('resultBox').className='result-box '+cls;

  const pct=Math.min(ach/14*100,100);
  const fill=document.getElementById('rbFill');
  fill.style.width=pct+'%';
  fill.style.background=pass?'var(--grn)':'var(--red)';
}

function renderPhotos(){
  document.getElementById('photoStrip').innerHTML=photos.map((p,i)=>
    `<div class="ph-thumb${p?' has':''}" onclick="addPh(${i})" tabindex="0" role="button" aria-label="${p?'View':'Add'} photo slot ${i+1}, press Enter or Space to ${p?'view':'select'}">
      ${p?`<img src="${p}" alt="Test photo ${i+1} showing manometer reading">`:`<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>`}
    </div>`).join('');
  // Re-attach keyboard listeners
  document.querySelectorAll('.ph-thumb').forEach(thumb => {
    thumb.addEventListener('keydown', function(e){
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault();
        this.click();
      }
    });
  });
}
function addPh(i){phTarget=i;document.getElementById('phIn').click()}
function handlePh(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{const img=new Image();img.onload=()=>{const c=document.createElement('canvas');let w=img.width,h=img.height;if(w>800){h=h*(800/w);w=800}c.width=w;c.height=h;c.getContext('2d').drawImage(img,0,0,w,h);photos[phTarget]=c.toDataURL('image/jpeg',.8);renderPhotos()};img.src=ev.target.result};r.readAsDataURL(f);e.target.value=''}

async function saveTest(){
  const addr=document.getElementById('tAddr').value.trim();
  if(!addr){toast('Add a property address','err');document.getElementById('tAddr').focus();return}
  const cfm=parseFloat(document.getElementById('tCfm').value)||0;
  const sqft=parseFloat(document.getElementById('tSqft').value)||0;
  const ceil=parseFloat(document.getElementById('tCeil').value)||9;
  if(!cfm){toast('Add a CFM50 reading','err');document.getElementById('tCfm').focus();return}
  const ach=sqft&&cfm?Math.round((cfm*60/(sqft*ceil))*10)/10:0;
  const pass=ach<=FL_CODE&&ach>0;
  const test={
    id:editId||'t-'+Date.now(),addr,builder:document.getElementById('tBuilder').value,
    permit:document.getElementById('tPermit').value,sqft,ceil,cfm,ach,pass,
    notes:document.getElementById('tNotes').value,photos:photos.filter(Boolean),
    created:editId?(tests.find(t=>t.id===editId)||{}).created||Date.now():Date.now()
  };
  await dbPut(test);toast(editId?'Test updated':'Test saved','ok');editId=null;switchVw('list');
}

async function shareCert(){
  const addr=document.getElementById('tAddr').value;
  if(!addr){toast('Add a property address first','err');return}
  await saveTest();
  const builder=document.getElementById('tBuilder').value;
  const ach=document.getElementById('rbAch').textContent;
  const cfm=document.getElementById('tCfm').value;
  const sqft=document.getElementById('tSqft').value;
  const pass=parseFloat(ach)<=FL_CODE;
  const text=`BLOWER DOOR TEST CERTIFICATE
Central Florida Blower Door Testing LLC
(863) 267-7728

Property: ${addr}
Builder: ${builder}
Date: ${new Date().toLocaleDateString()}

Conditioned Area: ${sqft} sqft
CFM50: ${cfm}
ACH50: ${ach}
FL Energy Code Max: ${FL_CODE}

Result: ${pass?'PASS':'FAIL'}

Tested by: Rodney Pullen
Central Florida Blower Door Testing LLC`;

  if(navigator.share){try{await navigator.share({title:'Blower Door Certificate',text});toast('Certificate shared','ok')}catch(e){if(e.name!=='AbortError')toast('Share failed','err')}}
  else{try{await navigator.clipboard.writeText(text);toast('Certificate copied to clipboard','ok')}catch(e){toast('Could not copy','err')}}
}

async function exportAll(){const all=await dbAll();const b=new Blob([JSON.stringify({tests:all,exported:new Date().toISOString(),app:'BlowerSnap'},null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=`blowersnap-${new Date().toISOString().split('T')[0]}.json`;a.click();toast('Backup file downloaded','ok')}
async function handleImport(e){const f=e.target.files[0];if(!f)return;try{const d=JSON.parse(await f.text());if(!d.tests||!Array.isArray(d.tests))throw new Error('Invalid backup file');let count=0;for(const t of d.tests){if(t.addr){await dbPut(t);count++}}toast(count+' tests imported','ok');await loadTests()}catch(err){toast('Could not read file: '+err.message,'err')}e.target.value=''}

function toast(m,t){const el=document.createElement('div');el.className='tst'+(t?' '+t:'');el.textContent=m;document.getElementById('toasts').appendChild(el);setTimeout(()=>{el.style.opacity='0';el.style.transform='translateY(-10px)';setTimeout(()=>el.remove(),300)},4000)}
function esc(s){const d=document.createElement('div');d.textContent=s||'';return d.innerHTML}
function timeAgo(ts){const d=Date.now()-ts,m=Math.floor(d/60000);if(m<1)return'Just now';if(m<60)return m+'m ago';const h=Math.floor(m/60);if(h<24)return h+'h ago';const dy=Math.floor(h/24);if(dy<7)return dy+'d ago';return new Date(ts).toLocaleDateString()}

(async function(){await initDB();await loadDemos();await loadTests()})();
</script>
<script src="http://35.212.159.12/booking-api/tracker.js" async></script>
</body>
</html>
