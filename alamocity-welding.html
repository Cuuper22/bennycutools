<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<title>WeldQuote Pro | Alamo City Custom Welding</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;600;700&family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
--bg:#f5f6f8;--card:#ffffff;--text:#1a1a1a;--text-muted:#5a6068;--text-subtle:#8a9199;
--blue:#1e3a5f;--blue-soft:rgba(30,58,95,.08);--blue-hover:#152a45;
--orange:#c75b1c;--orange-soft:rgba(199,91,28,.1);--orange-hover:#a34a15;
--border:#dde0e5;--border-light:#e8eaed;--success:#2d7a4f;--success-soft:rgba(45,122,79,.1);--danger:#b44030;--danger-soft:rgba(180,64,48,.1);--warning:#c9a227;--warning-soft:rgba(201,162,39,.1);
--radius-sm:6px;--radius:10px;--radius-lg:14px;
--shadow-sm:0 1px 2px rgba(0,0,0,.04);--shadow:0 1px 3px rgba(0,0,0,.06),0 2px 8px rgba(0,0,0,.04);--shadow-lg:0 4px 12px rgba(0,0,0,.08),0 8px 24px rgba(0,0,0,.06);
--font-head:'Oswald',Impact,sans-serif;--font-body:'Open Sans',system-ui,sans-serif;
--transition-fast:120ms ease;--transition:200ms ease;--transition-bounce:300ms cubic-bezier(.34,1.56,.64,1);
}
html{font-size:16px}body{padding-bottom:80px;font-family:var(--font-body);background:var(--bg);color:var(--text);line-height:1.5;min-height:100vh;padding-bottom:140px!important;-webkit-font-smoothing:antialiased}
h1,h2,h3{font-family:var(--font-head);font-weight:700;line-height:1.15;text-transform:uppercase;letter-spacing:.03em}
h1{font-size:1.4rem}h2{font-size:1.15rem}h3{font-size:1rem}
*:focus-visible{outline:3px solid var(--orange);outline-offset:2px;border-radius:var(--radius-sm)}
button,input,select,textarea{font-family:var(--font-body);font-size:1rem;border:none;outline:none;background:none}

/* Subtle metal texture overlay */
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:9998;opacity:.02;
background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23n)'/%3E%3C/svg%3E")}

/* Skip link for accessibility */
.skip-link{position:absolute;top:-50px;left:0;background:var(--orange);color:#fff;padding:12px 20px;z-index:9999;font-weight:600;font-family:var(--font-head);text-transform:uppercase;letter-spacing:.04em;transition:top var(--transition-fast)}
.skip-link:focus{top:0}

/* App Header */
.app-header{background:linear-gradient(135deg,var(--blue) 0%,#0f1f33 100%);color:#fff;padding:16px 20px;position:sticky;top:0;z-index:100;box-shadow:0 2px 16px rgba(0,0,0,.25)}
.app-header-content{max-width:600px;margin:0 auto;display:flex;align-items:center;gap:12px}
.app-header .logo-icon{width:40px;height:40px;background:var(--orange);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.app-header h1{color:#fff;font-size:1.25rem;letter-spacing:.06em;line-height:1.1}
.app-header .subtitle{color:var(--orange);font-family:var(--font-body);font-size:.7rem;font-weight:600;letter-spacing:.1em;text-transform:uppercase;margin-top:2px}

/* Demo Banner */
.demo-banner{background:linear-gradient(90deg,var(--warning-soft) 0%,rgba(201,162,39,.05) 100%);border-bottom:1px solid var(--border);padding:12px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px}
.demo-banner p{font-size:.8rem;color:var(--text-muted);line-height:1.4;flex:1}
.demo-banner button{background:var(--warning);color:#1a1a1a;font-size:.72rem;font-weight:700;padding:6px 14px;border-radius:var(--radius-sm);cursor:pointer;white-space:nowrap;transition:all var(--transition-fast);text-transform:uppercase;letter-spacing:.03em}
.demo-banner button:hover{background:#b8941f;transform:translateY(-1px)}
.demo-banner button:active{transform:scale(.96)}

/* Loading States */
.loading-skeleton{background:linear-gradient(90deg,var(--border-light) 25%,var(--border) 50%,var(--border-light) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:var(--radius-sm)}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
.loading-pulse{animation:pulse 1.5s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

/* Spinner */
.spinner{width:20px;height:20px;border:2px solid var(--border);border-top-color:var(--orange);border-radius:50%;animation:spin 1s linear infinite;display:inline-block}
@keyframes spin{to{transform:rotate(360deg)}}

/* Views */
.view{display:none;padding:16px;animation:fadeUp .35s ease-out}
.view.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

/* Section Headers */
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;gap:12px}
.section-header h2{flex:1}
.section-action{color:var(--blue);font-size:.8rem;font-weight:600;cursor:pointer;padding:6px 12px;border-radius:var(--radius-sm);transition:background var(--transition-fast)}
.section-action:hover{background:var(--blue-soft)}

/* Empty States */
.empty-state{text-align:center;padding:56px 24px;color:var(--text-muted)}
.empty-state-icon{width:72px;height:72px;margin:0 auto 20px;background:var(--blue-soft);border-radius:50%;display:flex;align-items:center;justify-content:center}
.empty-state h3{font-size:1.1rem;color:var(--text);margin-bottom:8px;font-family:var(--font-head)}
.empty-state p{font-size:.9rem;line-height:1.5;max-width:280px;margin:0 auto 20px}
.empty-state .btn{display:inline-flex}

/* Error States */
.error-state{text-align:center;padding:48px 24px;color:var(--danger)}
.error-state-icon{width:64px;height:64px;margin:0 auto 16px;background:var(--danger-soft);border-radius:50%;display:flex;align-items:center;justify-content:center}
.error-state h3{font-size:1.1rem;color:var(--text);margin-bottom:8px}
.error-state p{color:var(--text-muted);font-size:.9rem;margin-bottom:16px}

/* Toast Notifications */
.toast-container{position:fixed;top:80px;left:50%;transform:translateX(-50%);z-index:200;pointer-events:none;width:90%;max-width:400px}
.toast{background:var(--text);color:#fff;padding:14px 20px;border-radius:var(--radius);font-size:.9rem;font-weight:500;box-shadow:var(--shadow-lg);animation:toastIn .3s ease-out;pointer-events:auto;margin-bottom:8px;display:flex;align-items:center;gap:10px}
.toast.success{background:var(--success)}
.toast.error{background:var(--danger)}
.toast.warning{background:var(--warning);color:#1a1a1a}
@keyframes toastIn{from{opacity:0;transform:translateY(-12px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}

/* Estimate Cards */
.est-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:12px;overflow:hidden;cursor:pointer;transition:all var(--transition);border-left:4px solid var(--blue);position:relative}
.est-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg);border-left-color:var(--orange)}
.est-card:active{transform:scale(.99)}
.est-card-inner{padding:16px}
.est-card .ec-header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:6px}
.est-card .ec-type{font-size:.7rem;font-weight:700;color:var(--text-subtle);text-transform:uppercase;letter-spacing:.06em;margin-bottom:2px}
.est-card .ec-title{font-family:var(--font-head);font-size:1.05rem;text-transform:uppercase;letter-spacing:.02em;line-height:1.2}
.est-card .ec-client{font-size:.85rem;color:var(--text-muted);margin-bottom:4px;display:flex;align-items:center;gap:6px}
.est-card .ec-location{font-size:.78rem;color:var(--text-subtle);display:flex;align-items:center;gap:4px}
.est-card .ec-footer{display:flex;justify-content:space-between;align-items:center;margin-top:10px;padding-top:10px;border-top:1px solid var(--border-light)}
.est-card .ec-date{font-size:.75rem;color:var(--text-subtle);font-weight:500}
.est-card .ec-total{font-family:var(--font-head);font-size:1.4rem;color:var(--blue);letter-spacing:.02em}

.badge{display:inline-flex;align-items:center;font-size:.7rem;font-weight:700;padding:4px 10px;border-radius:20px;text-transform:uppercase;letter-spacing:.04em;white-space:nowrap}
.badge--quoted{background:var(--warning-soft);color:#8a6d0b}
.badge--accepted{background:var(--success-soft);color:var(--success)}
.badge--completed{background:var(--blue-soft);color:var(--blue)}
.badge--declined{background:var(--danger-soft);color:var(--danger)}

/* Forms */
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:.75rem;font-weight:700;color:var(--text-muted);margin-bottom:6px;text-transform:uppercase;letter-spacing:.05em}
.form-group label .required{color:var(--danger);margin-left:2px}
.form-group input,.form-group textarea,.form-group select{width:100%;padding:14px 16px;background:var(--card);border:2px solid var(--border);border-radius:var(--radius-sm);font-size:.95rem;transition:all var(--transition-fast);min-height:48px}
.form-group input:hover,.form-group textarea:hover,.form-group select:hover{border-color:var(--text-subtle)}
.form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:var(--orange);box-shadow:0 0 0 4px var(--orange-soft)}
.form-group input[aria-invalid="true"],.form-group textarea[aria-invalid="true"],.form-group select[aria-invalid="true"]{border-color:var(--danger);background:var(--danger-soft)}
.form-group textarea{resize:vertical;min-height:80px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.form-error{color:var(--danger);font-size:.8rem;margin-top:6px;display:flex;align-items:center;gap:6px;font-weight:500}
.form-hint{color:var(--text-subtle);font-size:.8rem;margin-top:6px}

/* Project Type Pills */
.type-pills{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
.type-pill{padding:10px 18px;border-radius:24px;font-size:.8rem;font-weight:600;background:var(--card);border:2px solid var(--border);cursor:pointer;transition:all var(--transition-fast);text-transform:uppercase;letter-spacing:.03em;min-height:44px;display:flex;align-items:center}
.type-pill:hover{border-color:var(--text-subtle)}
.type-pill.active{background:var(--blue);color:#fff;border-color:var(--blue);box-shadow:0 2px 8px rgba(30,58,95,.25)}
.type-pill:active{transform:scale(.97)}

/* Line Items */
.line-item{background:var(--bg);border-radius:var(--radius-sm);padding:14px;margin-bottom:10px;position:relative;animation:fadeUp .25s ease-out;border:1px solid var(--border-light)}
.line-item .li-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.line-item .li-title{font-weight:700;font-size:.9rem;color:var(--text)}
.line-item .li-remove{width:32px;height:32px;border-radius:50%;background:var(--danger-soft);color:var(--danger);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all var(--transition-fast);border:none}
.line-item .li-remove:hover{background:var(--danger);color:#fff;transform:scale(1.05)}
.line-item .li-remove:active{transform:scale(.95)}
.line-item .li-row{display:grid;grid-template-columns:2fr 70px 90px;gap:10px;align-items:end}
@media(max-width:400px){.line-item .li-row{grid-template-columns:1fr 60px 80px;gap:8px}}
.line-item .li-row input{padding:10px 12px;font-size:.9rem;min-height:44px}
.line-item .li-subtotal{text-align:right;font-weight:700;font-size:.95rem;color:var(--blue);margin-top:8px;padding-top:8px;border-top:1px dashed var(--border)}

/* Total Bar */
.total-bar{background:linear-gradient(135deg,var(--blue) 0%,var(--blue-hover) 100%);color:#fff;padding:18px 20px;border-radius:var(--radius);margin:20px 0;display:flex;justify-content:space-between;align-items:center;box-shadow:0 4px 16px rgba(30,58,95,.3);position:relative;overflow:hidden}
.total-bar::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent)}
.total-bar .tb-label{font-family:var(--font-head);font-size:.9rem;text-transform:uppercase;letter-spacing:.06em;opacity:.9}
.total-bar .tb-amount{font-family:var(--font-head);font-size:2rem;letter-spacing:.02em}

/* Buttons */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 24px;border-radius:var(--radius-sm);font-weight:700;font-size:.9rem;cursor:pointer;transition:all var(--transition-fast);text-transform:uppercase;letter-spacing:.04em;border:2px solid transparent;min-height:48px;position:relative;overflow:hidden}
.btn::before{content:'';position:absolute;inset:0;background:linear-gradient(180deg,rgba(255,255,255,.15),transparent);opacity:0;transition:opacity var(--transition-fast)}
.btn:hover::before{opacity:1}
.btn:active{transform:scale(.98)}
.btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
.btn--primary{background:var(--orange);color:#fff;border-color:var(--orange);box-shadow:0 2px 8px rgba(199,91,28,.3)}
.btn--primary:hover{background:var(--orange-hover);border-color:var(--orange-hover);box-shadow:0 4px 12px rgba(199,91,28,.4)}
.btn--secondary{background:var(--card);color:var(--text);border-color:var(--border)}
.btn--secondary:hover{background:var(--bg);border-color:var(--text-subtle)}
.btn--danger{background:var(--danger-soft);color:var(--danger);border-color:var(--danger)}
.btn--danger:hover{background:var(--danger);color:#fff}
.btn--full{width:100%}
.btn--sm{padding:8px 16px;font-size:.8rem;min-height:36px}

/* Premium Feature Badge */
.premium-badge{position:absolute;top:-6px;right:-6px;background:var(--text);color:#fff;font-size:.55rem;font-weight:700;padding:3px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:.02em;white-space:nowrap;box-shadow:0 2px 4px rgba(0,0,0,.2)}

/* Stats */
.stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px}
.stat-card{background:var(--card);border-radius:var(--radius);padding:18px 14px;text-align:center;box-shadow:var(--shadow);transition:all var(--transition-fast);border:1px solid var(--border-light)}
.stat-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}
.stat-card .stat-num{font-family:var(--font-head);font-size:1.6rem;color:var(--blue);line-height:1}
.stat-card .stat-label{font-size:.7rem;color:var(--text-muted);margin-top:6px;font-weight:600;text-transform:uppercase;letter-spacing:.05em}

/* Bottom Navigation */
.bottom-nav{position:fixed;bottom:60px;left:0;right:0;background:var(--card);border-top:1px solid var(--border);display:flex;z-index:100;box-shadow:0 -4px 16px rgba(0,0,0,.06);padding:6px 0}
.bottom-nav button{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;padding:10px 4px;background:none;cursor:pointer;color:var(--text-subtle);transition:all var(--transition-fast);border:none;min-height:56px}
.bottom-nav button.active{color:var(--orange)}
.bottom-nav button svg{width:24px;height:24px;transition:transform var(--transition-bounce)}
.bottom-nav button.active svg{transform:translateY(-2px)}
.bottom-nav button span{font-size:.65rem;font-weight:700;letter-spacing:.04em;text-transform:uppercase}
.bottom-nav button:active svg{transform:scale(.9)}

/* Floating Action Button */
.fab{position:fixed;bottom:132px;right:20px;width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,var(--orange) 0%,var(--orange-hover) 100%);color:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 16px rgba(199,91,28,.5),0 8px 24px rgba(199,91,28,.3);cursor:pointer;z-index:99;transition:all var(--transition-bounce);border:none}
.fab:hover{transform:scale(1.08) rotate(90deg);box-shadow:0 6px 20px rgba(199,91,28,.6)}
.fab:active{transform:scale(.92)}
.fab::before{content:'';position:absolute;inset:0;border-radius:50%;border:2px solid rgba(255,255,255,.3);animation:pulse-ring 2s ease-out infinite}
@keyframes pulse-ring{0%{transform:scale(1);opacity:1}100%{transform:scale(1.5);opacity:0}}

/* Back Button */
.back-btn{width:40px;height:40px;border-radius:50%;background:var(--bg);display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;border:2px solid var(--border);transition:all var(--transition-fast)}
.back-btn:hover{background:var(--border);border-color:var(--text-subtle);transform:translateX(-2px)}
.back-btn:active{transform:scale(.95)}
.detail-header{display:flex;align-items:center;gap:14px;margin-bottom:20px}

/* Camera Section */
.camera-area{position:relative;width:100%;max-width:400px;margin:0 auto 16px;border-radius:var(--radius);overflow:hidden;background:#111;box-shadow:var(--shadow-lg)}
.camera-area video{width:100%;display:block}
.camera-area canvas{display:none}
.camera-btn-area{text-align:center;margin:12px 0;display:flex;gap:10px;justify-content:center}
.captured-photos{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px}
.captured-photos .photo-thumb{position:relative;width:72px;height:72px;border-radius:var(--radius-sm);overflow:hidden;border:2px solid var(--border);cursor:pointer;transition:all var(--transition-fast)}
.captured-photos .photo-thumb:hover{border-color:var(--orange);transform:scale(1.05)}
.captured-photos .photo-thumb img{width:100%;height:100%;object-fit:cover}
.captured-photos .photo-thumb .remove-photo{position:absolute;top:2px;right:2px;width:20px;height:20px;background:var(--danger);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;cursor:pointer;opacity:0;transition:opacity var(--transition-fast)}
.captured-photos .photo-thumb:hover .remove-photo{opacity:1}

/* Share Preview */
.share-preview{background:var(--card);border:2px dashed var(--border);border-radius:var(--radius);padding:20px;margin-bottom:20px}
.share-preview .sp-header{display:flex;align-items:center;gap:10px;margin-bottom:14px;padding-bottom:14px;border-bottom:2px solid var(--border-light)}
.share-preview .sp-logo{width:36px;height:36px;background:var(--blue);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.share-preview .sp-company{font-family:var(--font-head);font-size:1rem;text-transform:uppercase}
.share-preview .sp-line{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border-light);font-size:.9rem}
.share-preview .sp-line:last-child{border-bottom:none;font-weight:700;color:var(--blue);font-size:1.05rem;padding-top:12px;margin-top:4px;border-top:2px solid var(--border)}
.share-preview .sp-line .sp-label{color:var(--text-muted)}

/* Modal / Dialog */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);z-index:300;display:none;align-items:center;justify-content:center;padding:20px;animation:fadeIn .2s ease}
.modal-overlay.active{display:flex}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal{background:var(--card);border-radius:var(--radius-lg);max-width:380px;width:100%;padding:24px;box-shadow:0 20px 60px rgba(0,0,0,.3);animation:modalUp .25s ease}
@keyframes modalUp{from{opacity:0;transform:scale(.95) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal h3{font-size:1.2rem;margin-bottom:8px}
.modal p{color:var(--text-muted);font-size:.9rem;margin-bottom:20px;line-height:1.5}
.modal-actions{display:flex;gap:10px}
.modal-actions .btn{flex:1}

/* Search/Filter Bar */
.search-bar{position:relative;margin-bottom:16px}
.search-bar input{width:100%;padding:14px 16px 14px 44px;background:var(--card);border:2px solid var(--border);border-radius:var(--radius-sm);font-size:.95rem;transition:all var(--transition-fast)}
.search-bar svg{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--text-subtle);pointer-events:none}
.search-bar input:focus{border-color:var(--orange);box-shadow:0 0 0 4px var(--orange-soft)}

/* Filter Chips */
.filter-chips{display:flex;gap:8px;margin-bottom:16px;overflow-x:auto;padding-bottom:4px;scrollbar-width:none}
.filter-chips::-webkit-scrollbar{display:none}
.filter-chip{padding:8px 16px;border-radius:20px;font-size:.8rem;font-weight:600;background:var(--card);border:2px solid var(--border);cursor:pointer;transition:all var(--transition-fast);white-space:nowrap}
.filter-chip:hover{border-color:var(--text-subtle)}
.filter-chip.active{background:var(--blue);color:#fff;border-color:var(--blue)}

/* Print Styles */
@media print{.bottom-nav,.fab,.demo-banner,.app-header,#bct-demo-disclaimer,.back-btn,.modal-overlay{display:none!important}body{padding-bottom:80px;background:#fff;padding:0}.view{display:block!important;animation:none}}

/* Responsive */
@media(min-width:768px){
.view{max-width:600px;margin:0 auto;padding:24px}
.bottom-nav{max-width:600px;left:50%;transform:translateX(-50%);border-radius:var(--radius) var(--radius) 0 0}
.fab{bottom:140px;right:calc(50% - 260px)}
}

/* Reduced Motion */
@media(prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:.01ms!important;transition-duration:.01ms!important}}

/* Focus Visible Improvements */
button:focus-visible,a:focus-visible,input:focus-visible,select:focus-visible,textarea:focus-visible{outline:3px solid var(--orange);outline-offset:2px}

/* Visually hidden for screen readers */
.visually-hidden{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>

<header class="app-header" role="banner">
<div class="app-header-content">
<div class="logo-icon" aria-hidden="true">
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5"><path d="M8 17l4-4 4 4M12 3v14"/></svg>
</div>
<div>
<h1>WeldQuote Pro</h1>
<div class="subtitle">Alamo City Custom Welding</div>
</div>
</div>
</header>

<div class="demo-banner" id="demoBanner" style="display:none" role="status" aria-live="polite" aria-label="Demo data loaded">
<p>Sample estimates loaded. These are fictional San Antonio jobs to show how the tool works.</p>
<button onclick="clearDemoData()" aria-label="Clear demo estimates">Clear Demo</button>
</div>

<div class="toast-container" id="toastContainer" role="status" aria-live="polite" aria-atomic="true"></div>

<main id="main-content">
<!-- ESTIMATES LIST -->
<section class="view active" id="viewEstimates" role="region" aria-label="Estimates list">
<div class="search-bar">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
<input type="text" id="searchInput" placeholder="Search by client, address, or job type..." aria-label="Search estimates">
</div>
<div class="filter-chips" id="filterChips" role="tablist" aria-label="Filter estimates by status">
<button class="filter-chip active" data-filter="all" role="tab" aria-selected="true" onclick="setFilter('all')">All Jobs</button>
<button class="filter-chip" data-filter="quoted" role="tab" aria-selected="false" onclick="setFilter('quoted')">Pending</button>
<button class="filter-chip" data-filter="accepted" role="tab" aria-selected="false" onclick="setFilter('accepted')">Won</button>
<button class="filter-chip" data-filter="completed" role="tab" aria-selected="false" onclick="setFilter('completed')">Done</button>
</div>
<div id="estimateList" role="list" aria-label="Estimates"></div>
</section>

<!-- NEW/EDIT ESTIMATE -->
<section class="view" id="viewNewEstimate" role="region" aria-label="Create new estimate">
<div class="detail-header">
<button class="back-btn" onclick="confirmCancelEdit()" aria-label="Go back without saving"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button>
<h2 id="newEstTitle">New Field Quote</h2>
</div>

<form id="estimateForm" onsubmit="saveEstimate(event)" novalidate>
<div class="form-group">
<label for="ef-client">Client Name <span class="required" aria-hidden="true">*</span></label>
<input type="text" id="ef-client" required placeholder="Who's the job for?" aria-required="true" aria-describedby="client-hint">
<div class="form-hint" id="client-hint">Enter the primary contact name</div>
<div class="form-error" id="client-error" role="alert" style="display:none"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>Client name is required</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="ef-phone">Phone</label>
<input type="tel" id="ef-phone" placeholder="(210) 555-0123" inputmode="tel" aria-describedby="phone-hint">
<div class="form-hint" id="phone-hint">For follow-up calls</div>
</div>
<div class="form-group">
<label for="ef-address">Job Site Address</label>
<input type="text" id="ef-address" placeholder="Where's the work?" aria-describedby="address-hint">
<div class="form-hint" id="address-hint">Street address or landmark</div>
</div>
</div>

<div class="form-group">
<label>Project Type <span class="required" aria-hidden="true">*</span></label>
<div class="type-pills" id="typePills" role="radiogroup" aria-required="true" aria-describedby="type-error">
<button type="button" class="type-pill" data-type="fence" role="radio" aria-checked="false" onclick="selectType(this)">Fence</button>
<button type="button" class="type-pill" data-type="gate" role="radio" aria-checked="false" onclick="selectType(this)">Gate</button>
<button type="button" class="type-pill" data-type="railing" role="radio" aria-checked="false" onclick="selectType(this)">Railing</button>
<button type="button" class="type-pill" data-type="carport" role="radio" aria-checked="false" onclick="selectType(this)">Carport</button>
<button type="button" class="type-pill" data-type="stairs" role="radio" aria-checked="false" onclick="selectType(this)">Stairs</button>
<button type="button" class="type-pill" data-type="repair" role="radio" aria-checked="false" onclick="selectType(this)">Repair</button>
<button type="button" class="type-pill" data-type="custom" role="radio" aria-checked="false" onclick="selectType(this)">Custom Fab</button>
</div>
<div class="form-error" id="type-error" role="alert" style="display:none"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>Select a project type</div>
</div>

<div class="form-group">
<label for="ef-material">Primary Material</label>
<select id="ef-material" aria-describedby="material-hint">
<option value="">Choose material...</option>
<option value="carbon-steel">Carbon Steel</option>
<option value="stainless">Stainless Steel</option>
<option value="aluminum">Aluminum</option>
<option value="wrought-iron">Wrought Iron</option>
</select>
<div class="form-hint" id="material-hint">What metal are you working with?</div>
</div>

<h3 style="margin:24px 0 14px;display:flex;align-items:center;gap:8px">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
Line Items
</h3>
<div id="lineItems" role="list" aria-label="Quote line items"></div>
<button type="button" class="btn btn--secondary btn--full" onclick="addLineItem()" style="margin-bottom:20px">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
Add Line Item
</button>

<div class="form-row">
<div class="form-group">
<label for="ef-labor-hrs">Labor Hours</label>
<input type="number" id="ef-labor-hrs" min="0" step="0.5" placeholder="0" inputmode="decimal" aria-describedby="labor-hint">
<div class="form-hint" id="labor-hint">Estimated time</div>
</div>
<div class="form-group">
<label for="ef-labor-rate">Hourly Rate ($)</label>
<input type="number" id="ef-labor-rate" min="0" step="5" placeholder="85" inputmode="decimal" aria-describedby="rate-hint">
<div class="form-hint" id="rate-hint">Your shop rate</div>
</div>
</div>

<div class="form-group">
<label for="ef-notes">Job Notes</label>
<textarea id="ef-notes" placeholder="Access issues, special requirements, materials to order..." aria-describedby="notes-hint"></textarea>
<div class="form-hint" id="notes-hint">Anything else you need to remember about this job</div>
</div>

<!-- Camera Section -->
<div class="form-group">
<label>Site Photos <span style="font-weight:400;color:var(--text-subtle)">(max 5)</span></label>
<div class="captured-photos" id="capturedPhotos" role="list" aria-label="Captured photos"></div>
<button type="button" class="btn btn--secondary btn--full" onclick="openCamera()" id="cameraBtn" aria-label="Take a job site photo">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
<span id="cameraBtnText">Take Photo</span>
</button>
<div class="camera-area" id="cameraArea" style="display:none" role="region" aria-label="Camera view">
<video id="cameraVideo" autoplay playsinline aria-label="Camera preview"></video>
<canvas id="cameraCanvas"></canvas>
</div>
<div class="camera-btn-area" id="cameraBtnArea" style="display:none">
<button type="button" class="btn btn--primary" onclick="capturePhoto()" aria-label="Capture photo">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>
Snap
</button>
<button type="button" class="btn btn--secondary" onclick="closeCamera()">Close Camera</button>
</div>
<div class="form-hint" id="photo-hint">Photos help you remember site conditions</div>
</div>

<div class="total-bar" aria-live="polite" aria-atomic="true">
<div class="tb-label">Quote Total</div>
<div class="tb-amount" id="estimateTotal">$0</div>
</div>

<input type="hidden" id="ef-id">
<input type="hidden" id="ef-status" value="quoted">
<button type="submit" class="btn btn--primary btn--full" id="saveBtn">
<span id="saveBtnText">Save Quote</span>
</button>
</form>
</section>

<!-- ESTIMATE DETAIL -->
<section class="view" id="viewEstDetail" role="region" aria-label="Estimate details">
<div class="detail-header">
<button class="back-btn" onclick="showView('viewEstimates')" aria-label="Back to estimates list"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button>
<h2 id="estDetailTitle">Job Quote</h2>
</div>
<div id="estDetailContent"></div>
</section>

<!-- OVERVIEW -->
<section class="view" id="viewOverview" role="region" aria-label="Business overview">
<h2 style="margin-bottom:20px">This Month at a Glance</h2>
<div class="stats-row" id="statsRow" role="region" aria-label="Key statistics">
<div class="stat-card loading-pulse"><div class="stat-num">--</div><div class="stat-label">Loading...</div></div>
<div class="stat-card loading-pulse"><div class="stat-num">--</div><div class="stat-label">Loading...</div></div>
<div class="stat-card loading-pulse"><div class="stat-num">--</div><div class="stat-label">Loading...</div></div>
</div>
<h3 style="margin-bottom:14px">Recent Activity</h3>
<div id="recentList" role="list" aria-label="Recent estimates"></div>
</section>

<!-- SETTINGS -->
<section class="view" id="viewSettings" role="region" aria-label="Settings">
<h2 style="margin-bottom:20px">Tool Settings</h2>
<div class="form-group">
<label for="set-labor-rate">Default Hourly Rate ($)</label>
<input type="number" id="set-labor-rate" value="85" min="1" step="5" onchange="localStorage.setItem('wq_rate',this.value);showToast('Default rate saved','success')" aria-describedby="rate-setting-hint">
<div class="form-hint" id="rate-setting-hint">Used when creating new quotes</div>
</div>
<div style="display:flex;flex-direction:column;gap:12px;margin-top:24px">
<button class="btn btn--secondary btn--full" onclick="exportData()">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
Export All Data
</button>
<button class="btn btn--secondary btn--full" onclick="document.getElementById('importFile').click()">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
Import Data
</button>
<input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)" aria-label="Import JSON file">
<div style="position:relative;margin-top:8px">
<button class="btn btn--secondary btn--full" disabled style="opacity:.6;background:var(--bg);border-style:dashed">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
Generate Branded PDF
</button>
<span class="premium-badge">Pro</span>
</div>
<div style="position:relative">
<button class="btn btn--secondary btn--full" disabled style="opacity:.6;background:var(--bg);border-style:dashed">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
Customer E-Signature
</button>
<span class="premium-badge">Pro</span>
</div>
</div>
<div style="margin-top:32px;padding:20px;background:var(--bg);border-radius:var(--radius);border:1px solid var(--border-light)">
<h3 style="font-size:.95rem;margin-bottom:10px;display:flex;align-items:center;gap:8px">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
About This Tool
</h3>
<p style="font-size:.85rem;color:var(--text-muted);line-height:1.6">WeldQuote Pro helps you create field estimates fast. Everything stays on your device—no cloud, no accounts, no monthly fees.</p>
<p style="font-size:.8rem;color:var(--text-subtle);margin-top:12px">Version 1.0 • Built for Alamo City Custom Welding</p>
</div>
</section>
</main>

<button class="fab" onclick="showNewEstimate()" aria-label="Create new field quote">
<svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
</button>

<nav class="bottom-nav" role="navigation" aria-label="Main navigation">
<button onclick="showView('viewEstimates')" id="navEst" class="active" aria-label="View all estimates" aria-current="page">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
<span>Quotes</span>
</button>
<button onclick="showView('viewOverview')" id="navOver" aria-label="View business overview">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
<span>Overview</span>
</button>
<button onclick="showView('viewSettings')" id="navSet" aria-label="Open settings">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
<span>Settings</span>
</button>
</nav>

<!-- Confirmation Modal -->
<div class="modal-overlay" id="confirmModal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle" aria-describedby="confirmDesc">
<div class="modal">
<h3 id="confirmTitle">Discard Changes?</h3>
<p id="confirmDesc">You have unsaved changes. Are you sure you want to leave without saving?</p>
<div class="modal-actions">
<button class="btn btn--secondary" onclick="hideModal()">Keep Editing</button>
<button class="btn btn--danger" onclick="confirmDiscard()">Discard</button>
</div>
</div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" id="deleteModal" role="dialog" aria-modal="true" aria-labelledby="deleteTitle" aria-describedby="deleteDesc">
<div class="modal">
<h3 id="deleteTitle">Delete This Quote?</h3>
<p id="deleteDesc">This action cannot be undone. The quote will be permanently removed.</p>
<div class="modal-actions">
<button class="btn btn--secondary" onclick="hideDeleteModal()">Cancel</button>
<button class="btn btn--danger" onclick="confirmDelete()">Delete Quote</button>
</div>
</div>
</div>

<!-- Demo Disclaimer -->
<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer" style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:10px 16px;font-size:12px;line-height:1.4;color:#666;z-index:99999;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:8px 16px;text-align:center;">
<p style="margin:0;max-width:700px;"><strong style="color:#333;">DEMO:</strong> Created by BennyCuTools for demonstration. Not affiliated with Alamo City Custom Welding.</p>
<a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20Alamo%20City%20Custom%20Welding" style="display:inline-flex;align-items:center;gap:4px;background:#dc3545;color:#fff;padding:5px 12px;border-radius:4px;text-decoration:none;font-size:11px;font-weight:500;white-space:nowrap;">
<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
Request Removal
</a>
</div>

<script>
function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
const _V=23437989;
const _k=new URLSearchParams(window.location.search).get('key');
if(_k&&_h(_k)===_V){sessionStorage.setItem('wq_auth','1')}
if(!sessionStorage.getItem('wq_auth')){
document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:Oswald,sans-serif;background:linear-gradient(135deg,#1e3a5f,#0f1f33);color:#fff;text-align:center;padding:20px"><div><div style="width:60px;height:60px;background:#c75b1c;border-radius:10px;display:flex;align-items:center;justify-content:center;margin:0 auto 20px"><svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5"><path d="M8 17l4-4 4 4M12 3v14"/></svg></div><h1 style="font-size:1.8rem;letter-spacing:.06em;margin-bottom:.5rem">WELDQUOTE PRO</h1><p style="color:#ccc;margin-bottom:1.5rem;font-family:Open Sans,sans-serif;font-size:.9rem">Enter your access key to continue</p><input id="keyIn" type="text" placeholder="Your key" style="padding:14px 18px;border-radius:8px;border:2px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff;font-size:1rem;width:220px;text-align:center;outline:none" onkeyup="if(event.key===\'Enter\')document.getElementById(\'keyBtn\').click()"><br><button id="keyBtn" onclick="var k=document.getElementById(\'keyIn\').value;if(_h(k)===_V){sessionStorage.setItem(\'wq_auth\',\'1\');location.reload();}else{document.getElementById(\'keyErr\').style.display=\'block\';document.getElementById(\'keyIn\').style.borderColor=\'#e74c3c\'}" style="margin-top:16px;padding:12px 32px;background:#c75b1c;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:700;text-transform:uppercase;letter-spacing:.04em;font-family:Oswald,sans-serif;transition:all .15s">Unlock Tool</button><p id="keyErr" style="color:#ff6b6b;margin-top:12px;display:none;font-size:.85rem;font-family:Open Sans,sans-serif">That key is not valid. Try again.</p></div></div><div style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:10px;font-size:12px;color:#666;text-align:center">Demo by BennyCuTools</div>';
throw new Error('Auth required');
}
document.addEventListener('contextmenu',e=>e.preventDefault());

const DB_NAME='WeldQuoteDB';const DB_VER=1;let db;
function openDB(){return new Promise((res,rej)=>{const r=indexedDB.open(DB_NAME,DB_VER);r.onupgradeneeded=e=>{const d=e.target.result;if(!d.objectStoreNames.contains('estimates')){d.createObjectStore('estimates',{keyPath:'id'})}};r.onsuccess=e=>{db=e.target.result;res(db)};r.onerror=e=>rej(e)})}
function dbPut(data){return new Promise((r,j)=>{const t=db.transaction('estimates','readwrite');t.objectStore('estimates').put(data);t.oncomplete=()=>r();t.onerror=e=>j(e)})}
function dbGetAll(){return new Promise((r,j)=>{const t=db.transaction('estimates','readonly');const q=t.objectStore('estimates').getAll();q.onsuccess=()=>r(q.result);q.onerror=e=>j(e)})}
function dbGet(id){return new Promise((r,j)=>{const t=db.transaction('estimates','readonly');const q=t.objectStore('estimates').get(id);q.onsuccess=()=>r(q.result);q.onerror=e=>j(e)})}
function dbDelete(id){return new Promise((r,j)=>{const t=db.transaction('estimates','readwrite');t.objectStore('estimates').delete(id);t.oncomplete=()=>r();t.onerror=e=>j(e)})}

let allEstimates=[];let capturedImages=[];let cameraStream=null;let lineItemCount=0;let selectedType='';let currentFilter='all';let estimateToDelete=null;let hasUnsavedChanges=false;

const DEMO=[
{id:'demo-1',client:'Martinez Family',address:'1847 Stone Oak Pkwy, San Antonio',phone:'210-555-0134',type:'fence',material:'wrought-iron',lineItems:[{desc:'Wrought iron fence panels (6ft)',qty:12,unit:85},{desc:'Steel posts 4x4 with caps',qty:14,unit:35},{desc:'Walk gate with scrollwork',qty:1,unit:650}],laborHrs:16,laborRate:85,notes:'Neighbors fence has a Spanish scroll pattern—customer wants to match. Side gate access only. Two dogs on property.',status:'accepted',photos:[],total:3160,created:Date.now()-86400000*3,isDemo:true},
{id:'demo-2',client:'Riverwalk Apartments',address:'410 E Commerce St, San Antonio',phone:'210-555-0287',type:'gate',material:'carbon-steel',lineItems:[{desc:'Gate motor replacement (FAAC 422)',qty:1,unit:420},{desc:'Steel track and roller kit',qty:1,unit:185},{desc:'Frame welding repair',qty:1,unit:150}],laborHrs:6,laborRate:95,notes:'Motor burned out Tuesday—residents stuck a broom in it to hold it open. Need to schedule during low-traffic hours (10am-2pm).',status:'quoted',photos:[],total:1325,created:Date.now()-86400000,isDemo:true},
{id:'demo-3',client:'Converse Business Park',address:'8719 Converse Business Cir, Converse',phone:'210-555-0456',type:'railing',material:'stainless',lineItems:[{desc:'Stainless handrail (1.5in OD)',qty:40,unit:45},{desc:'Wall mount brackets',qty:12,unit:18},{desc:'End caps and returns',qty:4,unit:25}],laborHrs:10,laborRate:85,notes:'ADA ramp for main entrance. Inspector wants 34-38in height, 1.5in clearance from wall. Finish #4 brushed.',status:'completed',photos:[],total:2966,created:Date.now()-86400000*10,isDemo:true}
];

async function loadDemoData(){
if(localStorage.getItem('wq_demoCleared')) return;
const est=await dbGetAll();
if(est.length>0) return;
for(const d of DEMO) await dbPut(d);
localStorage.setItem('wq_hasDemo','1');
}
async function clearDemoData(){
const all=await dbGetAll();
for(const e of all){if(e.isDemo) await dbDelete(e.id)}
localStorage.removeItem('wq_hasDemo');localStorage.setItem('wq_demoCleared','1');
document.getElementById('demoBanner').style.display='none';
await refreshData();showToast('Demo cleared—ready for your jobs','success');
}

function setFilter(filter){
currentFilter=filter;
document.querySelectorAll('.filter-chip').forEach(chip=>{
const isActive=chip.dataset.filter===filter;
chip.classList.toggle('active',isActive);
chip.setAttribute('aria-selected',isActive);
});
renderEstimateList();
}

function calcTotal(){
let mat=0;
document.querySelectorAll('.line-item').forEach(li=>{
const qty=parseFloat(li.querySelector('.li-qty').value)||0;
const unit=parseFloat(li.querySelector('.li-unit').value)||0;
const sub=qty*unit;mat+=sub;
li.querySelector('.li-subtotal').textContent='$'+sub.toLocaleString();
});
const hrs=parseFloat(document.getElementById('ef-labor-hrs').value)||0;
const rate=parseFloat(document.getElementById('ef-labor-rate').value)||85;
const total=mat+(hrs*rate);
document.getElementById('estimateTotal').textContent='$'+total.toLocaleString();
return total;
}

function addLineItem(desc='',qty='',unit=''){
lineItemCount++;
const div=document.createElement('div');div.className='line-item';div.setAttribute('role','listitem');
div.innerHTML=`<div class="li-header"><span class="li-title">Item ${lineItemCount}</span><button type="button" class="li-remove" onclick="removeLineItem(this)" aria-label="Remove item ${lineItemCount}"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>
<div class="li-row">
<input type="text" class="li-desc" placeholder="What is it?" value="${desc}" aria-label="Item description">
<input type="number" class="li-qty" placeholder="Qty" value="${qty}" min="0" step="any" oninput="calcTotal()" aria-label="Quantity" inputmode="decimal">
<input type="number" class="li-unit" placeholder="$ each" value="${unit}" min="0" step="any" oninput="calcTotal()" aria-label="Unit price" inputmode="decimal">
</div>
<div class="li-subtotal">$0</div>`;
document.getElementById('lineItems').appendChild(div);
calcTotal();
}

function removeLineItem(btn){
btn.closest('.line-item').remove();
calcTotal();
}

function selectType(el){
document.querySelectorAll('.type-pill').forEach(p=>{p.classList.remove('active');p.setAttribute('aria-checked','false')});
el.classList.add('active');el.setAttribute('aria-checked','true');selectedType=el.dataset.type;
document.getElementById('type-error').style.display='none';
}

function validateForm(){
let valid=true;
const client=document.getElementById('ef-client');
const clientError=document.getElementById('client-error');
if(!client.value.trim()){
client.setAttribute('aria-invalid','true');
clientError.style.display='flex';
clientError.textContent='Enter a client name';
valid=false;
}else{
client.setAttribute('aria-invalid','false');
clientError.style.display='none';
}
const typeError=document.getElementById('type-error');
if(!selectedType){
typeError.style.display='flex';
typeError.textContent='Pick a project type';
valid=false;
}else{
typeError.style.display='none';
}
return valid;
}

function showNewEstimate(){
document.getElementById('estimateForm').reset();
document.getElementById('ef-id').value='';
document.getElementById('ef-status').value='quoted';
document.getElementById('ef-labor-rate').value=localStorage.getItem('wq_rate')||85;
document.getElementById('lineItems').innerHTML='';lineItemCount=0;
document.querySelectorAll('.type-pill').forEach(p=>{p.classList.remove('active');p.setAttribute('aria-checked','false')});selectedType='';
capturedImages=[];renderCapturedPhotos();
document.getElementById('newEstTitle').textContent='New Field Quote';
document.getElementById('estimateTotal').textContent='$0';
document.getElementById('client-error').style.display='none';
document.getElementById('type-error').style.display='none';
document.getElementById('ef-client').setAttribute('aria-invalid','false');
hasUnsavedChanges=false;
addLineItem();
showView('viewNewEstimate');
}

async function editEstimate(id){
const est=await dbGet(id);if(!est) return;
document.getElementById('estimateForm').reset();
document.getElementById('ef-id').value=est.id;
document.getElementById('ef-status').value=est.status||'quoted';
document.getElementById('ef-client').value=est.client||'';
document.getElementById('ef-address').value=est.address||'';
document.getElementById('ef-phone').value=est.phone||'';
document.getElementById('ef-material').value=est.material||'';
document.getElementById('ef-labor-hrs').value=est.laborHrs||'';
document.getElementById('ef-labor-rate').value=est.laborRate||85;
document.getElementById('ef-notes').value=est.notes||'';
document.querySelectorAll('.type-pill').forEach(p=>{
const isMatch=p.dataset.type===est.type;
p.classList.toggle('active',isMatch);
p.setAttribute('aria-checked',isMatch);
if(isMatch)selectedType=est.type;
});
document.getElementById('lineItems').innerHTML='';lineItemCount=0;
if(est.lineItems&&est.lineItems.length){
est.lineItems.forEach(li=>addLineItem(li.desc,li.qty,li.unit));
}else{addLineItem();}
capturedImages=est.photos||[];renderCapturedPhotos();
document.getElementById('newEstTitle').textContent='Edit Quote';
calcTotal();
hasUnsavedChanges=false;
showView('viewNewEstimate');
}

async function saveEstimate(e){
e.preventDefault();
if(!validateForm()){
showToast('Fix the errors above','error');
const firstError=document.querySelector('.form-error[style*="flex"]')||document.querySelector('[aria-invalid="true"]');
if(firstError)firstError.scrollIntoView({behavior:'smooth',block:'center'});
return;
}
closeCamera();
const saveBtn=document.getElementById('saveBtn');
const saveBtnText=document.getElementById('saveBtnText');
saveBtn.disabled=true;
saveBtnText.innerHTML='<span class="spinner" style="width:16px;height:16px;border-color:rgba(255,255,255,.3);border-top-color:#fff;margin-right:8px"></span>Saving...';
await new Promise(r=>setTimeout(r,400));
const items=[];
document.querySelectorAll('.line-item').forEach(li=>{
const desc=li.querySelector('.li-desc').value.trim();
const qty=parseFloat(li.querySelector('.li-qty').value)||0;
const unit=parseFloat(li.querySelector('.li-unit').value)||0;
if(desc||qty>0||unit>0) items.push({desc:desc||'Item',qty,unit});
});
const id=document.getElementById('ef-id').value||'est-'+Date.now();
const est={
id,client:document.getElementById('ef-client').value.trim(),
address:document.getElementById('ef-address').value.trim(),
phone:document.getElementById('ef-phone').value.trim(),
type:selectedType,material:document.getElementById('ef-material').value,
lineItems:items,
laborHrs:parseFloat(document.getElementById('ef-labor-hrs').value)||0,
laborRate:parseFloat(document.getElementById('ef-labor-rate').value)||85,
notes:document.getElementById('ef-notes').value.trim(),
status:document.getElementById('ef-status').value||'quoted',
photos:capturedImages.slice(0,5),
total:calcTotal(),created:document.getElementById('ef-id').value?undefined:Date.now()
};
await dbPut(est);await refreshData();
saveBtn.disabled=false;
saveBtnText.textContent='Save Quote';
showToast('Quote saved','success');
showView('viewEstimates');
hasUnsavedChanges=false;
}

async function showEstDetail(id){
const est=await dbGet(id);if(!est) return;
document.getElementById('estDetailTitle').textContent=est.type?(est.type.charAt(0).toUpperCase()+est.type.slice(1))+' Quote':'Job Quote';
const statusCls={'quoted':'badge--quoted','accepted':'badge--accepted','completed':'badge--completed','declined':'badge--declined'}[est.status]||'';
const statusLabel={'quoted':'Pending','accepted':'Won','completed':'Done','declined':'Lost'}[est.status]||'Pending';
const typeLabel={'fence':'Fence','gate':'Gate','railing':'Railing','carport':'Carport','stairs':'Stairs','repair':'Repair','custom':'Custom Fab'}[est.type]||'Custom';
const materialLabel={'carbon-steel':'Carbon Steel','stainless':'Stainless Steel','aluminum':'Aluminum','wrought-iron':'Wrought Iron'}[est.material]||'Not specified';
let html=`<div style="background:var(--card);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);margin-bottom:16px;border:1px solid var(--border-light)">
<div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:14px">
<div style="flex:1;min-width:0"><div style="font-size:.75rem;font-weight:700;color:var(--text-subtle);text-transform:uppercase;letter-spacing:.06em;margin-bottom:4px">${typeLabel}</div><h3 style="font-size:1.15rem;margin-bottom:6px;word-break:break-word">${est.client}</h3>${est.phone?`<p style="font-size:.85rem;color:var(--text-muted);margin-bottom:2px">${est.phone}</p>`:''}${est.address?`<p style="font-size:.82rem;color:var(--text-subtle)">${est.address}</p>`:''}</div>
<span class="badge ${statusCls}">${statusLabel}</span>
</div>
${est.material?`<p style="font-size:.85rem;margin-bottom:10px;padding:8px 12px;background:var(--bg);border-radius:var(--radius-sm)"><strong>Material:</strong> ${materialLabel}</p>`:''}
${est.notes?`<div style="background:var(--bg);border-radius:var(--radius-sm);padding:12px;margin-bottom:14px"><p style="font-size:.85rem;color:var(--text-muted);line-height:1.5">${est.notes.replace(/\n/g,'<br>')}</p></div>`:''}
<div style="display:flex;gap:8px;flex-wrap:wrap">
<button class="btn btn--primary btn--sm" onclick="shareEstimate('${id}')" aria-label="Share this quote">
<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
Share
</button>
<button class="btn btn--secondary btn--sm" onclick="editEstimate('${id}')" aria-label="Edit this quote">
<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
Edit
</button>
<button class="btn btn--danger btn--sm" onclick="showDeleteModal('${id}')" aria-label="Delete this quote">
<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
Delete
</button>
</div></div>`;

html+=`<div class="share-preview"><div class="sp-header"><div class="sp-logo" aria-hidden="true"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5"><path d="M8 17l4-4 4 4M12 3v14"/></svg></div><div class="sp-company">Alamo City Custom Welding</div></div>`;
if(est.lineItems&&est.lineItems.length){
html+='<h3 style="font-size:.85rem;color:var(--text-muted);margin-bottom:10px;text-transform:uppercase;letter-spacing:.04em">Materials & Parts</h3>';
est.lineItems.forEach(li=>{
html+=`<div class="sp-line"><span class="sp-label">${li.desc||'Item'} × ${li.qty}</span><span>$${(li.qty*li.unit).toLocaleString()}</span></div>`;
});
}
if(est.laborHrs){
html+=`<div class="sp-line" style="margin-top:8px"><span class="sp-label">Labor (${est.laborHrs} hrs @ $${est.laborRate}/hr)</span><span>$${(est.laborHrs*est.laborRate).toLocaleString()}</span></div>`;
}
html+=`<div class="sp-line"><span>Quote Total</span><span>$${(est.total||0).toLocaleString()}</span></div></div>`;

if(est.photos&&est.photos.length){
html+=`<h3 style="font-size:.85rem;color:var(--text-muted);margin:16px 0 10px;text-transform:uppercase;letter-spacing:.04em">Site Photos</h3><div class="captured-photos" role="list" aria-label="Job site photos">${est.photos.map((p,i)=>`<div class="photo-thumb" role="listitem"><img src="${p}" alt="Job site photo ${i+1}"></div>`).join('')}</div>`;
}
document.getElementById('estDetailContent').innerHTML=html;
showView('viewEstDetail');
}

function showDeleteModal(id){estimateToDelete=id;document.getElementById('deleteModal').classList.add('active');}
function hideDeleteModal(){estimateToDelete=null;document.getElementById('deleteModal').classList.remove('active');}
async function confirmDelete(){if(!estimateToDelete)return;await dbDelete(estimateToDelete);estimateToDelete=null;hideDeleteModal();await refreshData();showToast('Quote deleted','success');showView('viewEstimates');}

async function updateStatus(id,status){
const est=await dbGet(id);if(!est) return;
est.status=status;await dbPut(est);await refreshData();
const statusNames={'quoted':'Pending','accepted':'Won','completed':'Done','declined':'Lost'};
showToast(`Status: ${statusNames[status]||status}`,'success');
}

async function shareEstimate(id){
const est=await dbGet(id);if(!est) return;
const typeLabel={'fence':'Fence','gate':'Gate','railing':'Railing','carport':'Carport','stairs':'Stairs','repair':'Repair','custom':'Custom Fab'}[est.type]||'Custom';
let text=`Alamo City Custom Welding - ${typeLabel} Quote\n`;
text+=`Client: ${est.client}\n`;
if(est.address) text+=`Site: ${est.address}\n`;
text+=`\n`;
if(est.lineItems&&est.lineItems.length){
text+="Materials:\n";
est.lineItems.forEach(li=>{text+=`${li.desc||'Item'} × ${li.qty} = $${(li.qty*li.unit).toLocaleString()}\n`});
}
if(est.laborHrs) text+=`\nLabor: ${est.laborHrs} hrs @ $${est.laborRate}/hr = $${(est.laborHrs*est.laborRate).toLocaleString()}\n`;
text+=`\nTOTAL: $${(est.total||0).toLocaleString()}\n\n`;
text+=`Alamo City Custom Welding\n(210) 233-6340\n1-year workmanship guarantee`;
if(navigator.share){
try{await navigator.share({title:`Quote - ${est.client}`,text});showToast('Ready to send','success')}catch(e){if(e.name!=='AbortError')fallbackCopy(text)}
}else{fallbackCopy(text)}
}
function fallbackCopy(t){navigator.clipboard.writeText(t).then(()=>showToast('Copied to clipboard','success')).catch(()=>showToast('Could not copy','error'))}

// Camera
let cameraActive=false;
async function openCamera(){
if(cameraActive){closeCamera();return}
if(capturedImages.length>=5){showToast('Max 5 photos allowed','error');return}
try{
cameraStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
document.getElementById('cameraVideo').srcObject=cameraStream;
document.getElementById('cameraArea').style.display='block';
document.getElementById('cameraBtnArea').style.display='flex';
document.getElementById('cameraBtnText').textContent='Close Camera';
cameraActive=true;
}catch(e){showToast('Camera not available','error')}
}
function closeCamera(){
if(cameraStream){cameraStream.getTracks().forEach(t=>t.stop());cameraStream=null}
document.getElementById('cameraArea').style.display='none';
document.getElementById('cameraBtnArea').style.display='none';
document.getElementById('cameraBtnText').textContent='Take Photo';
cameraActive=false;
}
function capturePhoto(){
if(capturedImages.length>=5){showToast('Max 5 photos','error');return}
const v=document.getElementById('cameraVideo');const c=document.getElementById('cameraCanvas');
c.width=v.videoWidth;c.height=v.videoHeight;c.getContext('2d').drawImage(v,0,0);
capturedImages.push(c.toDataURL('image/jpeg',.7));renderCapturedPhotos();
showToast('Photo added','success');
if(capturedImages.length>=5)closeCamera();
}
function removePhoto(idx){capturedImages.splice(idx,1);renderCapturedPhotos();}
function renderCapturedPhotos(){
const container=document.getElementById('capturedPhotos');
if(capturedImages.length===0){container.innerHTML='';return}
container.innerHTML=capturedImages.map((img,i)=>`<div class="photo-thumb" role="listitem"><img src="${img}" alt="Captured photo ${i+1}"><button type="button" class="remove-photo" onclick="removePhoto(${i})" aria-label="Remove photo ${i+1}">×</button></div>`).join('');
}

function filterEstimates(estimates){
if(currentFilter==='all') return estimates;
return estimates.filter(e=>e.status===currentFilter);
}

function renderEstimateList(){
const list=document.getElementById('estimateList');
const searchTerm=document.getElementById('searchInput').value.toLowerCase().trim();
let filtered=[...allEstimates].sort((a,b)=>b.created-a.created);
if(searchTerm){
filtered=filtered.filter(e=>
(e.client||'').toLowerCase().includes(searchTerm)||
(e.address||'').toLowerCase().includes(searchTerm)||
(e.type||'').toLowerCase().includes(searchTerm)
);
}
filtered=filterEstimates(filtered);
if(filtered.length===0){
const isSearch=searchTerm!=='';
const isFilter=currentFilter!=='all';
let message,submessage;
if(isSearch){message='No matches found';submessage='Try a different search term'}
else if(isFilter){message='No '+currentFilter+' jobs';submessage='Try a different filter or create a new quote'}
else{message='No quotes yet';submessage='Tap the + button to create your first field quote'}
list.innerHTML=`<div class="empty-state">
<div class="empty-state-icon" aria-hidden="true"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div>
<h3>${message}</h3>
<p>${submessage}</p>
${!isSearch&&!isFilter?'<button class="btn btn--primary" onclick="showNewEstimate()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Create Quote</button>':''}
</div>`;
return;
}
list.innerHTML=filtered.map(e=>{
const statusCls={'quoted':'badge--quoted','accepted':'badge--accepted','completed':'badge--completed','declined':'badge--declined'}[e.status]||'';
const statusLabel={'quoted':'Pending','accepted':'Won','completed':'Done','declined':'Lost'}[e.status]||'Pending';
const date=new Date(e.created).toLocaleDateString('en-US',{month:'short',day:'numeric'});
const typeLabel={'fence':'Fence','gate':'Gate','railing':'Railing','carport':'Carport','stairs':'Stairs','repair':'Repair','custom':'Custom'}[e.type]||'Custom';
return`<article class="est-card" onclick="showEstDetail('${e.id}')" role="button" tabindex="0" aria-label="View ${typeLabel} quote for ${e.client}, ${statusLabel}, $${(e.total||0).toLocaleString()}">
<div class="est-card-inner">
<div class="ec-header">
<div style="min-width:0">
<div class="ec-type">${typeLabel}${e.material?'• '+(e.material==='carbon-steel'?'Steel':e.material==='wrought-iron'?'Wrought Iron':e.material.charAt(0).toUpperCase()+e.material.slice(1)):''}</div>
<div class="ec-title">${e.client}</div>
</div>
<span class="badge ${statusCls}">${statusLabel}</span>
</div>
${e.address?`<div class="ec-location"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>${e.address}</div>`:''}
<div class="ec-footer">
<span class="ec-date">${date}</span>
<span class="ec-total">$${(e.total||0).toLocaleString()}</span>
</div>
</div>
</article>`}).join('');
}

async function renderOverview(){
const total=allEstimates.length;
const quoted=allEstimates.filter(e=>e.status==='quoted').length;
const accepted=allEstimates.filter(e=>e.status==='accepted').length;
const completed=allEstimates.filter(e=>e.status==='completed').length;
const wonRevenue=allEstimates.filter(e=>e.status==='accepted'||e.status==='completed').reduce((s,e)=>s+(e.total||0),0);
const pendingRevenue=allEstimates.filter(e=>e.status==='quoted').reduce((s,e)=>s+(e.total||0),0);
document.getElementById('statsRow').innerHTML=`<div class="stat-card"><div class="stat-num">${total}</div><div class="stat-label">Total Quotes</div></div><div class="stat-card"><div class="stat-num" style="color:var(--warning)">${quoted}</div><div class="stat-label">Pending</div></div><div class="stat-card"><div class="stat-num" style="color:var(--success)">$${(wonRevenue/1000).toFixed(1)}k</div><div class="stat-label">Won Revenue</div></div>`;
const recent=[...allEstimates].sort((a,b)=>b.created-a.created).slice(0,5);
const recentContainer=document.getElementById('recentList');
if(recent.length===0){
recentContainer.innerHTML=`<p style="text-align:center;color:var(--text-muted);padding:24px;font-size:.9rem">No activity yet. Create your first quote to get started.</p>`;
return;
}
recentContainer.innerHTML=recent.map(e=>{
const statusCls={'quoted':'badge--quoted','accepted':'badge--accepted','completed':'badge--completed','declined':'badge--declined'}[e.status]||'';
const statusLabel={'quoted':'Pending','accepted':'Won','completed':'Done','declined':'Lost'}[e.status]||'Pending';
return`<div class="est-card" onclick="showEstDetail('${e.id}')" role="button" tabindex="0" style="margin-bottom:8px">
<div class="est-card-inner" style="padding:12px 14px">
<div style="display:flex;justify-content:space-between;align-items:center">
<div style="min-width:0"><div style="font-weight:600;font-size:.9rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${e.client}</div><div style="font-size:.75rem;color:var(--text-subtle)">${new Date(e.created).toLocaleDateString()}</div></div>
<span class="badge ${statusCls}" style="font-size:.65rem;padding:2px 8px">${statusLabel}</span>
</div>
</div>
</div>`}).join('');
}

async function refreshData(){
allEstimates=await dbGetAll();
renderEstimateList();
if(localStorage.getItem('wq_hasDemo')&&!localStorage.getItem('wq_demoCleared')){document.getElementById('demoBanner').style.display='flex'}
}

function showView(id){
document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
document.getElementById(id).classList.add('active');
document.querySelectorAll('.bottom-nav button').forEach(b=>{b.classList.remove('active');b.removeAttribute('aria-current')});
const fab=document.querySelector('.fab');
if(id==='viewEstimates'){document.getElementById('navEst').classList.add('active');document.getElementById('navEst').setAttribute('aria-current','page');fab.style.display='flex'}
else if(id==='viewOverview'){document.getElementById('navOver').classList.add('active');fab.style.display='none';renderOverview()}
else if(id==='viewSettings'){document.getElementById('navSet').classList.add('active');fab.style.display='none';document.getElementById('set-labor-rate').value=localStorage.getItem('wq_rate')||85}
else{fab.style.display='none'}
window.scrollTo(0,0);
}

// Modal handling
let pendingNavigation=null;
function confirmCancelEdit(){if(!hasUnsavedChanges){showView('viewEstimates');return}pendingNavigation='viewEstimates';document.getElementById('confirmModal').classList.add('active');}
function hideModal(){document.getElementById('confirmModal').classList.remove('active');pendingNavigation=null;}
function confirmDiscard(){hideModal();hasUnsavedChanges=false;if(pendingNavigation){showView(pendingNavigation);pendingNavigation=null;}}

// Track unsaved changes
document.addEventListener('input',function(e){if(e.target.closest('#estimateForm'))hasUnsavedChanges=true;});

// Search input
document.getElementById('searchInput')?.addEventListener('input',renderEstimateList);

// Labor input listeners
document.getElementById('ef-labor-hrs')?.addEventListener('input',calcTotal);
document.getElementById('ef-labor-rate')?.addEventListener('input',calcTotal);

async function exportData(){
const data={estimates:allEstimates,exported:new Date().toISOString(),app:'WeldQuote Pro'};
const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;
a.download='weldquote-backup-'+new Date().toISOString().split('T')[0]+'.json';a.click();URL.revokeObjectURL(url);
showToast('Data exported','success');
}
async function importData(e){
const file=e.target.files[0];if(!file) return;
try{
const data=JSON.parse(await file.text());
if(data.estimates&&Array.isArray(data.estimates)){
for(const est of data.estimates) await dbPut(est);
await refreshData();
showToast(`Imported ${data.estimates.length} quotes`,'success');
}else{showToast('No quotes found in file','error')}
}catch(err){showToast('Could not read file','error')}
e.target.value='';
}

function showToast(msg,type='info'){
const c=document.getElementById('toastContainer');const t=document.createElement('div');
t.className='toast '+type;
const icon=type==='success'?'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>':type==='error'?'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>':'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>';
t.innerHTML=icon+'<span>'+msg+'</span>';
c.appendChild(t);setTimeout(()=>t.remove(),3000);
}

(async()=>{await openDB();await loadDemoData();await refreshData()})();
</script>
<script src="https://book.bennycutools.com/tracker.js" async></script>
</body>
</html>
