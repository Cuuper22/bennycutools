<!DOCTYPE html>
<html lang="en">
<head>
<meta name="robots" content="noindex, nofollow">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SepticTrack Pro — T.E.R. Septic Site & Utilities</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-yellow: #F5A623;
            --brand-yellow-dark: #D4900F;
            --brand-yellow-light: #FCEBD0;
            --brand-black: #1A1A1A;
            --brand-dark: #2D2D2D;
            --brand-gray: #6B7280;
            --brand-light: #F3F4F6;
            --brand-white: #FFFFFF;
            --success: #10B981;
            --success-light: #D1FAE5;
            --warning: #F59E0B;
            --warning-light: #FEF3C7;
            --danger: #EF4444;
            --danger-light: #FEE2E2;
            --info: #3B82F6;
            --info-light: #DBEAFE;
            --aerobic: #8B5CF6;
            --aerobic-light: #EDE9FE;
            --conventional: #059669;
            --conventional-light: #D1FAE5;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            --radius: 12px;
            --radius-sm: 8px;
            --radius-lg: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--brand-light);
            color: var(--brand-black);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            padding-bottom: 80px;
            user-select: none;
        }

        input, textarea, select {
            user-select: auto;
        }

        /* Header */
        .header {
            background: var(--brand-black);
            color: var(--brand-white);
            padding: 16px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-lg);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--brand-yellow);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon svg {
            width: 24px;
            height: 24px;
            stroke: var(--brand-black);
        }

        .logo-text {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
        }

        .logo-text span {
            color: var(--brand-yellow);
        }

        .header-badge {
            background: var(--brand-yellow);
            color: var(--brand-black);
            font-size: 0.7rem;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--brand-white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 16px;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .card-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.125rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title svg {
            width: 20px;
            height: 20px;
            stroke: var(--brand-yellow);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        @media (min-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .stat-card {
            background: var(--brand-white);
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--brand-yellow);
        }

        .stat-card.success { border-left-color: var(--success); }
        .stat-card.warning { border-left-color: var(--warning); }
        .stat-card.danger { border-left-color: var(--danger); }
        .stat-card.info { border-left-color: var(--info); }

        .stat-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--brand-black);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--brand-gray);
            margin-top: 4px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
            min-height: 44px;
            min-width: 44px;
        }

        .btn svg {
            width: 18px;
            height: 18px;
        }

        .btn-primary {
            background: var(--brand-yellow);
            color: var(--brand-black);
        }

        .btn-primary:hover {
            background: var(--brand-yellow-dark);
        }

        .btn-secondary {
            background: var(--brand-light);
            color: var(--brand-black);
        }

        .btn-secondary:hover {
            background: #E5E7EB;
        }

        .btn-danger {
            background: var(--danger-light);
            color: var(--danger);
        }

        .btn-danger:hover {
            background: #FECACA;
        }

        .btn-success {
            background: var(--success);
            color: var(--brand-white);
        }

        .btn-block {
            width: 100%;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.8rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 6px;
            color: var(--brand-dark);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #E5E7EB;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s ease;
            min-height: 44px;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--brand-yellow);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        /* Customer List */
        .customer-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .customer-item {
            background: var(--brand-white);
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .customer-item:hover {
            border-color: var(--brand-yellow);
        }

        .customer-item-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .customer-name {
            font-weight: 700;
            font-size: 1rem;
            color: var(--brand-black);
        }

        .customer-address {
            font-size: 0.85rem;
            color: var(--brand-gray);
            margin-top: 4px;
        }

        .system-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .system-badge.aerobic {
            background: var(--aerobic-light);
            color: var(--aerobic);
        }

        .system-badge.conventional {
            background: var(--conventional-light);
            color: var(--conventional);
        }

        .customer-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--brand-light);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: var(--brand-gray);
        }

        .meta-item svg {
            width: 16px;
            height: 16px;
        }

        .meta-item.due-soon {
            color: var(--warning);
        }

        .meta-item.overdue {
            color: var(--danger);
        }

        .meta-item.ok {
            color: var(--success);
        }

        /* Pumping History */
        .pumping-log {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .pumping-entry {
            display: flex;
            gap: 16px;
            padding: 16px;
            background: var(--brand-light);
            border-radius: var(--radius-sm);
            position: relative;
        }

        .pumping-date {
            text-align: center;
            min-width: 60px;
        }

        .pumping-day {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--brand-black);
            line-height: 1;
        }

        .pumping-month {
            font-size: 0.75rem;
            color: var(--brand-gray);
            text-transform: uppercase;
            margin-top: 4px;
        }

        .pumping-details {
            flex: 1;
        }

        .pumping-title {
            font-weight: 600;
            color: var(--brand-black);
            margin-bottom: 4px;
        }

        .sludge-level {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            background: var(--brand-white);
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .sludge-level.high {
            background: var(--danger-light);
            color: var(--danger);
        }

        .sludge-level.medium {
            background: var(--warning-light);
            color: var(--warning);
        }

        .sludge-level.low {
            background: var(--success-light);
            color: var(--success);
        }

        .pumping-notes {
            font-size: 0.85rem;
            color: var(--brand-gray);
            margin-top: 8px;
        }

        /* Contract Badge */
        .contract-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .contract-badge.active {
            background: var(--success-light);
            color: var(--success);
        }

        .contract-badge.expiring {
            background: var(--warning-light);
            color: var(--warning);
        }

        .contract-badge.expired {
            background: var(--danger-light);
            color: var(--danger);
        }

        .contract-badge.none {
            background: var(--brand-light);
            color: var(--brand-gray);
        }

        /* TCEQ Compliance Section */
        .compliance-card {
            border-left: 4px solid var(--success);
        }

        .compliance-card.warning {
            border-left-color: var(--warning);
        }

        .compliance-card.danger {
            border-left-color: var(--danger);
        }

        .compliance-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .compliance-status svg {
            width: 20px;
            height: 20px;
        }

        .compliance-status.ok {
            color: var(--success);
        }

        .compliance-status.warning {
            color: var(--warning);
        }

        .compliance-status.danger {
            color: var(--danger);
        }

        /* Alerts List */
        .alerts-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .alert-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            background: var(--brand-white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border-left: 4px solid var(--warning);
        }

        .alert-item.danger {
            border-left-color: var(--danger);
        }

        .alert-item.info {
            border-left-color: var(--info);
        }

        .alert-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .alert-icon.warning {
            background: var(--warning-light);
            color: var(--warning);
        }

        .alert-icon.danger {
            background: var(--danger-light);
            color: var(--danger);
        }

        .alert-icon.info {
            background: var(--info-light);
            color: var(--info);
        }

        .alert-icon svg {
            width: 20px;
            height: 20px;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            color: var(--brand-black);
            margin-bottom: 4px;
        }

        .alert-description {
            font-size: 0.85rem;
            color: var(--brand-gray);
        }

        /* County List */
        .county-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        @media (min-width: 768px) {
            .county-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        .county-chip {
            padding: 10px 12px;
            background: var(--brand-light);
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            font-weight: 500;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .county-chip svg {
            width: 14px;
            height: 14px;
            stroke: var(--brand-yellow);
        }

        /* Bottom Tab Bar */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--brand-black);
            display: flex;
            justify-content: space-around;
            padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
            z-index: 1000;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
        }

        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            color: var(--brand-gray);
            cursor: pointer;
            transition: color 0.2s ease;
            min-width: 64px;
            min-height: 44px;
            border: none;
            background: none;
        }

        .tab-item svg {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
        }

        .tab-item span {
            font-size: 0.7rem;
            font-weight: 500;
        }

        .tab-item.active {
            color: var(--brand-yellow);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: flex-end;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--brand-white);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        @media (min-width: 768px) {
            .modal-overlay {
                align-items: center;
            }
            
            .modal {
                border-radius: var(--radius-lg);
                max-height: 85vh;
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid var(--brand-light);
            position: sticky;
            top: 0;
            background: var(--brand-white);
            z-index: 10;
        }

        .modal-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
        }

        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--brand-light);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close svg {
            width: 20px;
            height: 20px;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--brand-light);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Search Input */
        .search-container {
            position: relative;
            margin-bottom: 16px;
        }

        .search-input {
            width: 100%;
            padding: 12px 14px 12px 44px;
            border: 2px solid #E5E7EB;
            border-radius: var(--radius);
            font-size: 1rem;
            font-family: inherit;
            min-height: 48px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--brand-yellow);
        }

        .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            color: var(--brand-gray);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 48px 24px;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            stroke: var(--brand-gray);
            opacity: 0.5;
            margin-bottom: 16px;
        }

        .empty-state-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--brand-black);
            margin-bottom: 8px;
        }

        .empty-state-text {
            font-size: 0.9rem;
            color: var(--brand-gray);
            margin-bottom: 20px;
        }

        /* Service Report Print Styles */
        .service-report {
            display: none;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .header, .tab-bar, .modal-overlay {
                display: none !important;
            }
            
            .main-content {
                padding: 0;
            }
            
            .tab-content {
                display: none !important;
            }
            
            .service-report {
                display: block !important;
                padding: 20px;
            }
            
            .service-report-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                border-bottom: 3px solid var(--brand-black);
                padding-bottom: 16px;
                margin-bottom: 24px;
            }
            
            .service-report-logo {
                font-family: 'Space Grotesk', sans-serif;
                font-size: 1.5rem;
                font-weight: 700;
            }
            
            .service-report-title {
                font-size: 1.25rem;
                font-weight: 600;
            }
            
            .report-section {
                margin-bottom: 24px;
            }
            
            .report-section-title {
                font-weight: 700;
                font-size: 1rem;
                border-bottom: 1px solid #ccc;
                padding-bottom: 8px;
                margin-bottom: 12px;
            }
            
            .report-row {
                display: flex;
                margin-bottom: 8px;
            }
            
            .report-label {
                width: 150px;
                font-weight: 600;
                color: #666;
            }
            
            .report-value {
                flex: 1;
            }
            
            .report-footer {
                margin-top: 48px;
                padding-top: 16px;
                border-top: 1px solid #ccc;
                text-align: center;
                font-size: 0.85rem;
                color: #666;
            }
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .mt-2 { margin-top: 8px; }
        .mt-4 { margin-top: 16px; }
        .mb-2 { margin-bottom: 8px; }
        .mb-4 { margin-bottom: 16px; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .gap-4 { gap: 16px; }

        /* Responsive Adjustments */
        @media (min-width: 768px) {
            .main-content {
                padding: 24px;
            }
            
            .customer-list {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .customer-list {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    
/* === DEMO DISCLAIMER === */
#bct-demo-disclaimer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #f8f8f8;
  border-top: 1px solid #ddd;
  padding: 10px 16px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 12px;
  line-height: 1.4;
  color: #666;
  z-index: 99999;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 8px 16px;
  text-align: center;
}
#bct-demo-disclaimer p {
  margin: 0;
  max-width: 700px;
}
#bct-demo-disclaimer strong {
  color: #333;
  font-weight: 600;
}
#bct-demo-disclaimer a.bct-delete-btn {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: #dc3545;
  color: #fff;
  padding: 5px 12px;
  border-radius: 4px;
  text-decoration: none;
  font-size: 11px;
  font-weight: 500;
  white-space: nowrap;
  transition: background 0.15s;
}
#bct-demo-disclaimer a.bct-delete-btn:hover {
  background: #b02a37;
}
@media (max-width: 600px) {
  #bct-demo-disclaimer {
    flex-direction: column;
    padding: 8px 12px 12px;
    font-size: 11px;
  }
}
/* Add bottom padding to body so disclaimer doesn't cover content */
body { padding-bottom: 60px !important; }
</style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2v6m0 12v2m-7-10H2m20 0h-3M6.34 6.34L4.93 4.93m12.73 0l-1.41 1.41M6.34 17.66l-1.41 1.41m12.73 0l-1.41-1.41"/>
                        <circle cx="12" cy="12" r="4"/>
                    </svg>
                </div>
                <div class="logo-text">Septic<span>Track</span> Pro</div>
            </div>
            <div class="header-badge">T.E.R. Septic</div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Tab -->
        <div id="tab-dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-customers">0</div>
                    <div class="stat-label">Total Customers</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-value" id="stat-due-soon">0</div>
                    <div class="stat-label">Due This Month</div>
                </div>
                <div class="stat-card danger">
                    <div class="stat-value" id="stat-overdue">0</div>
                    <div class="stat-label">Overdue</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-value" id="stat-contracts">0</div>
                    <div class="stat-label">Active Contracts</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                            <line x1="12" y1="9" x2="12" y2="13"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                        Upcoming Alerts
                    </h2>
                </div>
                <div class="alerts-list" id="alerts-list">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                            <circle cx="12" cy="10" r="3"/>
                        </svg>
                        Service Area — 10 Counties
                    </h2>
                </div>
                <div class="county-grid">
                    <div class="county-chip"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/></svg> Montgomery</div>
                    <div class="county-chip"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/></svg> Harris</div>
                    <div class="county-chip"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/></svg> Waller</div>
                    <div class="county-chip"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/></svg> Liberty</div>
                    <div class="county-chip"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/></svg> Fort Bend</div>
                    <div class="county-chip"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/></svg> Austin</div>
                    <div class="county-chip"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/></svg> Walker</div>
                    <div class="county-chip"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/></svg> Grimes</div>
                    <div class="county-chip"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/></svg> Chambers</div>
                    <div class="county-chip"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/></svg> Brazoria</div>
                </div>
            </div>
        </div>

        <!-- Customers Tab -->
        <div id="tab-customers" class="tab-content">
            <div class="search-container">
                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"/>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                </svg>
                <input type="text" class="search-input" id="customer-search" placeholder="Search customers...">
            </div>

            <div class="flex items-center justify-between mb-4">
                <h2 class="card-title">Customers</h2>
                <button class="btn btn-primary" onclick="openAddCustomerModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Add Customer
                </button>
            </div>

            <div class="customer-list" id="customer-list">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Pumping Tab -->
        <div id="tab-pumping" class="tab-content">
            <div class="flex items-center justify-between mb-4">
                <h2 class="card-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <polyline points="10 9 9 9 8 9"/>
                    </svg>
                    Pumping Log
                </h2>
                <button class="btn btn-primary" onclick="openAddPumpingModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Log Pumping
                </button>
            </div>

            <div class="pumping-log" id="pumping-log">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Contracts Tab -->
        <div id="tab-contracts" class="tab-content">
            <div class="flex items-center justify-between mb-4">
                <h2 class="card-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                    Maintenance Contracts
                </h2>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">TCEQ Compliance Status</span>
                </div>
                <p style="font-size: 0.9rem; color: var(--brand-gray); margin-bottom: 16px;">
                    Texas law requires aerobic system owners to maintain active maintenance contracts. Track compliance status below.
                </p>
                <div id="contracts-list">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="tab-reports" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        Generate Service Report
                    </h2>
                </div>
                <div class="form-group">
                    <label class="form-label">Select Customer</label>
                    <select class="form-select" id="report-customer">
                        <option value="">Choose a customer...</option>
                    </select>
                </div>
                <button class="btn btn-primary btn-block" onclick="generateReport()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 6 2 18 2 18 9"/>
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                        <rect x="6" y="14" width="12" height="8"/>
                    </svg>
                    Generate & Print Report
                </button>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        Quick Stats
                    </h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-aerobic">0</div>
                        <div class="stat-label">Aerobic Systems</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-conventional">0</div>
                        <div class="stat-label">Conventional</div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Data Backup
                    </h2>
                </div>
                <p style="font-size: 0.9rem; color: var(--brand-gray); margin-bottom: 16px;">
                    Export your data for backup or transfer to another device. Import to restore from a previous backup.
                </p>
                <div style="display: flex; gap: 12px;">
                    <button class="btn btn-secondary btn-block" onclick="exportData()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Export Data
                    </button>
                    <button class="btn btn-secondary btn-block" onclick="document.getElementById('import-file').click()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Import Data
                    </button>
                </div>
                <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importData(this)">
                <button class="btn btn-danger btn-block mt-4" onclick="clearAllData()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                    Clear All Data
                </button>
            </div>
        </div>
    </main>

    <!-- Service Report (Print Only) -->
    <div class="service-report" id="service-report">
        <div class="service-report-header">
            <div class="service-report-logo">T.E.R. Septic Site & Utilities LLC</div>
            <div class="service-report-title">Service History Report</div>
        </div>
        <div id="report-content"></div>
        <div class="report-footer">
            T.E.R. Septic Site & Utilities LLC | 22039 Lutheran Church Road, Tomball, TX 77377 | (281) 516-9530 | info@terseptic.com<br>
            TCEQ Licensed — OSSF Class II Installer | "Your Doody Is Our Duty"
        </div>
    </div>

    <!-- Bottom Tab Bar -->
    <nav class="tab-bar">
        <button class="tab-item active" data-tab="dashboard">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
            <span>Dashboard</span>
        </button>
        <button class="tab-item" data-tab="customers">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            <span>Customers</span>
        </button>
        <button class="tab-item" data-tab="pumping">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2v6m0 12v2"/>
                <path d="M4.93 10.93l1.41 1.41"/>
                <path d="M17.66 10.93l-1.41 1.41"/>
                <path d="M2 18h2"/>
                <path d="M20 18h2"/>
                <path d="M8 18a4 4 0 0 1 8 0"/>
                <path d="M12 14v-2"/>
            </svg>
            <span>Pumping</span>
        </button>
        <button class="tab-item" data-tab="contracts">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <path d="M9 15l2 2 4-4"/>
            </svg>
            <span>Contracts</span>
        </button>
        <button class="tab-item" data-tab="reports">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
            </svg>
            <span>Reports</span>
        </button>
    </nav>

    <!-- Add Customer Modal -->
    <div class="modal-overlay" id="add-customer-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Add Customer</h3>
                <button class="modal-close" onclick="closeModal('add-customer-modal')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Customer Name *</label>
                    <input type="text" class="form-input" id="customer-name" placeholder="John Smith">
                </div>
                <div class="form-group">
                    <label class="form-label">Phone</label>
                    <input type="tel" class="form-input" id="customer-phone" placeholder="(281) 555-1234">
                </div>
                <div class="form-group">
                    <label class="form-label">Address *</label>
                    <input type="text" class="form-input" id="customer-address" placeholder="123 Main St, Tomball, TX 77377">
                </div>
                <div class="form-group">
                    <label class="form-label">County *</label>
                    <select class="form-select" id="customer-county">
                        <option value="Montgomery">Montgomery County</option>
                        <option value="Harris">Harris County</option>
                        <option value="Waller">Waller County</option>
                        <option value="Liberty">Liberty County</option>
                        <option value="Fort Bend">Fort Bend County</option>
                        <option value="Austin">Austin County</option>
                        <option value="Walker">Walker County</option>
                        <option value="Grimes">Grimes County</option>
                        <option value="Chambers">Chambers County</option>
                        <option value="Brazoria">Brazoria County</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">System Type *</label>
                        <select class="form-select" id="customer-system-type">
                            <option value="aerobic">Aerobic</option>
                            <option value="conventional">Conventional</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tank Size (gal)</label>
                        <input type="number" class="form-input" id="customer-tank-size" placeholder="1000">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Install Date</label>
                    <input type="date" class="form-input" id="customer-install-date">
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="customer-notes" placeholder="Special access instructions, gate codes, etc."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('add-customer-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveCustomer()">Save Customer</button>
            </div>
        </div>
    </div>

    <!-- Add Pumping Modal -->
    <div class="modal-overlay" id="add-pumping-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Log Pumping Service</h3>
                <button class="modal-close" onclick="closeModal('add-pumping-modal')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Customer *</label>
                    <select class="form-select" id="pumping-customer">
                        <option value="">Select customer...</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Service Date *</label>
                        <input type="date" class="form-input" id="pumping-date">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sludge Level (%)</label>
                        <input type="number" class="form-input" id="pumping-sludge" placeholder="30" min="0" max="100">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Service Type</label>
                    <select class="form-select" id="pumping-type">
                        <option value="pumping">Full Pumping</option>
                        <option value="inspection">Inspection Only</option>
                        <option value="maintenance">Aerobic Maintenance</option>
                        <option value="jetting">Jetting/Cleaning</option>
                        <option value="repair">Repair</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="pumping-notes" placeholder="Condition of system, recommendations, parts replaced..."></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Next Service Due</label>
                        <input type="date" class="form-input" id="pumping-next-due">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Chlorine Added?</label>
                        <select class="form-select" id="pumping-chlorine">
                            <option value="no">No</option>
                            <option value="yes">Yes - Tablets Added</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('add-pumping-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="savePumping()">Save Service</button>
            </div>
        </div>
    </div>

    <!-- View Customer Modal -->
    <div class="modal-overlay" id="view-customer-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="view-customer-title">Customer Details</h3>
                <button class="modal-close" onclick="closeModal('view-customer-modal')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="view-customer-content">
                <!-- Populated by JS -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger btn-sm" id="delete-customer-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                    Delete
                </button>
                <button class="btn btn-secondary" onclick="closeModal('view-customer-modal')">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Security Layer
        function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
        const _V=-1177407372;
        const _k=new URLSearchParams(window.location.search).get('key');
        if(!_k||_h(_k)!==_V){
          document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;background:#111;color:#fff;text-align:center;padding:20px"><div><h1 style="font-size:2rem;margin-bottom:1rem">Access Denied</h1><p style="color:#999">This tool requires a valid access key.</p><p style="margin-top:1rem"><a href="mailto:ben@bennycutools.com" style="color:#4da6ff">ben@bennycutools.com</a></p></div></div>';
          throw new Error('Invalid key');
        }
        document.addEventListener('contextmenu',e=>e.preventDefault());
        document.addEventListener('keydown',e=>{
          if(e.key==='F12'||(e.ctrlKey&&e.shiftKey&&e.key==='I')||(e.ctrlKey&&e.key==='u')){
            e.preventDefault();
          }
        });

        // Database Layer with IndexedDB + localStorage fallback
        const DB_NAME = 'SepticTrackPro';
        const DB_VERSION = 1;
        let db = null;
        let useIndexedDB = true;

        // Initialize database
        async function initDB() {
            return new Promise((resolve, reject) => {
                if (!window.indexedDB) {
                    console.log('IndexedDB not supported, using localStorage');
                    useIndexedDB = false;
                    loadFromLocalStorage();
                    resolve();
                    return;
                }

                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = () => {
                    console.log('IndexedDB error, falling back to localStorage');
                    useIndexedDB = false;
                    loadFromLocalStorage();
                    resolve();
                };

                request.onsuccess = (event) => {
                    db = event.target.result;
                    loadData().then(resolve);
                };

                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    
                    if (!db.objectStoreNames.contains('customers')) {
                        const customerStore = db.createObjectStore('customers', { keyPath: 'id' });
                        customerStore.createIndex('name', 'name', { unique: false });
                    }
                    
                    if (!db.objectStoreNames.contains('pumpings')) {
                        const pumpingStore = db.createObjectStore('pumpings', { keyPath: 'id' });
                        pumpingStore.createIndex('customerId', 'customerId', { unique: false });
                        pumpingStore.createIndex('date', 'date', { unique: false });
                    }
                    
                    if (!db.objectStoreNames.contains('contracts')) {
                        const contractStore = db.createObjectStore('contracts', { keyPath: 'id' });
                        contractStore.createIndex('customerId', 'customerId', { unique: false });
                    }
                };
            });
        }

        // Data stores
        let customers = [];
        let pumpings = [];
        let contracts = [];

        // Load data from IndexedDB
        async function loadData() {
            if (!useIndexedDB) return;

            customers = await getAllFromStore('customers');
            pumpings = await getAllFromStore('pumpings');
            contracts = await getAllFromStore('contracts');

            // Load demo data if empty
            if (customers.length === 0) {
                await loadDemoData();
            }
        }

        function getAllFromStore(storeName) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => resolve([]);
            });
        }

        function saveToStore(storeName, data) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.put(data);
                request.onsuccess = () => {
                    saveToLocalStorage();
                    resolve();
                };
                request.onerror = () => reject(request.error);
            });
        }

        function deleteFromStore(storeName, id) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.delete(id);
                request.onsuccess = () => {
                    saveToLocalStorage();
                    resolve();
                };
                request.onerror = () => reject(request.error);
            });
        }

        // localStorage fallback
        function saveToLocalStorage() {
            localStorage.setItem('septictrack_customers', JSON.stringify(customers));
            localStorage.setItem('septictrack_pumpings', JSON.stringify(pumpings));
            localStorage.setItem('septictrack_contracts', JSON.stringify(contracts));
        }

        function loadFromLocalStorage() {
            customers = JSON.parse(localStorage.getItem('septictrack_customers') || '[]');
            pumpings = JSON.parse(localStorage.getItem('septictrack_pumpings') || '[]');
            contracts = JSON.parse(localStorage.getItem('septictrack_contracts') || '[]');
            
            if (customers.length === 0) {
                loadDemoData();
            }
        }

        // Demo Data - Tomball/Houston Area
        async function loadDemoData() {
            const demoCustomers = [
                {
                    id: 'c1',
                    name: 'Johnson Family',
                    phone: '(281) 555-0142',
                    address: '15823 Cypress North Houston Rd, Cypress, TX 77429',
                    county: 'Harris',
                    systemType: 'aerobic',
                    tankSize: 1500,
                    installDate: '2018-06-15',
                    notes: 'Gate code: 1234. Large dogs in backyard.',
                    contractStatus: 'active',
                    contractExpiry: '2026-06-15',
                    nextDue: '2026-03-15'
                },
                {
                    id: 'c2',
                    name: 'Williams Residence',
                    phone: '(936) 555-0198',
                    address: '28412 Magnolia Shadow Lane, Magnolia, TX 77355',
                    county: 'Montgomery',
                    systemType: 'conventional',
                    tankSize: 1000,
                    installDate: '2015-03-22',
                    notes: 'Access from back alley. Elderly couple.',
                    contractStatus: 'none',
                    nextDue: '2026-02-01'
                },
                {
                    id: 'c3',
                    name: 'Thompson Ranch',
                    phone: '(281) 555-0267',
                    address: '8901 Becker Road, Tomball, TX 77375',
                    county: 'Harris',
                    systemType: 'aerobic',
                    tankSize: 2000,
                    installDate: '2020-11-08',
                    notes: 'Large property with multiple buildings. Main house system.',
                    contractStatus: 'active',
                    contractExpiry: '2026-11-08',
                    nextDue: '2026-05-08'
                },
                {
                    id: 'c4',
                    name: 'Garcia Homestead',
                    phone: '(979) 555-0334',
                    address: '4521 FM 362, Waller, TX 77484',
                    county: 'Waller',
                    systemType: 'conventional',
                    tankSize: 1500,
                    installDate: '2012-08-30',
                    notes: 'Long gravel driveway. Call before arrival.',
                    contractStatus: 'none',
                    nextDue: '2024-08-30'
                },
                {
                    id: 'c5',
                    name: 'Miller Estate',
                    phone: '(281) 555-0401',
                    address: '19234 Spring Creek Ln, Spring, TX 77379',
                    county: 'Harris',
                    systemType: 'aerobic',
                    tankSize: 1500,
                    installDate: '2019-04-12',
                    notes: 'HOA requires 48-hour notice for service trucks.',
                    contractStatus: 'expiring',
                    contractExpiry: '2026-03-01',
                    nextDue: '2026-04-12'
                },
                {
                    id: 'c6',
                    name: 'Davis Property',
                    phone: '(936) 555-0478',
                    address: '6723 Honea Egypt Rd, Montgomery, TX 77316',
                    county: 'Montgomery',
                    systemType: 'aerobic',
                    tankSize: 1000,
                    installDate: '2021-02-28',
                    notes: 'Vacation home - may be unoccupied.',
                    contractStatus: 'active',
                    contractExpiry: '2027-02-28',
                    nextDue: '2026-08-28'
                },
                {
                    id: 'c7',
                    name: 'Rodriguez Farm',
                    phone: '(281) 555-0545',
                    address: '3456 Decker Prairie Rd, Pinehurst, TX 77362',
                    county: 'Waller',
                    systemType: 'conventional',
                    tankSize: 2500,
                    installDate: '2008-10-15',
                    notes: 'Commercial property - restaurant. Heavy usage.',
                    contractStatus: 'none',
                    nextDue: '2025-10-15'
                },
                {
                    id: 'c8',
                    name: 'Anderson Home',
                    phone: '(281) 555-0612',
                    address: '22156 Lutheran Church Rd, Tomball, TX 77377',
                    county: 'Harris',
                    systemType: 'aerobic',
                    tankSize: 1500,
                    installDate: '2017-07-04',
                    notes: 'Neighbor of office. Quick response priority.',
                    contractStatus: 'active',
                    contractExpiry: '2026-07-04',
                    nextDue: '2026-01-04'
                },
                {
                    id: 'c9',
                    name: 'Parker Residence',
                    phone: '(936) 555-0689',
                    address: '11890 FM 2978, Willis, TX 77378',
                    county: 'Montgomery',
                    systemType: 'conventional',
                    tankSize: 1000,
                    installDate: '2014-05-20',
                    notes: 'Mobile home on large lot.',
                    contractStatus: 'none',
                    nextDue: '2026-05-20'
                },
                {
                    id: 'c10',
                    name: 'Lee Family',
                    phone: '(281) 555-0756',
                    address: '5678 Stuebner Airline Rd, Klein, TX 77379',
                    county: 'Harris',
                    systemType: 'aerobic',
                    tankSize: 1500,
                    installDate: '2022-09-10',
                    notes: 'New construction. First maintenance due.',
                    contractStatus: 'active',
                    contractExpiry: '2027-09-10',
                    nextDue: '2026-03-10'
                }
            ];

            const demoPumpings = [
                { id: 'p1', customerId: 'c1', date: '2025-09-15', sludgeLevel: 35, type: 'pumping', notes: 'Normal pumping. System in good condition. Replaced aerator filter.', chlorine: 'yes' },
                { id: 'p2', customerId: 'c1', date: '2025-03-15', sludgeLevel: 20, type: 'maintenance', notes: 'Quarterly maintenance. Chlorine tablets added.', chlorine: 'yes' },
                { id: 'p3', customerId: 'c2', date: '2023-02-01', sludgeLevel: 45, type: 'pumping', notes: 'Tank was quite full. Recommend 3-year interval.', chlorine: 'no' },
                { id: 'p4', customerId: 'c3', date: '2025-11-08', sludgeLevel: 28, type: 'pumping', notes: 'Annual pumping per contract. All systems functioning well.', chlorine: 'yes' },
                { id: 'p5', customerId: 'c4', date: '2021-08-30', sludgeLevel: 55, type: 'pumping', notes: 'Overdue service. Heavy sludge buildup. Discussed maintenance plan.', chlorine: 'no' },
                { id: 'p6', customerId: 'c5', date: '2025-10-12', sludgeLevel: 30, type: 'maintenance', notes: 'Routine maintenance. Aerator running efficiently.', chlorine: 'yes' },
                { id: 'p7', customerId: 'c6', date: '2025-08-28', sludgeLevel: 25, type: 'maintenance', notes: 'Vacation home - low usage. System healthy.', chlorine: 'yes' },
                { id: 'p8', customerId: 'c7', date: '2023-10-15', sludgeLevel: 60, type: 'pumping', notes: 'Restaurant high usage. Recommend semi-annual pumping.', chlorine: 'no' },
                { id: 'p9', customerId: 'c8', date: '2025-07-04', sludgeLevel: 32, type: 'pumping', notes: 'Annual service. Fixed minor leak in outlet baffle.', chlorine: 'yes' },
                { id: 'p10', customerId: 'c10', date: '2025-09-10', sludgeLevel: 15, type: 'inspection', notes: 'First-year inspection. System operating perfectly.', chlorine: 'yes' }
            ];

            customers = demoCustomers;
            pumpings = demoPumpings;
            contracts = [];

            // Create contracts for aerobic systems
            customers.filter(c => c.systemType === 'aerobic' && c.contractStatus !== 'none').forEach(c => {
                contracts.push({
                    id: 'contract_' + c.id,
                    customerId: c.id,
                    startDate: c.installDate,
                    expiryDate: c.contractExpiry,
                    status: c.contractStatus,
                    frequency: 'quarterly',
                    notes: 'TCEQ-required aerobic system maintenance contract'
                });
            });

            if (useIndexedDB && db) {
                for (const c of customers) await saveToStore('customers', c);
                for (const p of pumpings) await saveToStore('pumpings', p);
                for (const ct of contracts) await saveToStore('contracts', ct);
            } else {
                saveToLocalStorage();
            }
        }

        // Generate unique ID
        function generateId() {
            return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Tab Navigation
        function setupTabs() {
            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    
                    // Update active tab
                    document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show corresponding content
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    document.getElementById('tab-' + tabId).classList.add('active');
                    
                    // Refresh content if needed
                    if (tabId === 'customers') renderCustomerList();
                    if (tabId === 'pumping') renderPumpingLog();
                    if (tabId === 'contracts') renderContracts();
                    if (tabId === 'reports') updateReportDropdown();
                });
            });
        }

        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            document.body.style.overflow = '';
        }

        function openAddCustomerModal() {
            // Reset form
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-phone').value = '';
            document.getElementById('customer-address').value = '';
            document.getElementById('customer-county').value = 'Montgomery';
            document.getElementById('customer-system-type').value = 'aerobic';
            document.getElementById('customer-tank-size').value = '';
            document.getElementById('customer-install-date').value = '';
            document.getElementById('customer-notes').value = '';
            openModal('add-customer-modal');
        }

        function openAddPumpingModal() {
            // Update customer dropdown
            const select = document.getElementById('pumping-customer');
            select.innerHTML = '<option value="">Select customer...</option>';
            customers.forEach(c => {
                select.innerHTML += `<option value="${c.id}">${c.name} - ${c.address.split(',')[0]}</option>`;
            });
            
            // Set default date to today
            document.getElementById('pumping-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('pumping-sludge').value = '';
            document.getElementById('pumping-type').value = 'pumping';
            document.getElementById('pumping-notes').value = '';
            document.getElementById('pumping-next-due').value = '';
            document.getElementById('pumping-chlorine').value = 'no';
            
            openModal('add-pumping-modal');
        }

        // Save Customer
        async function saveCustomer() {
            const name = document.getElementById('customer-name').value.trim();
            const address = document.getElementById('customer-address').value.trim();
            const county = document.getElementById('customer-county').value;

            if (!name || !address) {
                alert('Please fill in required fields (Name and Address)');
                return;
            }

            const customer = {
                id: generateId(),
                name: name,
                phone: document.getElementById('customer-phone').value.trim(),
                address: address,
                county: county,
                systemType: document.getElementById('customer-system-type').value,
                tankSize: parseInt(document.getElementById('customer-tank-size').value) || 1000,
                installDate: document.getElementById('customer-install-date').value,
                notes: document.getElementById('customer-notes').value.trim(),
                contractStatus: document.getElementById('customer-system-type').value === 'aerobic' ? 'none' : 'none',
                nextDue: calculateNextDue(new Date())
            };

            customers.push(customer);

            if (useIndexedDB && db) {
                await saveToStore('customers', customer);
            } else {
                saveToLocalStorage();
            }

            closeModal('add-customer-modal');
            renderCustomerList();
            updateStats();
        }

        // Calculate next due date (3 years for conventional, 3 months for aerobic maintenance)
        function calculateNextDue(fromDate, type = 'pumping') {
            const date = new Date(fromDate);
            if (type === 'pumping') {
                date.setFullYear(date.getFullYear() + 3);
            } else {
                date.setMonth(date.getMonth() + 3);
            }
            return date.toISOString().split('T')[0];
        }

        // Save Pumping
        async function savePumping() {
            const customerId = document.getElementById('pumping-customer').value;
            const date = document.getElementById('pumping-date').value;

            if (!customerId || !date) {
                alert('Please select a customer and date');
                return;
            }

            const pumping = {
                id: generateId(),
                customerId: customerId,
                date: date,
                sludgeLevel: parseInt(document.getElementById('pumping-sludge').value) || null,
                type: document.getElementById('pumping-type').value,
                notes: document.getElementById('pumping-notes').value.trim(),
                chlorine: document.getElementById('pumping-chlorine').value
            };

            pumpings.push(pumping);

            // Update customer's next due date
            const nextDue = document.getElementById('pumping-next-due').value;
            const customer = customers.find(c => c.id === customerId);
            if (customer && nextDue) {
                customer.nextDue = nextDue;
                if (useIndexedDB && db) {
                    await saveToStore('customers', customer);
                }
            }

            if (useIndexedDB && db) {
                await saveToStore('pumpings', pumping);
            } else {
                saveToLocalStorage();
            }

            closeModal('add-pumping-modal');
            renderPumpingLog();
            updateStats();
            renderAlerts();
        }

        // View Customer Details
        function viewCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;

            const customerPumpings = pumpings
                .filter(p => p.customerId === customerId)
                .sort((a, b) => new Date(b.date) - new Date(a.date));

            document.getElementById('view-customer-title').textContent = customer.name;
            
            const dueStatus = getDueStatus(customer.nextDue);
            
            let html = `
                <div style="margin-bottom: 20px;">
                    <span class="system-badge ${customer.systemType}">${customer.systemType}</span>
                    ${customer.contractStatus !== 'none' ? `<span class="contract-badge ${customer.contractStatus}" style="margin-left: 8px;">${customer.contractStatus} contract</span>` : ''}
                </div>
                
                <div style="background: var(--brand-light); padding: 16px; border-radius: var(--radius-sm); margin-bottom: 16px;">
                    <div style="display: flex; gap: 8px; align-items: flex-start; margin-bottom: 12px;">
                        <svg style="width: 18px; height: 18px; flex-shrink: 0; margin-top: 2px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                            <circle cx="12" cy="10" r="3"/>
                        </svg>
                        <div>
                            <div style="font-weight: 600;">${customer.address}</div>
                            <div style="font-size: 0.85rem; color: var(--brand-gray);">${customer.county} County</div>
                        </div>
                    </div>
                    ${customer.phone ? `
                    <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 12px;">
                        <svg style="width: 18px; height: 18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                        </svg>
                        <a href="tel:${customer.phone}" style="color: var(--brand-black);">${customer.phone}</a>
                    </div>
                    ` : ''}
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <svg style="width: 18px; height: 18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        <div>
                            <span>Next Due: </span>
                            <span class="meta-item ${dueStatus.class}" style="display: inline;">${formatDate(customer.nextDue)}</span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 16px;">
                    <div style="font-weight: 600; margin-bottom: 8px;">System Details</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.9rem;">
                        <div><span style="color: var(--brand-gray);">Tank Size:</span> ${customer.tankSize} gal</div>
                        <div><span style="color: var(--brand-gray);">Installed:</span> ${customer.installDate ? formatDate(customer.installDate) : 'Unknown'}</div>
                    </div>
                </div>
                
                ${customer.notes ? `
                <div style="margin-bottom: 16px;">
                    <div style="font-weight: 600; margin-bottom: 8px;">Notes</div>
                    <div style="background: var(--warning-light); padding: 12px; border-radius: var(--radius-sm); font-size: 0.9rem;">${customer.notes}</div>
                </div>
                ` : ''}
                
                <div>
                    <div style="font-weight: 600; margin-bottom: 12px;">Service History (${customerPumpings.length})</div>
                    ${customerPumpings.length > 0 ? customerPumpings.slice(0, 5).map(p => `
                        <div class="pumping-entry">
                            <div class="pumping-date">
                                <div class="pumping-day">${new Date(p.date).getDate()}</div>
                                <div class="pumping-month">${new Date(p.date).toLocaleString('en-US', { month: 'short', year: '2-digit' })}</div>
                            </div>
                            <div class="pumping-details">
                                <div class="pumping-title">${formatServiceType(p.type)}</div>
                                ${p.sludgeLevel ? `<span class="sludge-level ${getSludgeClass(p.sludgeLevel)}">${p.sludgeLevel}% sludge</span>` : ''}
                                ${p.notes ? `<div class="pumping-notes">${p.notes}</div>` : ''}
                            </div>
                        </div>
                    `).join('') : '<div style="text-align: center; color: var(--brand-gray); padding: 20px;">No service history yet</div>'}
                </div>
            `;

            document.getElementById('view-customer-content').innerHTML = html;
            
            // Setup delete button
            document.getElementById('delete-customer-btn').onclick = () => deleteCustomer(customerId);
            
            openModal('view-customer-modal');
        }

        // Delete Customer
        async function deleteCustomer(customerId) {
            if (!confirm('Are you sure you want to delete this customer and all their service history?')) return;

            customers = customers.filter(c => c.id !== customerId);
            pumpings = pumpings.filter(p => p.customerId !== customerId);
            contracts = contracts.filter(c => c.customerId !== customerId);

            if (useIndexedDB && db) {
                await deleteFromStore('customers', customerId);
                // Also delete related pumpings and contracts
                const relatedPumpings = pumpings.filter(p => p.customerId === customerId);
                for (const p of relatedPumpings) {
                    await deleteFromStore('pumpings', p.id);
                }
            }
            saveToLocalStorage();

            closeModal('view-customer-modal');
            renderCustomerList();
            updateStats();
            renderAlerts();
        }

        // Render Customer List
        function renderCustomerList(searchTerm = '') {
            const container = document.getElementById('customer-list');
            const filtered = customers.filter(c => 
                c.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                c.address.toLowerCase().includes(searchTerm.toLowerCase())
            );

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        <div class="empty-state-title">No customers found</div>
                        <div class="empty-state-text">${searchTerm ? 'Try adjusting your search' : 'Add your first customer to get started'}</div>
                        ${!searchTerm ? '<button class="btn btn-primary" onclick="openAddCustomerModal()">Add Customer</button>' : ''}
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(c => {
                const dueStatus = getDueStatus(c.nextDue);
                return `
                    <div class="customer-item" onclick="viewCustomer('${c.id}')">
                        <div class="customer-item-header">
                            <div>
                                <div class="customer-name">${c.name}</div>
                                <div class="customer-address">${c.address}</div>
                            </div>
                            <span class="system-badge ${c.systemType}">${c.systemType}</span>
                        </div>
                        <div class="customer-meta">
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                    <circle cx="12" cy="10" r="3"/>
                                </svg>
                                ${c.county}
                            </div>
                            <div class="meta-item ${dueStatus.class}">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12 6 12 12 16 14"/>
                                </svg>
                                ${dueStatus.text}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render Pumping Log
        function renderPumpingLog() {
            const container = document.getElementById('pumping-log');
            const sortedPumpings = [...pumpings].sort((a, b) => new Date(b.date) - new Date(a.date));

            if (sortedPumpings.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        <div class="empty-state-title">No pumping records yet</div>
                        <div class="empty-state-text">Log your first service to start tracking</div>
                        <button class="btn btn-primary" onclick="openAddPumpingModal()">Log Pumping</button>
                    </div>
                `;
                return;
            }

            container.innerHTML = sortedPumpings.map(p => {
                const customer = customers.find(c => c.id === p.customerId);
                const date = new Date(p.date);
                return `
                    <div class="pumping-entry">
                        <div class="pumping-date">
                            <div class="pumping-day">${date.getDate()}</div>
                            <div class="pumping-month">${date.toLocaleString('en-US', { month: 'short', year: '2-digit' })}</div>
                        </div>
                        <div class="pumping-details">
                            <div class="pumping-title">${customer ? customer.name : 'Unknown Customer'}</div>
                            <div style="font-size: 0.85rem; color: var(--brand-gray); margin-bottom: 6px;">${formatServiceType(p.type)}</div>
                            ${p.sludgeLevel ? `<span class="sludge-level ${getSludgeClass(p.sludgeLevel)}">${p.sludgeLevel}% sludge</span>` : ''}
                            ${p.chlorine === 'yes' ? `<span class="sludge-level" style="background: var(--info-light); color: var(--info); margin-left: 6px;">Chlorine Added</span>` : ''}
                            ${p.notes ? `<div class="pumping-notes">${p.notes}</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render Contracts
        function renderContracts() {
            const container = document.getElementById('contracts-list');
            const aerobicCustomers = customers.filter(c => c.systemType === 'aerobic');

            if (aerobicCustomers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: var(--brand-gray); padding: 20px;">
                        No aerobic systems in database
                    </div>
                `;
                return;
            }

            container.innerHTML = aerobicCustomers.map(c => {
                const contract = contracts.find(ct => ct.customerId === c.id);
                const status = c.contractStatus || 'none';
                let statusClass = 'none';
                let statusIcon = '';
                
                if (status === 'active') {
                    statusClass = 'ok';
                    statusIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`;
                } else if (status === 'expiring') {
                    statusClass = 'warning';
                    statusIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>`;
                } else if (status === 'expired') {
                    statusClass = 'danger';
                    statusIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>`;
                } else {
                    statusIcon = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>`;
                }

                return `
                    <div class="card compliance-card ${statusClass}" style="margin-bottom: 12px; padding: 14px;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <div style="font-weight: 600;">${c.name}</div>
                                <div style="font-size: 0.85rem; color: var(--brand-gray);">${c.address.split(',')[0]}</div>
                            </div>
                            <div class="compliance-status ${statusClass}">
                                ${statusIcon}
                                ${status === 'none' ? 'No Contract' : status.charAt(0).toUpperCase() + status.slice(1)}
                            </div>
                        </div>
                        ${c.contractExpiry ? `<div style="font-size: 0.8rem; color: var(--brand-gray); margin-top: 8px;">Expires: ${formatDate(c.contractExpiry)}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Render Alerts
        function renderAlerts() {
            const container = document.getElementById('alerts-list');
            const today = new Date();
            const alerts = [];

            // Check for overdue customers
            customers.forEach(c => {
                if (!c.nextDue) return;
                const dueDate = new Date(c.nextDue);
                const daysUntil = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));

                if (daysUntil < 0) {
                    alerts.push({
                        type: 'danger',
                        title: `${c.name} - Overdue`,
                        description: `Service was due ${formatDate(c.nextDue)}. ${Math.abs(daysUntil)} days overdue.`,
                        priority: 0
                    });
                } else if (daysUntil <= 30) {
                    alerts.push({
                        type: 'warning',
                        title: `${c.name} - Due Soon`,
                        description: `Service due ${formatDate(c.nextDue)}. ${daysUntil} days remaining.`,
                        priority: 1
                    });
                }
            });

            // Check for expiring contracts
            customers.filter(c => c.systemType === 'aerobic' && c.contractExpiry).forEach(c => {
                const expiryDate = new Date(c.contractExpiry);
                const daysUntil = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));

                if (daysUntil <= 30 && daysUntil > 0) {
                    alerts.push({
                        type: 'info',
                        title: `${c.name} - Contract Expiring`,
                        description: `TCEQ maintenance contract expires ${formatDate(c.contractExpiry)}.`,
                        priority: 2
                    });
                }
            });

            // Sort by priority
            alerts.sort((a, b) => a.priority - b.priority);

            if (alerts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: var(--brand-gray); padding: 24px;">
                        <svg style="width: 48px; height: 48px; margin-bottom: 8px; opacity: 0.5;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        <div style="font-weight: 600;">All Clear!</div>
                        <div style="font-size: 0.9rem;">No upcoming alerts or overdue services</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = alerts.slice(0, 5).map(a => `
                <div class="alert-item ${a.type}">
                    <div class="alert-icon ${a.type}">
                        ${a.type === 'danger' ? `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>` : ''}
                        ${a.type === 'warning' ? `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>` : ''}
                        ${a.type === 'info' ? `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>` : ''}
                    </div>
                    <div class="alert-content">
                        <div class="alert-title">${a.title}</div>
                        <div class="alert-description">${a.description}</div>
                    </div>
                </div>
            `).join('');
        }

        // Update Stats
        function updateStats() {
            const today = new Date();
            const thisMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            let dueSoon = 0;
            let overdue = 0;
            let activeContracts = 0;

            customers.forEach(c => {
                if (c.nextDue) {
                    const dueDate = new Date(c.nextDue);
                    if (dueDate < today) overdue++;
                    else if (dueDate <= thisMonth) dueSoon++;
                }
                if (c.contractStatus === 'active') activeContracts++;
            });

            document.getElementById('stat-customers').textContent = customers.length;
            document.getElementById('stat-due-soon').textContent = dueSoon;
            document.getElementById('stat-overdue').textContent = overdue;
            document.getElementById('stat-contracts').textContent = activeContracts;

            // Update reports stats
            document.getElementById('stat-aerobic').textContent = customers.filter(c => c.systemType === 'aerobic').length;
            document.getElementById('stat-conventional').textContent = customers.filter(c => c.systemType === 'conventional').length;
        }

        // Update Report Dropdown
        function updateReportDropdown() {
            const select = document.getElementById('report-customer');
            select.innerHTML = '<option value="">Choose a customer...</option>';
            customers.forEach(c => {
                select.innerHTML += `<option value="${c.id}">${c.name} - ${c.address.split(',')[0]}</option>`;
            });
        }

        // Generate Report
        function generateReport() {
            const customerId = document.getElementById('report-customer').value;
            if (!customerId) {
                alert('Please select a customer');
                return;
            }

            const customer = customers.find(c => c.id === customerId);
            const customerPumpings = pumpings
                .filter(p => p.customerId === customerId)
                .sort((a, b) => new Date(b.date) - new Date(a.date));

            const reportContent = `
                <div class="report-section">
                    <div class="report-section-title">Customer Information</div>
                    <div class="report-row"><span class="report-label">Name:</span><span class="report-value">${customer.name}</span></div>
                    <div class="report-row"><span class="report-label">Address:</span><span class="report-value">${customer.address}</span></div>
                    <div class="report-row"><span class="report-label">Phone:</span><span class="report-value">${customer.phone || 'Not on file'}</span></div>
                    <div class="report-row"><span class="report-label">County:</span><span class="report-value">${customer.county} County</span></div>
                </div>
                
                <div class="report-section">
                    <div class="report-section-title">System Information</div>
                    <div class="report-row"><span class="report-label">System Type:</span><span class="report-value">${customer.systemType.charAt(0).toUpperCase() + customer.systemType.slice(1)}</span></div>
                    <div class="report-row"><span class="report-label">Tank Size:</span><span class="report-value">${customer.tankSize} gallons</span></div>
                    <div class="report-row"><span class="report-label">Install Date:</span><span class="report-value">${customer.installDate ? formatDate(customer.installDate) : 'Unknown'}</span></div>
                    <div class="report-row"><span class="report-label">Next Service Due:</span><span class="report-value">${customer.nextDue ? formatDate(customer.nextDue) : 'Not scheduled'}</span></div>
                    ${customer.systemType === 'aerobic' ? `<div class="report-row"><span class="report-label">Contract Status:</span><span class="report-value">${customer.contractStatus ? customer.contractStatus.charAt(0).toUpperCase() + customer.contractStatus.slice(1) : 'None'}</span></div>` : ''}
                </div>
                
                <div class="report-section">
                    <div class="report-section-title">Service History</div>
                    ${customerPumpings.length > 0 ? customerPumpings.map(p => `
                        <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px dashed #ccc;">
                            <div class="report-row"><span class="report-label">Date:</span><span class="report-value">${formatDate(p.date)}</span></div>
                            <div class="report-row"><span class="report-label">Service Type:</span><span class="report-value">${formatServiceType(p.type)}</span></div>
                            ${p.sludgeLevel ? `<div class="report-row"><span class="report-label">Sludge Level:</span><span class="report-value">${p.sludgeLevel}%</span></div>` : ''}
                            ${p.chlorine === 'yes' ? `<div class="report-row"><span class="report-label">Chlorine:</span><span class="report-value">Tablets Added</span></div>` : ''}
                            ${p.notes ? `<div class="report-row"><span class="report-label">Notes:</span><span class="report-value">${p.notes}</span></div>` : ''}
                        </div>
                    `).join('') : '<p>No service history on file.</p>'}
                </div>
                
                <div class="report-section">
                    <div class="report-section-title">TCEQ Compliance Notes</div>
                    <p style="font-size: 0.9rem;">
                        ${customer.systemType === 'aerobic' 
                            ? 'This property has an aerobic septic system. Texas law requires an active maintenance contract with a licensed maintenance provider. Regular inspections and chlorine tablet replacement are required for proper operation and TCEQ compliance.'
                            : 'This property has a conventional septic system. TCEQ recommends pumping every 3-5 years depending on household size and usage. Regular maintenance helps prevent system failures and protects groundwater quality.'}
                    </p>
                </div>
                
                <div style="margin-top: 24px; text-align: center;">
                    <p style="font-size: 0.9rem;">Report generated: ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                </div>
            `;

            document.getElementById('report-content').innerHTML = reportContent;
            window.print();
        }

        // Export/Import Data
        function exportData() {
            const data = {
                customers: customers,
                pumpings: pumpings,
                contracts: contracts,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `septictrack-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function importData(input) {
            const file = input.files[0];
            if (!file) return;

            try {
                const text = await file.text();
                const data = JSON.parse(text);

                if (!data.customers || !Array.isArray(data.customers)) {
                    throw new Error('Invalid backup file: missing customers');
                }

                if (!confirm(`Import ${data.customers.length} customers and ${(data.pumpings || []).length} pumping records? This will replace all current data.`)) {
                    input.value = '';
                    return;
                }

                customers = data.customers || [];
                pumpings = data.pumpings || [];
                contracts = data.contracts || [];

                if (useIndexedDB && db) {
                    const transaction = db.transaction(['customers', 'pumpings', 'contracts'], 'readwrite');
                    await clearObjectStore(transaction, 'customers');
                    await clearObjectStore(transaction, 'pumpings');
                    await clearObjectStore(transaction, 'contracts');

                    for (const c of customers) await saveToStore('customers', c);
                    for (const p of pumpings) await saveToStore('pumpings', p);
                    for (const ct of contracts) await saveToStore('contracts', ct);
                } else {
                    saveToLocalStorage();
                }

                renderCustomerList();
                renderPumpingLog();
                renderContracts();
                renderAlerts();
                updateStats();
                updateReportDropdown();
                alert('Data imported successfully!');
            } catch (err) {
                alert('Error importing data: ' + err.message);
            }
            input.value = '';
        }

        function clearObjectStore(transaction, storeName) {
            return new Promise((resolve, reject) => {
                const store = transaction.objectStore(storeName);
                const request = store.clear();
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        async function clearAllData() {
            if (!confirm('WARNING: This will permanently delete ALL customers, pumping records, and contracts. This action cannot be undone. Are you sure?')) return;
            if (!confirm('Final confirmation: Delete all data?')) return;

            customers = [];
            pumpings = [];
            contracts = [];

            if (useIndexedDB && db) {
                const transaction = db.transaction(['customers', 'pumpings', 'contracts'], 'readwrite');
                await clearObjectStore(transaction, 'customers');
                await clearObjectStore(transaction, 'pumpings');
                await clearObjectStore(transaction, 'contracts');
            }
            saveToLocalStorage();

            renderCustomerList();
            renderPumpingLog();
            renderContracts();
            renderAlerts();
            updateStats();
            updateReportDropdown();
            alert('All data cleared.');
        }

        // Helper Functions
        function formatDate(dateStr) {
            if (!dateStr) return 'N/A';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        function formatServiceType(type) {
            const types = {
                'pumping': 'Full Pumping',
                'inspection': 'Inspection Only',
                'maintenance': 'Aerobic Maintenance',
                'jetting': 'Jetting/Cleaning',
                'repair': 'Repair Service'
            };
            return types[type] || type;
        }

        function getDueStatus(nextDue) {
            if (!nextDue) return { text: 'Not set', class: '' };
            const today = new Date();
            const dueDate = new Date(nextDue);
            const daysUntil = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));

            if (daysUntil < 0) return { text: `${Math.abs(daysUntil)}d overdue`, class: 'overdue' };
            if (daysUntil <= 30) return { text: `Due in ${daysUntil}d`, class: 'due-soon' };
            return { text: formatDate(nextDue), class: 'ok' };
        }

        function getSludgeClass(level) {
            if (level >= 50) return 'high';
            if (level >= 30) return 'medium';
            return 'low';
        }

        // Search functionality
        document.getElementById('customer-search').addEventListener('input', (e) => {
            renderCustomerList(e.target.value);
        });

        // Close modal on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await initDB();
            setupTabs();
            renderCustomerList();
            renderPumpingLog();
            renderContracts();
            renderAlerts();
            updateStats();
            updateReportDropdown();
        });
    </script>

<!-- DEMO DISCLAIMER - Legal Notice -->

<!-- BennyCuTools Purchase CTA — injected by inject-cta.py -->
<style>
#bct-cta-bar {
  position: fixed;
  bottom: 48px;
  left: 0;
  right: 0;
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  border-top: 2px solid #6366f1;
  padding: 10px 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  z-index: 99998;
  flex-wrap: wrap;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
}
#bct-cta-bar .bct-cta-text {
  color: #e4e4e7;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 14px;
  font-weight: 500;
}
#bct-cta-bar .bct-cta-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 20px;
  background: #6366f1;
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 14px;
  font-weight: 600;
  border: none;
  border-radius: 6px;
  text-decoration: none;
  cursor: pointer;
  transition: background 0.2s, transform 0.1s;
}
#bct-cta-bar .bct-cta-btn:hover {
  background: #4f46e5;
  transform: translateY(-1px);
}
#bct-cta-bar .bct-cta-btn-secondary {
  background: transparent;
  border: 1px solid #6366f1;
  color: #a5b4fc;
}
#bct-cta-bar .bct-cta-btn-secondary:hover {
  background: rgba(99,102,241,0.15);
}
@media (max-width: 600px) {
  #bct-cta-bar {
    flex-direction: column;
    gap: 8px;
    padding: 8px 12px;
    bottom: 44px;
  }
  #bct-cta-bar .bct-cta-text { font-size: 12px; }
  #bct-cta-bar .bct-cta-btn { font-size: 13px; padding: 7px 16px; width: 100%; justify-content: center; }
}
</style>
<div id="bct-cta-bar" role="banner" aria-label="Purchase this tool">
  <span class="bct-cta-text">Like this tool? Make it yours.</span>
  <a class="bct-cta-btn" id="bct-buy-btn" href="https://bennycutools.com/buy.html">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
    Get It — $200 One-Time
  </a>
  <a class="bct-cta-btn bct-cta-btn-secondary" href="mailto:cuuper225@gmail.com?subject=Question%20about%20my%20custom%20tool">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
    Questions? Email Ben
  </a>
</div>
<script>
// Auto-fill the buy link with the current tool's page name
(function(){
  try {
    var pg = location.pathname.replace(/.*\//, '').replace('.html','');
    var buyBtn = document.getElementById('bct-buy-btn');
    if (buyBtn && pg) {
      buyBtn.href = 'https://bennycutools.com/buy.html?tool=' + encodeURIComponent(pg);
    }
  } catch(e){}
})();
</script>
<!-- End BennyCuTools Purchase CTA -->

<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer">
  <p><strong>DEMO NOTICE:</strong> This tool was created by BennyCuTools as a free demonstration only.
  It is not affiliated with, endorsed by, or authorized by T.E.R. Septic.
  All brand references are used solely for demonstration purposes.</p>
  <a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20T.E.R.%20Septic&body=I%20am%20the%20owner%20of%20T.E.R.%20Septic%20and%20I%20request%20permanent%20deletion%20of%20the%20demo%20tool%20on%20bennycutools.com." class="bct-delete-btn" aria-label="Request permanent deletion of this demo">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
    Request Permanent Deletion
  </a>
</div>

</body>
</html>
