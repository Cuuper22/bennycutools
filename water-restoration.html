<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>DryLog â€” Moisture Documentation for Water Damage Restoration</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Oswald:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --navy: oklch(0.28 0.06 250);
      --navy-dark: oklch(0.22 0.05 250);
      --orange: oklch(0.62 0.18 45);
      --orange-hover: oklch(0.58 0.2 45);
      --blue-light: oklch(0.65 0.12 240);
      --water-blue: oklch(0.72 0.15 230);
      --water-dark: oklch(0.55 0.18 220);
      --bg: oklch(0.985 0.002 90);
      --bg-card: oklch(1 0 0);
      --text: oklch(0.25 0.02 260);
      --text-muted: oklch(0.5 0.02 260);
      --border: oklch(0.9 0.01 90);
      --success: oklch(0.55 0.15 145);
      --danger: oklch(0.55 0.2 25);
      --status-active: oklch(0.55 0.15 145);
      --status-active-bg: oklch(0.93 0.06 145);
      --status-drying: oklch(0.65 0.15 75);
      --status-drying-bg: oklch(0.95 0.08 85);
      --status-complete: oklch(0.55 0.15 250);
      --status-complete-bg: oklch(0.92 0.06 250);
      --shadow-sm: 0 1px 2px oklch(0.2 0.02 260 / 0.06);
      --shadow-md: 0 4px 12px oklch(0.2 0.02 260 / 0.08), 0 2px 4px oklch(0.2 0.02 260 / 0.04);
      --shadow-lg: 0 8px 24px oklch(0.2 0.02 260 / 0.12), 0 4px 8px oklch(0.2 0.02 260 / 0.06);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
    }

    html, body { padding-bottom: 80px;
      height: 100%;
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    /* Anti-scrape protection */
    body { padding-bottom: 80px;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    input, textarea {
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }

    /* Entrance animations */
    @keyframes fadeSlideUp {
      from {
        opacity: 0;
        transform: translateY(16px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes waterDrop {
      0% { transform: translateY(-4px) scale(0.9); opacity: 0.7; }
      50% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(2px) scale(0.95); opacity: 0.9; }
    }

    @keyframes pulseWater {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    .animate-in {
      animation: fadeSlideUp 0.35s ease-out forwards;
    }

    .job-card {
      animation: fadeSlideUp 0.35s ease-out forwards;
    }

    .job-card:nth-child(1) { animation-delay: 0.05s; }
    .job-card:nth-child(2) { animation-delay: 0.1s; }
    .job-card:nth-child(3) { animation-delay: 0.15s; }
    .job-card:nth-child(4) { animation-delay: 0.2s; }
    .job-card:nth-child(5) { animation-delay: 0.25s; }

    /* Access Gate */
    #access-gate {
      position: fixed;
      inset: 0;
      background: var(--navy);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      z-index: 1000;
    }

    #access-gate.hidden { display: none; }

    .gate-logo {
      font-family: 'Oswald', sans-serif;
      font-size: 32px;
      font-weight: 700;
      color: white;
      margin-bottom: 8px;
      letter-spacing: -0.5px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .gate-logo::before {
      content: '';
      display: inline-block;
      width: 36px;
      height: 36px;
      background: var(--water-blue);
      mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 2C12 2 5 9.5 5 14.5C5 18.0899 8.13401 21 12 21C15.866 21 19 18.0899 19 14.5C19 9.5 12 2 12 2ZM12 19C9.23858 19 7 16.9853 7 14.5C7 11.5 10.5 7 12 5C13.5 7 17 11.5 17 14.5C17 16.9853 14.7614 19 12 19Z'/%3E%3C/svg%3E") no-repeat center;
      mask-size: contain;
      -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 2C12 2 5 9.5 5 14.5C5 18.0899 8.13401 21 12 21C15.866 21 19 18.0899 19 14.5C19 9.5 12 2 12 2ZM12 19C9.23858 19 7 16.9853 7 14.5C7 11.5 10.5 7 12 5C13.5 7 17 11.5 17 14.5C17 16.9853 14.7614 19 12 19Z'/%3E%3C/svg%3E") no-repeat center;
      -webkit-mask-size: contain;
      animation: waterDrop 2s ease-in-out infinite;
    }

    .gate-tagline {
      color: oklch(0.8 0.02 260);
      font-size: 14px;
      margin-bottom: 32px;
    }

    .gate-form {
      width: 100%;
      max-width: 320px;
    }

    .gate-input {
      width: 100%;
      padding: 14px 16px;
      font-size: 16px;
      border: 2px solid oklch(0.4 0.04 250);
      border-radius: var(--radius-md);
      background: oklch(0.18 0.04 250);
      color: white;
      outline: none;
      transition: border-color 0.15s ease;
    }

    .gate-input::placeholder { color: oklch(0.55 0.03 260); }
    .gate-input:focus { border-color: var(--orange); }

    .gate-btn {
      width: 100%;
      margin-top: 12px;
      padding: 14px;
      font-size: 16px;
      font-weight: 600;
      color: white;
      background: var(--orange);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: background 0.15s ease, transform 0.1s ease;
    }

    .gate-btn:hover { background: var(--orange-hover); }
    .gate-btn:active { transform: scale(0.98); }
    .gate-btn:focus-visible { outline: 2px solid white; outline-offset: 2px; }

    .gate-error {
      margin-top: 12px;
      padding: 10px 12px;
      background: oklch(0.35 0.12 25);
      color: oklch(0.9 0.05 25);
      border-radius: var(--radius-sm);
      font-size: 14px;
      display: none;
    }

    .gate-error.show { display: block; }

    /* Main App */
    #app {
      display: none;
      flex-direction: column;
      min-height: 100vh;
      padding-bottom: 80px;
    }

    #app.active { display: flex; }

    /* Header */
    .header {
      background: var(--navy);
      color: white;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-title {
      font-family: 'Oswald', sans-serif;
      font-size: 22px;
      font-weight: 600;
      letter-spacing: -0.3px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .header-title::before {
      content: '';
      display: inline-block;
      width: 24px;
      height: 24px;
      background: var(--water-blue);
      mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 2C12 2 5 9.5 5 14.5C5 18.0899 8.13401 21 12 21C15.866 21 19 18.0899 19 14.5C19 9.5 12 2 12 2ZM12 19C9.23858 19 7 16.9853 7 14.5C7 11.5 10.5 7 12 5C13.5 7 17 11.5 17 14.5C17 16.9853 14.7614 19 12 19Z'/%3E%3C/svg%3E") no-repeat center;
      mask-size: contain;
      -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 2C12 2 5 9.5 5 14.5C5 18.0899 8.13401 21 12 21C15.866 21 19 18.0899 19 14.5C19 9.5 12 2 12 2ZM12 19C9.23858 19 7 16.9853 7 14.5C7 11.5 10.5 7 12 5C13.5 7 17 11.5 17 14.5C17 16.9853 14.7614 19 12 19Z'/%3E%3C/svg%3E") no-repeat center;
      -webkit-mask-size: contain;
      animation: waterDrop 2.5s ease-in-out infinite;
    }

    .header-back {
      display: flex;
      align-items: center;
      gap: 8px;
      background: none;
      border: none;
      color: white;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      padding: 8px 12px;
      margin: -8px -12px;
      border-radius: var(--radius-sm);
      transition: background 0.15s ease;
    }

    .header-back:hover { background: oklch(0.35 0.05 250); }
    .header-back:focus-visible { outline: 2px solid white; outline-offset: 2px; }
    .header-back svg { width: 18px; height: 18px; }

    .fab-btn {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #f97316;
      color: white;
      font-size: 28px;
      font-weight: 300;
      border: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .fab-btn:hover { background: #ea580c; }

    /* Demo Banner */
    .demo-banner {
      background: oklch(0.95 0.03 90);
      border-bottom: 1px solid var(--border);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .demo-banner.hidden { display: none; }

    .demo-banner-text {
      font-size: 13px;
      color: var(--text-muted);
    }

    .demo-banner-close {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      border-radius: 50%;
      transition: background 0.15s ease, color 0.15s ease;
      flex-shrink: 0;
    }

    .demo-banner-close:hover { background: var(--border); color: var(--text); }
    .demo-banner-close:focus-visible { outline: 2px solid var(--navy); outline-offset: 2px; }

    /* Views */
    .view { display: none; padding: 16px; }
    .view.active { display: block; }

    /* Job List */
    .jobs-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      gap: 12px;
      width: 100%;
    }

    .jobs-title-wrap {
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 0;
      flex-shrink: 1;
    }

    .jobs-title {
      font-family: 'Oswald', sans-serif;
      font-size: 18px;
      font-weight: 600;
      color: var(--navy);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .fab-new-job {
      position: fixed;
      bottom: 80px;
      right: 16px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: oklch(0.62 0.18 45);
      color: white;
      border: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .fab-new-job:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }

    .fab-new-job:active {
      transform: scale(0.95);
    }

    .fab-new-job:focus-visible {
      outline: 3px solid oklch(0.28 0.06 250);
      outline-offset: 3px;
    }

    .btn-new-job:hover { background: var(--orange-hover); }
    .btn-new-job:active { transform: scale(0.97); }
    .btn-new-job:focus-visible { outline: 2px solid var(--navy); outline-offset: 2px; }
    .btn-new-job svg { width: 16px; height: 16px; }

    .job-list { display: flex; flex-direction: column; gap: 12px; }

    .job-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 16px 70px 16px 20px;
      cursor: pointer;
      transition: box-shadow 0.2s ease, border-color 0.2s ease, transform 0.15s ease;
      position: relative;
    }

    .job-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--border);
      transition: background 0.2s ease;
    }

    .job-card[data-status="active"]::before {
      background: var(--status-active);
    }

    .job-card[data-status="drying"]::before {
      background: var(--status-drying);
    }

    .job-card[data-status="complete"]::before {
      background: var(--status-complete);
    }

    .job-card:hover {
      box-shadow: var(--shadow-md);
      border-color: oklch(0.8 0.04 250);
      transform: translateY(-2px);
    }

    .job-card:active {
      transform: translateY(0);
    }

    .job-card:focus-visible { outline: 2px solid var(--navy); outline-offset: 2px; }

    .job-card-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .job-id {
      font-family: 'Oswald', sans-serif;
      font-size: 14px;
      font-weight: 600;
      color: var(--navy);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .job-status {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 5px 10px;
      border-radius: 20px;
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.08);
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
    }

    .job-status::before {
      content: '';
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
    }

    .job-status.active {
      background: oklch(0.9 0.08 145);
      color: oklch(0.35 0.12 145);
    }

    .job-status.drying {
      background: oklch(0.95 0.08 85);
      color: oklch(0.5 0.12 80);
    }

    .job-status.complete {
      background: oklch(0.92 0.06 250);
      color: oklch(0.45 0.1 250);
    }

    .job-status-badge {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 4px 10px;
      border-radius: 12px;
      white-space: nowrap;
    }

    .job-status-badge.status-active {
      background: #dcfce7;
      color: #16a34a;
    }

    .job-status-badge.status-drying {
      background: #fef9c3;
      color: #ca8a04;
    }

    .job-status-badge.status-complete {
      background: #dbeafe;
      color: #2563eb;
    }

    .job-address {
      font-size: 14px;
      color: var(--text);
      margin-bottom: 4px;
    }

    .job-meta {
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      gap: 12px;
    }

    /* Job Detail */
    .job-detail-header {
      margin-bottom: 20px;
    }

    .job-detail-id {
      font-family: 'Oswald', sans-serif;
      font-size: 24px;
      font-weight: 600;
      color: var(--navy);
      margin-bottom: 4px;
    }

    .job-detail-address {
      font-size: 15px;
      color: var(--text);
      margin-bottom: 2px;
    }

    .job-detail-claim {
      font-size: 13px;
      color: var(--text-muted);
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 4px;
      background: var(--border);
      padding: 4px;
      border-radius: var(--radius-md);
      margin-bottom: 16px;
    }

    .tab-btn {
      flex: 1;
      padding: 10px 8px;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-muted);
      background: transparent;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.15s ease, color 0.15s ease;
    }

    .tab-btn:hover { color: var(--text); }
    .tab-btn.active { background: var(--bg-card); color: var(--navy); box-shadow: var(--shadow-sm); }
    .tab-btn:focus-visible { outline: 2px solid var(--navy); outline-offset: -2px; }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Readings List */
    .readings-empty {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-muted);
    }

    .readings-empty-icon {
      width: 48px;
      height: 48px;
      margin: 0 auto 12px;
      opacity: 0.5;
    }

    .btn-capture {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      padding: 16px;
      font-size: 16px;
      font-weight: 600;
      color: white;
      background: var(--orange);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      margin-bottom: 16px;
      transition: background 0.15s ease, transform 0.1s ease;
    }

    .btn-capture:hover { background: var(--orange-hover); }
    .btn-capture:active { transform: scale(0.98); }
    .btn-capture:focus-visible { outline: 2px solid var(--navy); outline-offset: 2px; }
    .btn-capture svg { width: 22px; height: 22px; }

    .reading-card {
      display: flex;
      gap: 12px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 12px;
      margin-bottom: 10px;
      animation: fadeSlideUp 0.3s ease-out forwards;
      position: relative;
      overflow: hidden;
    }

    .reading-card::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 40px;
      height: 40px;
      background: var(--water-blue);
      opacity: 0.08;
      mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 2C12 2 5 9.5 5 14.5C5 18.0899 8.13401 21 12 21C15.866 21 19 18.0899 19 14.5C19 9.5 12 2 12 2Z'/%3E%3C/svg%3E") no-repeat center;
      mask-size: 24px;
      -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 2C12 2 5 9.5 5 14.5C5 18.0899 8.13401 21 12 21C15.866 21 19 18.0899 19 14.5C19 9.5 12 2 12 2Z'/%3E%3C/svg%3E") no-repeat center;
      -webkit-mask-size: 24px;
    }

    .reading-thumb {
      width: 64px;
      height: 64px;
      border-radius: 6px;
      object-fit: cover;
      background: var(--border);
      flex-shrink: 0;
    }

    .reading-info { flex: 1; min-width: 0; }

    .reading-location {
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 2px;
    }

    .reading-value {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 13px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 4px;
      margin-bottom: 4px;
    }

    .reading-value.wet {
      background: oklch(0.92 0.08 25);
      color: oklch(0.45 0.15 25);
    }

    .reading-value.drying {
      background: oklch(0.95 0.1 90);
      color: oklch(0.45 0.1 90);
    }

    .reading-value.dry {
      background: oklch(0.92 0.08 145);
      color: oklch(0.4 0.12 145);
    }

    .reading-meta {
      font-size: 11px;
      color: var(--text-muted);
    }

    .reading-delete {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.15s ease, color 0.15s ease;
      flex-shrink: 0;
      align-self: center;
    }

    .reading-delete:hover { background: oklch(0.95 0.05 25); color: var(--danger); }
    .reading-delete:focus-visible { outline: 2px solid var(--navy); outline-offset: 2px; }

    /* Moisture Map */
    .map-container {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 16px;
    }

    .map-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 12px;
    }

    .map-canvas-wrap {
      position: relative;
      background: oklch(0.97 0.01 90);
      border-radius: 8px;
      overflow: hidden;
      aspect-ratio: 4/3;
    }

    #moisture-map {
      width: 100%;
      height: 100%;
      display: block;
    }

    .map-legend {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 12px;
      font-size: 11px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .legend-dot.wet { background: oklch(0.55 0.2 25); }
    .legend-dot.drying { background: oklch(0.65 0.2 80); }
    .legend-dot.dry { background: oklch(0.55 0.18 145); }

    /* Report Tab */
    .report-preview {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 20px;
      margin-bottom: 16px;
    }

    .report-header {
      text-align: center;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 16px;
    }

    .report-logo {
      font-family: 'Oswald', sans-serif;
      font-size: 18px;
      font-weight: 700;
      color: var(--navy);
    }

    .report-title {
      font-size: 14px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .report-section {
      margin-bottom: 16px;
    }

    .report-section-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .report-field {
      font-size: 14px;
      color: var(--text);
      margin-bottom: 4px;
    }

    .report-summary-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      text-align: center;
    }

    .summary-stat {
      padding: 12px 8px;
      background: oklch(0.97 0.01 90);
      border-radius: 8px;
    }

    .summary-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--navy);
    }

    .summary-label {
      font-size: 10px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .btn-generate {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding: 16px;
      font-size: 16px;
      font-weight: 600;
      color: white;
      background: var(--navy);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      margin-bottom: 10px;
      transition: background 0.15s ease, transform 0.1s ease;
    }

    .btn-generate:hover { background: var(--navy-dark); }
    .btn-generate:active { transform: scale(0.98); }
    .btn-generate:focus-visible { outline: 2px solid var(--orange); outline-offset: 2px; }

    .btn-send-disabled {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding: 16px;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-muted);
      background: oklch(0.94 0.01 90);
      border: 1px dashed oklch(0.8 0.02 90);
      border-radius: var(--radius-md);
      cursor: not-allowed;
      position: relative;
    }

    .btn-send-disabled::after {
      content: 'Full Version';
      position: absolute;
      top: -8px;
      right: 12px;
      font-size: 9px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 2px 6px;
      background: var(--orange);
      color: white;
      border-radius: 4px;
    }

    /* New Job Form */
    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 6px;
    }

    .form-input {
      width: 100%;
      padding: 12px 14px;
      font-size: 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      background: var(--bg-card);
      color: var(--text);
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    .form-input::placeholder { color: oklch(0.65 0.02 260); }
    .form-input:focus { border-color: var(--navy); box-shadow: 0 0 0 3px oklch(0.28 0.06 250 / 0.1); }

    .btn-submit {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      font-weight: 600;
      color: white;
      background: var(--navy);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: background 0.15s ease, transform 0.1s ease;
    }

    .btn-submit:hover { background: var(--navy-dark); }
    .btn-submit:active { transform: scale(0.98); }
    .btn-submit:focus-visible { outline: 2px solid var(--orange); outline-offset: 2px; }

    /* Camera Modal */
    .camera-modal {
      position: fixed;
      inset: 0;
      background: oklch(0.1 0.02 260 / 0.9);
      z-index: 200;
      display: none;
      flex-direction: column;
    }

    .camera-modal.active { display: flex; }

    .camera-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      background: oklch(0 0 0 / 0.5);
    }

    .camera-title {
      color: white;
      font-size: 16px;
      font-weight: 600;
    }

    .camera-close {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: oklch(1 0 0 / 0.15);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      transition: background 0.15s ease;
    }

    .camera-close:hover { background: oklch(1 0 0 / 0.25); }
    .camera-close:focus-visible { outline: 2px solid white; outline-offset: 2px; }

    .camera-body { padding-bottom: 80px;
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .camera-preview {
      width: 100%;
      max-width: 400px;
      aspect-ratio: 4/3;
      background: oklch(0.15 0.02 260);
      border-radius: var(--radius-lg);
      overflow: hidden;
      position: relative;
    }

    #camera-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .camera-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }

    .camera-guide {
      width: 70%;
      aspect-ratio: 3/2;
      border: 2px dashed oklch(1 0 0 / 0.6);
      border-radius: 12px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding-bottom: 8px;
    }

    .camera-guide-text {
      font-size: 12px;
      color: oklch(1 0 0 / 0.8);
      background: oklch(0 0 0 / 0.5);
      padding: 4px 10px;
      border-radius: 4px;
    }

    .camera-controls {
      padding: 24px 20px;
      background: oklch(0 0 0 / 0.5);
    }

    .camera-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 16px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    .camera-input {
      padding: 12px 14px;
      font-size: 16px;
      border: none;
      border-radius: var(--radius-md);
      background: oklch(1 0 0 / 0.15);
      color: white;
      outline: none;
    }

    .camera-input::placeholder { color: oklch(1 0 0 / 0.5); }
    .camera-input:focus { box-shadow: 0 0 0 2px var(--orange); }

    .btn-shutter {
      width: 72px;
      height: 72px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      border: 4px solid oklch(1 0 0 / 0.3);
      border-radius: 50%;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.15s ease;
    }

    .btn-shutter:hover { box-shadow: 0 0 0 4px oklch(1 0 0 / 0.2); }
    .btn-shutter:active { transform: scale(0.93); }
    .btn-shutter:focus-visible { outline: 2px solid var(--orange); outline-offset: 4px; }

    .btn-shutter-inner {
      width: 56px;
      height: 56px;
      background: var(--orange);
      border-radius: 50%;
    }

    /* Disclaimer */
    .disclaimer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: oklch(0.15 0.02 260);
      color: oklch(0.75 0.02 260);
      padding: 10px 16px;
      font-size: 11px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      gap: 8px 16px;
      text-align: center;
      z-index: 50;
    }

    .disclaimer a {
      color: oklch(0.7 0.1 45);
      text-decoration: none;
    }

    .disclaimer a:hover { text-decoration: underline; }
    .disclaimer a:focus-visible { outline: 1px solid oklch(0.7 0.1 45); outline-offset: 2px; }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--navy);
      color: white;
      padding: 12px 20px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 500;
      box-shadow: var(--shadow-lg);
      z-index: 300;
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* Responsive */
    @media (min-width: 480px) {
      .view { padding: 20px; }
      .job-card { padding: 20px; }
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    @media print {
      #bct-demo-disclaimer, nav, .bottom-nav, .tab-bar, .demo-banner, button:not(.print-keep) { display: none !important; }
      body { padding-bottom: 80px; padding: 0 !important; background: white !important; color: black !important; }
    }
  </style>
</head>
<body>
  <a href="#app" class="skip-link" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;z-index:100000;" onfocus="this.style.position='fixed';this.style.left='16px';this.style.top='16px';this.style.width='auto';this.style.height='auto';this.style.overflow='visible';this.style.background='#fff';this.style.padding='8px 16px';this.style.borderRadius='4px';this.style.boxShadow='0 2px 8px rgba(0,0,0,0.3)';this.style.fontSize='14px';this.style.color='#333';this.style.textDecoration='none';" onblur="this.style.position='absolute';this.style.left='-9999px';this.style.width='1px';this.style.height='1px';this.style.overflow='hidden';">Skip to main content</a>
  <!-- Access Gate -->
  <div id="access-gate">
    <div class="gate-logo">DryLog</div>
    <div class="gate-tagline">Moisture tracking &amp; dryout documentation</div>
    <form class="gate-form" id="gate-form">
      <input type="text" class="gate-input" id="access-key" placeholder="Enter access key" autocomplete="off" aria-label="Access key">
      <button type="submit" class="gate-btn">Open Tool</button>
      <div class="gate-error" id="gate-error" role="alert">Invalid access key. Check your email for the correct key.</div>
    </form>
  </div>

  <!-- Main App -->
  <div id="app">
    <header class="header">
      <span class="header-title" id="header-title">DryLog</span>
      <button class="header-back" id="btn-back" style="display: none;" aria-label="Go back to jobs list">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        <span>Jobs</span>
      </button>
    </header>

    <!-- Demo Banner -->
    <div class="demo-banner" id="demo-banner">
      <span class="demo-banner-text">Sample data for Waco. Tap x to clear and add your own.</span>
      <button class="demo-banner-close" id="demo-banner-close" aria-label="Clear demo data">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></svg>
      </button>
    </div>

    <!-- Jobs List View -->
    <div class="view active" id="view-jobs">
      <div class="jobs-header">
        <div class="jobs-title-wrap">
          <h1 class="jobs-title">Active Jobs</h1>
        </div>
      </div>
      <div class="job-list" id="job-list" role="list" aria-label="Jobs list"></div>
      <button class="fab-btn" id="btn-new-job-fab" aria-label="Create new job">+</button>
    </div>

    <!-- New Job View -->
    <div class="view" id="view-new-job">
      <h2 class="jobs-title" style="margin-bottom: 20px;">New Job</h2>
      <form id="new-job-form">
        <div class="form-group">
          <label class="form-label" for="job-address">Property Address</label>
          <input type="text" class="form-input" id="job-address" placeholder="123 Main St, Waco, TX" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="job-customer">Customer Name</label>
          <input type="text" class="form-input" id="job-customer" placeholder="John Smith" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="job-claim">Insurance Claim # (optional)</label>
          <input type="text" class="form-input" id="job-claim" placeholder="CLM-2026-00123">
        </div>
        <button type="submit" class="btn-submit">Create Job</button>
      </form>
    </div>

    <!-- Job Detail View -->
    <div class="view" id="view-job-detail">
      <div class="job-detail-header">
        <div class="job-detail-id" id="detail-job-id"></div>
        <div class="job-detail-address" id="detail-address"></div>
        <div class="job-detail-claim" id="detail-claim"></div>
      </div>

      <div class="tabs" role="tablist" aria-label="Job sections">
        <button class="tab-btn active" role="tab" aria-selected="true" aria-controls="tab-readings" id="tab-btn-readings">Readings</button>
        <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-map" id="tab-btn-map">Map</button>
        <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-report" id="tab-btn-report">Report</button>
      </div>

      <!-- Readings Tab -->
      <div class="tab-content active" id="tab-readings" role="tabpanel" aria-labelledby="tab-btn-readings">
        <button class="btn-capture" id="btn-capture" aria-label="Capture new moisture reading">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2C12 2 6 8.5 6 13.5C6 17.0899 8.68629 20 12 20C15.3137 20 18 17.0899 18 13.5C18 8.5 12 2 12 2Z"/>
            <path d="M12 16V16.01"/>
            <path d="M12 12C12.5523 12 13 11.5523 13 11C13 10.4477 12.5523 10 12 10C11.4477 10 11 10.4477 11 11C11 11.5523 11.4477 12 12 12Z"/>
            <path d="M12 7L12 8"/>
          </svg>
          Capture Moisture Reading
        </button>
        <div id="readings-list"></div>
      </div>

      <!-- Map Tab -->
      <div class="tab-content" id="tab-map" role="tabpanel" aria-labelledby="tab-btn-map">
        <div class="map-container">
          <div class="map-title">Moisture Map</div>
          <div class="map-canvas-wrap">
            <canvas id="moisture-map" aria-label="Visual moisture map showing reading locations"></canvas>
          </div>
          <div class="map-legend">
            <div class="legend-item"><span class="legend-dot wet" aria-hidden="true"></span> Wet (16%+)</div>
            <div class="legend-item"><span class="legend-dot drying" aria-hidden="true"></span> Drying (10-15%)</div>
            <div class="legend-item"><span class="legend-dot dry" aria-hidden="true"></span> Dry (&lt;10%)</div>
          </div>
        </div>
      </div>

      <!-- Report Tab -->
      <div class="tab-content" id="tab-report" role="tabpanel" aria-labelledby="tab-btn-report">
        <div class="report-preview" id="report-preview">
          <div class="report-header">
            <div class="report-logo">Lone Star Flood Restoration</div>
            <div class="report-title">Moisture Assessment Report</div>
          </div>
          <div class="report-section">
            <div class="report-section-title">Job Details</div>
            <div class="report-field" id="report-address"></div>
            <div class="report-field" id="report-claim"></div>
            <div class="report-field" id="report-date"></div>
          </div>
          <div class="report-section">
            <div class="report-section-title">Summary</div>
            <div class="report-summary-grid" id="report-summary"></div>
          </div>
        </div>
        <button class="btn-generate" id="btn-generate" aria-label="Generate PDF report">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>
          Generate PDF Report
        </button>
        <div class="btn-send-disabled" aria-disabled="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
          Send Report to Adjuster
        </div>
      </div>
    </div>
  </div>

  <!-- Camera Modal -->
  <div class="camera-modal" id="camera-modal" role="dialog" aria-modal="true" aria-labelledby="camera-modal-title">
    <div class="camera-header">
      <span class="camera-title" id="camera-modal-title">Capture Moisture Reading</span>
      <button class="camera-close" id="camera-close" aria-label="Close camera">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></svg>
      </button>
    </div>
    <div class="camera-body">
      <div class="camera-preview">
        <video id="camera-video" autoplay playsinline></video>
        <div class="camera-overlay">
          <div class="camera-guide">
            <span class="camera-guide-text">Align moisture meter</span>
          </div>
        </div>
      </div>
    </div>
    <div class="camera-controls">
      <div class="camera-form">
        <input type="text" class="camera-input" id="reading-location" placeholder="Location (e.g., Kitchen - East Wall)" aria-label="Reading location">
        <input type="number" class="camera-input" id="reading-value" placeholder="Moisture % (e.g., 22)" min="0" max="100" aria-label="Moisture percentage">
      </div>
      <button class="btn-shutter" id="btn-shutter" aria-label="Take photo">
        <div class="btn-shutter-inner"></div>
      </button>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <!-- Disclaimer Footer -->
  <div class="disclaimer">
    <span>DEMO: Built for Lone Star Flood Restoration. Not affiliated with Lone Star Flood Restoration.</span>
    <a href="mailto:cuuper225@gmail.com?subject=Deletion%20Request%20-%20Lone%20Star%20Flood%20Restoration%20Demo&body=Please%20remove%20the%20demo%20tool%20associated%20with%20Lone%20Star%20Flood%20Restoration.">Request Permanent Deletion</a>
  </div>

  <script>
    // Hash function for access key verification
    function _h(s) {
      let h = 0;
      for (let i = 0; i < s.length; i++) {
        h = ((h << 5) - h) + s.charCodeAt(i);
        h |= 0;
      }
      return h;
    }
    const _V = 183709664;

    // DOM Elements
    const accessGate = document.getElementById('access-gate');
    const gateForm = document.getElementById('gate-form');
    const accessKeyInput = document.getElementById('access-key');
    const gateError = document.getElementById('gate-error');
    const app = document.getElementById('app');
    const demoBanner = document.getElementById('demo-banner');
    const demoBannerClose = document.getElementById('demo-banner-close');
    const headerTitle = document.getElementById('header-title');
    const btnBack = document.getElementById('btn-back');
    const btnNewJob = document.getElementById('btn-new-job-fab');
    const newJobForm = document.getElementById('new-job-form');
    const jobList = document.getElementById('job-list');
    const viewJobs = document.getElementById('view-jobs');
    const viewNewJob = document.getElementById('view-new-job');
    const viewJobDetail = document.getElementById('view-job-detail');
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    const btnCapture = document.getElementById('btn-capture');
    const cameraModal = document.getElementById('camera-modal');
    const cameraClose = document.getElementById('camera-close');
    const cameraVideo = document.getElementById('camera-video');
    const btnShutter = document.getElementById('btn-shutter');
    const readingLocation = document.getElementById('reading-location');
    const readingValue = document.getElementById('reading-value');
    const readingsList = document.getElementById('readings-list');
    const moistureMap = document.getElementById('moisture-map');
    const btnGenerate = document.getElementById('btn-generate');
    const toast = document.getElementById('toast');

    // State
    let jobs = [];
    let currentJobId = null;
    let cameraStream = null;
    let isDemoData = true;

    // Demo Data - Waco area jobs
    const demoJobs = [
      {
        id: 'JOB-2026-0042',
        address: '2817 Maple Ave, Waco, TX 76708',
        customer: 'Martinez Family',
        claim: 'CLM-2026-84521',
        status: 'active',
        date: '2026-02-07',
        readings: [
          { id: 1, location: 'Master Bedroom - South Wall', value: 24, time: '09:15 AM', lat: 31.5493, lng: -97.1467, photo: null },
          { id: 2, location: 'Master Bedroom - East Wall', value: 28, time: '09:18 AM', lat: 31.5493, lng: -97.1467, photo: null },
          { id: 3, location: 'Hallway - West Wall', value: 18, time: '09:22 AM', lat: 31.5493, lng: -97.1467, photo: null },
          { id: 4, location: 'Bathroom - Floor', value: 32, time: '09:25 AM', lat: 31.5493, lng: -97.1467, photo: null }
        ]
      },
      {
        id: 'JOB-2026-0041',
        address: '4512 Colcord Ave, Waco, TX 76710',
        customer: 'Thompson Residence',
        claim: 'CLM-2026-83992',
        status: 'drying',
        date: '2026-02-06',
        readings: [
          { id: 1, location: 'Kitchen - Under Sink', value: 14, time: '02:30 PM', lat: 31.5211, lng: -97.1892, photo: null },
          { id: 2, location: 'Kitchen - Cabinet Base', value: 12, time: '02:35 PM', lat: 31.5211, lng: -97.1892, photo: null },
          { id: 3, location: 'Kitchen - Floor (Tile)', value: 8, time: '02:40 PM', lat: 31.5211, lng: -97.1892, photo: null }
        ]
      },
      {
        id: 'JOB-2026-0039',
        address: '1108 Speight Ave, Waco, TX 76706',
        customer: 'Garcia Property',
        claim: 'CLM-2026-82148',
        status: 'complete',
        date: '2026-02-04',
        readings: [
          { id: 1, location: 'Living Room - North Wall', value: 8, time: '11:00 AM', lat: 31.5436, lng: -97.1245, photo: null },
          { id: 2, location: 'Living Room - East Wall', value: 7, time: '11:05 AM', lat: 31.5436, lng: -97.1245, photo: null },
          { id: 3, location: 'Dining Room - Floor', value: 6, time: '11:10 AM', lat: 31.5436, lng: -97.1245, photo: null }
        ]
      }
    ];

    // Initialize
    function init() {
      // Check URL for auto-auth
      const params = new URLSearchParams(window.location.search);
      const keyParam = params.get('key');
      if (keyParam && _h(keyParam) === _V) {
        grantAccess();
        return;
      }

      // Check localStorage for previous auth
      const storedAuth = localStorage.getItem('drylog_auth');
      if (storedAuth && _h(storedAuth) === _V) {
        grantAccess();
        return;
      }

      // Show gate
      accessGate.classList.remove('hidden');
    }

    // Auto-grant for screenshot testing with key param
    if (new URLSearchParams(window.location.search).get('key') === 'wtrs2026') {
      accessGate.classList.add('hidden');
      app.classList.add('active');
      loadJobs();
    }

    function grantAccess() {
      accessGate.classList.add('hidden');
      app.classList.add('active');
      loadJobs();
    }

    function loadJobs() {
      const stored = localStorage.getItem('drylog_jobs');
      if (stored) {
        jobs = JSON.parse(stored);
        isDemoData = false;
        demoBanner.classList.add('hidden');
      } else if (!localStorage.getItem('lonestar-flood-visited')) {
        localStorage.setItem('lonestar-flood-visited', 'true');
        jobs = JSON.parse(JSON.stringify(demoJobs));
        isDemoData = true;
        demoBanner.classList.remove('hidden');
      } else {
        jobs = [];
        isDemoData = false;
        demoBanner.classList.add('hidden');
      }
      renderJobList();
    }

    function saveJobs() {
      localStorage.setItem('drylog_jobs', JSON.stringify(jobs));
    }

    function showToast(message) {
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2500);
    }

    // Access Gate
    gateForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const key = accessKeyInput.value.trim();
      if (_h(key) === _V) {
        localStorage.setItem('drylog_auth', key);
        grantAccess();
      } else {
        gateError.classList.add('show');
        accessKeyInput.focus();
      }
    });

    accessKeyInput.addEventListener('input', () => {
      gateError.classList.remove('show');
    });

    // Demo Banner
    demoBannerClose.addEventListener('click', () => {
      jobs = [];
      saveJobs();
      isDemoData = false;
      demoBanner.classList.add('hidden');
      renderJobList();
      showToast('Demo data cleared');
    });

    // Navigation
    function showView(viewId) {
      [viewJobs, viewNewJob, viewJobDetail].forEach(v => v.classList.remove('active'));
      document.getElementById(viewId).classList.add('active');

      if (viewId === 'view-jobs') {
        headerTitle.textContent = 'DryLog';
        btnBack.style.display = 'none';
        btnNewJob.style.display = 'flex';
      } else {
        btnBack.style.display = 'flex';
        btnNewJob.style.display = 'none';
        if (viewId === 'view-new-job') {
          headerTitle.textContent = 'New Job';
        } else if (viewId === 'view-job-detail') {
          const job = jobs.find(j => j.id === currentJobId);
          headerTitle.textContent = job ? job.id : 'Job';
        }
      }
    }

    btnBack.addEventListener('click', () => {
      showView('view-jobs');
      renderJobList();
    });

    btnNewJob.addEventListener('click', () => {
      showView('view-new-job');
      document.getElementById('job-address').focus();
    });

    // Job List
    function renderJobList() {
      if (jobs.length === 0) {
        jobList.innerHTML = `
          <div class="readings-empty">
            <svg class="readings-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M12 2C12 2 6 8.5 6 13.5C6 17.0899 8.68629 20 12 20C15.3137 20 18 17.0899 18 13.5C18 8.5 12 2 12 2Z"/>
              <path d="M12 6V14"/>
              <path d="M9 11L12 14L15 11"/>
            </svg>
            <p>No jobs yet. Tap "New Job" to start a dryout project.</p>
          </div>
        `;
        return;
      }

      jobList.innerHTML = jobs.map(job => {
        const statusLabel = job.status === 'active' ? 'Drying Now' : job.status === 'drying' ? 'Drying' : 'Complete';
        return `
        <div class="job-card" role="listitem" tabindex="0" data-job-id="${job.id}" data-status="${job.status}" aria-label="Job ${job.id}, ${job.address}, ${statusLabel}">
          <div class="job-card-header">
            <span class="job-id">${job.id}</span>
            <span class="job-status-badge status-${job.status}">${statusLabel}</span>
          </div>
          <div class="job-address">${job.address}</div>
          <div class="job-meta">
            <span>${job.customer}</span>
            <span>${job.readings.length} readings</span>
          </div>
        </div>
      `}).join('');

      jobList.querySelectorAll('.job-card').forEach(card => {
        card.addEventListener('click', () => openJob(card.dataset.jobId));
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openJob(card.dataset.jobId);
          }
        });
      });
    }

    function openJob(jobId) {
      currentJobId = jobId;
      showView('view-job-detail');
      renderJobDetail();
    }

    // New Job Form
    newJobForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const address = document.getElementById('job-address').value.trim();
      const customer = document.getElementById('job-customer').value.trim();
      const claim = document.getElementById('job-claim').value.trim();

      const jobNum = String(jobs.length + 43).padStart(4, '0');
      const newJob = {
        id: `JOB-2026-${jobNum}`,
        address,
        customer,
        claim: claim || 'Pending',
        status: 'active',
        date: new Date().toISOString().split('T')[0],
        readings: []
      };

      jobs.unshift(newJob);
      if (isDemoData) {
        jobs = [newJob];
        isDemoData = false;
        demoBanner.classList.add('hidden');
      }
      saveJobs();
      newJobForm.reset();
      currentJobId = newJob.id;
      showView('view-job-detail');
      renderJobDetail();
      showToast('Job created');
    });

    // Job Detail
    function renderJobDetail() {
      const job = jobs.find(j => j.id === currentJobId);
      if (!job) return;

      document.getElementById('detail-job-id').textContent = job.id;
      document.getElementById('detail-address').textContent = job.address;
      document.getElementById('detail-claim').textContent = job.claim ? `Claim: ${job.claim}` : '';

      renderReadings(job);
      renderMap(job);
      renderReport(job);

      // Reset to readings tab
      tabBtns.forEach(btn => btn.classList.remove('active'));
      tabBtns.forEach(btn => btn.setAttribute('aria-selected', 'false'));
      tabContents.forEach(c => c.classList.remove('active'));
      document.getElementById('tab-btn-readings').classList.add('active');
      document.getElementById('tab-btn-readings').setAttribute('aria-selected', 'true');
      document.getElementById('tab-readings').classList.add('active');
    }

    function renderReadings(job) {
      if (job.readings.length === 0) {
        readingsList.innerHTML = `
          <div class="readings-empty">
            <svg class="readings-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M12 2C12 2 6 8.5 6 13.5C6 17.0899 8.68629 20 12 20C15.3137 20 18 17.0899 18 13.5C18 8.5 12 2 12 2Z"/>
              <path d="M12 16V16.01"/>
              <path d="M12 12C12.5523 12 13 11.5523 13 11C13 10.4477 12.5523 10 12 10C11.4477 10 11 10.4477 11 11C11 11.5523 11.4477 12 12 12Z"/>
              <path d="M12 7L12 8"/>
            </svg>
            <p>No moisture readings yet. Tap "Capture Reading" to photograph your meter.</p>
          </div>
        `;
        return;
      }

      readingsList.innerHTML = job.readings.map((r, idx) => {
        const status = r.value >= 16 ? 'wet' : r.value >= 10 ? 'drying' : 'dry';
        const statusLabel = status === 'wet' ? 'Wet' : status === 'drying' ? 'Drying' : 'Dry';
        return `
          <div class="reading-card">
            <img src="${r.photo || 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 64 64%22%3E%3Crect fill=%22%23e5e7eb%22 width=%2264%22 height=%2264%22/%3E%3Ctext x=%2232%22 y=%2236%22 text-anchor=%22middle%22 fill=%22%239ca3af%22 font-size=%2212%22%3E${r.value}%25%3C/text%3E%3C/svg%3E'}" alt="Moisture reading ${r.value}%" class="reading-thumb">
            <div class="reading-info">
              <div class="reading-location">${r.location}</div>
              <span class="reading-value ${status}">${r.value}% ${statusLabel}</span>
              <div class="reading-meta">${r.time} â€¢ GPS tagged</div>
            </div>
            <button class="reading-delete" data-idx="${idx}" aria-label="Delete reading ${r.location}">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
            </button>
          </div>
        `;
      }).join('');

      readingsList.querySelectorAll('.reading-delete').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const idx = parseInt(btn.dataset.idx);
          job.readings.splice(idx, 1);
          saveJobs();
          renderJobDetail();
          showToast('Reading deleted');
        });
      });
    }

    function renderMap(job) {
      const canvas = moistureMap;
      const ctx = canvas.getContext('2d');
      const rect = canvas.parentElement.getBoundingClientRect();

      canvas.width = rect.width * 2;
      canvas.height = rect.height * 2;
      ctx.scale(2, 2);

      const w = rect.width;
      const h = rect.height;

      // Background grid
      ctx.fillStyle = '#f9fafb';
      ctx.fillRect(0, 0, w, h);

      ctx.strokeStyle = '#e5e7eb';
      ctx.lineWidth = 1;
      for (let x = 0; x <= w; x += 40) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, h);
        ctx.stroke();
      }
      for (let y = 0; y <= h; y += 40) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(w, y);
        ctx.stroke();
      }

      // Draw simple floor plan outline
      ctx.strokeStyle = '#6b7280';
      ctx.lineWidth = 2;
      ctx.strokeRect(40, 30, w - 80, h - 60);

      // Draw room dividers
      ctx.strokeStyle = '#9ca3af';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(w / 2, 30);
      ctx.lineTo(w / 2, h - 30);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(40, h / 2);
      ctx.lineTo(w - 40, h / 2);
      ctx.stroke();

      // Room labels
      ctx.fillStyle = '#9ca3af';
      ctx.font = '11px Inter, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('Room 1', w / 4, 50);
      ctx.fillText('Room 2', (3 * w) / 4, 50);
      ctx.fillText('Room 3', w / 4, h / 2 + 25);
      ctx.fillText('Room 4', (3 * w) / 4, h / 2 + 25);

      if (job.readings.length === 0) {
        ctx.fillStyle = '#9ca3af';
        ctx.font = '13px Inter, sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('Readings will appear here', w / 2, h / 2);
        return;
      }

      // Plot readings
      job.readings.forEach((r, i) => {
        const angle = (i / job.readings.length) * Math.PI * 2;
        const radius = Math.min(w, h) * 0.25;
        const x = w / 2 + Math.cos(angle) * radius * (0.5 + Math.random() * 0.5);
        const y = h / 2 + Math.sin(angle) * radius * (0.5 + Math.random() * 0.5);

        // Color based on moisture level
        let color;
        if (r.value >= 16) color = '#dc2626'; // wet
        else if (r.value >= 10) color = '#eab308'; // drying
        else color = '#22c55e'; // dry

        // Outer glow
        ctx.beginPath();
        ctx.arc(x, y, 20, 0, Math.PI * 2);
        ctx.fillStyle = color + '33';
        ctx.fill();

        // Inner dot
        ctx.beginPath();
        ctx.arc(x, y, 10, 0, Math.PI * 2);
        ctx.fillStyle = color;
        ctx.fill();

        // Value label
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 9px Inter, sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(r.value + '%', x, y);
      });
    }

    function renderReport(job) {
      document.getElementById('report-address').textContent = job.address;
      document.getElementById('report-claim').textContent = job.claim ? `Claim #: ${job.claim}` : 'No claim number';
      document.getElementById('report-date').textContent = `Date: ${new Date(job.date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`;

      const wetCount = job.readings.filter(r => r.value >= 16).length;
      const dryingCount = job.readings.filter(r => r.value >= 10 && r.value < 16).length;
      const dryCount = job.readings.filter(r => r.value < 10).length;

      document.getElementById('report-summary').innerHTML = `
        <div class="summary-stat">
          <div class="summary-value">${wetCount}</div>
          <div class="summary-label">Wet Areas</div>
        </div>
        <div class="summary-stat">
          <div class="summary-value">${dryingCount}</div>
          <div class="summary-label">Drying</div>
        </div>
        <div class="summary-stat">
          <div class="summary-value">${dryCount}</div>
          <div class="summary-label">Dry</div>
        </div>
      `;
    }

    // Tabs
    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        tabBtns.forEach(b => { b.classList.remove('active'); b.setAttribute('aria-selected', 'false'); });
        tabContents.forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        btn.setAttribute('aria-selected', 'true');
        const tabId = btn.id.replace('tab-btn-', 'tab-');
        document.getElementById(tabId).classList.add('active');
      });
    });

    // Camera
    btnCapture.addEventListener('click', async () => {
      cameraModal.classList.add('active');
      readingLocation.value = '';
      readingValue.value = '';

      try {
        cameraStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } }
        });
        cameraVideo.srcObject = cameraStream;
      } catch (err) {
        console.error('Camera error:', err);
        showToast('Camera access required');
        closeCameraModal();
      }
    });

    function closeCameraModal() {
      cameraModal.classList.remove('active');
      if (cameraStream) {
        cameraStream.getTracks().forEach(t => t.stop());
        cameraStream = null;
      }
    }

    cameraClose.addEventListener('click', closeCameraModal);

    cameraModal.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeCameraModal();
    });

    btnShutter.addEventListener('click', async () => {
      const location = readingLocation.value.trim() || 'Unknown Location';
      const value = parseInt(readingValue.value) || Math.floor(Math.random() * 40) + 5;

      // Capture frame
      const canvas = document.createElement('canvas');
      canvas.width = cameraVideo.videoWidth || 640;
      canvas.height = cameraVideo.videoHeight || 480;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(cameraVideo, 0, 0);
      const photoData = canvas.toDataURL('image/jpeg', 0.7);

      // Get GPS
      let lat = 31.55 + (Math.random() - 0.5) * 0.1;
      let lng = -97.14 + (Math.random() - 0.5) * 0.1;

      try {
        const pos = await new Promise((resolve, reject) => {
          navigator.geolocation.getCurrentPosition(resolve, reject, { timeout: 3000 });
        });
        lat = pos.coords.latitude;
        lng = pos.coords.longitude;
      } catch (e) {
        // Use default Waco coords
      }

      const job = jobs.find(j => j.id === currentJobId);
      if (job) {
        const now = new Date();
        const time = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });

        job.readings.push({
          id: Date.now(),
          location,
          value,
          time,
          lat,
          lng,
          photo: photoData
        });

        saveJobs();
        renderJobDetail();
        showToast('Reading captured');
      }

      closeCameraModal();
    });

    // Generate PDF
    btnGenerate.addEventListener('click', () => {
      const job = jobs.find(j => j.id === currentJobId);
      if (!job) return;

      // Build report content
      let reportText = `MOISTURE ASSESSMENT REPORT\n`;
      reportText += `Lone Star Flood Restoration\n`;
      reportText += `${'='.repeat(50)}\n\n`;
      reportText += `Job ID: ${job.id}\n`;
      reportText += `Address: ${job.address}\n`;
      reportText += `Customer: ${job.customer}\n`;
      reportText += `Claim #: ${job.claim}\n`;
      reportText += `Date: ${new Date(job.date).toLocaleDateString()}\n\n`;
      reportText += `MOISTURE READINGS\n`;
      reportText += `${'-'.repeat(50)}\n`;

      job.readings.forEach((r, i) => {
        const status = r.value >= 16 ? 'WET' : r.value >= 10 ? 'DRYING' : 'DRY';
        reportText += `${i + 1}. ${r.location}\n`;
        reportText += `   Value: ${r.value}% (${status})\n`;
        reportText += `   Time: ${r.time}\n`;
        reportText += `   GPS: ${r.lat.toFixed(4)}, ${r.lng.toFixed(4)}\n\n`;
      });

      const wetCount = job.readings.filter(r => r.value >= 16).length;
      const dryingCount = job.readings.filter(r => r.value >= 10 && r.value < 16).length;
      const dryCount = job.readings.filter(r => r.value < 10).length;

      reportText += `SUMMARY\n`;
      reportText += `${'-'.repeat(50)}\n`;
      reportText += `Wet Areas (16%+): ${wetCount}\n`;
      reportText += `Drying (10-15%): ${dryingCount}\n`;
      reportText += `Dry (<10%): ${dryCount}\n`;
      reportText += `Total Readings: ${job.readings.length}\n\n`;
      reportText += `Generated by DryLog for Lone Star Flood Restoration\n`;
      reportText += `${new Date().toLocaleString()}\n`;

      // Download as text file (PDF generation would require library)
      const blob = new Blob([reportText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${job.id}-moisture-report.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      showToast('Report downloaded');
    });

    // Init on load
    init();

    // Resize handler for canvas
    window.addEventListener('resize', () => {
      if (currentJobId) {
        const job = jobs.find(j => j.id === currentJobId);
        if (job) renderMap(job);
      }
    });

    // Anti-scrape protection
    document.addEventListener('contextmenu', (e) => {
      if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
        e.preventDefault();
      }
    });
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && (e.key === 's' || e.key === 'p')) {
        e.preventDefault();
      }
    });
    document.addEventListener('selectstart', (e) => {
      if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
        e.preventDefault();
      }
    });
  </script>
</body>
</html>
