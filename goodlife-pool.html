<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex,nofollow">
    <title>Pool Chemistry Health Check ‚Äî Good Life Pool & Spa Care</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        pool: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a5f'
                        },
                        aqua: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669'
                        },
                        warn: {
                            50: '#fffbeb',
                            100: '#fef3c7',
                            400: '#fbbf24',
                            500: '#f59e0b',
                            600: '#d97706'
                        },
                        danger: {
                            50: '#fef2f2',
                            100: '#fee2e2',
                            400: '#f87171',
                            500: '#ef4444',
                            600: '#dc2626'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
        
        .fade-in { animation: fadeIn 0.5s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { to { opacity: 1; } }
        
        .slide-up { animation: slideUp 0.4s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }
        
        .score-ring { transition: stroke-dashoffset 1.5s cubic-bezier(0.4, 0, 0.2, 1); }
        
        .param-card { transition: all 0.3s ease; }
        .param-card:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        
        .input-group input[type="number"] {
            -moz-appearance: textfield;
        }
        .input-group input::-webkit-outer-spin-button,
        .input-group input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .mode-tab { transition: all 0.3s ease; }
        .mode-tab.active { 
            background: white; 
            color: #1e40af; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }
        
        .symptom-card { transition: all 0.3s ease; cursor: pointer; }
        .symptom-card:hover { border-color: #93c5fd; }
        .symptom-card.selected { 
            border-color: #3b82f6; 
            background: #eff6ff;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
        }
        
        .health-bar { transition: width 1s ease-out, background-color 0.5s ease; }
        
        .btn-primary {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        
        .water-bg {
            background: linear-gradient(180deg, #eff6ff 0%, #dbeafe 100%);
        }
        
        .result-gradient {
            background: linear-gradient(135deg, #1e3a5f, #1e40af, #2563eb);
        }
    </style>

    <style>
    /* Kimi UI/UX Improvements */
    .fade-in-up { animation: fadeInUp 0.4s ease-out forwards; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    .radio-option, [class*="option"], [class*="choice"] { 
        min-height: 52px; transition: all 0.15s ease !important; 
    }
    .radio-option:active, [class*="option"]:active { transform: scale(0.98); }
    .btn-primary:active, [class*="btn"]:active { transform: translateY(1px); }
    /* Better progress bar */
    [class*="progress"] { height: 6px !important; border-radius: 3px; }
    </style>
    
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Header -->
    <header class="bg-white border-b border-gray-100 sticky top-0 z-50">
        <div class="max-w-3xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-pool-500 to-pool-700 flex items-center justify-center">
                    <i data-lucide="droplet" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                    <h1 class="text-sm font-bold text-gray-900 leading-tight">Good Life Pool & Spa</h1>
                    <p class="text-xs text-pool-600 font-medium">Mesa, AZ ¬∑ CPO Certified</p>
                </div>
            </div>
            <a href="tel:4802695620" class="flex items-center gap-2 bg-pool-50 text-pool-700 px-3 py-2 rounded-lg text-sm font-medium hover:bg-pool-100 transition-colors">
                <i data-lucide="phone" class="w-4 h-4"></i>
                <span class="hidden sm:inline">(480) 269-5620</span>
            </a>
        </div>
    </header>

    <main class="max-w-3xl mx-auto px-4 py-6">

        <!-- Hero -->
        <div class="text-center mb-8 fade-in">
            <div class="inline-flex items-center gap-2 bg-pool-50 text-pool-700 px-3 py-1.5 rounded-full text-xs font-medium mb-4">
                <i data-lucide="test-tubes" class="w-3.5 h-3.5"></i>
                Free Pool Assessment
            </div>
            <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2">Is Your Pool Water<br>Actually Safe?</h2>
            <p class="text-gray-500 text-sm sm:text-base max-w-lg mx-auto">Arizona's extreme heat, UV, and hard water make pool chemistry harder than you think. Check your levels in 2 minutes ‚Äî we'll tell you what's off and how to fix it.</p>
        </div>

        <!-- Input Mode Toggle -->
        <div id="input-section">
            <div class="bg-pool-100 rounded-xl p-1 flex mb-6 max-w-xs mx-auto">
                <button class="mode-tab active flex-1 rounded-lg py-2 px-3 text-xs font-semibold text-center" onclick="switchMode('numbers')">I Have Test Readings</button>
                <button class="mode-tab flex-1 rounded-lg py-2 px-3 text-xs font-semibold text-center text-pool-600" onclick="switchMode('symptoms')">I Just See Symptoms</button>
            </div>

            <!-- Numbers Mode -->
            <div id="numbers-mode">
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4">
                    <h3 class="text-base font-bold text-gray-900 mb-1">Enter your test strip readings</h3>
                    <p class="text-xs text-gray-500 mb-5">Don't have all the numbers? Just fill in what you have. We'll work with whatever you've got.</p>
                    
                    <div class="space-y-4">
                        <!-- pH -->
                        <div class="input-group">
                            <div class="flex items-center justify-between mb-1.5">
                                <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-purple-400"></span>
                                    pH Level
                                </label>
                                <span class="text-xs text-gray-400">Ideal: 7.2 ‚Äì 7.6</span>
                            </div>
                            <input type="number" id="ph" step="0.1" min="6.0" max="9.0" placeholder="e.g. 7.4" class="w-full border border-gray-200 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-pool-500 focus:ring-2 focus:ring-pool-500/20">
                        </div>
                        
                        <!-- Free Chlorine -->
                        <div class="input-group">
                            <div class="flex items-center justify-between mb-1.5">
                                <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-green-400"></span>
                                    Free Chlorine (ppm)
                                </label>
                                <span class="text-xs text-gray-400">Ideal: 1 ‚Äì 3 ppm</span>
                            </div>
                            <input type="number" id="chlorine" step="0.5" min="0" max="15" placeholder="e.g. 2.0" class="w-full border border-gray-200 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-pool-500 focus:ring-2 focus:ring-pool-500/20">
                        </div>
                        
                        <!-- Total Alkalinity -->
                        <div class="input-group">
                            <div class="flex items-center justify-between mb-1.5">
                                <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-blue-400"></span>
                                    Total Alkalinity (ppm)
                                </label>
                                <span class="text-xs text-gray-400">Ideal: 80 ‚Äì 120 ppm</span>
                            </div>
                            <input type="number" id="alkalinity" step="10" min="0" max="300" placeholder="e.g. 100" class="w-full border border-gray-200 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-pool-500 focus:ring-2 focus:ring-pool-500/20">
                        </div>
                        
                        <!-- CYA / Stabilizer -->
                        <div class="input-group">
                            <div class="flex items-center justify-between mb-1.5">
                                <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-amber-400"></span>
                                    CYA / Stabilizer (ppm)
                                </label>
                                <span class="text-xs text-gray-400">Ideal: 30 ‚Äì 50 ppm</span>
                            </div>
                            <input type="number" id="cya" step="5" min="0" max="200" placeholder="e.g. 40" class="w-full border border-gray-200 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-pool-500 focus:ring-2 focus:ring-pool-500/20">
                            <p class="text-xs text-amber-600 mt-1.5 flex items-start gap-1">
                                <i data-lucide="alert-triangle" class="w-3 h-3 mt-0.5 flex-shrink-0"></i>
                                <span>Arizona #1 issue: CYA builds up from stabilized chlorine tablets. High CYA makes chlorine ineffective even when levels test "normal."</span>
                            </p>
                        </div>
                        
                        <!-- Calcium Hardness -->
                        <div class="input-group">
                            <div class="flex items-center justify-between mb-1.5">
                                <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-cyan-400"></span>
                                    Calcium Hardness (ppm)
                                </label>
                                <span class="text-xs text-gray-400">Ideal: 200 ‚Äì 400 ppm</span>
                            </div>
                            <input type="number" id="calcium" step="10" min="0" max="800" placeholder="e.g. 300" class="w-full border border-gray-200 rounded-lg px-4 py-2.5 text-sm focus:outline-none focus:border-pool-500 focus:ring-2 focus:ring-pool-500/20">
                            <p class="text-xs text-gray-400 mt-1">Arizona's water is naturally hard ‚Äî calcium tends to run high here.</p>
                        </div>
                    </div>
                </div>

                <button onclick="analyzeNumbers()" class="btn-primary w-full text-white font-semibold py-3.5 rounded-xl text-sm flex items-center justify-center gap-2 mb-6">
                    <i data-lucide="search" class="w-4 h-4"></i>
                    Analyze My Pool Water
                </button>
            </div>

            <!-- Symptoms Mode -->
            <div id="symptoms-mode" class="hidden">
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4">
                    <h3 class="text-base font-bold text-gray-900 mb-1">What are you seeing?</h3>
                    <p class="text-xs text-gray-500 mb-5">Select everything that describes your pool right now. We'll diagnose the likely chemistry issues.</p>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3" id="symptoms-grid">
                        <div class="symptom-card border-2 border-gray-200 rounded-xl p-3 flex items-start gap-3" data-symptom="green-water" onclick="toggleSymptom(this)">
                            <span class="text-xl">üü¢</span>
                            <div>
                                <p class="text-sm font-semibold text-gray-800">Green/cloudy water</p>
                                <p class="text-xs text-gray-400">Algae growth, murky look</p>
                            </div>
                        </div>
                        <div class="symptom-card border-2 border-gray-200 rounded-xl p-3 flex items-start gap-3" data-symptom="eye-sting" onclick="toggleSymptom(this)">
                            <span class="text-xl">üëÅÔ∏è</span>
                            <div>
                                <p class="text-sm font-semibold text-gray-800">Eyes sting/burn</p>
                                <p class="text-xs text-gray-400">Red eyes after swimming</p>
                            </div>
                        </div>
                        <div class="symptom-card border-2 border-gray-200 rounded-xl p-3 flex items-start gap-3" data-symptom="white-scale" onclick="toggleSymptom(this)">
                            <span class="text-xl">‚¨ú</span>
                            <div>
                                <p class="text-sm font-semibold text-gray-800">White scale buildup</p>
                                <p class="text-xs text-gray-400">Crusty white along waterline/tile</p>
                            </div>
                        </div>
                        <div class="symptom-card border-2 border-gray-200 rounded-xl p-3 flex items-start gap-3" data-symptom="chlorine-smell" onclick="toggleSymptom(this)">
                            <span class="text-xl">üëÉ</span>
                            <div>
                                <p class="text-sm font-semibold text-gray-800">Strong chlorine smell</p>
                                <p class="text-xs text-gray-400">Chemical odor near pool</p>
                            </div>
                        </div>
                        <div class="symptom-card border-2 border-gray-200 rounded-xl p-3 flex items-start gap-3" data-symptom="skin-dry" onclick="toggleSymptom(this)">
                            <span class="text-xl">ü§ö</span>
                            <div>
                                <p class="text-sm font-semibold text-gray-800">Dry/itchy skin after</p>
                                <p class="text-xs text-gray-400">Skin irritation from swimming</p>
                            </div>
                        </div>
                        <div class="symptom-card border-2 border-gray-200 rounded-xl p-3 flex items-start gap-3" data-symptom="algae-walls" onclick="toggleSymptom(this)">
                            <span class="text-xl">üß±</span>
                            <div>
                                <p class="text-sm font-semibold text-gray-800">Slippery/slimy walls</p>
                                <p class="text-xs text-gray-400">Algae on surfaces</p>
                            </div>
                        </div>
                        <div class="symptom-card border-2 border-gray-200 rounded-xl p-3 flex items-start gap-3" data-symptom="stains" onclick="toggleSymptom(this)">
                            <span class="text-xl">üü§</span>
                            <div>
                                <p class="text-sm font-semibold text-gray-800">Staining on surfaces</p>
                                <p class="text-xs text-gray-400">Brown, green, or blue marks</p>
                            </div>
                        </div>
                        <div class="symptom-card border-2 border-gray-200 rounded-xl p-3 flex items-start gap-3" data-symptom="foam" onclick="toggleSymptom(this)">
                            <span class="text-xl">ü´ß</span>
                            <div>
                                <p class="text-sm font-semibold text-gray-800">Foaming/bubbles</p>
                                <p class="text-xs text-gray-400">Persistent foam on surface</p>
                            </div>
                        </div>
                    </div>
                </div>

                <button onclick="analyzeSymptoms()" id="btn-symptoms" class="btn-primary w-full text-white font-semibold py-3.5 rounded-xl text-sm flex items-center justify-center gap-2 mb-6 opacity-50 pointer-events-none" disabled>
                    <i data-lucide="search" class="w-4 h-4"></i>
                    Diagnose My Pool
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results-section" class="hidden">
            <!-- Overall Score -->
            <div class="result-gradient rounded-2xl p-6 sm:p-8 mb-6 text-white text-center slide-up">
                <p class="text-xs uppercase tracking-wider text-white/50 font-medium mb-3">Your Pool Health Score</p>
                <div class="relative w-36 h-36 mx-auto mb-4">
                    <svg class="w-full h-full -rotate-90" viewBox="0 0 120 120">
                        <circle cx="60" cy="60" r="52" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="10"/>
                        <circle cx="60" cy="60" r="52" fill="none" stroke="white" stroke-width="10" stroke-linecap="round"
                            stroke-dasharray="327" stroke-dashoffset="327" class="score-ring" id="score-ring"/>
                    </svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <span class="text-4xl font-extrabold" id="overall-score">0</span>
                        <span class="text-xs text-white/60">out of 100</span>
                    </div>
                </div>
                <p class="text-lg font-bold mb-1" id="score-label">Analyzing...</p>
                <p class="text-sm text-white/60" id="score-description"></p>
            </div>

            <!-- Parameter Breakdown -->
            <div id="param-results" class="space-y-3 mb-6">
                <!-- Filled by JS -->
            </div>

            <!-- Arizona Alert -->
            <div id="az-alert" class="bg-amber-50 border border-amber-200 rounded-2xl p-5 mb-6 hidden slide-up">
                <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0">
                        <i data-lucide="sun" class="w-5 h-5 text-amber-600"></i>
                    </div>
                    <div>
                        <h4 class="text-sm font-bold text-amber-800 mb-1">Arizona-Specific Warning</h4>
                        <p class="text-xs text-amber-700 leading-relaxed" id="az-alert-text"></p>
                    </div>
                </div>
            </div>

            <!-- CTA -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-6 text-center slide-up">
                <div class="w-14 h-14 rounded-full bg-pool-100 flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="shield-check" class="w-7 h-7 text-pool-600"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-900 mb-2">Stop Guessing. Start Swimming.</h3>
                <p class="text-sm text-gray-500 mb-1">This is exactly what Shaun checks every single week for Good Life customers.</p>
                <p class="text-sm text-gray-500 mb-5">Weekly professional service starts at <strong class="text-gray-900">$140/month</strong> ‚Äî that's less than $5/day for a pool that's always ready.</p>
                
                <a href="tel:4802695620" class="btn-primary inline-flex items-center gap-2 text-white font-semibold py-3 px-8 rounded-xl text-sm mb-3">
                    <i data-lucide="phone" class="w-4 h-4"></i>
                    Call Shaun: (480) 269-5620
                </a>
                <p class="text-xs text-gray-400">Free estimates ¬∑ CPO certified ¬∑ ROC #334813</p>
            </div>

            <!-- Quick fix tips -->
            <div id="fix-tips" class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-6">
                <h3 class="text-base font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <i data-lucide="wrench" class="w-4 h-4 text-pool-600"></i>
                    Quick Fixes You Can Try
                </h3>
                <div id="tips-list" class="space-y-3">
                    <!-- Filled by JS -->
                </div>
                <div class="mt-4 pt-4 border-t border-gray-100">
                    <p class="text-xs text-gray-400">These are temporary fixes. For consistent, worry-free water, professional weekly service is the real solution ‚Äî especially in Arizona's heat.</p>
                </div>
            </div>

            <button onclick="startOver()" class="w-full bg-white border border-gray-200 text-gray-600 font-medium py-3 rounded-xl text-sm hover:bg-gray-50 transition-colors mb-6">
                Test Different Readings
            </button>
        </div>

        <!-- Social proof -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 mb-6">
            <div class="flex items-center justify-center gap-6 flex-wrap text-center">
                <div class="flex items-center gap-2">
                    <span class="text-yellow-400">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                    <span class="text-xs font-medium text-gray-600">5-Star Rated</span>
                </div>
                <div class="text-xs text-gray-400">|</div>
                <div class="text-xs font-medium text-gray-600">CPO Certified</div>
                <div class="text-xs text-gray-400">|</div>
                <div class="text-xs font-medium text-gray-600">$140/mo Starting</div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 mt-8">
        <div class="max-w-3xl mx-auto px-4 py-8">
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
                <div>
                    <h3 class="text-white font-bold text-sm mb-1">Good Life Pool & Spa Care</h3>
                    <p class="text-xs">913 N Orlando, Mesa, AZ 85205</p>
                </div>
                <a href="tel:4802695620" class="text-pool-400 font-medium text-sm">(480) 269-5620</a>
            </div>
            <div class="text-xs space-y-1 mb-4">
                <p>Owner-operated by Shaun Erwin ¬∑ CPO Certified ¬∑ ROC License #334813</p>
                <p>Midwest values in a Southwest paradise</p>
                <p>Serving Mesa, Gilbert & Apache Junction ¬∑ Residential & Commercial</p>
            </div>
            <div class="flex items-center gap-4 pt-4 border-t border-gray-800">
                <a href="https://www.facebook.com/goodlifepoolcare" target="_blank" class="text-gray-500 hover:text-pool-400 transition-colors">
                    <i data-lucide="facebook" class="w-4 h-4"></i>
                </a>
                <a href="https://www.instagram.com/goodlifepoolcare/" target="_blank" class="text-gray-500 hover:text-pool-400 transition-colors">
                    <i data-lucide="instagram" class="w-4 h-4"></i>
                </a>
                <span class="text-xs text-gray-600 ml-auto">goodlifepoolcare.com</span>
            </div>
        </div>
    </footer>

    <script>
    // ============ STATE ============
    let selectedSymptoms = new Set();

    // ============ PARAMETER DEFINITIONS ============
    const params = {
        ph: {
            name: 'pH Level',
            color: 'purple',
            ideal: { min: 7.2, max: 7.6 },
            warn: { min: 7.0, max: 7.8 },
            unit: '',
            getStatus(val) {
                if (val >= 7.2 && val <= 7.6) return { status: 'good', label: 'Perfect Range', score: 100 };
                if (val >= 7.0 && val < 7.2) return { status: 'warn', label: 'Slightly Low', score: 70, fix: 'Add sodium bicarbonate (baking soda) to raise pH. Add about 1.5 lbs per 10,000 gallons to raise pH by 0.2.' };
                if (val > 7.6 && val <= 7.8) return { status: 'warn', label: 'Slightly High', score: 70, fix: 'Add muriatic acid to lower pH. Start with 1 cup per 10,000 gallons and retest after 4 hours.' };
                if (val < 7.0) return { status: 'danger', label: 'Too Low ‚Äî Corrosive', score: 30, fix: 'pH this low corrodes equipment and irritates skin. Add sodium bicarbonate immediately. Consider professional inspection of equipment for damage.' };
                if (val > 7.8) return { status: 'danger', label: 'Too High ‚Äî Chlorine Ineffective', score: 30, fix: 'High pH makes chlorine up to 75% less effective. Add muriatic acid carefully. At pH 8.0, you need 3x more chlorine to sanitize.' };
                return { status: 'unknown', label: 'Out of Range', score: 20 };
            },
            azNote: 'Arizona\'s hard water naturally pushes pH up. You\'ll fight this constantly ‚Äî it\'s one of the main reasons Arizona pool owners need weekly professional checks.'
        },
        chlorine: {
            name: 'Free Chlorine',
            color: 'green',
            ideal: { min: 1, max: 3 },
            unit: 'ppm',
            getStatus(val) {
                if (val >= 1 && val <= 3) return { status: 'good', label: 'Safe Range', score: 100 };
                if (val >= 0.5 && val < 1) return { status: 'warn', label: 'Getting Low', score: 60, fix: 'Add liquid chlorine or shock the pool. In Arizona summer, chlorine depletes fast ‚Äî you may need to shock 2-3x per week.' };
                if (val > 3 && val <= 5) return { status: 'warn', label: 'A Bit High', score: 75, fix: 'Wait it out ‚Äî Arizona sun will burn it off within a day. Don\'t swim until it drops below 3 ppm.' };
                if (val < 0.5) return { status: 'danger', label: 'Dangerously Low', score: 15, fix: 'Your pool is essentially unprotected. Algae and bacteria can grow within hours in Arizona heat. Shock immediately with 2-3 lbs of cal-hypo per 10,000 gallons.' };
                if (val > 5) return { status: 'danger', label: 'Too High to Swim', score: 40, fix: 'Do NOT swim. Chlorine over 5 ppm causes skin burns and eye damage. Wait for sun to bring it down, or add sodium thiosulfate to neutralize.' };
                return { status: 'unknown', label: 'Out of Range', score: 20 };
            },
            azNote: 'At 110¬∞F+ with intense UV, Arizona pools can lose 2-3 ppm of chlorine per day. That\'s why CYA (stabilizer) is critical here ‚Äî but too much CYA creates its own problems.'
        },
        alkalinity: {
            name: 'Total Alkalinity',
            color: 'blue',
            ideal: { min: 80, max: 120 },
            unit: 'ppm',
            getStatus(val) {
                if (val >= 80 && val <= 120) return { status: 'good', label: 'Well Buffered', score: 100 };
                if (val >= 60 && val < 80) return { status: 'warn', label: 'Low ‚Äî pH Will Bounce', score: 65, fix: 'Add sodium bicarbonate. Low alkalinity means pH swings wildly ‚Äî you\'ll chase your numbers all week.' };
                if (val > 120 && val <= 150) return { status: 'warn', label: 'Slightly High', score: 75, fix: 'Add muriatic acid to lower. High alkalinity pushes pH up and makes it hard to adjust.' };
                if (val < 60) return { status: 'danger', label: 'Very Low ‚Äî Unstable Water', score: 25, fix: 'Water this unstable can corrode surfaces and equipment. Add sodium bicarbonate in multiple doses over several days.' };
                if (val > 150) return { status: 'danger', label: 'Too High ‚Äî Scaling Risk', score: 35, fix: 'Combined with Arizona\'s hard water, this guarantees calcium scale buildup on tile and equipment. Needs professional treatment.' };
                return { status: 'unknown', label: 'Out of Range', score: 20 };
            },
            azNote: 'Alkalinity acts as a buffer for pH. In Arizona, evaporation concentrates minerals and pushes alkalinity up over time.'
        },
        cya: {
            name: 'CYA / Stabilizer',
            color: 'amber',
            ideal: { min: 30, max: 50 },
            unit: 'ppm',
            getStatus(val) {
                if (val >= 30 && val <= 50) return { status: 'good', label: 'Good Protection', score: 100 };
                if (val >= 50 && val <= 70) return { status: 'warn', label: 'Getting High', score: 60, fix: 'Stop using stabilized chlorine tablets (trichlor). Switch to liquid chlorine. CYA only leaves the water through dilution ‚Äî you may need a partial drain.' };
                if (val >= 20 && val < 30) return { status: 'warn', label: 'A Bit Low', score: 70, fix: 'Add cyanuric acid (stabilizer). Without enough CYA, Arizona sun destroys chlorine within hours.' };
                if (val < 20) return { status: 'danger', label: 'Unprotected ‚Äî Chlorine Burns Off', score: 30, fix: 'In Arizona, CYA below 20 means you\'re basically pouring chlorine money into the sun. Add stabilizer immediately.' };
                if (val > 70) return { status: 'danger', label: 'Chlorine Lock Risk', score: 20, fix: 'This is THE #1 Arizona pool problem. High CYA makes chlorine ineffective ‚Äî your pool tests "fine" but algae grows anyway. Only fix: partial drain and refill (25-50% of water). This is exactly what a pro handles.' };
                return { status: 'unknown', label: 'Out of Range', score: 20 };
            },
            azNote: 'This is by far the most common problem in Arizona pools. Every stabilized chlorine tablet adds CYA that NEVER leaves except through water replacement. Most DIY Arizona pools are sitting at 100+ ppm CYA without knowing it.'
        },
        calcium: {
            name: 'Calcium Hardness',
            color: 'cyan',
            ideal: { min: 200, max: 400 },
            unit: 'ppm',
            getStatus(val) {
                if (val >= 200 && val <= 400) return { status: 'good', label: 'Good Range', score: 100 };
                if (val >= 150 && val < 200) return { status: 'warn', label: 'A Bit Low', score: 70, fix: 'Add calcium chloride to raise hardness. Low calcium can etch plaster surfaces.' };
                if (val > 400 && val <= 500) return { status: 'warn', label: 'Getting High', score: 60, fix: 'Arizona fill water is already hard. As water evaporates, calcium concentrates. Use a hose filter when topping off, and consider partial drains periodically.' };
                if (val < 150) return { status: 'danger', label: 'Too Low ‚Äî Surface Damage', score: 35, fix: 'Water will pull calcium from plaster/tile, causing permanent etching. Add calcium chloride promptly.' };
                if (val > 500) return { status: 'danger', label: 'Scale City', score: 25, fix: 'At this level, calcium deposits on everything ‚Äî tile, equipment, heater elements. Partial drain with soft water is the only fix. A professional can also add sequestrant to manage it.' };
                return { status: 'unknown', label: 'Out of Range', score: 20 };
            },
            azNote: 'Mesa\'s tap water is 250-350 ppm calcium out of the faucet. Every time you add water to replace evaporation, you\'re adding more calcium. It only goes up.'
        }
    };

    // ============ SYMPTOM MAPPING ============
    const symptomDiagnoses = {
        'green-water': {
            likely: ['Low chlorine', 'High CYA (chlorine lock)', 'pH imbalance'],
            severity: 'high',
            explanation: 'Green water = algae growth. In Arizona, this usually means your chlorine is ineffective ‚Äî either too low, or your CYA is so high that chlorine can\'t work. This is the most common call Good Life gets.',
            fix: 'Shock the pool with liquid chlorine (not tablets ‚Äî they add more CYA). If it comes back within a week, CYA is likely too high and you need a partial drain.'
        },
        'eye-sting': {
            likely: ['pH too low or too high', 'Chloramines (combined chlorine)', 'High TDS'],
            severity: 'medium',
            explanation: 'Stinging eyes usually means pH is off (not actually "too much chlorine" like most people think). Could also mean chloramines ‚Äî chlorine that\'s used up but still in the water.',
            fix: 'Test pH first. If it\'s below 7.0 or above 7.8, that\'s your answer. If pH is fine, shock the pool to break down chloramines.'
        },
        'white-scale': {
            likely: ['High calcium hardness', 'High pH', 'High alkalinity'],
            severity: 'medium',
            explanation: 'White crusty buildup along the waterline is calcium scale. Very common in Arizona because of the hard water. It gets worse as water evaporates and concentrates minerals.',
            fix: 'Use a pumice stone to remove existing scale from tile. Lower pH to 7.2 to slow further deposits. Consider adding a sequestrant. Long-term: use a hose filter and periodic partial drains.'
        },
        'chlorine-smell': {
            likely: ['Chloramines (NOT too much chlorine)', 'Combined chlorine too high'],
            severity: 'medium',
            explanation: 'A strong "chlorine" smell actually means there\'s NOT ENOUGH active chlorine. What you\'re smelling is chloramines ‚Äî chlorine that\'s been used up fighting contaminants. A well-chlorinated pool has almost no smell.',
            fix: 'Shock the pool to "break point" ‚Äî add enough chlorine to destroy all chloramines. Usually 2-3x your normal shock dose.'
        },
        'skin-dry': {
            likely: ['pH too high', 'High TDS', 'Chloramine irritation'],
            severity: 'low',
            explanation: 'Dry or itchy skin after swimming usually indicates pH is above 7.6, or total dissolved solids (TDS) are too high from years of chemical additions without draining.',
            fix: 'Check and adjust pH to 7.2-7.4. If the problem persists, TDS may be high ‚Äî a partial drain and refill with fresh water helps.'
        },
        'algae-walls': {
            likely: ['Chlorine too low or ineffective', 'High CYA', 'Poor circulation'],
            severity: 'high',
            explanation: 'Slippery walls are the first sign of algae taking hold. In Arizona\'s heat, algae can go from "a little slippery" to "green swamp" in 48 hours.',
            fix: 'Brush all walls thoroughly, then shock hard. Run the pump 24 hours. If it keeps coming back, your CYA is likely too high ‚Äî chlorine can\'t fight it.'
        },
        'stains': {
            likely: ['Metal content (iron/copper)', 'Organic staining', 'Low pH corroding pipes'],
            severity: 'medium',
            explanation: 'Brown/rust stains = iron. Blue/green stains = copper (often from corroded heat exchanger). Organic stains come from leaves/berries sitting on the surface.',
            fix: 'Identify the stain type first. For metal stains, add a metal sequestrant. For organic, apply granular chlorine directly on the stain. Professional acid washing may be needed for severe cases.'
        },
        'foam': {
            likely: ['Detergent/soap contamination', 'High TDS', 'Algaecide overuse'],
            severity: 'low',
            explanation: 'Foam usually means something soapy got in the pool ‚Äî sunscreen, laundry detergent on swimsuits, or too much foaming algaecide.',
            fix: 'Wait it out and run the filter. For persistent foam, use an anti-foam agent or do a partial water change. Rinse swimsuits before swimming.'
        }
    };

    // ============ MODE SWITCHING ============
    function switchMode(mode) {
        const tabs = document.querySelectorAll('.mode-tab');
        tabs.forEach(t => t.classList.remove('active'));
        
        if (mode === 'numbers') {
            tabs[0].classList.add('active');
            document.getElementById('numbers-mode').classList.remove('hidden');
            document.getElementById('symptoms-mode').classList.add('hidden');
        } else {
            tabs[1].classList.add('active');
            document.getElementById('numbers-mode').classList.add('hidden');
            document.getElementById('symptoms-mode').classList.remove('hidden');
        }
    }

    // ============ SYMPTOM SELECTION ============
    function toggleSymptom(el) {
        const s = el.dataset.symptom;
        if (selectedSymptoms.has(s)) {
            selectedSymptoms.delete(s);
            el.classList.remove('selected');
        } else {
            selectedSymptoms.add(s);
            el.classList.add('selected');
        }
        
        const btn = document.getElementById('btn-symptoms');
        if (selectedSymptoms.size > 0) {
            btn.disabled = false;
            btn.classList.remove('opacity-50', 'pointer-events-none');
        } else {
            btn.disabled = true;
            btn.classList.add('opacity-50', 'pointer-events-none');
        }
    }

    // ============ ANALYSIS ============
    function analyzeNumbers() {
        const readings = {};
        let hasAny = false;
        
        ['ph', 'chlorine', 'alkalinity', 'cya', 'calcium'].forEach(p => {
            const val = document.getElementById(p).value;
            if (val !== '') {
                readings[p] = parseFloat(val);
                hasAny = true;
            }
        });
        
        if (!hasAny) {
            alert('Enter at least one reading to analyze.');
            return;
        }
        
        let results = [];
        let totalScore = 0;
        let testedCount = 0;
        let tips = [];
        let azAlerts = [];
        
        Object.keys(params).forEach(key => {
            if (readings[key] !== undefined) {
                const p = params[key];
                const analysis = p.getStatus(readings[key]);
                testedCount++;
                totalScore += analysis.score;
                
                results.push({
                    key,
                    name: p.name,
                    value: readings[key],
                    unit: p.unit,
                    color: p.color,
                    ...analysis
                });
                
                if (analysis.fix) {
                    tips.push({ param: p.name, fix: analysis.fix, status: analysis.status });
                }
                
                if (analysis.status !== 'good') {
                    azAlerts.push(p.azNote);
                }
            }
        });
        
        const avgScore = Math.round(totalScore / testedCount);
        showResults(avgScore, results, tips, azAlerts, testedCount);
    }

    function analyzeSymptoms() {
        if (selectedSymptoms.size === 0) return;
        
        let allIssues = new Set();
        let tips = [];
        let maxSeverity = 'low';
        const sevOrder = { low: 1, medium: 2, high: 3 };
        
        selectedSymptoms.forEach(s => {
            const diag = symptomDiagnoses[s];
            diag.likely.forEach(i => allIssues.add(i));
            tips.push({ param: s.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase()), fix: diag.fix, explanation: diag.explanation, status: diag.severity === 'high' ? 'danger' : diag.severity === 'medium' ? 'warn' : 'good' });
            if (sevOrder[diag.severity] > sevOrder[maxSeverity]) maxSeverity = diag.severity;
        });
        
        let score = maxSeverity === 'high' ? 25 : maxSeverity === 'medium' ? 55 : 75;
        score -= (selectedSymptoms.size - 1) * 5;
        score = Math.max(10, score);
        
        // Build symptom results
        let results = [];
        selectedSymptoms.forEach(s => {
            const diag = symptomDiagnoses[s];
            results.push({
                key: s,
                name: s.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase()),
                value: null,
                status: diag.severity === 'high' ? 'danger' : diag.severity === 'medium' ? 'warn' : 'good',
                label: diag.likely[0],
                explanation: diag.explanation
            });
        });
        
        let azAlerts = ['In Arizona, the most common root cause of multiple pool symptoms is CYA (stabilizer) buildup from chlorine tablets. When CYA exceeds 70 ppm, chlorine becomes ineffective even when test strips say levels are "fine." The only fix is partially draining and refilling the pool.'];
        
        showResults(score, results, tips, azAlerts, selectedSymptoms.size);
    }

    function showResults(score, results, tips, azAlerts, count) {
        document.getElementById('input-section').classList.add('hidden');
        document.getElementById('results-section').classList.remove('hidden');
        
        // Animate score ring
        setTimeout(() => {
            const ring = document.getElementById('score-ring');
            const offset = 327 - (327 * score / 100);
            ring.style.strokeDashoffset = offset;
            
            // Color the ring based on score
            if (score >= 80) ring.style.stroke = '#10b981';
            else if (score >= 50) ring.style.stroke = '#fbbf24';
            else ring.style.stroke = '#ef4444';
        }, 100);
        
        // Score number animation
        let current = 0;
        const interval = setInterval(() => {
            current += Math.ceil(score / 30);
            if (current >= score) { current = score; clearInterval(interval); }
            document.getElementById('overall-score').textContent = current;
        }, 40);
        
        // Score label
        const label = document.getElementById('score-label');
        const desc = document.getElementById('score-description');
        if (score >= 80) {
            label.textContent = 'Looking Good! üëç';
            desc.textContent = 'Your water chemistry is in solid shape. Keep up the regular testing.';
        } else if (score >= 50) {
            label.textContent = 'Needs Attention ‚ö†Ô∏è';
            desc.textContent = 'Some parameters are off. Fixable, but don\'t ignore it ‚Äî Arizona heat makes problems worse fast.';
        } else {
            label.textContent = 'Needs Professional Help üö®';
            desc.textContent = 'Multiple issues detected. In Arizona\'s extreme conditions, this can cause equipment damage and health risks within days.';
        }
        
        // Parameter cards
        const paramEl = document.getElementById('param-results');
        paramEl.innerHTML = results.map((r, i) => {
            const statusColors = {
                good: { bg: 'bg-emerald-50', border: 'border-emerald-200', text: 'text-emerald-700', badge: 'bg-emerald-100 text-emerald-700', bar: 'bg-emerald-500' },
                warn: { bg: 'bg-amber-50', border: 'border-amber-200', text: 'text-amber-700', badge: 'bg-amber-100 text-amber-700', bar: 'bg-amber-500' },
                danger: { bg: 'bg-red-50', border: 'border-red-200', text: 'text-red-700', badge: 'bg-red-100 text-red-700', bar: 'bg-red-500' },
                unknown: { bg: 'bg-gray-50', border: 'border-gray-200', text: 'text-gray-700', badge: 'bg-gray-100 text-gray-700', bar: 'bg-gray-500' }
            };
            const c = statusColors[r.status] || statusColors.unknown;
            const statusIcon = r.status === 'good' ? 'check-circle-2' : r.status === 'warn' ? 'alert-triangle' : 'alert-circle';
            
            return `
                <div class="param-card ${c.bg} border ${c.border} rounded-xl p-4 slide-up" style="animation-delay: ${i * 0.1}s">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-2">
                            <i data-lucide="${statusIcon}" class="w-4 h-4 ${c.text}"></i>
                            <span class="text-sm font-semibold text-gray-800">${r.name}</span>
                        </div>
                        <span class="text-xs font-medium px-2 py-0.5 rounded-full ${c.badge}">${r.label}</span>
                    </div>
                    ${r.value !== null ? `<p class="text-lg font-bold text-gray-900 mb-1">${r.value} ${r.unit || ''}</p>` : ''}
                    ${r.explanation ? `<p class="text-xs text-gray-600 leading-relaxed">${r.explanation}</p>` : ''}
                </div>
            `;
        }).join('');
        
        // Arizona alert
        if (azAlerts.length > 0) {
            document.getElementById('az-alert').classList.remove('hidden');
            document.getElementById('az-alert-text').textContent = azAlerts[0];
        }
        
        // Fix tips
        const tipsList = document.getElementById('tips-list');
        if (tips.length > 0) {
            document.getElementById('fix-tips').classList.remove('hidden');
            tipsList.innerHTML = tips.map(t => `
                <div class="flex items-start gap-3">
                    <div class="w-6 h-6 rounded-full ${t.status === 'danger' ? 'bg-red-100' : 'bg-amber-100'} flex items-center justify-center flex-shrink-0 mt-0.5">
                        <i data-lucide="wrench" class="w-3 h-3 ${t.status === 'danger' ? 'text-red-600' : 'text-amber-600'}"></i>
                    </div>
                    <div>
                        <p class="text-xs font-semibold text-gray-700">${t.param}</p>
                        <p class="text-xs text-gray-500 leading-relaxed">${t.fix}</p>
                    </div>
                </div>
            `).join('');
        } else {
            document.getElementById('fix-tips').classList.add('hidden');
        }
        
        // Save results
        localStorage.setItem('glpool-results', JSON.stringify({
            score, results, tips,
            timestamp: new Date().toISOString()
        }));
        
        lucide.createIcons();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function startOver() {
        document.getElementById('results-section').classList.add('hidden');
        document.getElementById('input-section').classList.remove('hidden');
        
        // Reset number inputs
        ['ph', 'chlorine', 'alkalinity', 'cya', 'calcium'].forEach(p => {
            document.getElementById(p).value = '';
        });
        
        // Reset symptoms
        selectedSymptoms.clear();
        document.querySelectorAll('.symptom-card').forEach(c => c.classList.remove('selected'));
        const btn = document.getElementById('btn-symptoms');
        btn.disabled = true;
        btn.classList.add('opacity-50', 'pointer-events-none');
        
        // Reset score ring
        document.getElementById('score-ring').style.strokeDashoffset = 327;
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ============ INIT ============
    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();
    });
    </script>
</body>
</html>
