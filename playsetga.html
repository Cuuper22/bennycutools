<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PlaysetQuote - Playset Installations of Georgia</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cabin:wght@400;600;700&family=Source+Sans+3:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --green-deep: #2d5a27;
  --green-mid: #4a7c3f;
  --green-light: #6b9f5e;
  --green-pale: #e8f0e5;
  --brown-dark: #5c3317;
  --brown-mid: #8B4513;
  --brown-light: #c49a6c;
  --brown-pale: #f5eee6;
  --cream: #faf8f3;
  --white: #ffffff;
  --text-primary: #2a2a2a;
  --text-secondary: #5a5a5a;
  --text-muted: #8a8a8a;
  --border: #e0ddd5;
  --success: #2d8a4e;
  --error: #c0392b;
  --warning: #d4a017;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.08);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.08), 0 2px 4px rgba(0,0,0,0.06);
  --shadow-lg: 0 8px 24px rgba(0,0,0,0.1), 0 4px 8px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
  --shadow-xl: 0 16px 48px rgba(0,0,0,0.12), 0 8px 16px rgba(0,0,0,0.08), 0 2px 4px rgba(0,0,0,0.04);
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 24px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
*:focus-visible { outline: 2px solid var(--green-mid); outline-offset: 2px; }

html { font-size: 16px; -webkit-text-size-adjust: 100%; }
body {
  font-family: 'Source Sans 3', -apple-system, sans-serif;
  background: var(--cream);
  color: var(--text-primary);
  min-height: 100vh;
  padding-bottom: 120px;
  -webkit-font-smoothing: antialiased;
}

@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    transition-duration: 0.01ms !important;
  }
}

/* === HEADER === */
.app-header {
  background: linear-gradient(135deg, var(--green-deep) 0%, var(--green-mid) 100%);
  color: white;
  padding: 16px 20px;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: var(--shadow-md);
}
.app-header h1 {
  font-family: 'Cabin', sans-serif;
  font-size: 20px;
  font-weight: 700;
  letter-spacing: -0.3px;
}
.app-header .subtitle {
  font-size: 12px;
  opacity: 0.8;
  margin-top: 2px;
  font-weight: 300;
}

/* === DEMO BANNER === */
.demo-banner {
  background: var(--brown-pale);
  border-bottom: 1px solid var(--brown-light);
  padding: 10px 20px;
  font-size: 13px;
  color: var(--brown-dark);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}
.demo-banner button {
  background: none;
  border: 1px solid var(--brown-mid);
  color: var(--brown-mid);
  padding: 4px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  font-family: inherit;
  white-space: nowrap;
  transition: all 0.15s;
}
.demo-banner button:active { transform: scale(0.97); }

/* === MAIN CONTENT === */
.content { padding: 0 16px; max-width: 500px; margin: 0 auto; }

/* === QUOTE LIST VIEW === */
.view { display: none; }
.view.active { display: block; }

.quote-card {
  background: var(--white);
  border-radius: var(--radius-lg);
  padding: 20px;
  margin: 16px 0;
  box-shadow: var(--shadow-md);
  border: 1px solid var(--border);
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  animation: slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) both;
  position: relative;
  overflow: hidden;
}
.quote-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0;
  width: 4px;
  height: 100%;
  border-radius: 4px 0 0 4px;
}
.quote-card.status-sent::before { background: var(--success); }
.quote-card.status-pending::before { background: var(--warning); }
.quote-card.status-draft::before { background: var(--text-muted); }
.quote-card:active { transform: scale(0.98); }

.quote-card:nth-child(1) { animation-delay: 0.05s; }
.quote-card:nth-child(2) { animation-delay: 0.1s; }
.quote-card:nth-child(3) { animation-delay: 0.15s; }
.quote-card:nth-child(4) { animation-delay: 0.2s; }

.qc-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
.qc-customer { font-family: 'Cabin', sans-serif; font-weight: 600; font-size: 17px; }
.qc-total { font-family: 'Cabin', sans-serif; font-weight: 700; font-size: 20px; color: var(--green-deep); }
.qc-model { font-size: 14px; color: var(--text-secondary); margin-bottom: 6px; }
.qc-services { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px; }
.qc-tag {
  background: var(--green-pale);
  color: var(--green-deep);
  font-size: 11px;
  font-weight: 500;
  padding: 3px 8px;
  border-radius: 20px;
}
.qc-footer { display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: var(--text-muted); }
.qc-status {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 11px;
}
.qc-status .dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  display: inline-block;
}
.status-sent .qc-status .dot { background: var(--success); }
.status-pending .qc-status .dot { background: var(--warning); }
.status-draft .qc-status .dot { background: var(--text-muted); }

/* === FAB BUTTON === */
.fab {
  position: fixed;
  bottom: 130px;
  right: 20px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--green-mid), var(--green-deep));
  color: white;
  border: none;
  box-shadow: var(--shadow-lg);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 90;
  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s;
  animation: fabPulse 2s ease-in-out infinite;
}
.fab:active { transform: scale(0.9); box-shadow: var(--shadow-sm); }
.fab svg { width: 24px; height: 24px; }

@keyframes fabPulse {
  0%, 100% { box-shadow: var(--shadow-lg), 0 0 0 0 rgba(74,124,63,0.3); }
  50% { box-shadow: var(--shadow-lg), 0 0 0 10px rgba(74,124,63,0); }
}

/* === QUOTE BUILDER === */
.builder-section {
  background: var(--white);
  border-radius: var(--radius-lg);
  padding: 20px;
  margin: 16px 0;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border);
  animation: slideUp 0.3s ease-out both;
}
.builder-section h2 {
  font-family: 'Cabin', sans-serif;
  font-size: 16px;
  font-weight: 600;
  color: var(--green-deep);
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.builder-section h2 svg { width: 20px; height: 20px; color: var(--green-mid); }

.form-group { margin-bottom: 16px; }
.form-group label {
  display: block;
  font-size: 13px;
  font-weight: 500;
  color: var(--text-secondary);
  margin-bottom: 6px;
}
.form-group input, .form-group select {
  width: 100%;
  padding: 12px 16px;
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  font-size: 16px;
  font-family: inherit;
  background: var(--white);
  color: var(--text-primary);
  transition: border-color 0.15s, box-shadow 0.15s;
}
.form-group input:focus, .form-group select:focus {
  border-color: var(--green-mid);
  box-shadow: 0 0 0 3px rgba(74,124,63,0.15);
}
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

/* === OPTION TOGGLES === */
.option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.option-toggle {
  background: var(--cream);
  border: 2px solid var(--border);
  border-radius: var(--radius-md);
  padding: 14px 12px;
  cursor: pointer;
  text-align: center;
  transition: all 0.15s ease;
  position: relative;
  user-select: none;
}
.option-toggle:active { transform: scale(0.97); }
.option-toggle.selected {
  background: var(--green-pale);
  border-color: var(--green-mid);
}
.option-toggle .opt-icon { margin-bottom: 6px; }
.option-toggle .opt-icon svg { width: 24px; height: 24px; color: var(--text-muted); transition: color 0.15s; }
.option-toggle.selected .opt-icon svg { color: var(--green-deep); }
.option-toggle .opt-label { font-size: 13px; font-weight: 500; color: var(--text-secondary); display: block; }
.option-toggle .opt-price { font-size: 12px; color: var(--text-muted); margin-top: 2px; }
.option-toggle.selected .opt-label { color: var(--green-deep); }

.option-toggle .check-mark {
  position: absolute;
  top: 6px; right: 6px;
  width: 18px; height: 18px;
  border-radius: 50%;
  background: var(--green-mid);
  display: none;
  align-items: center;
  justify-content: center;
}
.option-toggle.selected .check-mark { display: flex; }
.option-toggle .check-mark svg { width: 12px; height: 12px; color: white; }

/* === LIVE PRICE TOTAL === */
.price-display {
  background: linear-gradient(135deg, var(--green-deep), var(--green-mid));
  border-radius: var(--radius-lg);
  padding: 24px 20px;
  margin: 16px 0;
  color: white;
  text-align: center;
  box-shadow: var(--shadow-lg);
  position: sticky;
  bottom: 125px;
  z-index: 50;
}
.price-label { font-size: 13px; opacity: 0.85; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px; }
.price-amount {
  font-family: 'Cabin', sans-serif;
  font-size: 42px;
  font-weight: 700;
  letter-spacing: -1px;
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}
.price-amount.bump { transform: scale(1.08); }
.price-breakdown {
  font-size: 12px;
  opacity: 0.7;
  margin-top: 8px;
  line-height: 1.6;
}

/* === ACTION BUTTONS === */
.action-bar {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin: 16px 0 24px;
}
.btn {
  padding: 14px 20px;
  border-radius: var(--radius-md);
  font-family: 'Cabin', sans-serif;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.1s, box-shadow 0.15s;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
.btn:active { transform: scale(0.97); }
.btn svg { width: 18px; height: 18px; }
.btn-primary {
  background: linear-gradient(135deg, var(--green-mid), var(--green-deep));
  color: white;
  box-shadow: var(--shadow-md);
}
.btn-secondary {
  background: var(--white);
  color: var(--green-deep);
  border: 2px solid var(--green-mid);
}
.btn-full { grid-column: 1 / -1; }
.btn-danger {
  background: var(--white);
  color: var(--error);
  border: 2px solid var(--error);
}

/* === BOTTOM NAV === */
.bottom-nav {
  position: fixed;
  bottom: 60px;
  left: 0; right: 0;
  background: var(--white);
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: space-around;
  padding: 8px 0 12px;
  z-index: 100;
  box-shadow: 0 -2px 8px rgba(0,0,0,0.06);
}
.nav-btn {
  background: none;
  border: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  cursor: pointer;
  padding: 4px 16px;
  color: var(--text-muted);
  transition: color 0.15s;
  font-family: inherit;
}
.nav-btn.active { color: var(--green-deep); }
.nav-btn svg { width: 22px; height: 22px; }
.nav-btn span { font-size: 11px; font-weight: 500; }

/* === TOAST === */
.toast-container {
  position: fixed;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 9999;
  pointer-events: none;
}
.toast {
  background: var(--text-primary);
  color: white;
  padding: 12px 20px;
  border-radius: var(--radius-md);
  font-size: 14px;
  box-shadow: var(--shadow-lg);
  animation: toastIn 0.3s ease-out;
  margin-bottom: 8px;
  pointer-events: auto;
}
.toast.success { background: var(--success); }
.toast.error { background: var(--error); }

/* === HISTORY VIEW === */
.stats-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin: 16px 0;
}
.stat-card {
  background: var(--white);
  border-radius: var(--radius-md);
  padding: 16px;
  text-align: center;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border);
}
.stat-value {
  font-family: 'Cabin', sans-serif;
  font-size: 24px;
  font-weight: 700;
  color: var(--green-deep);
}
.stat-label { font-size: 11px; color: var(--text-muted); margin-top: 4px; text-transform: uppercase; letter-spacing: 0.5px; }

/* === SETTINGS VIEW === */
.settings-group {
  background: var(--white);
  border-radius: var(--radius-lg);
  padding: 20px;
  margin: 16px 0;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border);
}
.settings-group h3 {
  font-family: 'Cabin', sans-serif;
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 12px;
  color: var(--green-deep);
}
.settings-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid var(--border);
}
.settings-row:last-child { border-bottom: none; }
.settings-row label { font-size: 14px; color: var(--text-secondary); }
.settings-row input {
  width: 100px;
  text-align: right;
  padding: 8px 12px;
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  font-size: 14px;
  font-family: inherit;
}

/* === UPSELL LOCKED TAB === */
.locked-tab {
  position: relative;
  opacity: 0.5;
}
.locked-tab .lock-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(255,255,255,0.85);
  border-radius: var(--radius-lg);
  z-index: 10;
}
.locked-tab .lock-label {
  font-family: 'Cabin', sans-serif;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-secondary);
  margin-top: 8px;
}

/* === EMPTY STATE === */
.empty-state {
  text-align: center;
  padding: 48px 24px;
}
.empty-state svg { width: 80px; height: 80px; color: var(--text-muted); opacity: 0.4; margin-bottom: 16px; }
.empty-state h3 { font-family: 'Cabin', sans-serif; font-size: 18px; margin-bottom: 8px; }
.empty-state p { font-size: 14px; color: var(--text-muted); max-width: 260px; margin: 0 auto 20px; }

/* === ANIMATIONS === */
@keyframes slideUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes toastIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* === PRINT === */
@media print {
  .bottom-nav, .fab, .demo-banner, .toast-container, .app-header, #bct-demo-disclaimer { display: none !important; }
  body { padding: 0; background: white; }
  .content { max-width: 100%; }
  .quote-card { break-inside: avoid; box-shadow: none; border: 1px solid #ddd; }
}

/* === DESKTOP === */
@media (min-width: 1024px) {
  .bottom-nav { display: none; }
  body { padding-bottom: 80px; }
  .content { max-width: 600px; }
  .desktop-nav {
    display: flex !important;
    gap: 8px;
    margin-top: 8px;
  }
  .desktop-nav button {
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.3);
    color: white;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-family: 'Cabin', sans-serif;
    cursor: pointer;
    transition: all 0.15s;
  }
  .desktop-nav button.active { background: rgba(255,255,255,0.3); }
  .fab { bottom: 80px; }
  .price-display { bottom: 75px; }
}
@media (max-width: 1023px) {
  .desktop-nav { display: none !important; }
}

body { padding-bottom: 60px !important; }
</style>
</head>
<body>

<header class="app-header" role="banner">
  <h1>PlaysetQuote</h1>
  <div class="subtitle">Playset Installations of Georgia</div>
  <nav class="desktop-nav" style="display:none" aria-label="Main navigation">
    <button onclick="switchView('quotes')" class="active" data-nav="quotes">Quotes</button>
    <button onclick="switchView('builder')" data-nav="builder">New Quote</button>
    <button onclick="switchView('history')" data-nav="history">History</button>
    <button onclick="switchView('settings')" data-nav="settings">Settings</button>
  </nav>
</header>

<div class="demo-banner" id="demoBanner" style="display:none" role="status">
  <span>Sample data for Dawsonville area. Clear to add your own.</span>
  <button onclick="clearDemoData()" aria-label="Clear sample data">Clear</button>
</div>

<div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>

<main class="content" role="main">
  <!-- QUOTES LIST VIEW -->
  <section class="view active" id="quotesView" aria-label="Quote list">
    <div id="quotesList"></div>
    <div class="empty-state" id="emptyState" style="display:none">
      <svg viewBox="0 0 80 80" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
        <rect x="10" y="15" width="60" height="50" rx="4"/>
        <line x1="20" y1="30" x2="60" y2="30"/>
        <line x1="20" y1="40" x2="50" y2="40"/>
        <line x1="20" y1="50" x2="40" y2="50"/>
        <circle cx="55" cy="50" r="10"/>
        <line x1="55" y1="46" x2="55" y2="54"/>
        <line x1="51" y1="50" x2="59" y2="50"/>
      </svg>
      <h3>No quotes yet</h3>
      <p>Tap the button below to build your first quote in about 30 seconds.</p>
      <button class="btn btn-primary" onclick="switchView('builder')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Build a Quote
      </button>
    </div>
  </section>

  <!-- QUOTE BUILDER VIEW -->
  <section class="view" id="builderView" aria-label="Quote builder">
    <div class="builder-section" style="animation-delay:0.05s">
      <h2>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4-4V3"/><circle cx="12" cy="7" r="4"/></svg>
        Customer Info
      </h2>
      <div class="form-group">
        <label for="custName">Customer Name</label>
        <input type="text" id="custName" placeholder="First Last" autocomplete="off">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="custPhone">Phone</label>
          <input type="tel" id="custPhone" placeholder="(555) 555-1234">
        </div>
        <div class="form-group">
          <label for="custZip">Zip Code</label>
          <input type="text" id="custZip" placeholder="30534" maxlength="5" inputmode="numeric" oninput="calcTravel()">
        </div>
      </div>
    </div>

    <div class="builder-section" style="animation-delay:0.1s">
      <h2>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        Playset Details
      </h2>
      <div class="form-group">
        <label for="brand">Brand</label>
        <select id="brand" onchange="updatePrice()">
          <option value="">Pick a brand</option>
          <option value="gorilla">Gorilla</option>
          <option value="rainbow">Rainbow</option>
          <option value="kidkraft">KidKraft (Costco)</option>
          <option value="backyard">Backyard Discovery</option>
          <option value="cedar">Cedar Summit / Cedar Works</option>
          <option value="playnation">Playnation</option>
          <option value="superior">Superior Play</option>
          <option value="lifetime">Lifetime</option>
          <option value="walmart">Walmart Brand</option>
          <option value="homedepot">Home Depot Brand</option>
          <option value="commercial">Commercial Equipment</option>
          <option value="other">Other / Custom</option>
        </select>
      </div>
      <div class="form-group">
        <label for="modelSize">Size</label>
        <select id="modelSize" onchange="updatePrice()">
          <option value="small">Small (single tower / basic swing)</option>
          <option value="medium">Medium (tower + swings)</option>
          <option value="large">Large (multi-tower / slide combo)</option>
          <option value="xlarge">Extra Large / Commercial</option>
        </select>
      </div>
      <div class="form-group">
        <label for="modelName">Model Name (optional)</label>
        <input type="text" id="modelName" placeholder="e.g. Mountaineer, Highlander">
      </div>
    </div>

    <div class="builder-section" style="animation-delay:0.15s">
      <h2>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg>
        Services
      </h2>
      <div class="option-grid" id="serviceGrid">
        <div class="option-toggle selected" data-service="install" data-base="1" onclick="toggleService(this)" role="checkbox" aria-checked="true" tabindex="0">
          <span class="check-mark"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true"><polyline points="20 6 9 17 4 12"/></svg></span>
          <div class="opt-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg></div>
          <span class="opt-label">Install</span>
          <span class="opt-price">Base price</span>
        </div>
        <div class="option-toggle" data-service="mulch" data-cost="250" onclick="toggleService(this)" role="checkbox" aria-checked="false" tabindex="0">
          <span class="check-mark"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true"><polyline points="20 6 9 17 4 12"/></svg></span>
          <div class="opt-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M2 22h20"/><path d="M6 18c0-3 2-6 6-6s6 3 6 6"/><circle cx="12" cy="8" r="3"/></svg></div>
          <span class="opt-label">Mulch</span>
          <span class="opt-price">+$250</span>
        </div>
        <div class="option-toggle" data-service="border" data-cost="200" onclick="toggleService(this)" role="checkbox" aria-checked="false" tabindex="0">
          <span class="check-mark"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true"><polyline points="20 6 9 17 4 12"/></svg></span>
          <div class="opt-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><rect x="3" y="3" width="18" height="18" rx="2"/></svg></div>
          <span class="opt-label">Border</span>
          <span class="opt-price">+$200</span>
        </div>
        <div class="option-toggle" data-service="delivery" data-cost="150" onclick="toggleService(this)" role="checkbox" aria-checked="false" tabindex="0">
          <span class="check-mark"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true"><polyline points="20 6 9 17 4 12"/></svg></span>
          <div class="opt-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg></div>
          <span class="opt-label">Delivery</span>
          <span class="opt-price">+$150</span>
        </div>
        <div class="option-toggle" data-service="teardown" data-cost="200" onclick="toggleService(this)" role="checkbox" aria-checked="false" tabindex="0">
          <span class="check-mark"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true"><polyline points="20 6 9 17 4 12"/></svg></span>
          <div class="opt-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg></div>
          <span class="opt-label">Teardown</span>
          <span class="opt-price">+$200</span>
        </div>
        <div class="option-toggle" data-service="move" data-cost="400" onclick="toggleService(this)" role="checkbox" aria-checked="false" tabindex="0">
          <span class="check-mark"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true"><polyline points="20 6 9 17 4 12"/></svg></span>
          <div class="opt-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><polyline points="5 9 2 12 5 15"/><polyline points="19 9 22 12 19 15"/><line x1="2" y1="12" x2="22" y2="12"/></svg></div>
          <span class="opt-label">Move/Setup</span>
          <span class="opt-price">+$400</span>
        </div>
        <div class="option-toggle" data-service="refurbish" data-cost="300" onclick="toggleService(this)" role="checkbox" aria-checked="false" tabindex="0">
          <span class="check-mark"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true"><polyline points="20 6 9 17 4 12"/></svg></span>
          <div class="opt-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg></div>
          <span class="opt-label">Refurbish</span>
          <span class="opt-price">+$300</span>
        </div>
        <div class="option-toggle" data-service="relevel" data-cost="150" onclick="toggleService(this)" role="checkbox" aria-checked="false" tabindex="0">
          <span class="check-mark"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true"><polyline points="20 6 9 17 4 12"/></svg></span>
          <div class="opt-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><line x1="2" y1="12" x2="22" y2="12"/><polyline points="16 6 12 2 8 6"/><polyline points="8 18 12 22 16 18"/></svg></div>
          <span class="opt-label">Relevel</span>
          <span class="opt-price">+$150</span>
        </div>
      </div>
    </div>

    <div class="builder-section" style="animation-delay:0.2s">
      <h2>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
        Notes
      </h2>
      <div class="form-group" style="margin-bottom:0">
        <textarea id="quoteNotes" rows="3" placeholder="Backyard has a slope, customer wants it against the fence line..." style="width:100%;padding:12px 16px;border:1.5px solid var(--border);border-radius:var(--radius-sm);font-size:14px;font-family:inherit;resize:vertical;"></textarea>
      </div>
    </div>

    <div class="price-display" id="priceDisplay">
      <div class="price-label">Quote Total</div>
      <div class="price-amount" id="priceAmount">$0</div>
      <div class="price-breakdown" id="priceBreakdown"></div>
    </div>

    <div class="action-bar">
      <button class="btn btn-secondary" onclick="saveQuote('draft')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/></svg>
        Save Draft
      </button>
      <button class="btn btn-primary" onclick="shareQuote()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        Share Quote
      </button>
    </div>
    <button class="btn btn-secondary btn-full" onclick="resetBuilder()" style="margin-bottom:24px">Start Over</button>
  </section>

  <!-- HISTORY VIEW -->
  <section class="view" id="historyView" aria-label="Quote history">
    <div class="stats-row" id="statsRow">
      <div class="stat-card">
        <div class="stat-value" id="statTotal">0</div>
        <div class="stat-label">Total Quotes</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statSent">0</div>
        <div class="stat-label">Sent</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statRevenue">$0</div>
        <div class="stat-label">Quoted</div>
      </div>
    </div>
    <div id="historyList"></div>
  </section>

  <!-- SETTINGS VIEW -->
  <section class="view" id="settingsView" aria-label="Settings">
    <div class="settings-group">
      <h3>Base Install Prices</h3>
      <div class="settings-row">
        <label for="priceSmall">Small playset</label>
        <input type="number" id="priceSmall" value="250" oninput="savePrices()">
      </div>
      <div class="settings-row">
        <label for="priceMedium">Medium playset</label>
        <input type="number" id="priceMedium" value="400" oninput="savePrices()">
      </div>
      <div class="settings-row">
        <label for="priceLarge">Large playset</label>
        <input type="number" id="priceLarge" value="600" oninput="savePrices()">
      </div>
      <div class="settings-row">
        <label for="priceXlarge">Extra Large / Commercial</label>
        <input type="number" id="priceXlarge" value="1200" oninput="savePrices()">
      </div>
    </div>

    <div class="settings-group">
      <h3>Travel</h3>
      <div class="settings-row">
        <label for="travelRate">Per-mile rate over 20 mi</label>
        <input type="number" id="travelRate" value="2" step="0.5" oninput="savePrices()">
      </div>
      <div class="settings-row">
        <label for="homeZip">Your zip code</label>
        <input type="text" id="homeZip" value="30534" maxlength="5" oninput="savePrices()">
      </div>
    </div>

    <div class="settings-group">
      <h3>Data</h3>
      <div style="display:flex;flex-direction:column;gap:10px">
        <button class="btn btn-secondary" onclick="exportData()" aria-label="Export quotes as JSON backup">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Export Backup (JSON)
        </button>
        <button class="btn btn-secondary" onclick="importData()" aria-label="Import quotes from JSON backup">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
          Import Backup (JSON)
        </button>
      </div>
    </div>

    <!-- UPSELL GAP -->
    <div class="settings-group locked-tab" style="min-height:120px">
      <div class="lock-overlay">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1.5" aria-hidden="true">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
          <path d="M7 11V7a5 5 0 0110 0v4"/>
        </svg>
        <span class="lock-label">Customer Follow-Up -- Full Version</span>
        <span style="font-size:12px;color:var(--text-muted);margin-top:4px">Track which quotes become jobs</span>
      </div>
      <h3>Follow-Up Tracking</h3>
    </div>
  </section>
</main>

<button class="fab" id="fabBtn" onclick="switchView('builder')" aria-label="Create new quote">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" aria-hidden="true">
    <line x1="12" y1="5" x2="12" y2="19"/>
    <line x1="5" y1="12" x2="19" y2="12"/>
  </svg>
</button>

<nav class="bottom-nav" aria-label="Main navigation">
  <button class="nav-btn active" onclick="switchView('quotes')" data-nav="quotes" aria-label="View quotes">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
    <span>Quotes</span>
  </button>
  <button class="nav-btn" onclick="switchView('builder')" data-nav="builder" aria-label="Build a new quote">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    <span>New</span>
  </button>
  <button class="nav-btn" onclick="switchView('history')" data-nav="history" aria-label="View history and stats">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
    <span>History</span>
  </button>
  <button class="nav-btn" onclick="switchView('settings')" data-nav="settings" aria-label="Settings and pricing">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" aria-hidden="true"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
    <span>Settings</span>
  </button>
</nav>

<!-- DEMO DISCLAIMER -->
<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer" style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:10px 16px;font-size:12px;line-height:1.4;color:#666;z-index:99999;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:8px 16px;text-align:center;">
  <p style="margin:0;max-width:700px;"><strong style="color:#333;">DEMO NOTICE:</strong> This tool was created by BennyCuTools as a free demonstration only. It is not affiliated with, endorsed by, or authorized by Playset Installations of Georgia. All brand references are used solely for demonstration purposes.</p>
  <a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20Playset%20Installations%20of%20Georgia&body=I%20am%20the%20owner%20and%20I%20request%20permanent%20deletion%20of%20this%20demo." style="display:inline-flex;align-items:center;gap:4px;background:#dc3545;color:#fff;padding:5px 12px;border-radius:4px;text-decoration:none;font-size:11px;font-weight:500;white-space:nowrap;">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
    Request Permanent Deletion
  </a>
</div>

<input type="file" id="fileInput" accept=".json" style="display:none" onchange="handleImport(event)">

<script>
// === ACCESS KEY GATE ===
function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
const _V=-1111769334;
const _k=new URLSearchParams(window.location.search).get('key');
if(!_k||_h(_k)!==_V){
  document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;background:#1a1a1a;color:#fff;text-align:center;padding:20px"><div><h1 style="font-size:2rem;margin-bottom:1rem">Access Required</h1><p style="color:#999;margin-bottom:1rem">This tool needs a valid access key.</p><p><a href="mailto:ben@bennycutools.com" style="color:#6b9f5e">ben@bennycutools.com</a></p></div></div><div id="bct-demo-disclaimer" role="contentinfo" style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:10px 16px;font-size:12px;color:#666;z-index:99999;text-align:center;"><p style="margin:0"><strong style="color:#333;">DEMO NOTICE:</strong> This tool was created by BennyCuTools as a free demonstration only. Not affiliated with Playset Installations of Georgia.</p></div>';
  throw new Error('Invalid key');
}

// === ANTI-SCRAPE ===
document.addEventListener('contextmenu', e => e.preventDefault());

// === STATE ===
let quotes = [];
let editingId = null;
let DB;

const defaultPrices = {
  small: 250, medium: 400, large: 600, xlarge: 1200,
  mulch: 250, border: 200, delivery: 150, teardown: 200,
  move: 400, refurbish: 300, relevel: 150,
  travelRate: 2, homeZip: '30534'
};

let prices = { ...defaultPrices };

// === INDEXED DB ===
function initDB() {
  return new Promise((resolve, reject) => {
    const req = indexedDB.open('PlaysetQuoteDB', 1);
    req.onupgradeneeded = e => {
      const db = e.target.result;
      if (!db.objectStoreNames.contains('quotes')) {
        db.createObjectStore('quotes', { keyPath: 'id' });
      }
    };
    req.onsuccess = e => { DB = e.target.result; resolve(); };
    req.onerror = e => reject(e);
  });
}

function dbPut(quote) {
  return new Promise((resolve, reject) => {
    const tx = DB.transaction('quotes', 'readwrite');
    tx.objectStore('quotes').put(quote);
    tx.oncomplete = resolve;
    tx.onerror = reject;
  });
}

function dbGetAll() {
  return new Promise((resolve, reject) => {
    const tx = DB.transaction('quotes', 'readonly');
    const req = tx.objectStore('quotes').getAll();
    req.onsuccess = () => resolve(req.result);
    req.onerror = reject;
  });
}

function dbDelete(id) {
  return new Promise((resolve, reject) => {
    const tx = DB.transaction('quotes', 'readwrite');
    tx.objectStore('quotes').delete(id);
    tx.oncomplete = resolve;
    tx.onerror = reject;
  });
}

// === DEMO DATA ===
function getDemoQuotes() {
  const now = Date.now();
  return [
    {
      id: 'demo-1',
      isDemo: true,
      customer: 'Marcus & Sarah Thompson',
      phone: '(770) 555-3821',
      zip: '30040',
      brand: 'gorilla',
      size: 'medium',
      model: 'Mountaineer',
      services: ['install', 'mulch', 'border'],
      notes: 'Flat backyard, good space. Wants it near the back fence.',
      total: 850,
      status: 'sent',
      created: now - 86400000 * 2,
      travelCost: 0
    },
    {
      id: 'demo-2',
      isDemo: true,
      customer: 'First Baptist Church of Alpharetta',
      phone: '(770) 555-9102',
      zip: '30009',
      brand: 'commercial',
      size: 'xlarge',
      model: 'Commercial Swingbeam 8-seat',
      services: ['install', 'mulch'],
      notes: 'Church playground renovation. Need safety surfacing specs for insurance.',
      total: 1550,
      status: 'pending',
      created: now - 86400000,
      travelCost: 100
    },
    {
      id: 'demo-3',
      isDemo: true,
      customer: 'Jennifer Owens',
      phone: '(678) 555-4456',
      zip: '30506',
      brand: 'rainbow',
      size: 'large',
      model: 'Castle Package',
      services: ['install', 'teardown', 'mulch', 'border'],
      notes: 'Teardown old wooden set first. New Rainbow goes in same spot. Slight hill in yard.',
      total: 1250,
      status: 'sent',
      created: now - 3600000 * 3,
      travelCost: 0
    }
  ];
}

async function loadDemoData() {
  const existing = await dbGetAll();
  if (existing.length === 0 && !localStorage.getItem('pq_cleared_demo')) {
    const demos = getDemoQuotes();
    for (const d of demos) await dbPut(d);
    document.getElementById('demoBanner').style.display = 'flex';
    await loadQuotes();
  }
}

async function clearDemoData() {
  const all = await dbGetAll();
  for (const q of all) {
    if (q.isDemo) await dbDelete(q.id);
  }
  localStorage.setItem('pq_cleared_demo', '1');
  document.getElementById('demoBanner').style.display = 'none';
  showToast('Sample data cleared');
  await loadQuotes();
}

// === VIEWS ===
function switchView(viewName) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById(viewName + 'View').classList.add('active');

  document.querySelectorAll('.nav-btn, .desktop-nav button').forEach(b => {
    b.classList.toggle('active', b.dataset.nav === viewName);
  });

  const fab = document.getElementById('fabBtn');
  fab.style.display = viewName === 'builder' ? 'none' : 'flex';

  if (viewName === 'history') updateStats();
  if (viewName === 'quotes') loadQuotes();
}

// === TOGGLE SERVICES ===
function toggleService(el) {
  if (el.dataset.service === 'install') return; // always on
  el.classList.toggle('selected');
  el.setAttribute('aria-checked', el.classList.contains('selected'));
  updatePrice();
}

// === PRICE CALCULATION ===
function getBasePrice() {
  const size = document.getElementById('modelSize').value;
  const brand = document.getElementById('brand').value;
  let base = prices[size] || 400;
  // Premium brands cost more
  if (['rainbow', 'playnation', 'superior'].includes(brand)) base = Math.round(base * 1.3);
  if (brand === 'commercial') base = Math.round(base * 1.5);
  return base;
}

function calcTravel() {
  updatePrice();
}

function getApproxDistance(zip) {
  // Simple lookup for common GA zip prefixes
  const homePrefix = parseInt(prices.homeZip.substring(0, 3)) || 305;
  const custPrefix = parseInt((zip || '').substring(0, 3)) || homePrefix;
  const diff = Math.abs(custPrefix - homePrefix);
  return Math.round(diff * 3.5); // rough miles estimate
}

function updatePrice() {
  const base = getBasePrice();
  const zip = document.getElementById('custZip').value;
  const dist = getApproxDistance(zip);
  const freeRadius = 20;
  const travelCost = dist > freeRadius ? Math.round((dist - freeRadius) * prices.travelRate) : 0;

  let addonTotal = 0;
  const breakdown = [`Install: $${base}`];

  document.querySelectorAll('.option-toggle.selected').forEach(el => {
    const svc = el.dataset.service;
    if (svc !== 'install') {
      const cost = parseInt(el.dataset.cost) || prices[svc] || 0;
      addonTotal += cost;
      const label = el.querySelector('.opt-label').textContent;
      breakdown.push(`${label}: $${cost}`);
    }
  });

  if (travelCost > 0) breakdown.push(`Travel (~${dist} mi): $${travelCost}`);

  const total = base + addonTotal + travelCost;
  const amountEl = document.getElementById('priceAmount');
  amountEl.textContent = '$' + total.toLocaleString();
  amountEl.classList.add('bump');
  setTimeout(() => amountEl.classList.remove('bump'), 300);
  document.getElementById('priceBreakdown').textContent = breakdown.join(' + ');
}

// === SAVE QUOTE ===
async function saveQuote(status) {
  const name = document.getElementById('custName').value.trim();
  if (!name) { showToast('Add a customer name', 'error'); return; }
  if (!document.getElementById('brand').value) { showToast('Pick a playset brand', 'error'); return; }

  const selectedServices = [];
  document.querySelectorAll('.option-toggle.selected').forEach(el => selectedServices.push(el.dataset.service));

  const zip = document.getElementById('custZip').value;
  const dist = getApproxDistance(zip);
  const travelCost = dist > 20 ? Math.round((dist - 20) * prices.travelRate) : 0;

  const quote = {
    id: editingId || 'q-' + Date.now(),
    customer: name,
    phone: document.getElementById('custPhone').value,
    zip: zip,
    brand: document.getElementById('brand').value,
    size: document.getElementById('modelSize').value,
    model: document.getElementById('modelName').value,
    services: selectedServices,
    notes: document.getElementById('quoteNotes').value,
    total: parseInt(document.getElementById('priceAmount').textContent.replace(/[$,]/g, '')),
    travelCost: travelCost,
    status: status,
    created: editingId ? (quotes.find(q => q.id === editingId) || {}).created || Date.now() : Date.now(),
    updated: Date.now()
  };

  await dbPut(quote);
  showToast(status === 'sent' ? 'Quote saved and ready to share' : 'Draft saved');
  editingId = null;
  resetBuilder();
  switchView('quotes');
}

// === SHARE QUOTE ===
async function shareQuote() {
  const name = document.getElementById('custName').value.trim();
  if (!name) { showToast('Add a customer name first', 'error'); return; }

  await saveQuote('sent');
  const total = document.getElementById('priceAmount').textContent;
  const brand = document.getElementById('brand').value;
  const model = document.getElementById('modelName').value;
  const services = [];
  document.querySelectorAll('.option-toggle.selected .opt-label').forEach(el => services.push(el.textContent));

  const text = `Quote from Playset Installations of Georgia\n\nCustomer: ${name}\nPlayset: ${brand ? brand.charAt(0).toUpperCase() + brand.slice(1) : 'TBD'}${model ? ' ' + model : ''}\nServices: ${services.join(', ')}\nTotal: ${total}\n\nCall/text (678) 764-1932 to confirm.\nTerry Puckett - Playset Installations of Georgia`;

  if (navigator.share) {
    try {
      await navigator.share({ title: 'Playset Quote', text: text });
      showToast('Quote shared', 'success');
    } catch (e) { /* user cancelled */ }
  } else {
    try {
      await navigator.clipboard.writeText(text);
      showToast('Quote copied to clipboard', 'success');
    } catch (e) {
      showToast('Could not share', 'error');
    }
  }
}

// === RENDER QUOTES ===
async function loadQuotes() {
  quotes = await dbGetAll();
  quotes.sort((a, b) => (b.created || 0) - (a.created || 0));

  const hasDemo = quotes.some(q => q.isDemo);
  document.getElementById('demoBanner').style.display = hasDemo ? 'flex' : 'none';

  const list = document.getElementById('quotesList');
  const empty = document.getElementById('emptyState');

  if (quotes.length === 0) {
    list.innerHTML = '';
    empty.style.display = 'block';
    return;
  }
  empty.style.display = 'none';

  list.innerHTML = quotes.map(q => {
    const brandLabel = q.brand ? q.brand.charAt(0).toUpperCase() + q.brand.slice(1) : '';
    const modelLabel = q.model ? `${brandLabel} ${q.model}` : brandLabel;
    const sizeMap = { small: 'Small', medium: 'Medium', large: 'Large', xlarge: 'XL/Commercial' };
    const timeAgo = getTimeAgo(q.created);

    return `<div class="quote-card status-${q.status}" onclick="openQuote('${q.id}')">
      <div class="qc-header">
        <span class="qc-customer">${escHtml(q.customer)}</span>
        <span class="qc-total">$${(q.total || 0).toLocaleString()}</span>
      </div>
      <div class="qc-model">${escHtml(modelLabel)} - ${sizeMap[q.size] || q.size}</div>
      <div class="qc-services">${(q.services || []).map(s => `<span class="qc-tag">${s}</span>`).join('')}</div>
      <div class="qc-footer">
        <span>${timeAgo}</span>
        <span class="qc-status"><span class="dot"></span>${q.status}</span>
      </div>
    </div>`;
  }).join('');
}

function openQuote(id) {
  const q = quotes.find(x => x.id === id);
  if (!q) return;
  editingId = id;
  document.getElementById('custName').value = q.customer || '';
  document.getElementById('custPhone').value = q.phone || '';
  document.getElementById('custZip').value = q.zip || '';
  document.getElementById('brand').value = q.brand || '';
  document.getElementById('modelSize').value = q.size || 'medium';
  document.getElementById('modelName').value = q.model || '';
  document.getElementById('quoteNotes').value = q.notes || '';

  document.querySelectorAll('.option-toggle').forEach(el => {
    const svc = el.dataset.service;
    if (svc === 'install') return;
    const isSelected = (q.services || []).includes(svc);
    el.classList.toggle('selected', isSelected);
    el.setAttribute('aria-checked', isSelected);
  });

  updatePrice();
  switchView('builder');
}

function resetBuilder() {
  editingId = null;
  document.getElementById('custName').value = '';
  document.getElementById('custPhone').value = '';
  document.getElementById('custZip').value = '';
  document.getElementById('brand').value = '';
  document.getElementById('modelSize').value = 'medium';
  document.getElementById('modelName').value = '';
  document.getElementById('quoteNotes').value = '';
  document.querySelectorAll('.option-toggle').forEach(el => {
    if (el.dataset.service !== 'install') {
      el.classList.remove('selected');
      el.setAttribute('aria-checked', 'false');
    }
  });
  updatePrice();
}

// === HISTORY / STATS ===
function updateStats() {
  const total = quotes.length;
  const sent = quotes.filter(q => q.status === 'sent').length;
  const revenue = quotes.reduce((sum, q) => sum + (q.total || 0), 0);
  document.getElementById('statTotal').textContent = total;
  document.getElementById('statSent').textContent = sent;
  document.getElementById('statRevenue').textContent = '$' + revenue.toLocaleString();

  const histList = document.getElementById('historyList');
  histList.innerHTML = quotes.map(q => {
    return `<div class="quote-card status-${q.status}" style="cursor:default">
      <div class="qc-header">
        <span class="qc-customer">${escHtml(q.customer)}</span>
        <span class="qc-total">$${(q.total || 0).toLocaleString()}</span>
      </div>
      <div class="qc-footer">
        <span>${new Date(q.created).toLocaleDateString()}</span>
        <span class="qc-status"><span class="dot"></span>${q.status}</span>
      </div>
      <div style="margin-top:8px">
        <button class="btn btn-danger" style="padding:6px 12px;font-size:12px" onclick="deleteQuote('${q.id}')">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
          Delete
        </button>
      </div>
    </div>`;
  }).join('');
}

let deleteTimeout;
async function deleteQuote(id) {
  const card = event.target.closest('.quote-card');
  if (card) card.style.opacity = '0.3';
  showToast('Quote deleted. <button onclick="undoDelete()" style="background:none;border:none;color:#fff;text-decoration:underline;cursor:pointer;font-size:inherit;font-family:inherit;">Undo</button>');
  deleteTimeout = setTimeout(async () => {
    await dbDelete(id);
    await loadQuotes();
    updateStats();
  }, 5000);
}

function undoDelete() {
  clearTimeout(deleteTimeout);
  document.querySelectorAll('.quote-card').forEach(c => c.style.opacity = '1');
  showToast('Restored', 'success');
}

// === EXPORT / IMPORT ===
async function exportData() {
  const all = await dbGetAll();
  const blob = new Blob([JSON.stringify({ quotes: all, prices, exported: new Date().toISOString() }, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `playsetquote-backup-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
  showToast('Backup downloaded', 'success');
}

function importData() {
  document.getElementById('fileInput').click();
}

async function handleImport(event) {
  const file = event.target.files[0];
  if (!file) return;
  try {
    const text = await file.text();
    const data = JSON.parse(text);
    if (data.quotes) {
      for (const q of data.quotes) await dbPut(q);
      showToast(`Imported ${data.quotes.length} quotes`, 'success');
    }
    if (data.prices) {
      prices = { ...defaultPrices, ...data.prices };
      savePrices();
    }
    await loadQuotes();
  } catch (e) {
    showToast('Could not read that file', 'error');
  }
  event.target.value = '';
}

// === PRICES ===
function savePrices() {
  prices.small = parseInt(document.getElementById('priceSmall').value) || 250;
  prices.medium = parseInt(document.getElementById('priceMedium').value) || 400;
  prices.large = parseInt(document.getElementById('priceLarge').value) || 600;
  prices.xlarge = parseInt(document.getElementById('priceXlarge').value) || 1200;
  prices.travelRate = parseFloat(document.getElementById('travelRate').value) || 2;
  prices.homeZip = document.getElementById('homeZip').value || '30534';
  localStorage.setItem('pq_prices', JSON.stringify(prices));
}

function loadPrices() {
  const saved = localStorage.getItem('pq_prices');
  if (saved) {
    try { prices = { ...defaultPrices, ...JSON.parse(saved) }; } catch(e) {}
  }
  document.getElementById('priceSmall').value = prices.small;
  document.getElementById('priceMedium').value = prices.medium;
  document.getElementById('priceLarge').value = prices.large;
  document.getElementById('priceXlarge').value = prices.xlarge;
  document.getElementById('travelRate').value = prices.travelRate;
  document.getElementById('homeZip').value = prices.homeZip;
}

// === UTILS ===
function showToast(msg, type) {
  const toast = document.createElement('div');
  toast.className = 'toast' + (type ? ' ' + type : '');
  toast.innerHTML = msg;
  document.getElementById('toastContainer').appendChild(toast);
  setTimeout(() => toast.remove(), 4000);
}

function escHtml(s) {
  const d = document.createElement('div');
  d.textContent = s || '';
  return d.innerHTML;
}

function getTimeAgo(ts) {
  const diff = Date.now() - ts;
  const mins = Math.floor(diff / 60000);
  if (mins < 1) return 'Just now';
  if (mins < 60) return mins + 'm ago';
  const hrs = Math.floor(mins / 60);
  if (hrs < 24) return hrs + 'h ago';
  const days = Math.floor(hrs / 24);
  if (days < 7) return days + 'd ago';
  return new Date(ts).toLocaleDateString();
}

// === KEYBOARD NAV ===
document.querySelectorAll('.option-toggle').forEach(el => {
  el.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleService(el); }
  });
});

// === INIT ===
(async function init() {
  await initDB();
  loadPrices();
  updatePrice();
  await loadDemoData();
  await loadQuotes();
})();
</script>
</body>
</html>
