<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Satterlee 1892 Certification Engine</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='48' fill='%23214426'/%3E%3Ccircle cx='50' cy='50' r='42' fill='none' stroke='%23FFD100' stroke-width='3'/%3E%3Ctext x='50' y='58' font-family='Georgia,serif' font-size='32' font-weight='bold' fill='%23FFD100' text-anchor='middle'%3E1892%3C/text%3E%3C/svg%3E">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Tienne:wght@400;700;900&family=Raleway:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SATTERLEE 1892 CERTIFICATION ENGINE
   Satterlee Plumbing, Heating & Cooling â€” Est. 1892
   Joplin, Missouri
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

:root {
  --green: #214426;
  --green-dark: #192f1c;
  --green-light: #2d5c33;
  --green-pale: #e8f0e9;
  --green-mist: #f4f8f4;
  --gold: #FFD100;
  --gold-dark: #C9A600;
  --gold-light: #FFF0A0;
  --gold-pale: #FFF9D6;
  --white: #FFFFFF;
  --off-white: #FAFAF8;
  --cream: #F5F3EE;
  --text: #1a1a1a;
  --text-muted: #5a5a5a;
  --text-light: #8a8a8a;
  --border: #d4d0c8;
  --border-light: #e8e4dc;
  --shadow: 0 2px 8px rgba(33,68,38,0.08);
  --shadow-lg: 0 8px 32px rgba(33,68,38,0.12);
  --shadow-gold: 0 4px 16px rgba(255,209,0,0.2);
  --radius: 6px;
  --radius-lg: 10px;
  --font-heading: 'Tienne', Georgia, 'Times New Roman', serif;
  --font-body: 'Raleway', 'Segoe UI', system-ui, sans-serif;
  --nav-width: 260px;
  --topbar-height: 64px;
  --bottombar-height: 72px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html { font-size: 16px; -webkit-text-size-adjust: 100%; }
body {
  font-family: var(--font-body);
  color: var(--text);
  background: var(--off-white);
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
}

/* â”€â”€ Typography â”€â”€ */
h1, h2, h3, h4, h5 { font-family: var(--font-heading); font-weight: 700; line-height: 1.25; color: var(--green); }
h1 { font-size: 1.75rem; }
h2 { font-size: 1.4rem; }
h3 { font-size: 1.15rem; }

/* â”€â”€ Demo Banner â”€â”€ */
.demo-banner {
  background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
  color: var(--green-dark);
  padding: 10px 20px;
  text-align: center;
  font-size: 0.85rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  position: relative;
  z-index: 1000;
}
.demo-banner button {
  background: var(--green);
  color: var(--gold);
  border: none;
  padding: 4px 14px;
  border-radius: 3px;
  font-size: 0.8rem;
  cursor: pointer;
  font-weight: 600;
}
.demo-banner.hidden { display: none; }

/* â”€â”€ Top Bar â”€â”€ */
.topbar {
  height: var(--topbar-height);
  background: var(--green);
  display: flex;
  align-items: center;
  padding: 0 24px;
  position: sticky;
  top: 0;
  z-index: 900;
  box-shadow: 0 2px 12px rgba(0,0,0,0.15);
}
.topbar-brand {
  display: flex;
  align-items: center;
  gap: 14px;
}
.topbar-logo {
  width: 40px;
  height: 40px;
  background: var(--gold);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-heading);
  font-weight: 900;
  color: var(--green);
  font-size: 18px;
  flex-shrink: 0;
}
.topbar-title {
  color: var(--white);
  font-family: var(--font-heading);
  font-size: 1.15rem;
  font-weight: 700;
}
.topbar-subtitle {
  color: var(--gold);
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
}
.topbar-actions {
  margin-left: auto;
  display: flex;
  gap: 8px;
}
.topbar-btn {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.2);
  color: var(--white);
  padding: 8px 16px;
  border-radius: var(--radius);
  font-size: 0.85rem;
  cursor: pointer;
  font-family: var(--font-body);
  font-weight: 500;
  transition: all 0.2s;
}
.topbar-btn:hover { background: rgba(255,255,255,0.2); }
.topbar-btn.primary { background: var(--gold); color: var(--green); border-color: var(--gold); font-weight: 700; }
.topbar-btn.primary:hover { background: var(--gold-dark); }

/* â”€â”€ Layout â”€â”€ */
.app-layout { display: flex; min-height: calc(100vh - var(--topbar-height)); }

/* â”€â”€ Sidebar (â‰¥1024px) â”€â”€ */
.sidebar {
  width: var(--nav-width);
  background: var(--green-dark);
  border-right: 1px solid rgba(255,255,255,0.05);
  display: none;
  flex-direction: column;
  flex-shrink: 0;
  overflow-y: auto;
  position: sticky;
  top: var(--topbar-height);
  height: calc(100vh - var(--topbar-height));
}
.sidebar-nav { padding: 16px 12px; flex: 1; }
.nav-label {
  font-size: 0.65rem;
  font-weight: 700;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: rgba(255,255,255,0.35);
  padding: 16px 14px 6px;
}
.nav-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 14px;
  border-radius: var(--radius);
  color: rgba(255,255,255,0.7);
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 500;
  transition: all 0.15s;
  min-height: 44px;
}
.nav-item:hover { background: rgba(255,255,255,0.08); color: var(--white); }
.nav-item.active { background: rgba(255,209,0,0.12); color: var(--gold); }
.nav-item .nav-icon { font-size: 1.1rem; width: 24px; text-align: center; }
.nav-item .nav-badge {
  margin-left: auto;
  background: var(--gold);
  color: var(--green);
  font-size: 0.7rem;
  font-weight: 700;
  padding: 2px 8px;
  border-radius: 10px;
}
.sidebar-footer {
  padding: 16px;
  border-top: 1px solid rgba(255,255,255,0.08);
  text-align: center;
}
.sidebar-footer small {
  color: rgba(255,255,255,0.3);
  font-size: 0.7rem;
}

/* â”€â”€ Bottom Tab Bar (<1024px) â”€â”€ */
.bottombar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: var(--bottombar-height);
  background: var(--green);
  display: flex;
  align-items: center;
  justify-content: space-around;
  z-index: 900;
  box-shadow: 0 -2px 12px rgba(0,0,0,0.15);
  padding-bottom: env(safe-area-inset-bottom, 0px);
}
.tab-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 3px;
  color: rgba(255,255,255,0.5);
  font-size: 0.65rem;
  font-weight: 600;
  cursor: pointer;
  padding: 6px 12px;
  min-width: 60px;
  min-height: 44px;
  justify-content: center;
  transition: color 0.15s;
  position: relative;
}
.tab-item .tab-icon { font-size: 1.3rem; }
.tab-item.active { color: var(--gold); }
.tab-item .tab-badge {
  position: absolute;
  top: 2px;
  right: 6px;
  background: var(--gold);
  color: var(--green);
  font-size: 0.6rem;
  font-weight: 800;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* â”€â”€ Main Content â”€â”€ */
.main-content {
  flex: 1;
  padding: 24px;
  max-width: 1100px;
  margin: 0 auto;
  width: 100%;
}

/* â”€â”€ Cards â”€â”€ */
.card {
  background: var(--white);
  border: 1px solid var(--border-light);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow);
  overflow: hidden;
  margin-bottom: 20px;
}
.card-header {
  padding: 18px 24px;
  border-bottom: 1px solid var(--border-light);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--cream);
}
.card-header h3 { margin: 0; }
.card-body { padding: 24px; }
.card-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--border-light);
  background: var(--cream);
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 10px;
}

/* â”€â”€ Buttons â”€â”€ */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px;
  border-radius: var(--radius);
  font-family: var(--font-body);
  font-size: 0.9rem;
  font-weight: 600;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
  min-height: 44px;
  text-decoration: none;
}
.btn-primary { background: var(--green); color: var(--white); }
.btn-primary:hover { background: var(--green-light); }
.btn-gold { background: var(--gold); color: var(--green); }
.btn-gold:hover { background: var(--gold-dark); box-shadow: var(--shadow-gold); }
.btn-outline { background: transparent; color: var(--green); border: 2px solid var(--green); }
.btn-outline:hover { background: var(--green-pale); }
.btn-ghost { background: transparent; color: var(--text-muted); }
.btn-ghost:hover { color: var(--text); background: var(--cream); }
.btn-danger { background: #c0392b; color: var(--white); }
.btn-danger:hover { background: #a93226; }
.btn-sm { padding: 6px 14px; font-size: 0.8rem; min-height: 36px; }
.btn-lg { padding: 14px 32px; font-size: 1rem; }
.btn:disabled { opacity: 0.5; cursor: not-allowed; }

/* â”€â”€ Form Elements â”€â”€ */
.form-group { margin-bottom: 18px; }
.form-label {
  display: block;
  font-size: 0.82rem;
  font-weight: 600;
  color: var(--text-muted);
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.form-input, .form-select, .form-textarea {
  width: 100%;
  padding: 10px 14px;
  border: 1.5px solid var(--border);
  border-radius: var(--radius);
  font-family: var(--font-body);
  font-size: 16px;
  color: var(--text);
  background: var(--white);
  transition: border-color 0.2s, box-shadow 0.2s;
  min-height: 44px;
}
.form-input:focus, .form-select:focus, .form-textarea:focus {
  outline: none;
  border-color: var(--green);
  box-shadow: 0 0 0 3px rgba(33,68,38,0.1);
}
.form-textarea { resize: vertical; min-height: 80px; }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.form-hint { font-size: 0.75rem; color: var(--text-light); margin-top: 4px; }

/* â”€â”€ Tables â”€â”€ */
.data-table { width: 100%; border-collapse: collapse; }
.data-table th {
  text-align: left;
  padding: 12px 16px;
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-muted);
  border-bottom: 2px solid var(--border);
  background: var(--cream);
}
.data-table td {
  padding: 14px 16px;
  border-bottom: 1px solid var(--border-light);
  font-size: 0.9rem;
}
.data-table tr:hover td { background: var(--green-mist); }
.data-table .status-badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.status-certified { background: var(--gold-pale); color: var(--gold-dark); }
.status-pending { background: #FFF3E0; color: #E65100; }
.status-in-progress { background: var(--green-pale); color: var(--green); }
.status-failed { background: #FFEBEE; color: #C62828; }

/* â”€â”€ Seal â”€â”€ */
.seal-1892 {
  width: 200px;
  height: 200px;
  border-radius: 50%;
  border: 4px solid var(--gold);
  background: radial-gradient(circle at 30% 30%, #fff8dc, var(--gold-pale));
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  position: relative;
  box-shadow: 0 0 0 3px var(--green), 0 0 0 7px var(--gold), var(--shadow-lg);
  margin: 24px auto;
}
.seal-1892::before {
  content: '';
  position: absolute;
  inset: 6px;
  border-radius: 50%;
  border: 2px dashed var(--gold-dark);
}
.seal-1892 .seal-year {
  font-family: var(--font-heading);
  font-size: 2.8rem;
  font-weight: 900;
  color: var(--green);
  line-height: 1;
}
.seal-1892 .seal-text {
  font-size: 0.55rem;
  font-weight: 800;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--green);
  margin-top: 2px;
}
.seal-1892 .seal-brand {
  font-family: var(--font-heading);
  font-size: 0.65rem;
  font-weight: 700;
  color: var(--gold-dark);
  margin-top: 6px;
  letter-spacing: 1px;
}
.seal-1892 .seal-stars {
  color: var(--gold);
  font-size: 0.7rem;
  letter-spacing: 3px;
}

/* â”€â”€ Stats â”€â”€ */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
}
.stat-card {
  background: var(--white);
  border: 1px solid var(--border-light);
  border-radius: var(--radius-lg);
  padding: 20px;
  box-shadow: var(--shadow);
}
.stat-card .stat-value {
  font-family: var(--font-heading);
  font-size: 2rem;
  font-weight: 900;
  color: var(--green);
}
.stat-card .stat-label {
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-muted);
  margin-top: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.stat-card.gold { border-left: 4px solid var(--gold); }
.stat-card.green { border-left: 4px solid var(--green); }

/* â”€â”€ Inspection Checklist â”€â”€ */
.checklist-section {
  border: 1px solid var(--border-light);
  border-radius: var(--radius);
  margin-bottom: 14px;
  overflow: hidden;
}
.checklist-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 18px;
  background: var(--cream);
  cursor: pointer;
  min-height: 44px;
}
.checklist-header h4 {
  font-family: var(--font-heading);
  font-size: 0.95rem;
  color: var(--green);
  display: flex;
  align-items: center;
  gap: 10px;
}
.checklist-body { padding: 18px; border-top: 1px solid var(--border-light); }
.checklist-rating {
  display: flex;
  gap: 8px;
  margin: 10px 0;
  flex-wrap: wrap;
}
.rating-btn {
  padding: 8px 16px;
  border: 2px solid var(--border);
  border-radius: var(--radius);
  font-size: 0.82rem;
  font-weight: 600;
  cursor: pointer;
  background: var(--white);
  color: var(--text-muted);
  transition: all 0.2s;
  min-height: 44px;
}
.rating-btn:hover { border-color: var(--green); color: var(--green); }
.rating-btn.selected-pass { background: var(--green-pale); border-color: var(--green); color: var(--green); }
.rating-btn.selected-concern { background: #FFF3E0; border-color: #E65100; color: #E65100; }
.rating-btn.selected-fail { background: #FFEBEE; border-color: #C62828; color: #C62828; }
.rating-btn.selected-na { background: var(--cream); border-color: var(--text-light); color: var(--text-light); }

.photo-upload {
  border: 2px dashed var(--border);
  border-radius: var(--radius);
  padding: 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  color: var(--text-light);
  min-height: 80px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 6px;
}
.photo-upload:hover { border-color: var(--green); color: var(--green); background: var(--green-mist); }
.photo-upload .upload-icon { font-size: 1.5rem; }
.photo-thumbs {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 10px;
}
.photo-thumb {
  width: 64px;
  height: 64px;
  border-radius: var(--radius);
  object-fit: cover;
  border: 2px solid var(--border-light);
}

/* â”€â”€ Empty State â”€â”€ */
.empty-state {
  text-align: center;
  padding: 60px 30px;
}
.empty-state .empty-icon {
  font-size: 4rem;
  margin-bottom: 16px;
}
.empty-state h2 {
  font-family: var(--font-heading);
  margin-bottom: 12px;
}
.empty-state p {
  color: var(--text-muted);
  max-width: 480px;
  margin: 0 auto 24px;
  font-size: 0.95rem;
}

/* â”€â”€ Modal â”€â”€ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 2000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
}
.modal-overlay.active { opacity: 1; pointer-events: all; }
.modal {
  background: var(--white);
  border-radius: var(--radius-lg);
  max-width: 720px;
  width: 100%;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: var(--shadow-lg);
}
.modal-header {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border-light);
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  background: var(--white);
  z-index: 1;
}
.modal-header h2 { margin: 0; }
.modal-close {
  width: 36px;
  height: 36px;
  border: none;
  background: var(--cream);
  border-radius: 50%;
  font-size: 1.2rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-muted);
}
.modal-body { padding: 24px; }
.modal-footer { padding: 16px 24px; border-top: 1px solid var(--border-light); display: flex; gap: 10px; justify-content: flex-end; }

/* â”€â”€ Certification Report (Print View) â”€â”€ */
.cert-report {
  background: var(--white);
  max-width: 800px;
  margin: 0 auto;
  border: 1px solid var(--border-light);
  box-shadow: var(--shadow-lg);
}
.cert-report-header {
  background: var(--green);
  padding: 30px 40px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.cert-report-header .cert-brand {
  color: var(--white);
}
.cert-report-header .cert-brand h1 {
  color: var(--white);
  font-size: 1.5rem;
  margin: 0;
}
.cert-report-header .cert-brand .cert-tagline {
  color: var(--gold);
  font-size: 0.75rem;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
}
.cert-report-header .cert-seal-small {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  border: 3px solid var(--gold);
  background: radial-gradient(circle at 30% 30%, #fff8dc, var(--gold-pale));
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
  flex-shrink: 0;
}
.cert-report-header .cert-seal-small::before {
  content: '';
  position: absolute;
  inset: 4px;
  border-radius: 50%;
  border: 1px dashed var(--gold-dark);
}
.cert-seal-small .seal-yr {
  font-family: var(--font-heading);
  font-size: 1.2rem;
  font-weight: 900;
  color: var(--green);
  line-height: 1;
}
.cert-seal-small .seal-txt {
  font-size: 0.35rem;
  font-weight: 800;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--green);
}
.cert-report-body { padding: 30px 40px; }
.cert-report-title {
  text-align: center;
  padding-bottom: 24px;
  border-bottom: 2px solid var(--gold);
  margin-bottom: 24px;
}
.cert-report-title h2 {
  font-size: 1.3rem;
  margin-bottom: 4px;
  letter-spacing: 1px;
}
.cert-report-title .cert-number {
  font-size: 0.8rem;
  color: var(--text-muted);
  font-weight: 500;
}
.cert-detail-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 28px;
}
.cert-detail-item label {
  display: block;
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-light);
  margin-bottom: 3px;
}
.cert-detail-item span {
  font-size: 0.95rem;
  font-weight: 500;
}
.cert-inspection-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 28px;
}
.cert-inspection-table th {
  text-align: left;
  padding: 10px 14px;
  background: var(--green);
  color: var(--white);
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
}
.cert-inspection-table td {
  padding: 10px 14px;
  border-bottom: 1px solid var(--border-light);
  font-size: 0.85rem;
}
.cert-inspection-table tr:nth-child(even) td { background: var(--green-mist); }
.cert-result-pass { color: var(--green); font-weight: 700; }
.cert-result-concern { color: #E65100; font-weight: 700; }
.cert-result-fail { color: #C62828; font-weight: 700; }
.cert-result-na { color: var(--text-light); font-weight: 500; font-style: italic; }
.cert-report-footer {
  border-top: 2px solid var(--green);
  padding: 24px 40px;
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
}
.cert-signature { }
.cert-signature .sig-line {
  border-top: 1px solid var(--text);
  width: 200px;
  margin-top: 40px;
  padding-top: 6px;
  font-size: 0.75rem;
  color: var(--text-muted);
}
.cert-report-footer .cert-contact {
  text-align: right;
  font-size: 0.75rem;
  color: var(--text-muted);
  line-height: 1.8;
}
.cert-overall-result {
  text-align: center;
  padding: 20px;
  margin: 24px 0;
  border: 3px solid var(--gold);
  border-radius: var(--radius-lg);
  background: var(--gold-pale);
}
.cert-overall-result h3 {
  font-size: 1rem;
  color: var(--green);
  margin-bottom: 6px;
}
.cert-overall-result .result-text {
  font-family: var(--font-heading);
  font-size: 1.6rem;
  font-weight: 900;
  color: var(--green);
}
.cert-overall-result .result-text.fail-text { color: #C62828; }

/* â”€â”€ Data Management Panel â”€â”€ */
.data-panel {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}
.data-panel .data-action-card {
  padding: 24px;
  border: 1px solid var(--border-light);
  border-radius: var(--radius);
  text-align: center;
}
.data-action-card h4 { margin-bottom: 8px; }
.data-action-card p { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 16px; }

/* â”€â”€ Responsive â”€â”€ */
@media (min-width: 1024px) {
  .sidebar { display: flex; }
  .bottombar { display: none; }
  .main-content { padding-bottom: 24px; }
  .topbar-actions .mobile-only { display: none; }
}
@media (max-width: 1023px) {
  .sidebar { display: none; }
  .bottombar { display: flex; }
  .main-content { padding-bottom: calc(var(--bottombar-height) + 24px); }
  .topbar-actions .desktop-only { display: none; }
}
@media (max-width: 640px) {
  .main-content { padding: 16px; }
  .form-row { grid-template-columns: 1fr; }
  .cert-detail-grid { grid-template-columns: 1fr; }
  .data-panel { grid-template-columns: 1fr; }
  .stats-grid { grid-template-columns: 1fr 1fr; }
  .data-table { font-size: 0.8rem; }
  .data-table th, .data-table td { padding: 10px 10px; }
  h1 { font-size: 1.4rem; }
}

/* â”€â”€ Print Styles â”€â”€ */
@media print {
  body { background: white !important; }
  .demo-banner, .topbar, .sidebar, .bottombar, .no-print,
  .topbar-actions, .card-footer .btn, .btn { display: none !important; }
  .app-layout { display: block; }
  .main-content { padding: 0; max-width: 100%; }
  .cert-report {
    border: none;
    box-shadow: none;
    page-break-inside: avoid;
  }
  .cert-report-header {
    background: var(--green) !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  .cert-inspection-table th {
    background: var(--green) !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color: white !important;
  }
  .cert-inspection-table tr:nth-child(even) td {
    background: #f4f8f4 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  .cert-overall-result {
    background: #FFF9D6 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  .seal-1892, .cert-seal-small {
    background: #FFF9D6 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  .stat-card, .card { break-inside: avoid; }
  .print-only { display: block !important; }
}
.print-only { display: none; }

/* â”€â”€ Micro-interactions â”€â”€ */
.checklist-section {
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}
.checklist-section:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(33,68,38,0.08);
}
.rating-btn {
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}
.rating-btn:active {
  transform: scale(0.96);
}
.nav-item, .tab-item {
  transition: all 0.15s ease;
}
.nav-item:active, .tab-item:active {
  transform: scale(0.98);
}
.card {
  transition: box-shadow 0.2s ease;
}
.btn {
  transition: all 0.15s ease;
}
.btn:active {
  transform: translateY(1px);
}
.seal-1892 {
  transition: transform 0.3s ease;
}
.seal-1892:hover {
  transform: scale(1.02);
}

/* â”€â”€ Security: Disable selection on structural elements â”€â”€ */
.topbar, .sidebar, .bottombar, .nav-item, .tab-item, .demo-banner, .card-header, .checklist-header, .seal-1892 {
  -webkit-user-select: none;
  user-select: none;
}

/* â”€â”€ Utility â”€â”€ */
.text-gold { color: var(--gold); }
.text-green { color: var(--green); }
.text-muted { color: var(--text-muted); }
.text-center { text-align: center; }
.mt-1 { margin-top: 8px; }
.mt-2 { margin-top: 16px; }
.mt-3 { margin-top: 24px; }
.mb-1 { margin-bottom: 8px; }
.mb-2 { margin-bottom: 16px; }
.mb-3 { margin-bottom: 24px; }
.gap-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
.flex-between { display: flex; justify-content: space-between; align-items: center; }
.clickable-row { cursor: pointer; }
.divider { border: none; border-top: 1px solid var(--border-light); margin: 20px 0; }

/* Toast */
.toast-container {
  position: fixed;
  bottom: 90px;
  right: 20px;
  z-index: 3000;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.toast {
  background: var(--green);
  color: var(--white);
  padding: 12px 20px;
  border-radius: var(--radius);
  font-size: 0.85rem;
  font-weight: 500;
  box-shadow: var(--shadow-lg);
  animation: toastIn 0.3s ease;
  max-width: 360px;
}
.toast.success { border-left: 4px solid var(--gold); }
.toast.error { background: #C62828; border-left: 4px solid #FFCDD2; }
@keyframes toastIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

/* === DEMO DISCLAIMER === */
#bct-demo-disclaimer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #f8f8f8;
  border-top: 1px solid #ddd;
  padding: 10px 16px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 12px;
  line-height: 1.4;
  color: #666;
  z-index: 99999;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 8px 16px;
  text-align: center;
}
#bct-demo-disclaimer p {
  margin: 0;
  max-width: 700px;
}
#bct-demo-disclaimer strong {
  color: #333;
  font-weight: 600;
}
#bct-demo-disclaimer a.bct-delete-btn {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: #dc3545;
  color: #fff;
  padding: 5px 12px;
  border-radius: 4px;
  text-decoration: none;
  font-size: 11px;
  font-weight: 500;
  white-space: nowrap;
  transition: background 0.15s;
}
#bct-demo-disclaimer a.bct-delete-btn:hover {
  background: #b02a37;
}
@media (max-width: 600px) {
  #bct-demo-disclaimer {
    flex-direction: column;
    padding: 8px 12px 12px;
    font-size: 11px;
  }
}
/* Add bottom padding to body so disclaimer doesn't cover content */
body { padding-bottom: 60px !important; }
</style>
</head>
<body>

<!-- â•â•â• DEMO BANNER â•â•â• -->
<div class="demo-banner" id="demoBanner">
  â˜… Demo Mode â€” Viewing sample certifications for Joplin, MO properties
  <button onclick="dismissDemo()">Dismiss &amp; Clear Demo Data</button>
</div>

<!-- â•â•â• TOP BAR â•â•â• -->
<div class="topbar">
  <div class="topbar-brand">
    <div class="topbar-logo">S</div>
    <div>
      <div class="topbar-title">Satterlee Plumbing</div>
      <div class="topbar-subtitle">1892 Certification Engine</div>
    </div>
  </div>
  <div class="topbar-actions">
    <button class="topbar-btn primary" onclick="showNewCertification()">+ New Certification</button>
    <button class="topbar-btn desktop-only" onclick="showDataPanel()" title="Data Management">âš™</button>
  </div>
</div>

<!-- â•â•â• APP LAYOUT â•â•â• -->
<div class="app-layout">

  <!-- â”€â”€ Sidebar â”€â”€ -->
  <nav class="sidebar">
    <div class="sidebar-nav">
      <div class="nav-label">Certifications</div>
      <div class="nav-item active" data-view="dashboard" onclick="navigate('dashboard')">
        <span class="nav-icon">ğŸ“Š</span> Dashboard
      </div>
      <div class="nav-item" data-view="certifications" onclick="navigate('certifications')">
        <span class="nav-icon">ğŸ“‹</span> All Certifications
        <span class="nav-badge" id="certCountBadge">0</span>
      </div>
      <div class="nav-item" data-view="new-cert" onclick="navigate('new-cert')">
        <span class="nav-icon">âœ¦</span> New Certification
      </div>
      <div class="nav-label">Management</div>
      <div class="nav-item" data-view="agents" onclick="navigate('agents')">
        <span class="nav-icon">ğŸ¤</span> Agent Directory
      </div>
      <div class="nav-item" data-view="revenue" onclick="navigate('revenue')">
        <span class="nav-icon">ğŸ’°</span> Revenue Tracking
      </div>
      <div class="nav-label">System</div>
      <div class="nav-item" data-view="data" onclick="navigate('data')">
        <span class="nav-icon">ğŸ—ƒ</span> Data Management
      </div>
    </div>
    <div class="sidebar-footer">
      <small>Satterlee Plumbing, Heating &amp; Cooling<br>Est. 1892 Â· Joplin, Missouri</small>
    </div>
  </nav>

  <!-- â”€â”€ Main Content â”€â”€ -->
  <main class="main-content" id="mainContent">
    <!-- Views rendered by JS -->
  </main>

</div>

<!-- â”€â”€ Bottom Tab Bar â”€â”€ -->
<div class="bottombar">
  <div class="tab-item active" data-view="dashboard" onclick="navigate('dashboard')">
    <span class="tab-icon">ğŸ“Š</span>
    Dashboard
  </div>
  <div class="tab-item" data-view="certifications" onclick="navigate('certifications')">
    <span class="tab-icon">ğŸ“‹</span>
    Certs
    <span class="tab-badge" id="certCountTab">0</span>
  </div>
  <div class="tab-item" data-view="new-cert" onclick="navigate('new-cert')">
    <span class="tab-icon">âœ¦</span>
    New
  </div>
  <div class="tab-item" data-view="agents" onclick="navigate('agents')">
    <span class="tab-icon">ğŸ¤</span>
    Agents
  </div>
  <div class="tab-item" data-view="data" onclick="navigate('data')">
    <span class="tab-icon">âš™</span>
    Data
  </div>
</div>

<!-- â•â•â• MODAL â•â•â• -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModalOutside(event)">
  <div class="modal" id="modalContent">
    <!-- Filled dynamically -->
  </div>
</div>

<!-- â•â•â• TOAST â•â•â• -->
<div class="toast-container" id="toastContainer"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SATTERLEE 1892 CERTIFICATION ENGINE
   Core Application Logic
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// â”€â”€ Security Layer: Access Key Gate â”€â”€
(function _sec(){
  function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
  const _V=-2117083312;
  const _k=new URLSearchParams(window.location.search).get('key');
  if(!_k||_h(_k)!==_V){
    document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:sans-serif;background:#111;color:#fff;text-align:center;padding:20px"><div><h1 style="font-size:2rem;margin-bottom:1rem">Access Denied</h1><p style="color:#999">This tool requires a valid access key.</p><p style="margin-top:1rem"><a href="mailto:ben@bennycutools.com" style="color:#4da6ff">ben@bennycutools.com</a></p></div></div>';
    throw new Error('Invalid key');
  }
  // Disable right-click
  document.addEventListener('contextmenu',e=>e.preventDefault());
  // Block common dev tools shortcuts
  document.addEventListener('keydown',e=>{
    if(e.key==='F12'||(e.ctrlKey&&e.shiftKey&&(e.key==='I'||e.key==='J'||e.key==='C'))||(e.ctrlKey&&e.key==='u')){
      e.preventDefault();
    }
  });
})();

// â”€â”€ State â”€â”€
let db = null;
const DB_NAME = 'Satterlee1892CertEngine';
const DB_VERSION = 1;
const STORES = { certs: 'certifications', agents: 'agents', settings: 'settings' };
let currentView = 'dashboard';
let currentCert = null;

// â”€â”€ Inspection Categories â”€â”€
const INSPECTION_ITEMS = [
  { id: 'cast_iron_stack', name: 'Cast Iron Stack Condition', category: 'Plumbing', icon: 'ğŸ”©',
    desc: 'Inspect vertical cast iron waste/vent stacks for corrosion, joint separation, or belly sags. Common in pre-1960 Joplin homes.' },
  { id: 'sewer_line', name: 'Sewer Line Material & Condition', category: 'Plumbing', icon: 'ğŸ—',
    desc: 'Identify material (clay, cast iron, orangeburg, PVC). Check for root intrusion, bellying, or offset joints. Joplin clay tiles are 80-130 years old.' },
  { id: 'water_heater', name: 'Water Heater Age & Condition', category: 'Plumbing', icon: 'ğŸ”¥',
    desc: 'Decode serial number for manufacture date. Check anode rod, T&P valve, flue draft, and sediment buildup.' },
  { id: 'boiler_flue', name: 'Boiler Flue Liner', category: 'Heating', icon: 'ğŸ­',
    desc: 'Inspect chimney flue liner for cracking, separation, or blockage. Terra cotta liners in historic homes are prone to deterioration.' },
  { id: 'steam_boiler', name: 'Steam Boiler Status', category: 'Heating', icon: 'â™¨ï¸',
    desc: 'Evaluate boiler operation: sight glass level, pressure gauge, safety valve, low-water cutoff, aquastat. Note if converting to forced air.' },
  { id: 'radiant_heat', name: 'Radiant Heat System', category: 'Heating', icon: 'ğŸŒ¡',
    desc: 'Check radiators, baseboards, or in-floor system. Inspect for leaks, air locks, zone valve operation, and circulator pump condition.' },
  { id: 'electrical_panel', name: 'Electrical Panel Assessment', category: 'Electrical', icon: 'âš¡',
    desc: 'Identify panel type (original fuse box, post-tornado breaker panel, Federal Pacific, Zinsco). Note amperage and grounding.' },
  { id: 'gas_lines', name: 'Gas Line Integrity', category: 'Mechanical', icon: 'ğŸ”§',
    desc: 'Check gas supply lines, flex connectors, shutoff valves, and appliance connections. Leak test at meter and appliances.' },
  { id: 'hvac_system', name: 'HVAC System Evaluation', category: 'Cooling', icon: 'â„ï¸',
    desc: 'Evaluate A/C and furnace age, condition, refrigerant type. Post-2011 systems in tornado zone are ~15 years old and entering replacement window.' },
  { id: 'backflow', name: 'Backflow Prevention', category: 'Plumbing', icon: 'ğŸ”„',
    desc: 'Verify presence and function of backflow prevention devices on irrigation, fire suppression, and domestic supply.' }
];

const RATING_OPTIONS = [
  { value: 'pass', label: 'âœ“ Pass', cls: 'selected-pass' },
  { value: 'concern', label: 'âš  Concern', cls: 'selected-concern' },
  { value: 'fail', label: 'âœ• Fail', cls: 'selected-fail' },
  { value: 'na', label: 'N/A', cls: 'selected-na' }
];

// â”€â”€ IndexedDB â”€â”€
function openDB() {
  return new Promise((resolve, reject) => {
    const req = indexedDB.open(DB_NAME, DB_VERSION);
    req.onupgradeneeded = (e) => {
      const d = e.target.result;
      if (!d.objectStoreNames.contains(STORES.certs)) {
        const cs = d.createObjectStore(STORES.certs, { keyPath: 'id' });
        cs.createIndex('status', 'status');
        cs.createIndex('date', 'date');
        cs.createIndex('agentId', 'agentId');
      }
      if (!d.objectStoreNames.contains(STORES.agents)) {
        d.createObjectStore(STORES.agents, { keyPath: 'id' });
      }
      if (!d.objectStoreNames.contains(STORES.settings)) {
        d.createObjectStore(STORES.settings, { keyPath: 'key' });
      }
    };
    req.onsuccess = (e) => { db = e.target.result; resolve(db); };
    req.onerror = (e) => { console.error('IndexedDB error', e); reject(e); };
  });
}

function dbPut(store, data) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction(store, 'readwrite');
    tx.objectStore(store).put(data);
    tx.oncomplete = () => resolve();
    tx.onerror = (e) => reject(e);
  });
}

function dbGetAll(store) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction(store, 'readonly');
    const req = tx.objectStore(store).getAll();
    req.onsuccess = () => resolve(req.result);
    req.onerror = (e) => reject(e);
  });
}

function dbGet(store, key) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction(store, 'readonly');
    const req = tx.objectStore(store).get(key);
    req.onsuccess = () => resolve(req.result);
    req.onerror = (e) => reject(e);
  });
}

function dbDelete(store, key) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction(store, 'readwrite');
    tx.objectStore(store).delete(key);
    tx.oncomplete = () => resolve();
    tx.onerror = (e) => reject(e);
  });
}

function dbClear(store) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction(store, 'readwrite');
    tx.objectStore(store).clear();
    tx.oncomplete = () => resolve();
    tx.onerror = (e) => reject(e);
  });
}

// â”€â”€ Utilities â”€â”€
function genId() { return Date.now().toString(36) + Math.random().toString(36).slice(2, 8); }
function formatDate(d) { return new Date(d).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }); }
function certNumber(cert) { return 'SC-' + cert.id.slice(0,8).toUpperCase(); }

function toast(msg, type = 'success') {
  const c = document.getElementById('toastContainer');
  const t = document.createElement('div');
  t.className = `toast ${type}`;
  t.textContent = msg;
  c.appendChild(t);
  setTimeout(() => { t.style.opacity = '0'; t.style.transition = 'opacity 0.3s'; setTimeout(() => t.remove(), 300); }, 3500);
}

function overallResult(inspections) {
  if (!inspections || inspections.length === 0) return 'Pending';
  const rated = inspections.filter(i => i.rating && i.rating !== 'na');
  if (rated.length === 0) return 'Pending';
  if (rated.some(i => i.rating === 'fail')) return 'Not Certified';
  if (rated.some(i => i.rating === 'concern')) return 'Certified with Conditions';
  return 'Certified';
}

function statusClass(status) {
  const map = { 'Certified': 'status-certified', 'Certified with Conditions': 'status-pending',
    'Not Certified': 'status-failed', 'Pending': 'status-in-progress', 'In Progress': 'status-in-progress' };
  return map[status] || 'status-in-progress';
}

// â”€â”€ Navigation â”€â”€
function navigate(view) {
  currentView = view;
  document.querySelectorAll('.nav-item').forEach(n => n.classList.toggle('active', n.dataset.view === view));
  document.querySelectorAll('.tab-item').forEach(t => t.classList.toggle('active', t.dataset.view === view));
  renderView();
}

function showNewCertification() { navigate('new-cert'); }
function showDataPanel() { navigate('data'); }

async function renderView() {
  const main = document.getElementById('mainContent');
  switch (currentView) {
    case 'dashboard': main.innerHTML = await renderDashboard(); break;
    case 'certifications': main.innerHTML = await renderCertifications(); break;
    case 'new-cert': main.innerHTML = await renderNewCert(); initNewCertForm(); break;
    case 'edit-cert': main.innerHTML = await renderEditCert(); initEditCertForm(); break;
    case 'view-cert': main.innerHTML = await renderViewCert(); break;
    case 'agents': main.innerHTML = await renderAgents(); break;
    case 'revenue': main.innerHTML = await renderRevenue(); break;
    case 'data': main.innerHTML = await renderDataManagement(); break;
    default: main.innerHTML = await renderDashboard();
  }
  updateBadges();
}

async function updateBadges() {
  const certs = await dbGetAll(STORES.certs);
  const count = certs.length;
  const badge1 = document.getElementById('certCountBadge');
  const badge2 = document.getElementById('certCountTab');
  if (badge1) badge1.textContent = count;
  if (badge2) badge2.textContent = count;
}

// â”€â”€ Dashboard â”€â”€
async function renderDashboard() {
  const certs = await dbGetAll(STORES.certs);
  const agents = await dbGetAll(STORES.agents);

  if (certs.length === 0) {
    return renderEmptyState();
  }

  const certified = certs.filter(c => overallResult(c.inspections) === 'Certified').length;
  const withConditions = certs.filter(c => overallResult(c.inspections) === 'Certified with Conditions').length;
  const pending = certs.filter(c => ['Pending','In Progress'].includes(c.status)).length;
  const totalFees = certs.reduce((sum, c) => sum + (parseFloat(c.fee) || 0), 0);

  const recent = [...certs].sort((a,b) => new Date(b.date) - new Date(a.date)).slice(0, 5);

  return `
    <div class="mb-3">
      <h1>Certification Dashboard</h1>
      <p class="text-muted">Satterlee 1892 Standard â€” Joplin, Missouri</p>
    </div>

    <div class="stats-grid">
      <div class="stat-card gold">
        <div class="stat-value">${certified}</div>
        <div class="stat-label">Certified Properties</div>
      </div>
      <div class="stat-card green">
        <div class="stat-value">${certs.length}</div>
        <div class="stat-label">Total Inspections</div>
      </div>
      <div class="stat-card gold">
        <div class="stat-value">$${totalFees.toLocaleString()}</div>
        <div class="stat-label">Certification Revenue</div>
      </div>
      <div class="stat-card green">
        <div class="stat-value">${agents.length}</div>
        <div class="stat-label">Partner Agents</div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h3>Recent Certifications</h3>
        <button class="btn btn-sm btn-outline" onclick="navigate('certifications')">View All</button>
      </div>
      <div class="card-body" style="padding:0">
        <table class="data-table">
          <thead>
            <tr>
              <th>Cert #</th>
              <th>Property Address</th>
              <th>Agent</th>
              <th>Date</th>
              <th>Result</th>
            </tr>
          </thead>
          <tbody>
            ${recent.map(c => {
              const result = overallResult(c.inspections);
              return `<tr class="clickable-row" onclick="viewCertification('${c.id}')">
                <td style="font-weight:700;color:var(--green)">${certNumber(c)}</td>
                <td>${c.address}</td>
                <td>${c.agentName || 'â€”'}</td>
                <td>${formatDate(c.date)}</td>
                <td><span class="status-badge ${statusClass(result)}">${result}</span></td>
              </tr>`;
            }).join('')}
          </tbody>
        </table>
      </div>
    </div>

    ${pending > 0 ? `<div class="card">
      <div class="card-header"><h3>â³ ${pending} Certification${pending > 1 ? 's' : ''} In Progress</h3></div>
      <div class="card-body">
        <p class="text-muted">Complete open inspections to generate the 1892 Seal certification report.</p>
        <button class="btn btn-primary mt-1" onclick="navigate('certifications')">View Open Certifications</button>
      </div>
    </div>` : ''}
  `;
}

function renderEmptyState() {
  return `
    <div class="empty-state">
      <div class="seal-1892">
        <div class="seal-stars">â˜… â˜… â˜…</div>
        <div class="seal-year">1892</div>
        <div class="seal-text">Certified Standard</div>
        <div class="seal-brand">Satterlee</div>
      </div>
      <h2>The 1892 Certification Engine</h2>
      <p>
        Generate premium "Satterlee Certified" home health reports for Joplin's historic
        housing stock. Built for real estate agents and Satterlee technicians to transform
        property inspections into professional, authoritative certifications.
      </p>
      <div class="gap-row" style="justify-content:center">
        <button class="btn btn-gold btn-lg" onclick="navigate('new-cert')">âœ¦ New Certification</button>
        <button class="btn btn-outline" onclick="navigate('data')">Import Records</button>
      </div>
    </div>
  `;
}

// â”€â”€ Certifications List â”€â”€
async function renderCertifications() {
  const certs = await dbGetAll(STORES.certs);
  const sorted = [...certs].sort((a,b) => new Date(b.date) - new Date(a.date));

  return `
    <div class="flex-between mb-3">
      <div>
        <h1>All Certifications</h1>
        <p class="text-muted">${certs.length} total record${certs.length !== 1 ? 's' : ''}</p>
      </div>
      <button class="btn btn-gold" onclick="navigate('new-cert')">+ New Certification</button>
    </div>
    <div class="card">
      <div class="card-body" style="padding:0">
        ${sorted.length === 0 ? '<div class="empty-state"><p>No certifications yet. Start a new one!</p></div>' : `
        <table class="data-table">
          <thead>
            <tr>
              <th>Cert #</th>
              <th>Property Address</th>
              <th>Type</th>
              <th>Agent</th>
              <th>Date</th>
              <th>Fee</th>
              <th>Result</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            ${sorted.map(c => {
              const result = overallResult(c.inspections);
              return `<tr>
                <td style="font-weight:700;color:var(--green)">${certNumber(c)}</td>
                <td>${c.address}</td>
                <td style="font-size:0.8rem">${c.propertyType || 'â€”'}</td>
                <td>${c.agentName || 'â€”'}</td>
                <td>${formatDate(c.date)}</td>
                <td>${c.fee ? '$'+parseFloat(c.fee).toLocaleString() : 'â€”'}</td>
                <td><span class="status-badge ${statusClass(result)}">${result}</span></td>
                <td>
                  <div class="gap-row">
                    <button class="btn btn-sm btn-ghost" onclick="viewCertification('${c.id}')" title="View Report">ğŸ“„</button>
                    <button class="btn btn-sm btn-ghost" onclick="editCertification('${c.id}')" title="Edit">âœï¸</button>
                    <button class="btn btn-sm btn-ghost" onclick="deleteCertification('${c.id}')" title="Delete" style="color:#c0392b">ğŸ—‘</button>
                  </div>
                </td>
              </tr>`;
            }).join('')}
          </tbody>
        </table>`}
      </div>
    </div>
  `;
}

// â”€â”€ New Certification Form â”€â”€
async function renderNewCert() {
  const agents = await dbGetAll(STORES.agents);
  return `
    <div class="mb-3">
      <h1>âœ¦ New Pre-Listing Certification</h1>
      <p class="text-muted">Generate a Satterlee 1892 Standard home health report</p>
    </div>

    <form id="newCertForm" onsubmit="return false;">
    <div class="card mb-2">
      <div class="card-header"><h3>ğŸ  Property Information</h3></div>
      <div class="card-body">
        <div class="form-group">
          <label class="form-label">Property Address *</label>
          <input type="text" class="form-input" id="certAddress" placeholder="e.g., 1523 S Sergeant Ave, Joplin, MO 64801" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Property Type</label>
            <select class="form-select" id="certPropertyType">
              <option value="Historic (Pre-1950)">Historic (Pre-1950)</option>
              <option value="Mid-Century (1950-1990)">Mid-Century (1950-1990)</option>
              <option value="Pre-Tornado (1990-2011)">Pre-Tornado (1990-2011)</option>
              <option value="Post-Tornado Rebuild (2011-2015)">Post-Tornado Rebuild (2011-2015)</option>
              <option value="Modern (2015+)">Modern (2015+)</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Year Built (est.)</label>
            <input type="number" class="form-input" id="certYearBuilt" placeholder="e.g., 1925" min="1850" max="2026">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Property Notes</label>
          <textarea class="form-textarea" id="certNotes" placeholder="Additional context about the property (original boiler, known issues, etc.)"></textarea>
        </div>
      </div>
    </div>

    <div class="card mb-2">
      <div class="card-header"><h3>ğŸ¤ Requesting Agent</h3></div>
      <div class="card-body">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Agent Name *</label>
            <input type="text" class="form-input" id="certAgentName" placeholder="e.g., Jennifer Maxwell" list="agentSuggestions" required>
            <datalist id="agentSuggestions">
              ${agents.map(a => `<option value="${a.name}">`).join('')}
            </datalist>
          </div>
          <div class="form-group">
            <label class="form-label">Brokerage</label>
            <input type="text" class="form-input" id="certAgentBrokerage" placeholder="e.g., Keller Williams Joplin">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Agent Phone</label>
            <input type="tel" class="form-input" id="certAgentPhone" placeholder="(417) 555-0123">
          </div>
          <div class="form-group">
            <label class="form-label">Agent Email</label>
            <input type="email" class="form-input" id="certAgentEmail" placeholder="agent@brokerage.com">
          </div>
        </div>
      </div>
    </div>

    <div class="card mb-2">
      <div class="card-header"><h3>ğŸ’° Certification Details</h3></div>
      <div class="card-body">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Certification Fee</label>
            <input type="number" class="form-input" id="certFee" placeholder="250" min="0" step="25">
            <div class="form-hint">Standard: $250 Â· Rush: $400 Â· Commercial: $500+</div>
          </div>
          <div class="form-group">
            <label class="form-label">Service Type</label>
            <select class="form-select" id="certServiceType">
              <option value="Standard">Standard (3-5 business days)</option>
              <option value="Rush">Rush (24-48 hours)</option>
              <option value="Commercial">Commercial</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Assigned Technician</label>
          <input type="text" class="form-input" id="certTech" placeholder="e.g., Mike Henderson">
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-footer">
        <button type="button" class="btn btn-ghost" onclick="navigate('dashboard')">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="saveCertAndInspect()">Save & Begin Inspection â†’</button>
        <button type="button" class="btn btn-gold" onclick="saveCertOnly()">Save for Later</button>
      </div>
    </div>
    </form>
  `;
}

function initNewCertForm() { /* future enhancement hooks */ }

async function saveCertOnly() {
  const cert = gatherCertForm();
  if (!cert) return;
  cert.status = 'Pending';
  cert.inspections = [];
  await dbPut(STORES.certs, cert);
  await saveAgentFromCert(cert);
  toast('Certification saved â€” ready for inspection');
  navigate('certifications');
}

async function saveCertAndInspect() {
  const cert = gatherCertForm();
  if (!cert) return;
  cert.status = 'In Progress';
  cert.inspections = INSPECTION_ITEMS.map(item => ({ ...item, rating: '', notes: '', photos: [] }));
  await dbPut(STORES.certs, cert);
  await saveAgentFromCert(cert);
  toast('Certification created â€” begin inspection');
  currentCert = cert.id;
  currentView = 'edit-cert';
  renderView();
}

function gatherCertForm() {
  const address = document.getElementById('certAddress')?.value.trim();
  const agentName = document.getElementById('certAgentName')?.value.trim();
  if (!address || !agentName) {
    toast('Property address and agent name are required', 'error');
    return null;
  }
  return {
    id: genId(),
    address,
    propertyType: document.getElementById('certPropertyType')?.value || '',
    yearBuilt: document.getElementById('certYearBuilt')?.value || '',
    notes: document.getElementById('certNotes')?.value || '',
    agentName,
    agentBrokerage: document.getElementById('certAgentBrokerage')?.value || '',
    agentPhone: document.getElementById('certAgentPhone')?.value || '',
    agentEmail: document.getElementById('certAgentEmail')?.value || '',
    fee: document.getElementById('certFee')?.value || '',
    serviceType: document.getElementById('certServiceType')?.value || 'Standard',
    tech: document.getElementById('certTech')?.value || '',
    date: new Date().toISOString(),
    inspections: [],
    status: 'Pending',
    isDemo: false
  };
}

async function saveAgentFromCert(cert) {
  if (!cert.agentName) return;
  const agents = await dbGetAll(STORES.agents);
  const existing = agents.find(a => a.name.toLowerCase() === cert.agentName.toLowerCase());
  if (!existing) {
    await dbPut(STORES.agents, {
      id: genId(),
      name: cert.agentName,
      brokerage: cert.agentBrokerage,
      phone: cert.agentPhone,
      email: cert.agentEmail,
      certCount: 1,
      firstCert: cert.date,
      isDemo: cert.isDemo || false
    });
  } else {
    existing.certCount = (existing.certCount || 0) + 1;
    if (cert.agentBrokerage) existing.brokerage = cert.agentBrokerage;
    if (cert.agentPhone) existing.phone = cert.agentPhone;
    if (cert.agentEmail) existing.email = cert.agentEmail;
    await dbPut(STORES.agents, existing);
  }
}

// â”€â”€ Edit Certification (Inspection) â”€â”€
async function editCertification(id) {
  currentCert = id;
  currentView = 'edit-cert';
  renderView();
}

async function renderEditCert() {
  const cert = await dbGet(STORES.certs, currentCert);
  if (!cert) return '<p>Certification not found.</p>';

  if (!cert.inspections || cert.inspections.length === 0) {
    cert.inspections = INSPECTION_ITEMS.map(item => ({ ...item, rating: '', notes: '', photos: [] }));
    cert.status = 'In Progress';
    await dbPut(STORES.certs, cert);
  }

  const completed = cert.inspections.filter(i => i.rating).length;
  const total = cert.inspections.length;

  return `
    <div class="flex-between mb-3">
      <div>
        <h1>ğŸ” Inspection: ${certNumber(cert)}</h1>
        <p class="text-muted">${cert.address}</p>
      </div>
      <div class="gap-row">
        <button class="btn btn-outline btn-sm" onclick="navigate('certifications')">â† Back</button>
        <button class="btn btn-gold btn-sm" onclick="finalizeCert('${cert.id}')">Finalize & Generate Report</button>
      </div>
    </div>

    <div class="card mb-2">
      <div class="card-body">
        <div class="flex-between">
          <span style="font-weight:600">${completed} of ${total} items inspected</span>
          <span class="text-muted">${Math.round(completed/total*100)}% complete</span>
        </div>
        <div style="background:var(--border-light);height:8px;border-radius:4px;margin-top:10px;overflow:hidden">
          <div style="background:var(--green);height:100%;width:${(completed/total*100)}%;border-radius:4px;transition:width 0.3s"></div>
        </div>
      </div>
    </div>

    ${cert.inspections.map((item, idx) => `
      <div class="checklist-section" id="checklist-${idx}">
        <div class="checklist-header" onclick="toggleChecklist(${idx})">
          <h4>
            <span>${item.icon || 'ğŸ”§'}</span>
            ${item.name}
            ${item.rating ? `<span class="status-badge ${statusClass(item.rating === 'pass' ? 'Certified' : item.rating === 'fail' ? 'Not Certified' : item.rating === 'concern' ? 'Certified with Conditions' : 'Pending')}" style="font-size:0.65rem">${item.rating.toUpperCase()}</span>` : ''}
          </h4>
          <span class="text-muted" style="font-size:0.8rem">${item.category}</span>
        </div>
        <div class="checklist-body" id="checklist-body-${idx}" style="display:${item.rating ? 'none' : 'block'}">
          <p class="text-muted mb-2" style="font-size:0.85rem">${item.desc}</p>
          <label class="form-label">Rating</label>
          <div class="checklist-rating">
            ${RATING_OPTIONS.map(opt => `
              <button type="button" class="rating-btn ${item.rating === opt.value ? opt.cls : ''}"
                onclick="setRating(${idx}, '${opt.value}', this)">${opt.label}</button>
            `).join('')}
          </div>
          <div class="form-group mt-2">
            <label class="form-label">Technician Notes</label>
            <textarea class="form-textarea" id="notes-${idx}" placeholder="Observations, measurements, recommendations..."
              onchange="setNotes(${idx}, this.value)">${item.notes || ''}</textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Photo Documentation</label>
            <div class="photo-upload" onclick="document.getElementById('photo-input-${idx}').click()">
              <span class="upload-icon">ğŸ“·</span>
              <span>Tap to add photos</span>
            </div>
            <input type="file" id="photo-input-${idx}" accept="image/*" multiple style="display:none"
              onchange="addPhotos(${idx}, this.files)">
            <div class="photo-thumbs" id="photo-thumbs-${idx}">
              ${(item.photos || []).map((p, pi) => `<img src="${p}" class="photo-thumb" alt="Photo ${pi+1}">`).join('')}
            </div>
          </div>
        </div>
      </div>
    `).join('')}

    <div class="card mt-3">
      <div class="card-footer">
        <button class="btn btn-ghost" onclick="navigate('certifications')">Save & Exit</button>
        <button class="btn btn-gold btn-lg" onclick="finalizeCert('${cert.id}')">âœ¦ Finalize & Generate 1892 Report</button>
      </div>
    </div>
  `;
}

function initEditCertForm() { }

function toggleChecklist(idx) {
  const body = document.getElementById(`checklist-body-${idx}`);
  if (body) body.style.display = body.style.display === 'none' ? 'block' : 'none';
}

async function setRating(idx, value, btn) {
  const cert = await dbGet(STORES.certs, currentCert);
  if (!cert) return;
  cert.inspections[idx].rating = value;
  await dbPut(STORES.certs, cert);

  // Update UI
  const parent = btn.parentElement;
  parent.querySelectorAll('.rating-btn').forEach(b => b.className = 'rating-btn');
  const opt = RATING_OPTIONS.find(o => o.value === value);
  if (opt) btn.classList.add(opt.cls);

  // Update progress
  renderView();
}

async function setNotes(idx, value) {
  const cert = await dbGet(STORES.certs, currentCert);
  if (!cert) return;
  cert.inspections[idx].notes = value;
  await dbPut(STORES.certs, cert);
}

async function addPhotos(idx, files) {
  const cert = await dbGet(STORES.certs, currentCert);
  if (!cert) return;
  if (!cert.inspections[idx].photos) cert.inspections[idx].photos = [];

  for (const file of files) {
    const reader = new FileReader();
    await new Promise(resolve => {
      reader.onload = (e) => {
        cert.inspections[idx].photos.push(e.target.result);
        resolve();
      };
      reader.readAsDataURL(file);
    });
  }
  await dbPut(STORES.certs, cert);
  renderView();
}

async function finalizeCert(id) {
  const cert = await dbGet(STORES.certs, id);
  if (!cert) return;
  const result = overallResult(cert.inspections);
  cert.status = result;
  cert.finalizedDate = new Date().toISOString();
  await dbPut(STORES.certs, cert);
  toast(`Certification finalized: ${result}`);
  currentCert = id;
  currentView = 'view-cert';
  renderView();
}

// â”€â”€ View Certification Report â”€â”€
async function viewCertification(id) {
  currentCert = id;
  currentView = 'view-cert';
  renderView();
}

async function renderViewCert() {
  const cert = await dbGet(STORES.certs, currentCert);
  if (!cert) return '<p>Certification not found.</p>';

  const result = overallResult(cert.inspections);
  const isCertified = result === 'Certified' || result === 'Certified with Conditions';

  return `
    <div class="flex-between mb-3 no-print">
      <div>
        <h1>ğŸ“„ Certification Report</h1>
        <p class="text-muted">${certNumber(cert)} â€” ${cert.address}</p>
      </div>
      <div class="gap-row">
        <button class="btn btn-outline btn-sm" onclick="navigate('certifications')">â† Back</button>
        <button class="btn btn-sm btn-primary" onclick="editCertification('${cert.id}')">âœï¸ Edit Inspection</button>
        <button class="btn btn-gold btn-sm" onclick="window.print()">ğŸ–¨ Print Report</button>
      </div>
    </div>

    <div class="cert-report">
      <div class="cert-report-header">
        <div class="cert-brand">
          <h1>Satterlee Plumbing, Heating &amp; Cooling</h1>
          <div class="cert-tagline">Quality &amp; Reliability Since 1892 Â· Joplin, Missouri</div>
        </div>
        <div class="cert-seal-small">
          <div class="seal-yr">1892</div>
          <div class="seal-txt">Certified</div>
        </div>
      </div>

      <div class="cert-report-body">
        <div class="cert-report-title">
          <h2>HOME SYSTEMS CERTIFICATION REPORT</h2>
          <div class="cert-number">${certNumber(cert)} Â· Issued ${formatDate(cert.finalizedDate || cert.date)}</div>
        </div>

        <div class="cert-detail-grid">
          <div class="cert-detail-item">
            <label>Property Address</label>
            <span>${cert.address}</span>
          </div>
          <div class="cert-detail-item">
            <label>Property Type</label>
            <span>${cert.propertyType || 'Not specified'}</span>
          </div>
          <div class="cert-detail-item">
            <label>Year Built</label>
            <span>${cert.yearBuilt || 'Unknown'}</span>
          </div>
          <div class="cert-detail-item">
            <label>Inspection Date</label>
            <span>${formatDate(cert.date)}</span>
          </div>
          <div class="cert-detail-item">
            <label>Requesting Agent</label>
            <span>${cert.agentName || 'N/A'}${cert.agentBrokerage ? ' Â· ' + cert.agentBrokerage : ''}</span>
          </div>
          <div class="cert-detail-item">
            <label>Lead Technician</label>
            <span>${cert.tech || 'Satterlee Certified Tech'}</span>
          </div>
        </div>

        ${cert.notes ? `<div style="background:var(--cream);padding:14px 18px;border-radius:var(--radius);margin-bottom:24px;font-size:0.9rem">
          <strong>Property Notes:</strong> ${cert.notes}
        </div>` : ''}

        <table class="cert-inspection-table">
          <thead>
            <tr>
              <th style="width:35%">Inspection Item</th>
              <th style="width:15%">Category</th>
              <th style="width:12%">Result</th>
              <th>Technician Notes</th>
            </tr>
          </thead>
          <tbody>
            ${(cert.inspections || []).map(item => {
              const rcls = item.rating === 'pass' ? 'cert-result-pass' : item.rating === 'fail' ? 'cert-result-fail' :
                item.rating === 'concern' ? 'cert-result-concern' : 'cert-result-na';
              const rlabel = item.rating === 'pass' ? 'âœ“ PASS' : item.rating === 'fail' ? 'âœ• FAIL' :
                item.rating === 'concern' ? 'âš  CONCERN' : item.rating === 'na' ? 'N/A' : 'â€”';
              return `<tr>
                <td><strong>${item.name}</strong></td>
                <td>${item.category}</td>
                <td class="${rcls}">${rlabel}</td>
                <td style="font-size:0.82rem">${item.notes || 'â€”'}</td>
              </tr>`;
            }).join('')}
          </tbody>
        </table>

        <div class="cert-overall-result">
          <h3>Overall Certification Result</h3>
          <div class="result-text ${!isCertified ? 'fail-text' : ''}">${result}</div>
        </div>

        ${isCertified ? `
        <div style="text-align:center;margin:30px 0">
          <div class="seal-1892">
            <div class="seal-stars">â˜… â˜… â˜…</div>
            <div class="seal-year">1892</div>
            <div class="seal-text">Certified Standard</div>
            <div class="seal-brand">Satterlee</div>
          </div>
          <p style="font-size:0.85rem;color:var(--text-muted);margin-top:16px;max-width:400px;margin-left:auto;margin-right:auto">
            This property has been inspected and ${result === 'Certified' ? 'meets' : 'conditionally meets'} the
            Satterlee 1892 Standard for home mechanical systems integrity.
          </p>
        </div>
        ` : ''}
      </div>

      <div class="cert-report-footer">
        <div class="cert-signature">
          <div class="sig-line">Certifying Technician Â· ${cert.tech || 'Satterlee Plumbing'}</div>
        </div>
        <div class="cert-contact">
          Satterlee Plumbing, Heating &amp; Cooling<br>
          3423 N Main St, Joplin, MO 64801<br>
          satterleeplumbing.com
        </div>
      </div>
    </div>
  `;
}

async function deleteCertification(id) {
  if (!confirm('Delete this certification? This cannot be undone.')) return;
  await dbDelete(STORES.certs, id);
  toast('Certification deleted');
  renderView();
}

// â”€â”€ Agents Directory â”€â”€
async function renderAgents() {
  const agents = await dbGetAll(STORES.agents);
  const certs = await dbGetAll(STORES.certs);

  return `
    <div class="flex-between mb-3">
      <div>
        <h1>ğŸ¤ Agent Directory</h1>
        <p class="text-muted">${agents.length} partner agent${agents.length !== 1 ? 's' : ''}</p>
      </div>
      <button class="btn btn-outline" onclick="showAddAgentModal()">+ Add Agent</button>
    </div>

    ${agents.length === 0 ? '<div class="card"><div class="card-body text-center text-muted">No agents yet. Agents are automatically added when you create certifications.</div></div>' : `
    <div class="card">
      <div class="card-body" style="padding:0">
        <table class="data-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Brokerage</th>
              <th>Phone</th>
              <th>Email</th>
              <th>Certifications</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            ${agents.map(a => {
              const agentCerts = certs.filter(c => c.agentName && c.agentName.toLowerCase() === a.name.toLowerCase());
              return `<tr>
                <td style="font-weight:600">${a.name}</td>
                <td>${a.brokerage || 'â€”'}</td>
                <td>${a.phone || 'â€”'}</td>
                <td>${a.email || 'â€”'}</td>
                <td>${agentCerts.length}</td>
                <td><button class="btn btn-sm btn-ghost" onclick="deleteAgent('${a.id}')" style="color:#c0392b">ğŸ—‘</button></td>
              </tr>`;
            }).join('')}
          </tbody>
        </table>
      </div>
    </div>`}
  `;
}

function showAddAgentModal() {
  openModal(`
    <div class="modal-header">
      <h2>Add Agent</h2>
      <button class="modal-close" onclick="closeModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Agent Name *</label>
        <input type="text" class="form-input" id="modalAgentName" required>
      </div>
      <div class="form-group">
        <label class="form-label">Brokerage</label>
        <input type="text" class="form-input" id="modalAgentBrokerage">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Phone</label>
          <input type="tel" class="form-input" id="modalAgentPhone">
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="modalAgentEmail">
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveNewAgent()">Save Agent</button>
    </div>
  `);
}

async function saveNewAgent() {
  const name = document.getElementById('modalAgentName')?.value.trim();
  if (!name) { toast('Agent name is required', 'error'); return; }
  await dbPut(STORES.agents, {
    id: genId(),
    name,
    brokerage: document.getElementById('modalAgentBrokerage')?.value || '',
    phone: document.getElementById('modalAgentPhone')?.value || '',
    email: document.getElementById('modalAgentEmail')?.value || '',
    certCount: 0,
    firstCert: null,
    isDemo: false
  });
  toast('Agent added');
  closeModal();
  renderView();
}

async function deleteAgent(id) {
  if (!confirm('Remove this agent from the directory?')) return;
  await dbDelete(STORES.agents, id);
  toast('Agent removed');
  renderView();
}

// â”€â”€ Revenue Tracking â”€â”€
async function renderRevenue() {
  const certs = await dbGetAll(STORES.certs);
  const withFees = certs.filter(c => parseFloat(c.fee) > 0);
  const total = withFees.reduce((sum, c) => sum + parseFloat(c.fee), 0);
  const avgFee = withFees.length > 0 ? total / withFees.length : 0;

  // Revenue by month
  const byMonth = {};
  withFees.forEach(c => {
    const m = new Date(c.date).toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
    byMonth[m] = (byMonth[m] || 0) + parseFloat(c.fee);
  });

  // Revenue by agent
  const byAgent = {};
  withFees.forEach(c => {
    const name = c.agentName || 'Direct';
    byAgent[name] = (byAgent[name] || 0) + parseFloat(c.fee);
  });

  return `
    <div class="mb-3">
      <h1>ğŸ’° Revenue Tracking</h1>
      <p class="text-muted">Certification fee revenue and agent performance</p>
    </div>

    <div class="stats-grid">
      <div class="stat-card gold">
        <div class="stat-value">$${total.toLocaleString()}</div>
        <div class="stat-label">Total Revenue</div>
      </div>
      <div class="stat-card green">
        <div class="stat-value">${withFees.length}</div>
        <div class="stat-label">Paid Certifications</div>
      </div>
      <div class="stat-card gold">
        <div class="stat-value">$${Math.round(avgFee).toLocaleString()}</div>
        <div class="stat-label">Avg. Fee</div>
      </div>
    </div>

    ${Object.keys(byAgent).length > 0 ? `
    <div class="card mb-2">
      <div class="card-header"><h3>Revenue by Agent</h3></div>
      <div class="card-body" style="padding:0">
        <table class="data-table">
          <thead><tr><th>Agent</th><th>Certifications</th><th>Revenue</th></tr></thead>
          <tbody>
            ${Object.entries(byAgent).sort((a,b) => b[1] - a[1]).map(([name, rev]) => {
              const cnt = withFees.filter(c => (c.agentName || 'Direct') === name).length;
              return `<tr><td style="font-weight:600">${name}</td><td>${cnt}</td><td style="font-weight:700;color:var(--green)">$${rev.toLocaleString()}</td></tr>`;
            }).join('')}
          </tbody>
        </table>
      </div>
    </div>` : ''}

    ${Object.keys(byMonth).length > 0 ? `
    <div class="card">
      <div class="card-header"><h3>Monthly Revenue</h3></div>
      <div class="card-body" style="padding:0">
        <table class="data-table">
          <thead><tr><th>Month</th><th>Certifications</th><th>Revenue</th></tr></thead>
          <tbody>
            ${Object.entries(byMonth).map(([month, rev]) => {
              const cnt = withFees.filter(c => new Date(c.date).toLocaleDateString('en-US', { year: 'numeric', month: 'short' }) === month).length;
              return `<tr><td>${month}</td><td>${cnt}</td><td style="font-weight:700;color:var(--green)">$${rev.toLocaleString()}</td></tr>`;
            }).join('')}
          </tbody>
        </table>
      </div>
    </div>` : '<div class="card"><div class="card-body text-center text-muted">No revenue data yet. Add certification fees when creating new certifications.</div></div>'}
  `;
}

// â”€â”€ Data Management â”€â”€
async function renderDataManagement() {
  const certs = await dbGetAll(STORES.certs);
  const agents = await dbGetAll(STORES.agents);

  return `
    <div class="mb-3">
      <h1>ğŸ—ƒ Data Management</h1>
      <p class="text-muted">Import, export, and manage certification data</p>
    </div>

    <div class="stats-grid mb-3">
      <div class="stat-card green">
        <div class="stat-value">${certs.length}</div>
        <div class="stat-label">Certifications</div>
      </div>
      <div class="stat-card gold">
        <div class="stat-value">${agents.length}</div>
        <div class="stat-label">Agents</div>
      </div>
    </div>

    <div class="data-panel">
      <div class="card data-action-card">
        <h4>ğŸ“¤ Export CSV</h4>
        <p>Download certifications as a spreadsheet-ready CSV file.</p>
        <button class="btn btn-primary btn-sm" onclick="exportCSV()">Download CSV</button>
      </div>
      <div class="card data-action-card">
        <h4>ğŸ’¾ Full JSON Backup</h4>
        <p>Export all data (certifications, agents, settings) as JSON.</p>
        <button class="btn btn-primary btn-sm" onclick="exportJSON()">Download Backup</button>
      </div>
      <div class="card data-action-card">
        <h4>ğŸ“¥ Import CSV</h4>
        <p>Import certifications from a CSV file or clipboard paste.</p>
        <input type="file" accept=".csv" id="csvImportInput" style="display:none" onchange="importCSV(this.files[0])">
        <div class="gap-row" style="justify-content:center">
          <button class="btn btn-outline btn-sm" onclick="document.getElementById('csvImportInput').click()">Choose File</button>
          <button class="btn btn-ghost btn-sm" onclick="showClipboardImport()">Paste</button>
        </div>
      </div>
      <div class="card data-action-card">
        <h4>ğŸ”„ Restore JSON Backup</h4>
        <p>Restore all data from a previously exported JSON backup.</p>
        <input type="file" accept=".json" id="jsonImportInput" style="display:none" onchange="importJSON(this.files[0])">
        <button class="btn btn-outline btn-sm" onclick="document.getElementById('jsonImportInput').click()">Choose File</button>
      </div>
    </div>

    <hr class="divider">

    <div class="card">
      <div class="card-header">
        <h3 style="color:#c0392b">âš  Danger Zone</h3>
      </div>
      <div class="card-body">
        <p class="text-muted mb-2">Permanently delete all certification data. This cannot be undone.</p>
        <button class="btn btn-danger btn-sm" onclick="clearAllData()">Delete All Data</button>
      </div>
    </div>

    <div class="card mt-2">
      <div class="card-header">
        <h3>ğŸ“‹ Clipboard Import</h3>
      </div>
      <div class="card-body">
        <p class="text-muted mb-2">Paste tab-separated or comma-separated data. Columns: Address, Agent Name, Brokerage, Fee, Property Type, Year Built</p>
        <textarea class="form-textarea" id="clipboardPaste" rows="5" placeholder="Paste data here..."></textarea>
        <button class="btn btn-primary btn-sm mt-1" onclick="importClipboard()">Import Pasted Data</button>
      </div>
    </div>
  `;
}

async function exportCSV() {
  const certs = await dbGetAll(STORES.certs);
  const headers = ['Cert #','Address','Property Type','Year Built','Agent','Brokerage','Date','Fee','Service Type','Tech','Status','Result'];
  const rows = certs.map(c => [
    certNumber(c), c.address, c.propertyType, c.yearBuilt, c.agentName, c.agentBrokerage,
    formatDate(c.date), c.fee, c.serviceType, c.tech, c.status, overallResult(c.inspections)
  ]);
  const csv = [headers, ...rows].map(r => r.map(v => `"${(v||'').toString().replace(/"/g,'""')}"`).join(',')).join('\n');
  downloadFile(csv, 'satterlee-certifications.csv', 'text/csv');
  toast('CSV exported');
}

async function exportJSON() {
  const certs = await dbGetAll(STORES.certs);
  const agents = await dbGetAll(STORES.agents);
  const data = { version: 1, exported: new Date().toISOString(), certifications: certs, agents };
  downloadFile(JSON.stringify(data, null, 2), 'satterlee-backup.json', 'application/json');
  toast('JSON backup exported');
}

async function importJSON(file) {
  try {
    const text = await file.text();
    const data = JSON.parse(text);
    if (data.certifications) {
      for (const c of data.certifications) await dbPut(STORES.certs, c);
    }
    if (data.agents) {
      for (const a of data.agents) await dbPut(STORES.agents, a);
    }
    toast(`Imported ${(data.certifications||[]).length} certifications, ${(data.agents||[]).length} agents`);
    renderView();
  } catch (e) {
    toast('Invalid JSON file', 'error');
  }
}

async function importCSV(file) {
  try {
    const text = await file.text();
    parseAndImportCSV(text);
  } catch (e) {
    toast('Error reading CSV file', 'error');
  }
}

async function importClipboard() {
  const text = document.getElementById('clipboardPaste')?.value;
  if (!text || !text.trim()) { toast('Nothing to import', 'error'); return; }
  parseAndImportCSV(text);
}

async function parseAndImportCSV(text) {
  const lines = text.trim().split('\n').filter(l => l.trim());
  if (lines.length < 2) { toast('Need at least a header row and one data row', 'error'); return; }
  let imported = 0;
  for (let i = 1; i < lines.length; i++) {
    const cols = lines[i].split(/[,\t]/).map(c => c.replace(/^"|"$/g, '').trim());
    if (cols.length >= 1 && cols[0]) {
      const cert = {
        id: genId(),
        address: cols[0] || '',
        agentName: cols[1] || '',
        agentBrokerage: cols[2] || '',
        fee: cols[3] || '',
        propertyType: cols[4] || 'Historic (Pre-1950)',
        yearBuilt: cols[5] || '',
        notes: '', agentPhone: '', agentEmail: '',
        serviceType: 'Standard', tech: '',
        date: new Date().toISOString(),
        inspections: [],
        status: 'Pending',
        isDemo: false
      };
      await dbPut(STORES.certs, cert);
      if (cert.agentName) await saveAgentFromCert(cert);
      imported++;
    }
  }
  toast(`Imported ${imported} certification${imported !== 1 ? 's' : ''}`);
  renderView();
}

async function clearAllData() {
  if (!confirm('Are you sure? This will permanently delete ALL certifications and agent data.')) return;
  if (!confirm('FINAL WARNING: This cannot be undone. Proceed?')) return;
  await dbClear(STORES.certs);
  await dbClear(STORES.agents);
  toast('All data cleared');
  renderView();
}

function downloadFile(content, filename, type) {
  const blob = new Blob([content], { type });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// â”€â”€ Modal â”€â”€
function openModal(html) {
  document.getElementById('modalContent').innerHTML = html;
  document.getElementById('modalOverlay').classList.add('active');
}
function closeModal() { document.getElementById('modalOverlay').classList.remove('active'); }
function closeModalOutside(e) { if (e.target === document.getElementById('modalOverlay')) closeModal(); }

// â”€â”€ Demo Data â”€â”€
async function loadDemoData() {
  const settings = await dbGet(STORES.settings, 'demoLoaded');
  if (settings?.value) return;

  const demoAgents = [
    { id: 'demo-a1', name: 'Jennifer Maxwell', brokerage: 'Keller Williams Joplin', phone: '(417) 555-0142', email: 'jmaxwell@kwjoplin.com', certCount: 3, isDemo: true },
    { id: 'demo-a2', name: 'Dustin Roper', brokerage: 'Re/Max Heritage', phone: '(417) 555-0278', email: 'dustin@remaxheritage.com', certCount: 1, isDemo: true },
    { id: 'demo-a3', name: 'Lisa Thornberry', brokerage: 'Century 21 Joplin', phone: '(417) 555-0399', email: 'lisa.t@c21joplin.com', certCount: 1, isDemo: true }
  ];

  const demoCerts = [
    {
      id: 'demo-c1', address: '1523 S Sergeant Ave, Joplin, MO 64801',
      propertyType: 'Historic (Pre-1950)', yearBuilt: '1928',
      notes: 'Original Craftsman bungalow, cast iron stacks throughout, original steam boiler converted to forced air in 1985.',
      agentName: 'Jennifer Maxwell', agentBrokerage: 'Keller Williams Joplin',
      agentPhone: '(417) 555-0142', agentEmail: 'jmaxwell@kwjoplin.com',
      fee: '250', serviceType: 'Standard', tech: 'Mike Henderson',
      date: '2026-01-15T14:00:00.000Z', finalizedDate: '2026-01-17T10:30:00.000Z',
      status: 'Certified', isDemo: true,
      inspections: [
        { ...INSPECTION_ITEMS[0], rating: 'concern', notes: 'Moderate corrosion at 3rd-floor stack joint. Functional but will need replacement within 3-5 years. No active leaks.', photos: [] },
        { ...INSPECTION_ITEMS[1], rating: 'pass', notes: 'Original clay tile sewer to main. Camera shows good condition, no root intrusion. Line was jetted in 2022.', photos: [] },
        { ...INSPECTION_ITEMS[2], rating: 'pass', notes: 'Bradford White 50-gal, manufactured 2019. Anode rod good, T&P valve functional. ~7 years remaining life.', photos: [] },
        { ...INSPECTION_ITEMS[3], rating: 'pass', notes: 'Flue liner replaced with stainless steel in 2003 during furnace upgrade. Good condition.', photos: [] },
        { ...INSPECTION_ITEMS[4], rating: 'na', notes: 'Original steam boiler removed in 1985. Converted to forced-air gas furnace.', photos: [] },
        { ...INSPECTION_ITEMS[5], rating: 'na', notes: 'No radiant heat system present. Standard forced-air ducted system.', photos: [] },
        { ...INSPECTION_ITEMS[6], rating: 'pass', notes: '200A Square D breaker panel. Updated from original fuse box in 2010. Proper grounding.', photos: [] },
        { ...INSPECTION_ITEMS[7], rating: 'pass', notes: 'CSST flex lines to furnace and water heater. Properly bonded. No leaks detected at meter.', photos: [] },
        { ...INSPECTION_ITEMS[8], rating: 'concern', notes: 'Lennox 3-ton A/C unit, 2015 install. R-410A. Functional but condenser fan showing early wear. Furnace is 2003 Trane, nearing end of life.', photos: [] },
        { ...INSPECTION_ITEMS[9], rating: 'pass', notes: 'Watts 009 backflow on irrigation supply. Tested and certified current.', photos: [] }
      ]
    },
    {
      id: 'demo-c2', address: '402 W 4th St, Joplin, MO 64801',
      propertyType: 'Historic (Pre-1950)', yearBuilt: '1910',
      notes: 'Two-story Victorian with original plumbing throughout basement. Steam boiler still operational. Buyer concerned about systems.',
      agentName: 'Jennifer Maxwell', agentBrokerage: 'Keller Williams Joplin',
      agentPhone: '(417) 555-0142', agentEmail: 'jmaxwell@kwjoplin.com',
      fee: '400', serviceType: 'Rush', tech: 'Carlos Mendez',
      date: '2026-01-28T09:00:00.000Z', finalizedDate: '2026-01-29T16:00:00.000Z',
      status: 'Not Certified', isDemo: true,
      inspections: [
        { ...INSPECTION_ITEMS[0], rating: 'fail', notes: 'Severe corrosion and active seepage at basement horizontal run. Bell-and-spigot joints failing. Recommend full replacement.', photos: [] },
        { ...INSPECTION_ITEMS[1], rating: 'fail', notes: 'Original clay tile sewer, camera reveals multiple offset joints and root intrusion at property line. Recommend excavation and PVC replacement.', photos: [] },
        { ...INSPECTION_ITEMS[2], rating: 'concern', notes: 'AO Smith 40-gal, manufactured 2012. 14 years old, past expected life. Anode rod depleted. Replace within 6 months.', photos: [] },
        { ...INSPECTION_ITEMS[3], rating: 'concern', notes: 'Original terra cotta flue liner. Cracking visible at crown. Recommend stainless liner before next heating season.', photos: [] },
        { ...INSPECTION_ITEMS[4], rating: 'concern', notes: 'Weil-McLain steam boiler, circa 1995. Operational but showing age. Sight glass cloudy, safety valve last tested 2020. Service immediately.', photos: [] },
        { ...INSPECTION_ITEMS[5], rating: 'pass', notes: 'Original cast iron radiators in excellent condition. All zones heating. Some air lock in 2nd floor bathroom radiator, bled on site.', photos: [] },
        { ...INSPECTION_ITEMS[6], rating: 'fail', notes: 'Federal Pacific Stab-Lok panel, 100A. Known fire hazard. Recommend complete panel replacement to modern 200A.', photos: [] },
        { ...INSPECTION_ITEMS[7], rating: 'pass', notes: 'Black iron gas lines. Leak test negative. Shutoff valves at each appliance.', photos: [] },
        { ...INSPECTION_ITEMS[8], rating: 'na', notes: 'No central air conditioning. Window units in use. Steam heat only.', photos: [] },
        { ...INSPECTION_ITEMS[9], rating: 'na', notes: 'No irrigation or fire suppression system present.', photos: [] }
      ]
    },
    {
      id: 'demo-c3', address: '3312 S Kentucky Ave, Joplin, MO 64804',
      propertyType: 'Post-Tornado Rebuild (2011-2015)', yearBuilt: '2012',
      notes: 'Post-tornado rebuild, all systems installed 2012. Entering replacement window for water heater and HVAC.',
      agentName: 'Dustin Roper', agentBrokerage: 'Re/Max Heritage',
      agentPhone: '(417) 555-0278', agentEmail: 'dustin@remaxheritage.com',
      fee: '250', serviceType: 'Standard', tech: 'Travis Owens',
      date: '2026-02-01T11:00:00.000Z', finalizedDate: '2026-02-03T14:00:00.000Z',
      status: 'Certified', isDemo: true,
      inspections: [
        { ...INSPECTION_ITEMS[0], rating: 'na', notes: 'PVC DWV system throughout. No cast iron present. 2012 construction.', photos: [] },
        { ...INSPECTION_ITEMS[1], rating: 'pass', notes: 'Schedule 40 PVC sewer line, 2012 install. Camera shows clean, no issues. 60-year expected life.', photos: [] },
        { ...INSPECTION_ITEMS[2], rating: 'concern', notes: 'Rheem 50-gal electric, manufactured 2012. 14 years old. Functional but at end of expected life. Budget for replacement.', photos: [] },
        { ...INSPECTION_ITEMS[3], rating: 'na', notes: 'Direct-vent furnace, no traditional flue/chimney. PVC intake and exhaust. Good condition.', photos: [] },
        { ...INSPECTION_ITEMS[4], rating: 'na', notes: 'No boiler. Forced-air gas furnace system.', photos: [] },
        { ...INSPECTION_ITEMS[5], rating: 'na', notes: 'No radiant heat. Standard forced-air ducted system.', photos: [] },
        { ...INSPECTION_ITEMS[6], rating: 'pass', notes: '200A Square D QO panel. Meets current code. AFCI breakers on bedroom circuits. Properly grounded.', photos: [] },
        { ...INSPECTION_ITEMS[7], rating: 'pass', notes: 'CSST gas lines with proper bonding. No leaks. Shutoff valves present.', photos: [] },
        { ...INSPECTION_ITEMS[8], rating: 'pass', notes: 'Carrier 3-ton split system, 2012 install. R-410A. 14 SEER. Running well but entering replacement window. Recommend budgeting.', photos: [] },
        { ...INSPECTION_ITEMS[9], rating: 'pass', notes: 'Febco 765 backflow on irrigation. Annual test current.', photos: [] }
      ]
    },
    {
      id: 'demo-c4', address: '819 N Wall Ave, Joplin, MO 64801',
      propertyType: 'Historic (Pre-1950)', yearBuilt: '1935',
      notes: 'Pre-listing certification requested by agent. Property has been rental for 20 years, maintenance history unknown.',
      agentName: 'Lisa Thornberry', agentBrokerage: 'Century 21 Joplin',
      agentPhone: '(417) 555-0399', agentEmail: 'lisa.t@c21joplin.com',
      fee: '250', serviceType: 'Standard', tech: 'Mike Henderson',
      date: '2026-02-05T08:00:00.000Z',
      status: 'In Progress', isDemo: true,
      inspections: [
        { ...INSPECTION_ITEMS[0], rating: 'concern', notes: 'Cast iron stack has surface corrosion but no active leaks. Monitor annually.', photos: [] },
        { ...INSPECTION_ITEMS[1], rating: '', notes: '', photos: [] },
        { ...INSPECTION_ITEMS[2], rating: 'pass', notes: 'Newer AO Smith 40-gal, 2021. Good condition.', photos: [] },
        { ...INSPECTION_ITEMS[3], rating: '', notes: '', photos: [] },
        { ...INSPECTION_ITEMS[4], rating: '', notes: '', photos: [] },
        { ...INSPECTION_ITEMS[5], rating: '', notes: '', photos: [] },
        { ...INSPECTION_ITEMS[6], rating: '', notes: '', photos: [] },
        { ...INSPECTION_ITEMS[7], rating: '', notes: '', photos: [] },
        { ...INSPECTION_ITEMS[8], rating: '', notes: '', photos: [] },
        { ...INSPECTION_ITEMS[9], rating: '', notes: '', photos: [] }
      ]
    },
    {
      id: 'demo-c5', address: '2710 E 15th St, Joplin, MO 64801',
      propertyType: 'Post-Tornado Rebuild (2011-2015)', yearBuilt: '2013',
      notes: 'Rush certification â€” closing in 48 hours. All 2013 systems, buyer wants confirmation before final walkthrough.',
      agentName: 'Jennifer Maxwell', agentBrokerage: 'Keller Williams Joplin',
      agentPhone: '(417) 555-0142', agentEmail: 'jmaxwell@kwjoplin.com',
      fee: '400', serviceType: 'Rush', tech: 'Carlos Mendez',
      date: '2026-02-06T07:30:00.000Z', finalizedDate: '2026-02-06T15:00:00.000Z',
      status: 'Certified', isDemo: true,
      inspections: [
        { ...INSPECTION_ITEMS[0], rating: 'na', notes: 'All PVC DWV. No cast iron. 2013 construction.', photos: [] },
        { ...INSPECTION_ITEMS[1], rating: 'pass', notes: 'PVC sewer, 2013 install. Clean on camera.', photos: [] },
        { ...INSPECTION_ITEMS[2], rating: 'pass', notes: 'Rheem hybrid heat pump water heater, 2020 upgrade. Excellent condition.', photos: [] },
        { ...INSPECTION_ITEMS[3], rating: 'na', notes: 'High-efficiency furnace with PVC flue. No traditional chimney.', photos: [] },
        { ...INSPECTION_ITEMS[4], rating: 'na', notes: 'No boiler. Forced air system.', photos: [] },
        { ...INSPECTION_ITEMS[5], rating: 'na', notes: 'No radiant heat present.', photos: [] },
        { ...INSPECTION_ITEMS[6], rating: 'pass', notes: '200A Eaton panel. AFCI/GFCI where required. Clean install.', photos: [] },
        { ...INSPECTION_ITEMS[7], rating: 'pass', notes: 'CSST bonded, no leaks. All appliance shutoffs present.', photos: [] },
        { ...INSPECTION_ITEMS[8], rating: 'pass', notes: 'Trane XR15, 2013 install. R-410A. Running strong. Recommend annual service.', photos: [] },
        { ...INSPECTION_ITEMS[9], rating: 'na', notes: 'No irrigation system.', photos: [] }
      ]
    }
  ];

  for (const a of demoAgents) await dbPut(STORES.agents, a);
  for (const c of demoCerts) await dbPut(STORES.certs, c);
  await dbPut(STORES.settings, { key: 'demoLoaded', value: true });
}

async function dismissDemo() {
  // Remove demo data
  const certs = await dbGetAll(STORES.certs);
  const agents = await dbGetAll(STORES.agents);
  for (const c of certs) { if (c.isDemo) await dbDelete(STORES.certs, c.id); }
  for (const a of agents) { if (a.isDemo) await dbDelete(STORES.agents, a.id); }
  await dbPut(STORES.settings, { key: 'demoLoaded', value: 'dismissed' });
  document.getElementById('demoBanner').classList.add('hidden');
  toast('Demo data cleared');
  renderView();
}

// â”€â”€ Init â”€â”€
async function init() {
  try {
    await openDB();
    const settings = await dbGet(STORES.settings, 'demoLoaded');
    if (!settings) {
      await loadDemoData();
    } else if (settings.value === 'dismissed') {
      document.getElementById('demoBanner').classList.add('hidden');
    }
    navigate('dashboard');
  } catch (e) {
    console.error('Init error:', e);
    document.getElementById('mainContent').innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">âš ï¸</div>
        <h2>Storage Error</h2>
        <p>Unable to initialize IndexedDB. Your browser may be in private mode or have storage disabled.</p>
      </div>
    `;
  }
}

init();
</script>

<!-- DEMO DISCLAIMER - Legal Notice -->

<!-- BennyCuTools Purchase CTA â€” injected by inject-cta.py -->
<style>
#bct-cta-bar {
  position: fixed;
  bottom: 48px;
  left: 0;
  right: 0;
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  border-top: 2px solid #6366f1;
  padding: 10px 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  z-index: 99998;
  flex-wrap: wrap;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
}
#bct-cta-bar .bct-cta-text {
  color: #e4e4e7;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 14px;
  font-weight: 500;
}
#bct-cta-bar .bct-cta-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 20px;
  background: #6366f1;
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 14px;
  font-weight: 600;
  border: none;
  border-radius: 6px;
  text-decoration: none;
  cursor: pointer;
  transition: background 0.2s, transform 0.1s;
}
#bct-cta-bar .bct-cta-btn:hover {
  background: #4f46e5;
  transform: translateY(-1px);
}
#bct-cta-bar .bct-cta-btn-secondary {
  background: transparent;
  border: 1px solid #6366f1;
  color: #a5b4fc;
}
#bct-cta-bar .bct-cta-btn-secondary:hover {
  background: rgba(99,102,241,0.15);
}
@media (max-width: 600px) {
  #bct-cta-bar {
    flex-direction: column;
    gap: 8px;
    padding: 8px 12px;
    bottom: 44px;
  }
  #bct-cta-bar .bct-cta-text { font-size: 12px; }
  #bct-cta-bar .bct-cta-btn { font-size: 13px; padding: 7px 16px; width: 100%; justify-content: center; }
}
</style>
<div id="bct-cta-bar" role="banner" aria-label="Purchase this tool">
  <span class="bct-cta-text">Like this tool? Make it yours.</span>
  <a class="bct-cta-btn" id="bct-buy-btn" href="https://bennycutools.com/buy.html">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
    Get It â€” $200 One-Time
  </a>
  <a class="bct-cta-btn bct-cta-btn-secondary" href="mailto:cuuper225@gmail.com?subject=Question%20about%20my%20custom%20tool">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
    Questions? Email Ben
  </a>
</div>
<script>
// Auto-fill the buy link with the current tool's page name
(function(){
  try {
    var pg = location.pathname.replace(/.*\//, '').replace('.html','');
    var buyBtn = document.getElementById('bct-buy-btn');
    if (buyBtn && pg) {
      buyBtn.href = 'https://bennycutools.com/buy.html?tool=' + encodeURIComponent(pg);
    }
  } catch(e){}
})();
</script>
<!-- End BennyCuTools Purchase CTA -->

<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer">
  <p><strong>DEMO NOTICE:</strong> This tool was created by BennyCuTools as a free demonstration only.
  It is not affiliated with, endorsed by, or authorized by Satterlee Plumbing.
  All brand references are used solely for demonstration purposes.</p>
  <a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20Satterlee%20Plumbing&body=I%20am%20the%20owner%20of%20Satterlee%20Plumbing%20and%20I%20request%20permanent%20deletion%20of%20the%20demo%20tool%20on%20bennycutools.com." class="bct-delete-btn" aria-label="Request permanent deletion of this demo">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
    Request Permanent Deletion
  </a>
</div>

</body>
</html>
