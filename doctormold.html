<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MoldDoc - Doctor Mold Pro</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
--bg:#f3f4f6;--card:#ffffff;--text:#18181b;--text-muted:#6b7280;
--teal:#0d9488;--teal-soft:rgba(13,148,136,.08);--red:#dc2626;--red-soft:rgba(220,38,38,.08);
--amber:#d97706;--amber-soft:rgba(217,119,6,.1);--slate:#334155;--slate-soft:rgba(51,65,85,.06);
--border:#e2e5ea;--radius:10px;
--shadow:0 1px 3px rgba(0,0,0,.05),0 2px 8px rgba(0,0,0,.03);
--shadow-lg:0 4px 16px rgba(0,0,0,.08);
--font-head:'Space Grotesk',system-ui,sans-serif;--font-body:'Inter',system-ui,sans-serif;
}
html{font-size:16px}body{font-family:var(--font-body);background:var(--bg);color:var(--text);line-height:1.5;min-height:100vh;padding-bottom:140px!important;-webkit-font-smoothing:antialiased}
h1,h2,h3{font-family:var(--font-head);font-weight:700;line-height:1.2}
*:focus-visible{outline:2px solid var(--teal);outline-offset:2px}
button,input,select,textarea{font-family:var(--font-body);font-size:1rem;border:none;outline:none;background:none}

.app-header{background:linear-gradient(135deg,var(--slate) 0%,#1e293b 100%);color:#fff;padding:14px 20px;position:sticky;top:0;z-index:100;box-shadow:0 2px 12px rgba(0,0,0,.2)}
.app-header h1{color:#fff;font-size:1.3rem}
.app-header .subtitle{color:var(--teal);font-size:.72rem;font-weight:600;letter-spacing:.06em;margin-top:1px}

.demo-banner{background:var(--teal-soft);border-bottom:1px solid var(--border);padding:10px 16px;display:flex;align-items:center;justify-content:space-between;gap:8px}
.demo-banner p{font-size:.8rem;color:var(--text-muted)}
.demo-banner button{background:var(--teal);color:#fff;font-size:.72rem;font-weight:600;padding:4px 12px;border-radius:6px;cursor:pointer;transition:transform .15s}
.demo-banner button:active{transform:scale(.96)}

.view{display:none;padding:16px;animation:fadeUp .3s ease-out}.view.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.skip-link{position:absolute;top:-40px;left:0;background:var(--teal);color:#fff;padding:8px 16px;z-index:9999;font-weight:600}.skip-link:focus{top:0}

.insp-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:12px;overflow:hidden;cursor:pointer;transition:transform .2s,box-shadow .2s}
.insp-card:hover{transform:translateY(-1px);box-shadow:var(--shadow-lg)}
.insp-card:active{transform:scale(.985)}
.insp-card-inner{padding:14px 16px;display:flex;gap:14px}
.insp-bar{width:4px;border-radius:2px;flex-shrink:0}
.insp-bar.teal{background:var(--teal)}.insp-bar.red{background:var(--red)}.insp-bar.amber{background:var(--amber)}.insp-bar.slate{background:var(--slate)}
.insp-info{flex:1}
.insp-info .ic-address{font-family:var(--font-head);font-weight:600;font-size:.95rem;margin-bottom:2px}
.insp-info .ic-meta{font-size:.82rem;color:var(--text-muted);margin-bottom:4px}
.insp-info .ic-rooms{font-size:.78rem;color:var(--text-muted)}
.badge{font-size:.68rem;font-weight:600;padding:3px 8px;border-radius:20px;letter-spacing:.03em;white-space:nowrap}
.badge--pending{background:var(--amber-soft);color:var(--amber)}
.badge--positive{background:var(--red-soft);color:var(--red)}
.badge--negative{background:var(--teal-soft);color:var(--teal)}
.badge--remediated{background:var(--slate-soft);color:var(--slate)}

.form-group{margin-bottom:14px}
.form-group label{display:block;font-size:.8rem;font-weight:600;color:var(--text-muted);margin-bottom:5px}
.form-group input,.form-group textarea,.form-group select{width:100%;padding:12px 14px;background:var(--card);border:1px solid var(--border);border-radius:8px;font-size:.95rem;transition:border-color .2s,box-shadow .2s}
.form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:var(--teal);box-shadow:0 0 0 3px var(--teal-soft)}
.form-group textarea{resize:vertical;min-height:60px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}

.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 20px;border-radius:8px;font-weight:600;font-size:.9rem;cursor:pointer;transition:transform .15s}
.btn:active{transform:scale(.97)}
.btn--primary{background:var(--teal);color:#fff;box-shadow:0 2px 8px rgba(13,148,136,.25)}
.btn--secondary{background:var(--card);color:var(--text);border:1px solid var(--border)}
.btn--danger{background:var(--red);color:#fff}
.btn--full{width:100%}
.btn--disabled{opacity:.45;cursor:not-allowed;position:relative}
.btn--disabled::after{content:'Full version';position:absolute;top:-8px;right:-8px;background:var(--text);color:#fff;font-size:.55rem;padding:2px 6px;border-radius:4px}

.room-card{background:var(--bg);border-radius:8px;padding:14px;margin-bottom:8px;border:1px solid var(--border);position:relative;animation:fadeUp .2s ease-out}
.room-card .rc-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.room-card .rc-name{font-family:var(--font-head);font-weight:600;font-size:.95rem}
.room-card .rc-actions{display:flex;gap:6px}
.room-card .rc-actions button{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background .15s}
.room-card .rc-remove{background:var(--red-soft);color:var(--red)}
.room-card .rc-remove:hover{background:rgba(220,38,38,.15)}
.room-card .rc-photos{display:flex;gap:4px;flex-wrap:wrap}
.room-card .rc-photos img{width:48px;height:48px;border-radius:4px;object-fit:cover;border:1px solid var(--border)}

.stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:20px}
.stat-card{background:var(--card);border-radius:8px;padding:14px;text-align:center;box-shadow:var(--shadow)}
.stat-card .stat-num{font-family:var(--font-head);font-size:1.5rem;color:var(--slate);line-height:1}
.stat-card .stat-label{font-size:.7rem;color:var(--text-muted);margin-top:4px;font-weight:500}

.bottom-nav{position:fixed;bottom:60px;left:0;right:0;background:var(--card);border-top:1px solid var(--border);display:flex;z-index:100;box-shadow:0 -2px 8px rgba(0,0,0,.06);padding:4px 0}
.bottom-nav button{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;padding:8px 4px;background:none;cursor:pointer;color:var(--text-muted);transition:color .15s;border:none}
.bottom-nav button.active{color:var(--teal)}
.bottom-nav button svg{width:22px;height:22px}
.bottom-nav button span{font-size:.66rem;font-weight:600;letter-spacing:.03em}

.fab{position:fixed;bottom:128px;right:20px;width:56px;height:56px;border-radius:50%;background:var(--teal);color:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 16px rgba(13,148,136,.35);cursor:pointer;z-index:99;transition:transform .2s cubic-bezier(.34,1.56,.64,1)}
.fab:hover{transform:scale(1.08)}.fab:active{transform:scale(.92)}

.toast-container{position:fixed;top:70px;left:50%;transform:translateX(-50%);z-index:200;pointer-events:none}
.toast{background:var(--text);color:#fff;padding:10px 20px;border-radius:8px;font-size:.85rem;font-weight:500;box-shadow:var(--shadow-lg);animation:toastIn .3s ease-out;pointer-events:auto}
@keyframes toastIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}

.back-btn{width:36px;height:36px;border-radius:50%;background:var(--bg);display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;border:1px solid var(--border)}
.detail-header{display:flex;align-items:center;gap:12px;margin-bottom:16px}

.camera-area{width:100%;max-width:400px;margin:0 auto 8px;border-radius:8px;overflow:hidden;background:#111}
.camera-area video{width:100%;display:block}.camera-area canvas{display:none}

@media(prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:.01ms!important;transition-duration:.01ms!important}}
@media print{.bottom-nav,.fab,.demo-banner,.app-header,#bct-demo-disclaimer{display:none!important}body{background:#fff;padding:0}.view{display:block!important}}
@media(min-width:768px){.view{max-width:600px;margin:0 auto;padding:24px}.bottom-nav{max-width:600px;left:50%;transform:translateX(-50%);border-radius:12px 12px 0 0}}
</style>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>
<header class="app-header" role="banner"><h1>MoldDoc</h1><div class="subtitle">Doctor Mold Pro</div></header>
<div class="demo-banner" id="demoBanner" style="display:none" role="status" aria-label="Demo data notice">
<p>Sample Tampa inspections loaded. Tap to clear and start fresh.</p>
<button onclick="clearDemoData()" aria-label="Clear demo data">Clear</button>
</div>
<div aria-live="polite" class="toast-container" id="toastContainer"></div>

<main id="main-content">
<section class="view active" id="viewInspections" role="region" aria-label="Inspections"><div id="inspList"></div></section>

<section class="view" id="viewNewInsp" role="region" aria-label="New inspection">
<div class="detail-header">
<button class="back-btn" onclick="showView('viewInspections')" aria-label="Go back"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button>
<h2 id="newInspTitle">New Inspection</h2>
</div>
<form id="inspForm" onsubmit="saveInspection(event)">
<div class="form-group"><label for="if-address">Property Address</label><input type="text" id="if-address" required placeholder="Full address"></div>
<div class="form-group"><label for="if-client">Client Name</label><input type="text" id="if-client" placeholder="Homeowner or agent"></div>
<div class="form-group"><label for="if-phone">Phone</label><input type="tel" id="if-phone"></div>
<div class="form-row">
<div class="form-group"><label for="if-date">Inspection Date</label><input type="date" id="if-date"></div>
<div class="form-group"><label for="if-sqft">Approx. Sq Ft</label><input type="number" id="if-sqft" min="0" placeholder="e.g., 1800"></div>
</div>
<div class="form-group"><label for="if-type">Property Type</label>
<select id="if-type"><option value="single-family">Single Family Home</option><option value="condo">Condo / Apartment</option><option value="townhouse">Townhouse</option><option value="commercial">Commercial</option><option value="multi-family">Multi-Family</option></select>
</div>
<div class="form-group"><label for="if-reason">Reason for Inspection</label>
<select id="if-reason"><option value="visible-mold">Visible Mold / Discoloration</option><option value="musty-smell">Musty Smell</option><option value="water-damage">Water Damage</option><option value="real-estate">Real Estate Transaction</option><option value="health-concern">Health Concern</option><option value="post-hurricane">Post-Hurricane / Storm</option><option value="routine">Routine Check</option></select>
</div>
<div class="form-group"><label for="if-notes">General Notes</label><textarea id="if-notes" placeholder="Overall observations, access notes, humidity levels..."></textarea></div>
<div class="form-group"><label for="if-status">Status</label>
<select id="if-status"><option value="pending">Pending Results</option><option value="positive">Mold Found</option><option value="negative">Clear - No Mold</option><option value="remediated">Remediation Complete</option></select>
</div>

<h3 style="margin:20px 0 12px">Rooms Inspected</h3>
<div id="roomsList"></div>
<button type="button" class="btn btn--secondary btn--full" onclick="addRoom()" style="margin-bottom:16px">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
Add Room
</button>

<input type="hidden" id="if-id">
<button type="submit" class="btn btn--primary btn--full" style="margin-top:8px">Save Inspection</button>
</form>
</section>

<section class="view" id="viewInspDetail" role="region" aria-label="Inspection detail">
<div class="detail-header">
<button class="back-btn" onclick="showView('viewInspections')" aria-label="Go back"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button>
<h2 id="inspDetailTitle">Inspection</h2>
</div>
<div id="inspDetailContent"></div>
</section>

<section class="view" id="viewOverview" role="region" aria-label="Overview">
<h2 style="margin-bottom:16px">Overview</h2>
<div class="stats-row" id="statsRow"></div>
<h3 style="margin-bottom:12px">Needs Follow-Up</h3>
<div id="followUpList"></div>
</section>

<section class="view" id="viewSettings" role="region" aria-label="Settings">
<h2 style="margin-bottom:16px">Settings</h2>
<div style="display:flex;flex-direction:column;gap:10px">
<button class="btn btn--secondary btn--full" onclick="exportData()">Export Data (JSON)</button>
<button class="btn btn--secondary btn--full" onclick="document.getElementById('importFile').click()">Import Data (JSON)</button>
<input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
<button class="btn btn--disabled btn--full" disabled aria-label="Branded inspection reports available in full version">Generate Branded Reports</button>
<button class="btn btn--disabled btn--full" disabled aria-label="Lab integration available in full version">Lab Results Integration</button>
</div>
</section>
</main>

<button class="fab" onclick="showNewInsp()" aria-label="New inspection"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>

<nav class="bottom-nav" role="navigation" aria-label="Main navigation">
<button onclick="showView('viewInspections')" id="navInsp" class="active" aria-label="Inspections"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg><span>Inspections</span></button>
<button onclick="showView('viewOverview')" id="navOver" aria-label="Overview"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg><span>Overview</span></button>
<button onclick="showView('viewSettings')" id="navSet" aria-label="Settings"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg><span>Settings</span></button>
</nav>

<div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer" style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:10px 16px;font-size:12px;line-height:1.4;color:#666;z-index:99999;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:8px 16px;text-align:center;">
<p style="margin:0;max-width:700px;"><strong style="color:#333;">DEMO NOTICE:</strong> This tool was created by BennyCuTools as a free demonstration only. It is not affiliated with, endorsed by, or authorized by Doctor Mold Pro. All brand references are used solely for demonstration purposes.</p>
<a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20Doctor%20Mold%20Pro&body=I%20am%20the%20owner%20and%20I%20request%20permanent%20deletion%20of%20this%20demo." style="display:inline-flex;align-items:center;gap:4px;background:#dc3545;color:#fff;padding:5px 12px;border-radius:4px;text-decoration:none;font-size:11px;font-weight:500;white-space:nowrap;"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>Request Permanent Deletion</a>
</div>

<script>
function _h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0;}return h;}
const _V=-240134981;
const _k=new URLSearchParams(window.location.search).get('key');
if(_k&&_h(_k)===_V){sessionStorage.setItem('md_auth','1')}
if(!sessionStorage.getItem('md_auth')){
document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;font-family:Space Grotesk,sans-serif;background:linear-gradient(135deg,#334155,#1e293b);color:#fff;text-align:center;padding:20px"><div><h1 style="font-size:1.8rem;margin-bottom:.5rem">MoldDoc</h1><p style="color:#aaa;margin-bottom:1.5rem;font-family:Inter,sans-serif">Access key required</p><input id="keyIn" type="text" placeholder="Enter key" style="padding:12px 16px;border-radius:8px;border:1px solid #555;background:rgba(255,255,255,.1);color:#fff;font-size:1rem;width:200px;text-align:center"><br><button onclick="var k=document.getElementById(\'keyIn\').value;if(_h(k)===_V){sessionStorage.setItem(\'md_auth\',\'1\');location.reload();}else{document.getElementById(\'keyErr\').style.display=\'block\'}" style="margin-top:12px;padding:10px 24px;background:#0d9488;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600">Enter</button><p id="keyErr" style="color:#e74c3c;margin-top:8px;display:none;font-size:.85rem;font-family:Inter">Invalid key</p></div></div><div id="bct-demo-disclaimer" role="contentinfo" style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:10px 16px;font-size:12px;color:#666;z-index:99999;text-align:center;"><p style="margin:0;"><strong style="color:#333;">DEMO NOTICE:</strong> Not affiliated with Doctor Mold Pro.</p></div>';
throw new Error('Auth required');
}
document.addEventListener('contextmenu',e=>e.preventDefault());

const DB_NAME='MoldDocDB';const DB_VER=1;let db;
function openDB(){return new Promise((r,j)=>{const q=indexedDB.open(DB_NAME,DB_VER);q.onupgradeneeded=e=>{e.target.result.createObjectStore('inspections',{keyPath:'id'})};q.onsuccess=e=>{db=e.target.result;r(db)};q.onerror=e=>j(e)})}
function dbPut(d){return new Promise((r,j)=>{const t=db.transaction('inspections','readwrite');t.objectStore('inspections').put(d);t.oncomplete=()=>r();t.onerror=e=>j(e)})}
function dbGetAll(){return new Promise((r,j)=>{const t=db.transaction('inspections','readonly');const q=t.objectStore('inspections').getAll();q.onsuccess=()=>r(q.result);q.onerror=e=>j(e)})}
function dbGet(id){return new Promise((r,j)=>{const t=db.transaction('inspections','readonly');const q=t.objectStore('inspections').get(id);q.onsuccess=()=>r(q.result);q.onerror=e=>j(e)})}
function dbDelete(id){return new Promise((r,j)=>{const t=db.transaction('inspections','readwrite');t.objectStore('inspections').delete(id);t.oncomplete=()=>r();t.onerror=e=>j(e)})}

let allInspections=[];let roomCounter=0;let activeRoomCamera=null;let cameraStream=null;

const DEMO=[
{id:'demo-1',address:'4217 W Swann Ave, Tampa, FL',client:'Henderson Family',phone:'813-555-0142',date:'2026-02-05',sqft:2200,type:'single-family',reason:'water-damage',status:'positive',notes:'Water intrusion from roof leak in northwest corner. Visible Stachybotrys (black mold) on drywall behind master closet. Elevated moisture readings throughout second floor. Recommended full remediation of affected areas.',rooms:[
{name:'Master Bedroom Closet',finding:'visible-growth',severity:'heavy',sample:'Yes - Air & Surface',photos:[],notes:'Black mold on drywall, spreading along baseboard. Moisture reading 68%. Drywall saturated.'},
{name:'Guest Bathroom',finding:'visible-growth',severity:'moderate',sample:'Yes - Surface',photos:[],notes:'Growth along ceiling near vent. Possible condensation issue compounding the roof leak.'},
{name:'Hallway (2nd Floor)',finding:'moisture-only',severity:'light',sample:'No',photos:[],notes:'Elevated moisture on walls but no visible growth yet. Monitor closely.'}
],created:Date.now()-86400000*7,isDemo:true},
{id:'demo-2',address:'1903 Bayshore Blvd, Tampa, FL',client:'Bayshore Properties LLC',phone:'813-555-0287',date:'2026-01-28',sqft:3800,type:'commercial',reason:'musty-smell',status:'pending',notes:'Tenant complaints about musty odor in south office suite. HVAC system is 15 years old. Building management wants full assessment before lease renewal.',rooms:[
{name:'South Office Suite',finding:'musty-odor',severity:'moderate',sample:'Yes - Air',photos:[],notes:'Strong musty smell. No visible growth on walls or ceiling. Air sample collected near return vent.'},
{name:'HVAC Plenum',finding:'visible-growth',severity:'moderate',sample:'Yes - Surface',photos:[],notes:'Growth inside ductwork visible at access panel. Recommend duct cleaning and possible coil replacement.'}
],created:Date.now()-86400000*15,isDemo:true},
{id:'demo-3',address:'8842 Citrus Park Dr, Tampa, FL',client:'Morales Residence',phone:'813-555-0456',date:'2025-12-10',sqft:1650,type:'single-family',reason:'real-estate',status:'negative',notes:'Pre-purchase inspection for buyer. No mold found anywhere. Home is in good condition with new HVAC installed 2024. Moisture readings normal throughout.',rooms:[
{name:'Kitchen',finding:'none',severity:'none',sample:'No',photos:[],notes:'Clean. No moisture issues.'},
{name:'Garage',finding:'none',severity:'none',sample:'No',photos:[],notes:'Dry. No staining or odor.'},
{name:'Master Bathroom',finding:'none',severity:'none',sample:'No',photos:[],notes:'Caulking intact. No signs of water damage.'}
],created:Date.now()-86400000*63,isDemo:true}
];

async function loadDemoData(){
if(localStorage.getItem('md_demoCleared')) return;
const all=await dbGetAll();if(all.length>0) return;
for(const d of DEMO) await dbPut(d);
localStorage.setItem('md_hasDemo','1');
}
async function clearDemoData(){
const all=await dbGetAll();for(const i of all){if(i.isDemo) await dbDelete(i.id)}
localStorage.removeItem('md_hasDemo');localStorage.setItem('md_demoCleared','1');
document.getElementById('demoBanner').style.display='none';
await refreshData();showToast('Demo data cleared');
}

function getStatusInfo(s){
const map={'pending':{label:'Pending Results',cls:'badge--pending',bar:'amber'},'positive':{label:'Mold Found',cls:'badge--positive',bar:'red'},'negative':{label:'Clear',cls:'badge--negative',bar:'teal'},'remediated':{label:'Remediated',cls:'badge--remediated',bar:'slate'}};
return map[s]||{label:s,cls:'',bar:'slate'};
}

function renderInspList(){
const list=document.getElementById('inspList');
const sorted=[...allInspections].sort((a,b)=>{
const order={positive:0,pending:1,remediated:2,negative:3};
return(order[a.status]??5)-(order[b.status]??5)||(b.created-a.created);
});
if(sorted.length===0){
list.innerHTML=`<div style="text-align:center;padding:48px 20px;color:var(--text-muted)"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="margin-bottom:12px;opacity:.4"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg><p style="font-size:.95rem;font-weight:600">No inspections yet</p><p style="font-size:.85rem">Tap + to start documenting a job.</p></div>`;return;
}
list.innerHTML=sorted.map(i=>{
const si=getStatusInfo(i.status);
const roomCount=(i.rooms||[]).length;
const date=i.date?new Date(i.date+'T12:00:00').toLocaleDateString('en-US',{month:'short',day:'numeric'}):'';
return`<article class="insp-card" onclick="showInspDetail('${i.id}')" role="button" tabindex="0" aria-label="${i.address} - ${si.label}">
<div class="insp-card-inner"><div class="insp-bar ${si.bar}"></div><div class="insp-info">
<div class="ic-address">${i.address.split(',')[0]}</div>
<div class="ic-meta">${i.client||''} | ${date} | ${i.reason?i.reason.replace(/-/g,' '):''}</div>
<div style="display:flex;gap:8px;align-items:center;margin-top:6px"><span class="badge ${si.cls}">${si.label}</span><span class="ic-rooms">${roomCount} room${roomCount!==1?'s':''}</span></div>
</div></div></article>`;}).join('');
}

function addRoom(name='',finding='',severity='',sample='',notes=''){
roomCounter++;const div=document.createElement('div');div.className='room-card';div.dataset.roomIdx=roomCounter;
div.innerHTML=`<div class="rc-header"><input type="text" class="rc-name" placeholder="Room name (e.g., Master Bathroom)" value="${name}" style="font-family:var(--font-head);font-weight:600;font-size:.95rem;border:none;background:none;flex:1;padding:0" aria-label="Room name">
<div class="rc-actions"><button type="button" class="rc-remove" onclick="this.closest('.room-card').remove()" aria-label="Remove room"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div></div>
<div class="form-row" style="margin-bottom:8px">
<select class="rc-finding" aria-label="Finding" style="padding:8px;border:1px solid var(--border);border-radius:6px;font-size:.85rem;background:var(--card)">
<option value="none" ${finding==='none'?'selected':''}>No Issues</option>
<option value="visible-growth" ${finding==='visible-growth'?'selected':''}>Visible Growth</option>
<option value="moisture-only" ${finding==='moisture-only'?'selected':''}>Moisture Only</option>
<option value="musty-odor" ${finding==='musty-odor'?'selected':''}>Musty Odor</option>
<option value="staining" ${finding==='staining'?'selected':''}>Staining</option>
</select>
<select class="rc-severity" aria-label="Severity" style="padding:8px;border:1px solid var(--border);border-radius:6px;font-size:.85rem;background:var(--card)">
<option value="none" ${severity==='none'?'selected':''}>None</option>
<option value="light" ${severity==='light'?'selected':''}>Light</option>
<option value="moderate" ${severity==='moderate'?'selected':''}>Moderate</option>
<option value="heavy" ${severity==='heavy'?'selected':''}>Heavy</option>
</select>
</div>
<div class="form-row" style="margin-bottom:8px">
<select class="rc-sample" aria-label="Sample taken" style="padding:8px;border:1px solid var(--border);border-radius:6px;font-size:.85rem;background:var(--card)">
<option value="No" ${sample!=='Yes - Air'&&sample!=='Yes - Surface'&&sample!=='Yes - Air & Surface'?'selected':''}>No Sample</option>
<option value="Yes - Air" ${sample==='Yes - Air'?'selected':''}>Air Sample</option>
<option value="Yes - Surface" ${sample==='Yes - Surface'?'selected':''}>Surface Sample</option>
<option value="Yes - Air & Surface" ${sample==='Yes - Air & Surface'?'selected':''}>Air + Surface</option>
</select>
<div></div>
</div>
<textarea class="rc-notes" placeholder="Room notes..." style="width:100%;padding:8px;border:1px solid var(--border);border-radius:6px;font-size:.85rem;min-height:40px;resize:vertical;margin-bottom:8px" aria-label="Room notes">${notes}</textarea>
<div class="rc-photos" data-room="${roomCounter}"></div>
<button type="button" class="btn btn--secondary" style="font-size:.78rem;padding:6px 12px;margin-top:4px" onclick="openRoomCamera(${roomCounter})" aria-label="Take photo for this room">
<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
Photo
</button>
<div class="camera-area" id="camArea-${roomCounter}" style="display:none"><video autoplay playsinline></video><canvas></canvas></div>
<div id="camBtns-${roomCounter}" style="display:none;text-align:center;margin-top:4px">
<button type="button" class="btn btn--primary" style="font-size:.78rem;padding:6px 12px" onclick="captureRoomPhoto(${roomCounter})">Snap</button>
<button type="button" class="btn btn--secondary" style="font-size:.78rem;padding:6px 12px" onclick="closeRoomCamera(${roomCounter})">Done</button>
</div>`;
document.getElementById('roomsList').appendChild(div);
}

let roomPhotos={};
async function openRoomCamera(idx){
if(cameraStream){cameraStream.getTracks().forEach(t=>t.stop());cameraStream=null}
try{
cameraStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
const area=document.getElementById('camArea-'+idx);
area.style.display='block';
area.querySelector('video').srcObject=cameraStream;
document.getElementById('camBtns-'+idx).style.display='block';
activeRoomCamera=idx;
}catch(e){showToast('Camera not available')}
}
function closeRoomCamera(idx){
if(cameraStream){cameraStream.getTracks().forEach(t=>t.stop());cameraStream=null}
const area=document.getElementById('camArea-'+idx);
if(area){area.style.display='none'}
const btns=document.getElementById('camBtns-'+idx);
if(btns){btns.style.display='none'}
activeRoomCamera=null;
}
function captureRoomPhoto(idx){
const area=document.getElementById('camArea-'+idx);
const v=area.querySelector('video');const c=area.querySelector('canvas');
c.width=v.videoWidth;c.height=v.videoHeight;c.getContext('2d').drawImage(v,0,0);
const data=c.toDataURL('image/jpeg',0.7);
if(!roomPhotos[idx]) roomPhotos[idx]=[];
roomPhotos[idx].push(data);
renderRoomPhotos(idx);
showToast('Photo captured');
}
function renderRoomPhotos(idx){
const container=document.querySelector(`.rc-photos[data-room="${idx}"]`);
if(!container||!roomPhotos[idx]) return;
container.innerHTML=roomPhotos[idx].map((p,i)=>`<img src="${p}" alt="Room photo ${i+1}">`).join('');
}

function showNewInsp(){
document.getElementById('inspForm').reset();document.getElementById('if-id').value='';
document.getElementById('roomsList').innerHTML='';roomCounter=0;roomPhotos={};
document.getElementById('newInspTitle').textContent='New Inspection';
addRoom();showView('viewNewInsp');
}

async function editInsp(id){
const insp=await dbGet(id);if(!insp) return;
document.getElementById('if-id').value=insp.id;
document.getElementById('if-address').value=insp.address||'';
document.getElementById('if-client').value=insp.client||'';
document.getElementById('if-phone').value=insp.phone||'';
document.getElementById('if-date').value=insp.date||'';
document.getElementById('if-sqft').value=insp.sqft||'';
document.getElementById('if-type').value=insp.type||'single-family';
document.getElementById('if-reason').value=insp.reason||'visible-mold';
document.getElementById('if-notes').value=insp.notes||'';
document.getElementById('if-status').value=insp.status||'pending';
document.getElementById('roomsList').innerHTML='';roomCounter=0;roomPhotos={};
(insp.rooms||[]).forEach((rm,i)=>{
addRoom(rm.name,rm.finding,rm.severity,rm.sample,rm.notes);
roomPhotos[i+1]=rm.photos||[];renderRoomPhotos(i+1);
});
document.getElementById('newInspTitle').textContent='Edit Inspection';
showView('viewNewInsp');
}

async function saveInspection(e){
e.preventDefault();
if(cameraStream){cameraStream.getTracks().forEach(t=>t.stop());cameraStream=null}
const rooms=[];
document.querySelectorAll('.room-card').forEach(card=>{
const idx=parseInt(card.dataset.roomIdx);
rooms.push({
name:card.querySelector('.rc-name').value||'Unnamed Room',
finding:card.querySelector('.rc-finding').value,
severity:card.querySelector('.rc-severity').value,
sample:card.querySelector('.rc-sample').value,
notes:card.querySelector('.rc-notes').value,
photos:(roomPhotos[idx]||[]).slice(0,4)
});
});
const id=document.getElementById('if-id').value||'insp-'+Date.now();
const insp={id,address:document.getElementById('if-address').value,client:document.getElementById('if-client').value,
phone:document.getElementById('if-phone').value,date:document.getElementById('if-date').value,
sqft:parseInt(document.getElementById('if-sqft').value)||null,type:document.getElementById('if-type').value,
reason:document.getElementById('if-reason').value,notes:document.getElementById('if-notes').value,
status:document.getElementById('if-status').value,rooms,created:Date.now()};
await dbPut(insp);await refreshData();showToast('Inspection saved');showView('viewInspections');
}

async function showInspDetail(id){
const insp=await dbGet(id);if(!insp) return;
const si=getStatusInfo(insp.status);
document.getElementById('inspDetailTitle').textContent=insp.address.split(',')[0];
const date=insp.date?new Date(insp.date+'T12:00:00').toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'}):'';
let html=`<div style="background:var(--card);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);margin-bottom:16px">
<div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px">
<div><h3 style="margin-bottom:2px">${insp.address}</h3>
<p style="font-size:.85rem;color:var(--text-muted)">${insp.client||''} ${insp.phone?'| '+insp.phone:''}</p></div>
<span class="badge ${si.cls}">${si.label}</span></div>
<div style="display:flex;gap:16px;flex-wrap:wrap;font-size:.85rem;margin-bottom:8px">
${date?`<span>${date}</span>`:''} ${insp.sqft?`<span>${insp.sqft.toLocaleString()} sq ft</span>`:''}
${insp.type?`<span>${insp.type.replace(/-/g,' ')}</span>`:''}
${insp.reason?`<span>Reason: ${insp.reason.replace(/-/g,' ')}</span>`:''}</div>
${insp.notes?`<p style="font-size:.85rem;color:var(--text-muted);margin-top:8px;padding-top:8px;border-top:1px solid var(--border)">${insp.notes}</p>`:''}
<div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px">
<button class="btn btn--primary" onclick="shareInsp('${id}')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg> Share</button>
<button class="btn btn--secondary" onclick="editInsp('${id}')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg> Edit</button>
</div></div>`;

(insp.rooms||[]).forEach(rm=>{
const findColor={['visible-growth']:'var(--red)',['moisture-only']:'var(--amber)',['musty-odor']:'var(--amber)',['staining']:'var(--amber)',['none']:'var(--teal)'}[rm.finding]||'var(--slate)';
html+=`<div class="room-card" style="border-left:3px solid ${findColor}">
<div class="rc-header"><span style="font-family:var(--font-head);font-weight:600">${rm.name}</span>
<span class="badge" style="background:${findColor}11;color:${findColor}">${(rm.finding||'none').replace(/-/g,' ')}</span></div>
${rm.severity&&rm.severity!=='none'?`<p style="font-size:.82rem;margin-bottom:4px"><strong>Severity:</strong> ${rm.severity}</p>`:''}
${rm.sample&&rm.sample!=='No'?`<p style="font-size:.82rem;margin-bottom:4px"><strong>Sample:</strong> ${rm.sample}</p>`:''}
${rm.notes?`<p style="font-size:.82rem;color:var(--text-muted)">${rm.notes}</p>`:''}
${rm.photos&&rm.photos.length?`<div class="rc-photos" style="margin-top:8px">${rm.photos.map((p,i)=>`<img src="${p}" alt="${rm.name} photo ${i+1}">`).join('')}</div>`:''}
</div>`;
});
document.getElementById('inspDetailContent').innerHTML=html;
showView('viewInspDetail');
}

async function shareInsp(id){
const insp=await dbGet(id);if(!insp) return;
let text=`Mold Inspection Summary\n${insp.address}\nClient: ${insp.client||'N/A'}\nDate: ${insp.date||'N/A'}\n\n`;
(insp.rooms||[]).forEach(rm=>{
text+=`${rm.name}: ${(rm.finding||'none').replace(/-/g,' ')}`;
if(rm.severity&&rm.severity!=='none') text+=` (${rm.severity})`;
text+='\n';if(rm.notes) text+=`  ${rm.notes}\n`;
});
text+=`\nStatus: ${getStatusInfo(insp.status).label}\nDoctor Mold Pro | Tampa, FL`;
if(navigator.share){try{await navigator.share({title:'Inspection - '+insp.address,text});showToast('Shared')}catch(e){if(e.name!=='AbortError') fallbackCopy(text)}}else{fallbackCopy(text)}
}
function fallbackCopy(t){navigator.clipboard.writeText(t).then(()=>showToast('Copied')).catch(()=>showToast('Could not share'))}

async function renderOverview(){
const total=allInspections.length;
const pos=allInspections.filter(i=>i.status==='positive').length;
const pend=allInspections.filter(i=>i.status==='pending').length;
document.getElementById('statsRow').innerHTML=`
<div class="stat-card"><div class="stat-num">${total}</div><div class="stat-label">Total</div></div>
<div class="stat-card"><div class="stat-num" style="color:var(--red)">${pos}</div><div class="stat-label">Mold Found</div></div>
<div class="stat-card"><div class="stat-num" style="color:var(--amber)">${pend}</div><div class="stat-label">Pending</div></div>`;
const follow=allInspections.filter(i=>['positive','pending'].includes(i.status));
const fl=document.getElementById('followUpList');
if(follow.length===0){fl.innerHTML='<p style="text-align:center;color:var(--text-muted);padding:20px">All inspections resolved.</p>'}
else{fl.innerHTML=follow.map(i=>{const si=getStatusInfo(i.status);return`<div class="insp-card" onclick="showInspDetail('${i.id}')" role="button" tabindex="0"><div class="insp-card-inner"><div class="insp-bar ${si.bar}"></div><div class="insp-info"><div class="ic-address">${i.address.split(',')[0]}</div><span class="badge ${si.cls}" style="margin-top:4px">${si.label}</span></div></div></div>`}).join('')}
}

async function refreshData(){allInspections=await dbGetAll();renderInspList();if(localStorage.getItem('md_hasDemo')&&!localStorage.getItem('md_demoCleared')){document.getElementById('demoBanner').style.display='flex'}}

function showView(id){
document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
document.getElementById(id).classList.add('active');
document.querySelectorAll('.bottom-nav button').forEach(b=>b.classList.remove('active'));
const fab=document.querySelector('.fab');
if(id==='viewInspections'){document.getElementById('navInsp').classList.add('active');fab.style.display='flex'}
else if(id==='viewOverview'){document.getElementById('navOver').classList.add('active');fab.style.display='none';renderOverview()}
else if(id==='viewSettings'){document.getElementById('navSet').classList.add('active');fab.style.display='none'}
else{fab.style.display='none'}
window.scrollTo(0,0);
}

async function exportData(){const d={inspections:allInspections,exported:new Date().toISOString()};const b=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download='molddoc-'+new Date().toISOString().split('T')[0]+'.json';a.click();URL.revokeObjectURL(u);showToast('Exported')}
async function importData(e){const f=e.target.files[0];if(!f) return;try{const d=JSON.parse(await f.text());if(d.inspections){for(const i of d.inspections) await dbPut(i)}await refreshData();showToast('Imported')}catch(err){showToast('Invalid file')}e.target.value=''}

function showToast(msg){const c=document.getElementById('toastContainer');const t=document.createElement('div');t.className='toast';t.textContent=msg;c.appendChild(t);setTimeout(()=>t.remove(),2500)}

(async()=>{await openDB();await loadDemoData();await refreshData()})();
</script>
</body>
</html>
