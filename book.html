<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Book a Demo — BennyCu Tools</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  :root{
    --bg:#0a0a0f;--surface:#12121a;--border:#1e1e2e;--text:#e4e4e7;
    --muted:#71717a;--accent:#6366f1;--accent-glow:rgba(99,102,241,.15);
    --green:#22c55e;--radius:12px;
  }
  body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1.5rem}
  .container{max-width:520px;width:100%}
  .logo{text-align:center;margin-bottom:2rem}
  .logo h1{font-size:1.5rem;font-weight:700;background:linear-gradient(135deg,#6366f1,#a78bfa);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  .logo p{color:var(--muted);font-size:.875rem;margin-top:.25rem}
  .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:2rem;box-shadow:0 0 60px rgba(99,102,241,.05)}
  .card h2{font-size:1.25rem;font-weight:600;margin-bottom:.25rem}
  .card .sub{color:var(--muted);font-size:.875rem;margin-bottom:1.5rem;line-height:1.5}
  .field{margin-bottom:1.25rem}
  .field label{display:block;font-size:.8rem;font-weight:500;color:var(--muted);margin-bottom:.4rem;text-transform:uppercase;letter-spacing:.05em}
  .field input,.field select,.field textarea{width:100%;padding:.7rem .9rem;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:.9rem;font-family:inherit;transition:border-color .2s}
  .field input:focus,.field select:focus,.field textarea:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-glow)}
  .field textarea{resize:vertical;min-height:80px}
  .field select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2371717a' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .75rem center}
  .field select option{background:var(--surface);color:var(--text)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
  .btn{display:block;width:100%;padding:.8rem;background:var(--accent);color:#fff;border:none;border-radius:8px;font-size:.95rem;font-weight:600;font-family:inherit;cursor:pointer;transition:all .2s;margin-top:.5rem}
  .btn:hover{filter:brightness(1.1);transform:translateY(-1px);box-shadow:0 4px 20px rgba(99,102,241,.3)}
  .btn:active{transform:translateY(0)}
  .btn:disabled{opacity:0.6;cursor:not-allowed;transform:none}
  .trust{display:flex;align-items:center;justify-content:center;gap:.5rem;margin-top:1.25rem;color:var(--muted);font-size:.8rem}
  .trust svg{width:14px;height:14px;fill:var(--green)}
  .success{display:none;text-align:center;padding:2rem}
  .success .check{width:64px;height:64px;border-radius:50%;background:rgba(34,197,94,.1);display:flex;align-items:center;justify-content:center;margin:0 auto 1rem}
  .success .check svg{width:32px;height:32px;fill:var(--green)}
  .success h2{color:var(--green);margin-bottom:.5rem}
  .success p{color:var(--muted);font-size:.9rem;line-height:1.6}
  .footer{text-align:center;margin-top:2rem;color:var(--muted);font-size:.75rem}
  .footer a{color:var(--accent);text-decoration:none}
  .error{color:#ef4444;font-size:.8rem;margin-top:.25rem;display:none}
  .source-tag{display:inline-block;padding:.2rem .5rem;background:var(--accent-glow);color:var(--accent);font-size:.7rem;border-radius:4px;margin-left:.5rem}
  @media(max-width:500px){.row{grid-template-columns:1fr}.card{padding:1.5rem}}
</style>
</head>
<body>
<div class="container">
  <div class="logo">
    <h1>BennyCu Tools</h1>
    <p>Custom business software, built for you</p>
  </div>

  <div class="card" id="formCard">
    <h2>Book Your Free Demo <span id="sourceTag" class="source-tag" style="display:none"></span></h2>
    <p class="sub">I'll walk you through the tool I built specifically for your business. Pick a time that works — I'll confirm within a few hours.</p>

    <form id="bookingForm">
      <input type="hidden" id="sourceField" name="source">
      <input type="hidden" id="referrerField" name="referrer">

      <div class="row">
        <div class="field">
          <label>Your Name</label>
          <input type="text" name="name" required placeholder="John Smith" id="nameInput">
        </div>
        <div class="field">
          <label>Business Name</label>
          <input type="text" name="business" required placeholder="Smith's HVAC" id="businessInput">
        </div>
      </div>

      <div class="field">
        <label>Email</label>
        <input type="email" name="email" required placeholder="john@example.com" id="emailInput">
      </div>

      <div class="row">
        <div class="field">
          <label>Phone (optional)</label>
          <input type="tel" name="phone" placeholder="(555) 123-4567" id="phoneInput">
        </div>
        <div class="field">
          <label>Date</label>
          <input type="date" name="date" required id="dateInput">
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>Time</label>
          <select name="time" required id="timeInput">
            <option value="" disabled selected>Select a slot</option>
          </select>
        </div>
        <div class="field">
          <label>Notes (optional)</label>
          <input type="text" name="notes" placeholder="Any specific questions..." id="notesInput">
        </div>
      </div>

      <div class="error" id="formError"></div>
      <button type="submit" class="btn" id="submitBtn">Book My Demo</button>
    </form>

    <div class="trust">
      <svg viewBox="0 0 16 16"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.78 5.28-4.5 5.5a.75.75 0 0 1-1.06.06l-2.5-2a.75.75 0 1 1 .94-1.18l1.94 1.55L10.72 4.72a.75.75 0 0 1 1.06 1.06z"/></svg>
      Free 15-min call · No obligation · 100% custom demo
    </div>
  </div>

  <div class="card success" id="successCard">
    <div class="check">
      <svg viewBox="0 0 16 16"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.78 5.28-4.5 5.5a.75.75 0 0 1-1.06.06l-2.5-2a.75.75 0 1 1 .94-1.18l1.94 1.55L10.72 4.72a.75.75 0 0 1 1.06 1.06z"/></svg>
    </div>
    <h2>You're booked!</h2>
    <p>I'll confirm your exact demo time via email within a few hours. If you need to reach me before then, email <a href="mailto:ben@bennycutools.com" style="color:var(--accent)">ben@bennycutools.com</a>.</p>
    <p style="margin-top:1rem;font-size:.85rem">— Ben</p>
  </div>

  <div class="footer">
    <a href="https://bennycutools.com">Back to BennyCu Tools</a>
  </div>
</div>

<script>
const API_BASE = 'http://35.212.159.12/booking-api'; // Via Caddy proxy

// Get URL parameters
const urlParams = new URLSearchParams(location.search);
const source = urlParams.get('source') || 'direct';
const referrer = document.referrer || '';

// Show source tag
const sourceTag = document.getElementById('sourceTag');
if (source && source !== 'direct') {
    sourceTag.style.display = 'inline-block';
    sourceTag.textContent = source === 'email' ? 'From Email' : source === 'tool' ? 'From Tool' : source;
}

// Set hidden fields
document.getElementById('sourceField').value = source;
document.getElementById('referrerField').value = referrer;

// Date picker setup
const dateInput = document.getElementById('dateInput');
const today = new Date();
const maxDate = new Date();
maxDate.setDate(today.getDate() + 60);
dateInput.min = today.toISOString().split('T')[0];
dateInput.max = maxDate.toISOString().split('T')[0];

// Load time slots when date changes
dateInput.addEventListener('change', async function() {
    const date = this.value;
    const timeSelect = document.getElementById('timeInput');
    timeSelect.innerHTML = '<option value="" disabled selected>Loading...</option>';
    
    try {
        const res = await fetch(`${API_BASE}/api/slots?from=${date}&to=${date}`);
        const data = await res.json();
        
        const daySlots = data.slots[date];
        if (!daySlots || daySlots.blocked || daySlots.times.length === 0) {
            timeSelect.innerHTML = '<option value="" disabled selected>No slots available</option>';
            return;
        }
        
        timeSelect.innerHTML = '<option value="" disabled selected>Select a slot</option>';
        daySlots.times.forEach(slot => {
            if (slot.available) {
                const option = document.createElement('option');
                option.value = slot.start;
                option.textContent = `${slot.start} - ${slot.end}`;
                timeSelect.appendChild(option);
            }
        });
    } catch (err) {
        timeSelect.innerHTML = '<option value="" disabled selected>Error loading slots</option>';
    }
});

// Form submission
document.getElementById('bookingForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const btn = document.getElementById('submitBtn');
    const error = document.getElementById('formError');
    
    btn.disabled = true;
    btn.textContent = 'Booking...';
    error.style.display = 'none';
    
    const formData = {
        name: document.getElementById('nameInput').value,
        email: document.getElementById('emailInput').value,
        business: document.getElementById('businessInput').value,
        phone: document.getElementById('phoneInput').value || null,
        date: document.getElementById('dateInput').value,
        time: document.getElementById('timeInput').value,
        notes: document.getElementById('notesInput').value || null,
        source: document.getElementById('sourceField').value,
        referrer: document.getElementById('referrerField').value
    };
    
    try {
        const res = await fetch(`${API_BASE}/api/book`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(formData)
        });
        
        const data = await res.json();
        
        if (res.ok && data.success) {
            document.getElementById('formCard').style.display = 'none';
            document.getElementById('successCard').style.display = 'block';
        } else {
            error.textContent = data.error || 'Booking failed. Please try again.';
            error.style.display = 'block';
            btn.disabled = false;
            btn.textContent = 'Book My Demo';
        }
    } catch (err) {
        error.textContent = 'Network error. Please try again.';
        error.style.display = 'block';
        btn.disabled = false;
        btn.textContent = 'Book My Demo';
    }
});
</script>
</body>
</html>
