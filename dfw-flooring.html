<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>DFW Flooring Estimator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --primary: oklch(0.45 0.16 30);
      --primary-light: oklch(0.55 0.14 30);
      --primary-dark: oklch(0.35 0.18 30);
      --secondary: oklch(0.50 0.12 220);
      --background: oklch(0.985 0.005 80);
      --surface: oklch(1 0 0);
      --surface-alt: oklch(0.97 0.005 80);
      --text: oklch(0.20 0.02 30);
      --text-muted: oklch(0.45 0.02 30);
      --border: oklch(0.88 0.01 80);
      --success: oklch(0.55 0.15 145);
      --warning: oklch(0.65 0.18 80);
      --error: oklch(0.55 0.2 25);
      --shadow-sm: 0 1px 2px oklch(0.2 0.02 30 / 0.05);
      --shadow-md: 0 4px 12px oklch(0.2 0.02 30 / 0.08), 0 2px 4px oklch(0.2 0.02 30 / 0.04);
      --shadow-lg: 0 12px 40px oklch(0.2 0.02 30 / 0.12), 0 4px 12px oklch(0.2 0.02 30 / 0.06);
      --shadow-glow: 0 0 20px oklch(0.45 0.16 30 / 0.25);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --font-display: 'Outfit', system-ui, sans-serif;
      --font-body: 'DM Sans', system-ui, sans-serif;
    }
    
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    
    html { font-size: 16px; -webkit-tap-highlight-color: transparent; }
    
    body { padding-bottom: 80px;
      font-family: var(--font-body);
      background: var(--background);
      color: var(--text);
      line-height: 1.5;
      min-height: 100vh;
      min-height: 100dvh;
      padding-bottom: 140px !important;
      overflow-x: hidden;
    }
    
    /* Noise texture overlay */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      opacity: 0.025;
      pointer-events: none;
      z-index: 9999;
    }
    
    /* Focus visible styles */
    *:focus-visible {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
    
    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* Typography */
    h1, h2, h3 { font-family: var(--font-display); font-weight: 600; line-height: 1.2; }
    h1 { font-size: 1.75rem; }
    h2 { font-size: 1.375rem; }
    h3 { font-size: 1.125rem; }
    
    /* Animations */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    
    @keyframes drawStroke {
      to { stroke-dashoffset: 0; }
    }
    
    @keyframes confetti {
      0% { transform: translateY(0) rotate(0); opacity: 1; }
      100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    @keyframes countUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-in { animation: fadeUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; opacity: 0; }
    .animate-in-1 { animation-delay: 0.08s; }
    .animate-in-2 { animation-delay: 0.16s; }
    .animate-in-3 { animation-delay: 0.24s; }
    .animate-in-4 { animation-delay: 0.32s; }
    .animate-in-5 { animation-delay: 0.4s; }
    
    /* Ensure elements are visible after animation */
    .animate-in.animate-complete,
    .card.animate-in { opacity: 1; }
    
    /* Card 3D hover effect enhancement */
    .card-3d {
      transform-style: preserve-3d;
      perspective: 1000px;
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;
    }
    
    .card-3d:hover {
      transform: translateY(-6px) rotateX(-2deg) rotateY(2deg);
      box-shadow: 0 20px 40px oklch(0.2 0.02 30 / 0.15), 0 8px 16px oklch(0.2 0.02 30 / 0.1);
    }
    
    .card-3d:active {
      transform: translateY(-2px) scale(0.98);
    }
    
    /* Button ripple effect */
    .btn, .gate-btn, .tool-btn {
      position: relative;
      overflow: hidden;
    }
    
    .btn::after, .gate-btn::after, .tool-btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width 0.4s ease, height 0.4s ease;
    }
    
    .btn:active::after, .gate-btn:active::after, .tool-btn:active::after {
      width: 200%;
      height: 200%;
    }
    
    /* Floating animation for decorative elements */
    @keyframes floatEnhanced {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-6px) rotate(1deg); }
      50% { transform: translateY(-10px) rotate(0deg); }
      75% { transform: translateY(-6px) rotate(-1deg); }
    }
    
    .float-animation {
      animation: floatEnhanced 5s ease-in-out infinite;
    }
    
    /* Pulse glow for FAB */
    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 4px 12px oklch(0.45 0.16 30 / 0.3), 0 0 0 0 oklch(0.45 0.16 30 / 0.4); }
      50% { box-shadow: 0 4px 12px oklch(0.45 0.16 30 / 0.3), 0 0 20px 10px oklch(0.45 0.16 30 / 0); }
    }
    
    .fab {
      animation: pulseGlow 2s ease-in-out infinite;
    }
    
    /* Number count-up animation */
    @keyframes countUpPop {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .count-up {
      animation: countUpPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }
    
    /* Staggered slide-in for lists */
    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .slide-in-item {
      animation: slideInRight 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      opacity: 0;
    }
    
    /* Shimmer loading effect */
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    .shimmer {
      background: linear-gradient(90deg, var(--surface-alt) 25%, var(--surface) 50%, var(--surface-alt) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    
    /* Success checkmark animation */
    @keyframes checkmarkDraw {
      0% { stroke-dashoffset: 50; }
      100% { stroke-dashoffset: 0; }
    }
    
    .checkmark-animated path {
      stroke-dasharray: 50;
      stroke-dashoffset: 50;
      animation: checkmarkDraw 0.5s ease-out forwards;
    }
    
    /* Scale bounce for interactions */
    @keyframes scaleBounce {
      0% { transform: scale(0.8); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .scale-bounce {
      animation: scaleBounce 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    /* Gate Screen */
    #gate-screen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 50%, var(--primary-light) 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      z-index: 10000;
      overflow: hidden;
    }
    
    #gate-screen::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image: 
        linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridMove 20s linear infinite;
    }
    
    @keyframes gridMove {
      0% { transform: translate(0, 0); }
      100% { transform: translate(50px, 50px); }
    }
    
    #gate-screen.hidden { display: none; }
    
    .gate-card {
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: 40px 32px;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 24px 64px rgba(0,0,0,0.3), 0 8px 24px rgba(0,0,0,0.2);
      text-align: center;
      position: relative;
      z-index: 1;
      animation: fadeUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    .gate-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--primary-light), var(--primary));
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }
    
    .gate-logo {
      width: 90px;
      height: 90px;
      margin: 0 auto 24px;
      animation: floatEnhanced 4s ease-in-out infinite;
      filter: drop-shadow(0 8px 16px oklch(0.45 0.16 30 / 0.2));
    }
    
    .gate-logo svg {
      width: 100%;
      height: 100%;
    }
    
    .gate-title {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 8px;
    }
    
    .gate-subtitle {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-bottom: 24px;
    }
    
    .gate-input-wrap {
      position: relative;
      margin-bottom: 16px;
    }
    
    .gate-input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 1rem;
      font-family: var(--font-body);
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    .gate-input:focus {
      border-color: var(--primary);
      box-shadow: var(--shadow-glow);
    }
    
    .gate-btn {
      width: 100%;
      padding: 14px 24px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-size: 1rem;
      font-weight: 600;
      font-family: var(--font-display);
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s, background 0.2s;
    }
    
    .gate-btn:hover {
      background: var(--primary-light);
      box-shadow: var(--shadow-md);
    }
    
    .gate-btn:active {
      transform: scale(0.97);
    }
    
    .gate-error {
      color: var(--error);
      font-size: 0.85rem;
      margin-top: 12px;
      display: none;
    }
    
    .gate-error.show { display: block; }
    
    /* App Container */
    #app {
      display: none;
      min-height: 100vh;
      min-height: 100dvh;
    }
    
    #app.active { display: block; }
    
    /* Header */
    .app-header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 12px 16px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow-sm);
    }
    
    .header-content {
      display: flex;
      align-items: center;
      gap: 12px;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .header-logo {
      width: 40px;
      height: 40px;
      flex-shrink: 0;
    }
    
    .header-text h1 {
      font-size: 1.1rem;
      color: var(--primary);
    }
    
    .header-text span {
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    
    /* Demo Banner */
    .demo-banner {
      background: linear-gradient(90deg, var(--warning), oklch(0.70 0.16 60));
      color: var(--text);
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      font-size: 0.85rem;
    }
    
    .demo-banner.hidden { display: none; }
    
    .demo-banner-text { flex: 1; }
    
    .demo-banner-btn {
      background: rgba(0,0,0,0.15);
      border: none;
      color: var(--text);
      padding: 6px 12px;
      border-radius: var(--radius-sm);
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      transition: background 0.15s;
    }
    
    .demo-banner-btn:hover { background: rgba(0,0,0,0.25); }
    
    /* Main Content */
    .main-content {
      padding: 16px;
      max-width: 800px;
      margin: 0 auto;
    }
    
    /* Views */
    .view { display: none; }
    .view.active { display: block; }
    
    /* Cards */
    .card {
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-md);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .card:hover {
      box-shadow: var(--shadow-lg);
    }
    
    .card-3d {
      transform-style: preserve-3d;
      perspective: 1000px;
    }
    
    .card-3d:hover {
      transform: rotateX(-2deg) rotateY(2deg) translateY(-4px);
    }
    
    /* Room Preview Cards */
    .room-card {
      display: flex;
      gap: 16px;
      align-items: center;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
      padding: 8px;
      margin: -8px;
      border-radius: var(--radius-md);
    }
    
    .room-card:hover {
      background: var(--surface-alt);
      transform: translateX(4px);
    }
    
    .room-preview {
      width: 80px;
      height: 80px;
      border-radius: var(--radius-md);
      overflow: hidden;
      flex-shrink: 0;
      position: relative;
      background: var(--surface-alt);
      box-shadow: 0 4px 8px oklch(0.2 0.02 30 / 0.1);
      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }
    
    .room-card:hover .room-preview {
      transform: scale(1.05);
      box-shadow: 0 8px 16px oklch(0.2 0.02 30 / 0.15);
    }
    
    .room-preview canvas {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .room-info { flex: 1; }
    
    .room-name {
      font-weight: 600;
      font-family: var(--font-display);
      margin-bottom: 4px;
      transition: color 0.2s ease;
    }
    
    .room-card:hover .room-name {
      color: var(--primary);
    }
    
    .room-details {
      font-size: 0.85rem;
      color: var(--text-muted);
    }
    
    .room-sqft {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--primary);
      font-family: var(--font-display);
      transition: transform 0.2s ease;
    }
    
    .room-card:hover .room-sqft {
      transform: scale(1.1);
    }
    
    .room-sqft span {
      font-size: 0.75rem;
      font-weight: 400;
      color: var(--text-muted);
    }
    
    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 20px;
      border-radius: var(--radius-md);
      font-size: 0.95rem;
      font-weight: 600;
      font-family: var(--font-display);
      border: none;
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s, background 0.2s;
      text-decoration: none;
    }
    
    .btn:active { transform: scale(0.97); }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--primary-light);
      box-shadow: var(--shadow-md), var(--shadow-glow);
    }
    
    .btn-secondary {
      background: var(--surface-alt);
      color: var(--text);
      border: 1px solid var(--border);
    }
    
    .btn-secondary:hover {
      background: var(--border);
    }
    
    .btn-large {
      width: 100%;
      padding: 16px 24px;
      font-size: 1.1rem;
    }
    
    .btn-icon {
      width: 44px;
      height: 44px;
      padding: 0;
      border-radius: 50%;
    }
    
    /* Floating Action Button */
    .fab {
      position: fixed;
      bottom: 140px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      border: none;
      box-shadow: var(--shadow-lg), var(--shadow-glow);
      cursor: pointer;
      z-index: 50;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s, box-shadow 0.2s;
      animation: pulse 2s ease-in-out infinite;
    }
    
    .fab:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-lg), 0 0 30px oklch(0.45 0.16 30 / 0.4);
    }
    
    .fab:active { transform: scale(0.95); animation: none; }
    
    .fab svg { width: 28px; height: 28px; }
    
    /* Form Elements */
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-label {
      display: block;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 6px;
    }
    
    .form-input {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 1rem;
      font-family: var(--font-body);
      background: var(--surface);
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    .form-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px oklch(0.45 0.16 30 / 0.15);
    }
    
    .form-input::placeholder { color: var(--text-muted); opacity: 0.7; }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    
    /* Canvas Container */
    .canvas-container {
      background: var(--surface);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-md);
      margin-bottom: 16px;
      position: relative;
    }
    
    .canvas-wrapper {
      position: relative;
      width: 100%;
      aspect-ratio: 4/3;
      background: #f5f5f5;
      touch-action: none;
    }
    
    .canvas-wrapper canvas {
      position: absolute;
      top: 0;
      left: 0;
    }
    
    .canvas-toolbar {
      display: flex;
      gap: 8px;
      padding: 12px;
      background: var(--surface-alt);
      border-top: 1px solid var(--border);
      flex-wrap: wrap;
    }
    
    .tool-btn {
      width: 44px;
      height: 44px;
      border-radius: var(--radius-sm);
      border: 2px solid var(--border);
      background: var(--surface);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
    }
    
    .tool-btn:hover { border-color: var(--primary); }
    
    .tool-btn.active {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }
    
    .tool-btn svg { width: 20px; height: 20px; }
    
    /* Flooring Type Selector */
    .flooring-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .flooring-option {
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      padding: 12px 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .flooring-option:hover { border-color: var(--primary-light); }
    
    .flooring-option.selected {
      border-color: var(--primary);
      background: oklch(0.45 0.16 30 / 0.08);
    }
    
    .flooring-swatch {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-sm);
      margin: 0 auto 8px;
      overflow: hidden;
    }
    
    .flooring-name {
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    /* Waste Factor Slider */
    .waste-slider-container {
      margin-bottom: 16px;
    }
    
    .waste-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    .waste-value {
      font-weight: 700;
      color: var(--primary);
      font-family: var(--font-display);
    }
    
    .waste-slider {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      background: var(--border);
      -webkit-appearance: none;
      appearance: none;
    }
    
    .waste-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
      box-shadow: var(--shadow-md);
    }
    
    /* Summary Panel */
    .summary-panel {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      color: white;
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 16px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 32px oklch(0.45 0.16 30 / 0.3), 0 4px 16px oklch(0.45 0.16 30 / 0.2);
    }
    
    .summary-panel::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      pointer-events: none;
    }
    
    .summary-panel::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    }
    
    .summary-title {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-bottom: 8px;
    }
    
    .summary-value {
      font-size: 2.5rem;
      font-weight: 700;
      font-family: var(--font-display);
      line-height: 1;
    }
    
    .summary-value span {
      font-size: 1rem;
      font-weight: 400;
      opacity: 0.8;
    }
    
    .summary-breakdown {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.2);
    }
    
    .breakdown-item {
      text-align: center;
    }
    
    .breakdown-value {
      font-size: 1.25rem;
      font-weight: 600;
      font-family: var(--font-display);
    }
    
    .breakdown-label {
      font-size: 0.75rem;
      opacity: 0.8;
    }
    
    /* Acclimation Timeline */
    .acclimation-card {
      background: linear-gradient(135deg, oklch(0.55 0.15 145 / 0.08), oklch(0.55 0.15 145 / 0.15));
      border: 2px solid oklch(0.55 0.15 145 / 0.3);
      border-radius: var(--radius-md);
      padding: 20px;
      margin-bottom: 16px;
      position: relative;
      overflow: hidden;
      animation: fadeUp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    .acclimation-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, var(--success), oklch(0.65 0.15 145));
    }
    
    .acclimation-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }
    
    .acclimation-header svg {
      width: 28px;
      height: 28px;
      color: var(--success);
      animation: pulse 2s ease-in-out infinite;
    }
    
    .acclimation-header span {
      font-weight: 600;
      color: oklch(0.35 0.15 145);
    }
    
    .acclimation-days {
      font-size: 2rem;
      font-weight: 700;
      font-family: var(--font-display);
      color: oklch(0.35 0.15 145);
      line-height: 1;
      margin-bottom: 4px;
    }
    
    .acclimation-days::after {
      content: 'recommended';
      display: block;
      font-size: 0.7rem;
      font-weight: 500;
      color: oklch(0.55 0.15 145);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 2px;
    }
    
    .acclimation-text {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 8px;
    }
    
    /* Acclimation progress bar */
    .acclimation-progress {
      height: 6px;
      background: oklch(0.88 0.01 80);
      border-radius: 3px;
      margin-top: 12px;
      overflow: hidden;
    }
    
    .acclimation-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--success), oklch(0.65 0.15 145));
      border-radius: 3px;
      transition: width 1s ease-out;
      animation: shimmer 2s infinite;
    }
    
    /* Quote Actions */
    .quote-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 16px;
    }
    
    /* Projects List */
    .projects-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .project-card {
      display: flex;
      align-items: center;
      gap: 16px;
      cursor: pointer;
    }
    
    .project-icon {
      width: 56px;
      height: 56px;
      background: var(--primary);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      flex-shrink: 0;
    }
    
    .project-icon svg { width: 28px; height: 28px; }
    
    .project-info { flex: 1; }
    
    .project-name {
      font-weight: 600;
      font-family: var(--font-display);
    }
    
    .project-details {
      font-size: 0.85rem;
      color: var(--text-muted);
    }
    
    .project-status {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .status-in-progress {
      background: oklch(0.55 0.15 145 / 0.15);
      color: oklch(0.40 0.15 145);
    }
    
    .status-quote-sent {
      background: oklch(0.50 0.12 220 / 0.15);
      color: oklch(0.40 0.12 220);
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 48px 24px;
    }
    
    .empty-illustration {
      width: 140px;
      height: 140px;
      margin: 0 auto 24px;
      animation: floatEnhanced 5s ease-in-out infinite;
      filter: drop-shadow(0 8px 16px oklch(0.45 0.16 30 / 0.15));
    }
    
    .empty-illustration svg {
      width: 100%;
      height: 100%;
    }
    
    .empty-illustration path {
      stroke-dasharray: 300;
      stroke-dashoffset: 300;
      animation: drawStroke 2s ease-out forwards, floatEnhanced 5s ease-in-out 2s infinite;
    }
    
    .empty-illustration circle {
      transform-origin: center;
      animation: scaleBounce 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) 0.5s both;
    }
    
    .empty-title {
      font-size: 1.25rem;
      margin-bottom: 8px;
    }
    
    .empty-text {
      color: var(--text-muted);
      margin-bottom: 24px;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
    }
    
    /* Tab Bar */
    .tab-bar {
      position: fixed;
      bottom: 60px;
      left: 0;
      right: 0;
      background: var(--surface);
      border-top: 1px solid var(--border);
      display: flex;
      padding: 8px 0;
      padding-bottom: calc(8px + env(safe-area-inset-bottom));
      z-index: 100;
    }
    
    .tab-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px 4px;
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 0.7rem;
      cursor: pointer;
      transition: color 0.2s;
    }
    
    .tab-item:hover { color: var(--primary-light); }
    
    .tab-item.active { color: var(--primary); }
    
    .tab-item svg { width: 24px; height: 24px; }
    
    /* Toast */
    .toast-container {
      position: fixed;
      bottom: 200px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 8px;
      pointer-events: none;
    }
    
    .toast {
      background: var(--text);
      color: white;
      padding: 12px 20px;
      border-radius: var(--radius-md);
      font-size: 0.9rem;
      box-shadow: var(--shadow-lg);
      animation: fadeUp 0.3s ease-out;
      pointer-events: auto;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .toast svg { width: 20px; height: 20px; flex-shrink: 0; }
    
    .toast-success { background: var(--success); }
    .toast-error { background: var(--error); }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px);
      z-index: 500;
      display: none;
      align-items: flex-end;
      justify-content: center;
    }
    
    .modal-overlay.active { display: flex; }
    
    .modal-content {
      background: var(--surface);
      width: 100%;
      max-width: 500px;
      max-height: 80vh;
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      overflow: hidden;
      animation: fadeUp 0.3s ease-out;
    }
    
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
    }
    
    .modal-title {
      font-size: 1.1rem;
      font-weight: 600;
      font-family: var(--font-display);
    }
    
    .modal-close {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: var(--surface-alt);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-body { padding-bottom: 80px;
      padding: 20px;
      overflow-y: auto;
    }
    
    /* Coming Soon Badge */
    .coming-soon {
      position: relative;
      opacity: 0.5;
      pointer-events: none;
    }
    
    .coming-soon::after {
      content: 'Coming Soon';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--text);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.7rem;
      font-weight: 600;
      white-space: nowrap;
    }
    
    /* Desktop */
    @media (min-width: 768px) {
      .main-content { padding: 24px; }
      .flooring-grid { grid-template-columns: repeat(6, 1fr); }
      .quote-actions { grid-template-columns: repeat(4, 1fr); }
    }

    /* Skip Link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--primary);
      color: white;
      padding: 8px 16px;
      text-decoration: none;
      font-weight: 600;
      border-radius: 0 0 var(--radius-md) 0;
      z-index: 10000;
      transition: top 0.2s ease;
      font-family: var(--font-display);
    }
    .skip-link:focus {
      top: 0;
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    /* Print styles */
    @media print {
      body { padding-bottom: 80px; background: white !important; padding-bottom: 0 !important; }
      body::before { display: none; }
      .app-header, .tab-bar, .fab, .demo-banner, #bct-demo-disclaimer { display: none !important; }
      .card { box-shadow: none; border: 1px solid #ddd; }
      .summary-panel { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }
    
    /* Flooring pattern backgrounds with enhanced depth */
    .pattern-hardwood {
      background: linear-gradient(90deg, #8B4513 0%, #A0522D 10%, #8B4513 20%, #A0522D 30%, #8B4513 40%, #A0522D 50%, #8B4513 60%, #A0522D 70%, #8B4513 80%, #A0522D 90%, #8B4513 100%);
      background-size: 20px 100%;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .pattern-tile {
      background: 
        linear-gradient(90deg, #ccc 1px, transparent 1px),
        linear-gradient(180deg, #ccc 1px, transparent 1px),
        linear-gradient(#e5e5e5, #e5e5e5);
      background-size: 12px 12px, 12px 12px, 100% 100%;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .pattern-carpet {
      background: #5a5a7a;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='1' cy='1' r='1' fill='%236a6a8a'/%3E%3C/svg%3E");
      background-size: 4px 4px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .pattern-lvp {
      background: linear-gradient(90deg, #d4a574 0%, #c9976a 8%, #d4a574 16%, #c9976a 24%, #d4a574 32%);
      background-size: 24px 100%;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);
    }
    
    .pattern-laminate {
      background: linear-gradient(90deg, #b8956c 0%, #a68558 10%, #b8956c 20%);
      background-size: 16px 100%;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);
    }
    
    .pattern-vinyl {
      background: #c4c4c4;
      background-image: linear-gradient(45deg, #b0b0b0 25%, transparent 25%, transparent 75%, #b0b0b0 75%);
      background-size: 10px 10px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Enhanced flooring option interactions */
    .flooring-option {
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      padding: 12px 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
      position: relative;
      overflow: hidden;
    }
    
    .flooring-option::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.4) 50%, transparent 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .flooring-option:hover { 
      border-color: var(--primary-light); 
      transform: translateY(-3px);
      box-shadow: 0 8px 16px oklch(0.2 0.02 30 / 0.1);
    }
    
    .flooring-option:hover::before {
      opacity: 1;
    }
    
    .flooring-option.selected {
      border-color: var(--primary);
      background: oklch(0.45 0.16 30 / 0.08);
      box-shadow: 0 4px 12px oklch(0.45 0.16 30 / 0.15);
    }
    
    .flooring-option.selected::after {
      content: '\2713';
      position: absolute;
      top: 4px;
      right: 4px;
      width: 18px;
      height: 18px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: scaleBounce 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
  </style>
</head>
<body>
  <!-- Gate Screen -->
  <div id="gate-screen">
    <div class="gate-card animate-in">
      <svg class="gate-logo" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="8" y="8" width="64" height="64" rx="12" fill="oklch(0.45 0.16 30)"/>
        <path d="M20 28h40M20 40h40M20 52h40M28 20v40M52 20v40" stroke="white" stroke-width="2" stroke-linecap="round"/>
        <rect x="32" y="32" width="16" height="16" rx="2" fill="white" fill-opacity="0.3"/>
      </svg>
      <h2 class="gate-title">DFW Flooring Estimator</h2>
      <p class="gate-subtitle">Enter your access key to continue</p>
      <div class="gate-input-wrap">
        <label for="gate-key" class="visually-hidden" style="position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0;">Access Key</label>
        <input type="text" id="gate-key" class="gate-input" placeholder="Access key" autocomplete="off">
      </div>
      <button type="button" id="gate-submit" class="gate-btn">Open Estimator</button>
      <p id="gate-error" class="gate-error">Invalid access key. Please try again.</p>
    </div>
  </div>
  
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Main App -->
  <div id="app">
    <!-- Header -->
    <header class="app-header">
      <div class="header-content">
        <svg class="header-logo" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="40" height="40" rx="8" fill="oklch(0.45 0.16 30)"/>
          <path d="M10 14h20M10 20h20M10 26h20M14 10v20M26 10v20" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        <div class="header-text">
          <h1>DFW Flooring Estimator</h1>
          <span>Arlington, TX</span>
        </div>
      </div>
    </header>
    
    <!-- Demo Banner -->
    <div id="demo-banner" class="demo-banner hidden">
      <span class="demo-banner-text">Sample data for Arlington. Tap to clear and add your own.</span>
      <button type="button" class="demo-banner-btn" id="clear-demo-btn" aria-label="Clear sample data">Clear Sample Data</button>
    </div>
    
    <!-- Main Content -->
    <main id="main-content" class="main-content">
      <!-- Projects View -->
      <section id="view-projects" class="view active" aria-labelledby="projects-heading">
        <h2 id="projects-heading" class="visually-hidden" style="position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0;">Your Projects</h2>
        <div id="projects-container"></div>
        <div id="empty-state" class="empty-state hidden">
          <svg class="empty-illustration" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="20" y="30" width="80" height="60" rx="4" fill="oklch(0.88 0.01 80)"/>
            <path d="M30 50h60M30 65h60M30 80h60M45 40v50M75 40v50" stroke="oklch(0.45 0.16 30)" stroke-width="2" stroke-linecap="round" stroke-dasharray="200" stroke-dashoffset="200" style="animation: drawStroke 1.5s ease-out 0.5s forwards"/>
            <circle cx="95" cy="25" r="15" fill="oklch(0.45 0.16 30)"/>
            <path d="M95 18v14M88 25h14" stroke="white" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <h3 class="empty-title">No projects yet</h3>
          <p class="empty-text">Tap the button below to start your first flooring estimate. Measure rooms, pick materials, and generate quotes in minutes.</p>
          <button type="button" class="btn btn-primary btn-large" id="empty-new-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Start First Estimate
          </button>
        </div>
      </section>
      
      <!-- New Project View -->
      <section id="view-new-project" class="view" aria-labelledby="new-project-heading">
        <h2 id="new-project-heading" class="animate-in" style="margin-bottom: 16px;">New Estimate</h2>
        <div class="card animate-in animate-in-1">
          <div class="form-group">
            <label for="project-customer" class="form-label">Customer Name</label>
            <input type="text" id="project-customer" class="form-input" placeholder="e.g. Johnson Family">
          </div>
          <div class="form-group">
            <label for="project-address" class="form-label">Address</label>
            <input type="text" id="project-address" class="form-input" placeholder="e.g. 1234 Oak St, Arlington">
            <button type="button" id="geolocate-btn" class="btn btn-secondary" style="margin-top: 8px; width: 100%;" aria-label="Use current location">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="2" x2="12" y2="4"/><line x1="12" y1="20" x2="12" y2="22"/><line x1="2" y1="12" x2="4" y2="12"/><line x1="20" y1="12" x2="22" y2="12"/></svg>
              Use Current Location
            </button>
          </div>
          <div class="form-group">
            <label for="project-phone" class="form-label">Phone (optional)</label>
            <input type="tel" id="project-phone" class="form-input" placeholder="(817) 555-1234">
          </div>
          <button type="button" class="btn btn-primary btn-large" id="create-project-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
            Create Estimate
          </button>
        </div>
      </section>
      
      <!-- Room Editor View -->
      <section id="view-room-editor" class="view" aria-labelledby="room-editor-heading">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
          <button type="button" class="btn-icon btn-secondary" id="back-to-project-btn" aria-label="Back to project">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
          </button>
          <h2 id="room-editor-heading" class="animate-in">Room Details</h2>
        </div>
        
        <div class="card animate-in animate-in-1">
          <div class="form-group">
            <label for="room-name" class="form-label">Room Name</label>
            <input type="text" id="room-name" class="form-input" placeholder="e.g. Living Room">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="room-length" class="form-label">Length (ft)</label>
              <input type="number" id="room-length" class="form-input" placeholder="18" min="1" step="0.5">
            </div>
            <div class="form-group">
              <label for="room-width" class="form-label">Width (ft)</label>
              <input type="number" id="room-width" class="form-input" placeholder="15" min="1" step="0.5">
            </div>
          </div>
        </div>
        
        <!-- Canvas for room sketch -->
        <div class="canvas-container animate-in animate-in-2">
          <div class="canvas-wrapper" id="room-canvas-wrapper">
            <canvas id="room-canvas"></canvas>
          </div>
          <div class="canvas-toolbar">
            <button type="button" class="tool-btn active" data-tool="select" aria-label="Select tool">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/></svg>
            </button>
            <button type="button" class="tool-btn" data-tool="rectangle" aria-label="Draw rectangle">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
            </button>
            <button type="button" class="tool-btn" data-tool="polygon" aria-label="Draw L-shape">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h10v8h6v8H4V4z"/></svg>
            </button>
            <button type="button" class="tool-btn" data-tool="delete" aria-label="Delete shape">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
            </button>
            <button type="button" class="tool-btn" data-tool="clear" aria-label="Clear canvas">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 4H8l-7 8 7 8h13a2 2 0 002-2V6a2 2 0 00-2-2z"/><line x1="18" y1="9" x2="12" y2="15"/><line x1="12" y1="9" x2="18" y2="15"/></svg>
            </button>
          </div>
        </div>
        
        <!-- Flooring Type Selection -->
        <div class="card animate-in animate-in-3">
          <h3 style="margin-bottom: 12px;">Flooring Type</h3>
          <div class="flooring-grid" id="flooring-options" role="radiogroup" aria-label="Select flooring type">
            <button type="button" class="flooring-option selected" data-type="hardwood" data-waste="10" role="radio" aria-checked="true">
              <div class="flooring-swatch pattern-hardwood"></div>
              <span class="flooring-name">Hardwood</span>
            </button>
            <button type="button" class="flooring-option" data-type="tile" data-waste="12" role="radio" aria-checked="false">
              <div class="flooring-swatch pattern-tile"></div>
              <span class="flooring-name">Tile</span>
            </button>
            <button type="button" class="flooring-option" data-type="carpet" data-waste="15" role="radio" aria-checked="false">
              <div class="flooring-swatch pattern-carpet"></div>
              <span class="flooring-name">Carpet</span>
            </button>
            <button type="button" class="flooring-option" data-type="lvp" data-waste="8" role="radio" aria-checked="false">
              <div class="flooring-swatch pattern-lvp"></div>
              <span class="flooring-name">LVP</span>
            </button>
            <button type="button" class="flooring-option" data-type="laminate" data-waste="10" role="radio" aria-checked="false">
              <div class="flooring-swatch pattern-laminate"></div>
              <span class="flooring-name">Laminate</span>
            </button>
            <button type="button" class="flooring-option" data-type="vinyl" data-waste="8" role="radio" aria-checked="false">
              <div class="flooring-swatch pattern-vinyl"></div>
              <span class="flooring-name">Vinyl</span>
            </button>
          </div>
        </div>
        
        <!-- Waste Factor -->
        <div class="card animate-in animate-in-4">
          <div class="waste-slider-container">
            <div class="waste-header">
              <label for="waste-slider" class="form-label" style="margin: 0;">Waste Factor</label>
              <span class="waste-value" id="waste-display">10%</span>
            </div>
            <input type="range" id="waste-slider" class="waste-slider" min="5" max="25" value="10">
          </div>
          <p style="font-size: 0.8rem; color: var(--text-muted);">Adds extra material for cuts, pattern matching, and mistakes. 10-15% is typical for standard rooms.</p>
        </div>
        
        <button type="button" class="btn btn-primary btn-large" id="save-room-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
          Save Room
        </button>
      </section>
      
      <!-- Project Detail View -->
      <section id="view-project-detail" class="view" aria-labelledby="project-detail-heading">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
          <button type="button" class="btn-icon btn-secondary" id="back-to-projects-btn" aria-label="Back to projects">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
          </button>
          <div>
            <h2 id="project-detail-heading" class="animate-in" style="margin: 0;"></h2>
            <p id="project-detail-address" class="animate-in" style="font-size: 0.85rem; color: var(--text-muted); margin: 0;"></p>
          </div>
        </div>
        
        <!-- Summary Panel -->
        <div class="summary-panel animate-in animate-in-1" id="summary-panel">
          <p class="summary-title">Total Material Needed</p>
          <p class="summary-value"><span id="total-sqft">0</span> <span>sq ft</span></p>
          <div class="summary-breakdown">
            <div class="breakdown-item">
              <p class="breakdown-value" id="base-sqft">0</p>
              <p class="breakdown-label">Base Area</p>
            </div>
            <div class="breakdown-item">
              <p class="breakdown-value" id="waste-sqft">+0</p>
              <p class="breakdown-label">Waste Buffer</p>
            </div>
          </div>
        </div>
        
        <!-- Acclimation Card (shown for hardwood) -->
        <div class="acclimation-card animate-in animate-in-2 hidden" id="acclimation-card">
          <div class="acclimation-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            <span>Acclimation Required</span>
          </div>
          <p class="acclimation-days" id="acclimation-days">7 Days</p>
          <div class="acclimation-progress">
            <div class="acclimation-progress-bar" style="width: 0%"></div>
          </div>
          <p class="acclimation-text">Hardwood needs to sit in the home before installation to adjust to local humidity. Texas humidity typically requires 5-7 days.</p>
        </div>
        
        <!-- Rooms List -->
        <div class="card animate-in animate-in-3">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h3>Rooms</h3>
            <button type="button" class="btn btn-secondary" id="add-room-btn" style="padding: 8px 14px; font-size: 0.85rem;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              Add Room
            </button>
          </div>
          <div id="rooms-list" class="projects-list"></div>
        </div>
        
        <!-- Quote Actions -->
        <div class="quote-actions animate-in animate-in-4">
          <button type="button" class="btn btn-primary" id="generate-pdf-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
            PDF Quote
          </button>
          <button type="button" class="btn btn-secondary" id="share-quote-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
            Share
          </button>
        </div>
        
        <!-- Upsell Teaser -->
        <div class="card coming-soon animate-in animate-in-5" style="text-align: center; padding: 24px;">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="margin: 0 auto 12px; color: var(--text-muted);"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          <h3 style="margin-bottom: 4px;">Multi-Crew Scheduling</h3>
          <p style="color: var(--text-muted); font-size: 0.85rem;">Assign jobs to crews, track install dates, and send reminders.</p>
        </div>
      </section>
      
      <!-- Settings View -->
      <section id="view-settings" class="view" aria-labelledby="settings-heading">
        <h2 id="settings-heading" class="animate-in" style="margin-bottom: 16px;">Settings</h2>
        
        <div class="card animate-in animate-in-1">
          <h3 style="margin-bottom: 16px;">Data Management</h3>
          <button type="button" class="btn btn-secondary btn-large" id="export-btn" style="margin-bottom: 12px;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Export All Data (JSON)
          </button>
          <button type="button" class="btn btn-secondary btn-large" id="import-btn" style="margin-bottom: 12px;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
            Import Data (JSON)
          </button>
          <input type="file" id="import-file" accept=".json" style="display: none;">
        </div>
        
        <div class="card animate-in animate-in-2">
          <h3 style="margin-bottom: 16px;">About</h3>
          <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 8px;">DFW Flooring Estimator</p>
          <p style="font-size: 0.85rem; color: var(--text-muted);">Built for DFW Flooring Warehouse, Arlington TX. Quickly measure rooms, calculate waste factors, and generate quotes right from your phone or tablet.</p>
        </div>
      </section>
    </main>
    
    <!-- FAB -->
    <button type="button" class="fab" id="fab-new" aria-label="Start new estimate">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    </button>
    
    <!-- Tab Bar -->
    <nav class="tab-bar" aria-label="Main navigation">
      <button type="button" class="tab-item active" data-view="projects" aria-label="Projects">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        <span>Projects</span>
      </button>
      <button type="button" class="tab-item" data-view="new-project" aria-label="New estimate">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
        <span>New</span>
      </button>
      <button type="button" class="tab-item coming-soon" data-view="calendar" aria-label="Calendar" disabled>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        <span>Calendar</span>
      </button>
      <button type="button" class="tab-item" data-view="settings" aria-label="Settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
        <span>Settings</span>
      </button>
    </nav>
  </div>
  
  <!-- Toast Container -->
  <div class="toast-container" id="toast-container" aria-live="polite" aria-atomic="true"></div>
  
  <!-- DEMO DISCLAIMER - Legal Notice -->
  <div id="bct-demo-disclaimer" role="contentinfo" aria-label="Demo disclaimer" style="position:fixed;bottom:0;left:0;right:0;background:#f8f8f8;border-top:1px solid #ddd;padding:10px 16px;font-size:12px;line-height:1.4;color:#666;z-index:99999;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:8px 16px;text-align:center;">
    <p style="margin:0;max-width:700px;"><strong style="color:#333;">DEMO:</strong> Sample tool by BennyCuTools. Not affiliated with DFW Flooring Warehouse.</p>
    <a href="mailto:cuuper225@gmail.com?subject=Delete%20Demo%3A%20DFW%20Flooring%20Warehouse&body=I%20am%20the%20owner%20and%20I%20request%20permanent%20deletion%20of%20this%20demo." style="display:inline-flex;align-items:center;gap:4px;background:#dc3545;color:#fff;padding:5px 12px;border-radius:4px;text-decoration:none;font-size:11px;font-weight:500;white-space:nowrap;">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
      Request Permanent Deletion
    </a>
  </div>

  <script>
    // Access key verification
    const _V = 2021042003;
    function _h(s) {
      let h = 0;
      for (let i = 0; i < s.length; i++) {
        h = ((h << 5) - h) + s.charCodeAt(i);
        h |= 0;
      }
      return h;
    }
    
    // State
    let state = {
      authenticated: false,
      projects: [],
      currentProjectId: null,
      currentRoomId: null,
      hasDemo: false
    };
    
    // Fabric.js canvas
    let fabricCanvas = null;
    let currentTool = 'select';
    let isDrawing = false;
    let drawStart = null;
    
    // DOM Elements
    const gateScreen = document.getElementById('gate-screen');
    const app = document.getElementById('app');
    const gateKey = document.getElementById('gate-key');
    const gateSubmit = document.getElementById('gate-submit');
    const gateError = document.getElementById('gate-error');
    const demoBanner = document.getElementById('demo-banner');
    const projectsContainer = document.getElementById('projects-container');
    const emptyState = document.getElementById('empty-state');
    const toastContainer = document.getElementById('toast-container');
    
    // Initialize
    document.addEventListener('DOMContentLoaded', init);
    
    function init() {
      // Check URL key first
      const urlKey = new URLSearchParams(window.location.search).get('key');
      if (urlKey && _h(urlKey) === _V) {
        authenticate();
        return;
      }
      
      // Check stored auth
      if (localStorage.getItem('dfw-flooring-auth') === 'true') {
        authenticate();
        return;
      }
      
      // Show gate
      gateSubmit.addEventListener('click', handleGateSubmit);
      gateKey.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleGateSubmit();
      });
    }
    
    function handleGateSubmit() {
      const key = gateKey.value.trim();
      if (_h(key) === _V) {
        localStorage.setItem('dfw-flooring-auth', 'true');
        authenticate();
      } else {
        gateError.classList.add('show');
        gateKey.style.borderColor = 'var(--error)';
        gateKey.focus();
      }
    }
    
    function authenticate() {
      state.authenticated = true;
      gateScreen.classList.add('hidden');
      app.classList.add('active');
      loadData();
      setupEventListeners();
      initCanvas();
    }
    
    function loadData() {
      const stored = localStorage.getItem('dfw-flooring-data');
      if (stored) {
        try {
          const parsed = JSON.parse(stored);
          state.projects = parsed.projects || [];
          state.hasDemo = parsed.hasDemo || false;
        } catch (e) {
          state.projects = [];
        }
      }
      
      // Check if first visit
      if (!stored && !localStorage.getItem('dfw-flooring-visited')) {
        localStorage.setItem('dfw-flooring-visited', 'true');
        loadDemoData();
      }
      
      renderProjects();
      updateDemoBanner();
    }
    
    function loadDemoData() {
      const now = Date.now();
      state.projects = [
        {
          id: 'demo-1',
          customer: 'Martinez Family',
          address: '4521 Pioneer Pkwy, Arlington, TX',
          phone: '(817) 555-2847',
          createdAt: now - 7200000,
          status: 'in-progress',
          isDemo: true,
          rooms: [
            {
              id: 'r1',
              name: 'Living Room',
              length: 18,
              width: 15,
              flooringType: 'lvp',
              wasteFactor: 10,
              sqft: 270
            },
            {
              id: 'r2',
              name: 'Master Bedroom',
              length: 14,
              width: 12,
              flooringType: 'lvp',
              wasteFactor: 10,
              sqft: 168
            }
          ]
        },
        {
          id: 'demo-2',
          customer: 'Thompson Residence',
          address: '2108 Oak Grove Ln, Arlington, TX',
          phone: '(817) 555-9134',
          createdAt: now - 86400000,
          status: 'quote-sent',
          isDemo: true,
          rooms: [
            {
              id: 'r1',
              name: 'Kitchen',
              length: 16,
              width: 12,
              flooringType: 'tile',
              wasteFactor: 12,
              sqft: 192
            },
            {
              id: 'r2',
              name: 'Dining Room',
              length: 12,
              width: 10,
              flooringType: 'hardwood',
              wasteFactor: 10,
              sqft: 120
            },
            {
              id: 'r3',
              name: 'Hallway',
              length: 20,
              width: 4,
              flooringType: 'hardwood',
              wasteFactor: 15,
              sqft: 80
            }
          ]
        },
        {
          id: 'demo-3',
          customer: 'Davis Home Renovation',
          address: '789 Meadowbrook Dr, Pantego, TX',
          phone: '(682) 555-4721',
          createdAt: now - 172800000,
          status: 'in-progress',
          isDemo: true,
          rooms: [
            {
              id: 'r1',
              name: 'Bedroom 1',
              length: 12,
              width: 11,
              flooringType: 'carpet',
              wasteFactor: 15,
              sqft: 132
            },
            {
              id: 'r2',
              name: 'Bedroom 2',
              length: 10,
              width: 10,
              flooringType: 'carpet',
              wasteFactor: 15,
              sqft: 100
            }
          ]
        }
      ];
      state.hasDemo = true;
      saveData();
    }
    
    function saveData() {
      localStorage.setItem('dfw-flooring-data', JSON.stringify({
        projects: state.projects,
        hasDemo: state.hasDemo
      }));
    }
    
    function updateDemoBanner() {
      const hasAnyDemo = state.projects.some(p => p.isDemo);
      demoBanner.classList.toggle('hidden', !hasAnyDemo);
    }
    
    function clearDemoData() {
      state.projects = state.projects.filter(p => !p.isDemo);
      state.hasDemo = false;
      saveData();
      renderProjects();
      updateDemoBanner();
      showToast('Sample data cleared', 'success');
    }
    
    function setupEventListeners() {
      // Tab navigation
      document.querySelectorAll('.tab-item').forEach(tab => {
        tab.addEventListener('click', () => {
          if (tab.disabled) return;
          const view = tab.dataset.view;
          showView(view);
          document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
        });
      });
      
      // FAB
      document.getElementById('fab-new').addEventListener('click', () => showView('new-project'));
      document.getElementById('empty-new-btn').addEventListener('click', () => showView('new-project'));
      
      // Clear demo
      document.getElementById('clear-demo-btn').addEventListener('click', clearDemoData);
      
      // Create project
      document.getElementById('create-project-btn').addEventListener('click', createProject);
      
      // Geolocation
      document.getElementById('geolocate-btn').addEventListener('click', getLocation);
      
      // Back buttons
      document.getElementById('back-to-projects-btn').addEventListener('click', () => showView('projects'));
      document.getElementById('back-to-project-btn').addEventListener('click', () => {
        if (state.currentProjectId) {
          showProjectDetail(state.currentProjectId);
        } else {
          showView('projects');
        }
      });
      
      // Add room
      document.getElementById('add-room-btn').addEventListener('click', () => {
        state.currentRoomId = null;
        resetRoomEditor();
        showView('room-editor');
      });
      
      // Save room
      document.getElementById('save-room-btn').addEventListener('click', saveRoom);
      
      // Flooring options
      document.getElementById('flooring-options').addEventListener('click', (e) => {
        const option = e.target.closest('.flooring-option');
        if (!option) return;
        document.querySelectorAll('.flooring-option').forEach(o => {
          o.classList.remove('selected');
          o.setAttribute('aria-checked', 'false');
        });
        option.classList.add('selected');
        option.setAttribute('aria-checked', 'true');
        document.getElementById('waste-slider').value = option.dataset.waste;
        updateWasteDisplay();
        updateCanvasPattern();
      });
      
      // Waste slider
      document.getElementById('waste-slider').addEventListener('input', updateWasteDisplay);
      
      // Canvas tools
      document.querySelectorAll('.tool-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const tool = btn.dataset.tool;
          if (tool === 'clear') {
            fabricCanvas.clear();
            fabricCanvas.backgroundColor = '#f5f5f5';
            fabricCanvas.renderAll();
            return;
          }
          if (tool === 'delete') {
            const active = fabricCanvas.getActiveObject();
            if (active) {
              fabricCanvas.remove(active);
              fabricCanvas.renderAll();
            }
            return;
          }
          currentTool = tool;
          document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          updateCanvasMode();
        });
      });
      
      // Generate PDF
      document.getElementById('generate-pdf-btn').addEventListener('click', generatePDF);
      
      // Share
      document.getElementById('share-quote-btn').addEventListener('click', shareQuote);
      
      // Export/Import
      document.getElementById('export-btn').addEventListener('click', exportData);
      document.getElementById('import-btn').addEventListener('click', () => document.getElementById('import-file').click());
      document.getElementById('import-file').addEventListener('change', importData);
      
      // Room dimensions update canvas
      document.getElementById('room-length').addEventListener('input', updateCanvasFromDimensions);
      document.getElementById('room-width').addEventListener('input', updateCanvasFromDimensions);
    }
    
    function showView(viewName) {
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.getElementById(`view-${viewName}`).classList.add('active');
      
      // Update tab active state
      document.querySelectorAll('.tab-item').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.view === viewName);
      });
      
      // Re-trigger animations
      const view = document.getElementById(`view-${viewName}`);
      view.querySelectorAll('.animate-in').forEach(el => {
        el.style.animation = 'none';
        el.offsetHeight;
        el.style.animation = null;
      });
    }
    
    function renderProjects() {
      const container = projectsContainer;
      container.innerHTML = '';
      
      if (state.projects.length === 0) {
        emptyState.classList.remove('hidden');
        return;
      }
      
      emptyState.classList.add('hidden');
      
      state.projects.forEach((project, idx) => {
        const totalSqft = project.rooms.reduce((sum, r) => {
          const waste = r.sqft * (r.wasteFactor / 100);
          return sum + r.sqft + waste;
        }, 0);
        
        const card = document.createElement('div');
        card.className = `card card-3d project-card animate-in animate-in-${Math.min(idx + 1, 5)}`;
        card.style.opacity = '1'; // Ensure visible
        card.innerHTML = `
          <div class="project-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          </div>
          <div class="project-info">
            <p class="project-name">${escapeHtml(project.customer)}</p>
            <p class="project-details">${project.rooms.length} room${project.rooms.length !== 1 ? 's' : ''} | ${Math.round(totalSqft)} sq ft total</p>
          </div>
          <span class="project-status status-${project.status}">${project.status === 'in-progress' ? 'In Progress' : 'Quote Sent'}</span>
        `;
        card.addEventListener('click', () => showProjectDetail(project.id));
        container.appendChild(card);
      });
    }
    
    function showProjectDetail(projectId) {
      const project = state.projects.find(p => p.id === projectId);
      if (!project) return;
      
      state.currentProjectId = projectId;
      
      document.getElementById('project-detail-heading').textContent = project.customer;
      document.getElementById('project-detail-address').textContent = project.address;
      
      // Calculate totals
      let baseSqft = 0;
      let wasteSqft = 0;
      let hasHardwood = false;
      
      project.rooms.forEach(room => {
        baseSqft += room.sqft;
        wasteSqft += room.sqft * (room.wasteFactor / 100);
        if (room.flooringType === 'hardwood') hasHardwood = true;
      });
      
      // Animate numbers with count-up effect
      animateNumber(document.getElementById('total-sqft'), Math.round(baseSqft + wasteSqft));
      animateNumber(document.getElementById('base-sqft'), Math.round(baseSqft));
      animateNumber(document.getElementById('waste-sqft'), Math.round(wasteSqft), '+');
      
      // Acclimation card
      const acclimationCard = document.getElementById('acclimation-card');
      acclimationCard.classList.toggle('hidden', !hasHardwood);
      
      // Animate acclimation progress bar
      if (hasHardwood) {
        setTimeout(() => {
          const progressBar = document.querySelector('.acclimation-progress-bar');
          if (progressBar) {
            progressBar.style.width = '70%';
          }
        }, 300);
      }
      
      // Render rooms
      const roomsList = document.getElementById('rooms-list');
      roomsList.innerHTML = '';
      
      project.rooms.forEach(room => {
        const roomCard = document.createElement('div');
        roomCard.className = 'card room-card';
        roomCard.innerHTML = `
          <div class="room-preview">
            <div class="flooring-swatch pattern-${room.flooringType}" style="width: 100%; height: 100%;"></div>
          </div>
          <div class="room-info">
            <p class="room-name">${escapeHtml(room.name)}</p>
            <p class="room-details">${room.length}' x ${room.width}' | ${capitalize(room.flooringType)} | ${room.wasteFactor}% waste</p>
          </div>
          <p class="room-sqft">${Math.round(room.sqft + (room.sqft * room.wasteFactor / 100))}<span> sq ft</span></p>
        `;
        roomCard.addEventListener('click', () => editRoom(room.id));
        roomsList.appendChild(roomCard);
      });
      
      showView('project-detail');
    }
    
    function createProject() {
      const customer = document.getElementById('project-customer').value.trim();
      const address = document.getElementById('project-address').value.trim();
      const phone = document.getElementById('project-phone').value.trim();
      
      if (!customer) {
        showToast('Please enter a customer name', 'error');
        document.getElementById('project-customer').focus();
        return;
      }
      
      const project = {
        id: 'p-' + Date.now(),
        customer,
        address,
        phone,
        createdAt: Date.now(),
        status: 'in-progress',
        isDemo: false,
        rooms: []
      };
      
      state.projects.unshift(project);
      saveData();
      
      // Clear form
      document.getElementById('project-customer').value = '';
      document.getElementById('project-address').value = '';
      document.getElementById('project-phone').value = '';
      
      showToast('Estimate created', 'success');
      showProjectDetail(project.id);
    }
    
    function getLocation() {
      if (!navigator.geolocation) {
        showToast('Location not available on this device', 'error');
        return;
      }
      
      navigator.geolocation.getCurrentPosition(
        async (pos) => {
          try {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;
            document.getElementById('project-address').value = `${lat.toFixed(6)}, ${lng.toFixed(6)} (GPS)`;
            showToast('Location captured', 'success');
          } catch (e) {
            document.getElementById('project-address').value = `${pos.coords.latitude.toFixed(6)}, ${pos.coords.longitude.toFixed(6)}`;
          }
        },
        (err) => {
          showToast('Could not get location: ' + err.message, 'error');
        },
        { enableHighAccuracy: true, timeout: 10000 }
      );
    }
    
    function initCanvas() {
      const wrapper = document.getElementById('room-canvas-wrapper');
      const canvasEl = document.getElementById('room-canvas');
      
      // Set canvas size
      const width = wrapper.clientWidth || 400;
      const height = width * 0.75;
      
      canvasEl.width = width;
      canvasEl.height = height;
      
      fabricCanvas = new fabric.Canvas('room-canvas', {
        backgroundColor: '#f5f5f5',
        selection: true
      });
      
      fabricCanvas.setDimensions({ width, height });
      
      // Handle window resize
      window.addEventListener('resize', () => {
        const newWidth = wrapper.clientWidth;
        const newHeight = newWidth * 0.75;
        fabricCanvas.setDimensions({ width: newWidth, height: newHeight });
        fabricCanvas.renderAll();
      });
      
      // Drawing handlers
      fabricCanvas.on('mouse:down', handleCanvasMouseDown);
      fabricCanvas.on('mouse:move', handleCanvasMouseMove);
      fabricCanvas.on('mouse:up', handleCanvasMouseUp);
    }
    
    function handleCanvasMouseDown(opt) {
      if (currentTool !== 'rectangle' && currentTool !== 'polygon') return;
      isDrawing = true;
      const pointer = fabricCanvas.getPointer(opt.e);
      drawStart = { x: pointer.x, y: pointer.y };
    }
    
    function handleCanvasMouseMove(opt) {
      if (!isDrawing || currentTool === 'select') return;
      // Could show preview here
    }
    
    function handleCanvasMouseUp(opt) {
      if (!isDrawing) return;
      isDrawing = false;
      
      const pointer = fabricCanvas.getPointer(opt.e);
      const width = Math.abs(pointer.x - drawStart.x);
      const height = Math.abs(pointer.y - drawStart.y);
      const left = Math.min(pointer.x, drawStart.x);
      const top = Math.min(pointer.y, drawStart.y);
      
      if (width < 20 || height < 20) return;
      
      const selectedFlooring = document.querySelector('.flooring-option.selected');
      const flooringType = selectedFlooring ? selectedFlooring.dataset.type : 'hardwood';
      
      if (currentTool === 'rectangle') {
        const rect = new fabric.Rect({
          left,
          top,
          width,
          height,
          fill: getPatternColor(flooringType),
          stroke: '#333',
          strokeWidth: 2,
          rx: 4,
          ry: 4
        });
        fabricCanvas.add(rect);
      } else if (currentTool === 'polygon') {
        // L-shape
        const points = [
          { x: left, y: top },
          { x: left + width * 0.6, y: top },
          { x: left + width * 0.6, y: top + height * 0.5 },
          { x: left + width, y: top + height * 0.5 },
          { x: left + width, y: top + height },
          { x: left, y: top + height }
        ];
        const poly = new fabric.Polygon(points, {
          fill: getPatternColor(flooringType),
          stroke: '#333',
          strokeWidth: 2
        });
        fabricCanvas.add(poly);
      }
      
      fabricCanvas.renderAll();
    }
    
    function getPatternColor(type) {
      const colors = {
        hardwood: '#A0522D',
        tile: '#ddd',
        carpet: '#5a5a7a',
        lvp: '#c9976a',
        laminate: '#a68558',
        vinyl: '#b0b0b0'
      };
      return colors[type] || '#ddd';
    }
    
    function updateCanvasMode() {
      fabricCanvas.isDrawingMode = false;
      fabricCanvas.selection = currentTool === 'select';
      fabricCanvas.forEachObject(obj => {
        obj.selectable = currentTool === 'select';
      });
    }
    
    function updateCanvasPattern() {
      const selectedFlooring = document.querySelector('.flooring-option.selected');
      const flooringType = selectedFlooring ? selectedFlooring.dataset.type : 'hardwood';
      const color = getPatternColor(flooringType);
      
      fabricCanvas.forEachObject(obj => {
        obj.set('fill', color);
      });
      fabricCanvas.renderAll();
    }
    
    function updateCanvasFromDimensions() {
      // Draw a room rectangle based on input dimensions
      const length = parseFloat(document.getElementById('room-length').value) || 15;
      const width = parseFloat(document.getElementById('room-width').value) || 12;
      
      // Clear existing shapes and redraw
      fabricCanvas.clear();
      fabricCanvas.backgroundColor = '#f5f5f5';
      
      const canvasWidth = fabricCanvas.getWidth();
      const canvasHeight = fabricCanvas.getHeight();
      const padding = 40;
      
      // Scale to fit
      const maxWidth = canvasWidth - padding * 2;
      const maxHeight = canvasHeight - padding * 2;
      const scale = Math.min(maxWidth / length, maxHeight / width);
      
      const rectWidth = length * scale;
      const rectHeight = width * scale;
      const left = (canvasWidth - rectWidth) / 2;
      const top = (canvasHeight - rectHeight) / 2;
      
      const selectedFlooring = document.querySelector('.flooring-option.selected');
      const flooringType = selectedFlooring ? selectedFlooring.dataset.type : 'hardwood';
      
      const rect = new fabric.Rect({
        left,
        top,
        width: rectWidth,
        height: rectHeight,
        fill: getPatternColor(flooringType),
        stroke: '#333',
        strokeWidth: 2,
        rx: 4,
        ry: 4
      });
      
      // Add dimension labels
      const lengthLabel = new fabric.Text(`${length}'`, {
        left: left + rectWidth / 2,
        top: top + rectHeight + 10,
        fontSize: 14,
        fontFamily: 'DM Sans, sans-serif',
        fill: '#333',
        originX: 'center'
      });
      
      const widthLabel = new fabric.Text(`${width}'`, {
        left: left - 15,
        top: top + rectHeight / 2,
        fontSize: 14,
        fontFamily: 'DM Sans, sans-serif',
        fill: '#333',
        originY: 'center',
        angle: -90
      });
      
      fabricCanvas.add(rect, lengthLabel, widthLabel);
      fabricCanvas.renderAll();
    }
    
    function resetRoomEditor() {
      document.getElementById('room-name').value = '';
      document.getElementById('room-length').value = '';
      document.getElementById('room-width').value = '';
      document.getElementById('waste-slider').value = 10;
      updateWasteDisplay();
      
      document.querySelectorAll('.flooring-option').forEach(o => {
        o.classList.remove('selected');
        o.setAttribute('aria-checked', 'false');
      });
      document.querySelector('.flooring-option[data-type="hardwood"]').classList.add('selected');
      document.querySelector('.flooring-option[data-type="hardwood"]').setAttribute('aria-checked', 'true');
      
      if (fabricCanvas) {
        fabricCanvas.clear();
        fabricCanvas.backgroundColor = '#f5f5f5';
        fabricCanvas.renderAll();
      }
    }
    
    function editRoom(roomId) {
      const project = state.projects.find(p => p.id === state.currentProjectId);
      if (!project) return;
      
      const room = project.rooms.find(r => r.id === roomId);
      if (!room) return;
      
      state.currentRoomId = roomId;
      
      document.getElementById('room-name').value = room.name;
      document.getElementById('room-length').value = room.length;
      document.getElementById('room-width').value = room.width;
      document.getElementById('waste-slider').value = room.wasteFactor;
      updateWasteDisplay();
      
      document.querySelectorAll('.flooring-option').forEach(o => {
        o.classList.toggle('selected', o.dataset.type === room.flooringType);
        o.setAttribute('aria-checked', o.dataset.type === room.flooringType ? 'true' : 'false');
      });
      
      showView('room-editor');
      updateCanvasFromDimensions();
    }
    
    function saveRoom() {
      const name = document.getElementById('room-name').value.trim() || 'Unnamed Room';
      const length = parseFloat(document.getElementById('room-length').value) || 0;
      const width = parseFloat(document.getElementById('room-width').value) || 0;
      const wasteFactor = parseInt(document.getElementById('waste-slider').value) || 10;
      const selectedFlooring = document.querySelector('.flooring-option.selected');
      const flooringType = selectedFlooring ? selectedFlooring.dataset.type : 'hardwood';
      
      if (length <= 0 || width <= 0) {
        showToast('Please enter room dimensions', 'error');
        return;
      }
      
      const sqft = length * width;
      
      const project = state.projects.find(p => p.id === state.currentProjectId);
      if (!project) {
        showToast('Project not found', 'error');
        return;
      }
      
      if (state.currentRoomId) {
        // Edit existing room
        const roomIdx = project.rooms.findIndex(r => r.id === state.currentRoomId);
        if (roomIdx >= 0) {
          project.rooms[roomIdx] = {
            ...project.rooms[roomIdx],
            name,
            length,
            width,
            flooringType,
            wasteFactor,
            sqft
          };
        }
      } else {
        // Add new room
        project.rooms.push({
          id: 'r-' + Date.now(),
          name,
          length,
          width,
          flooringType,
          wasteFactor,
          sqft
        });
      }
      
      saveData();
      showToast('Room saved', 'success');
      showProjectDetail(state.currentProjectId);
    }
    
    function updateWasteDisplay() {
      const val = document.getElementById('waste-slider').value;
      document.getElementById('waste-display').textContent = val + '%';
    }
    
    async function generatePDF() {
      const project = state.projects.find(p => p.id === state.currentProjectId);
      if (!project) return;
      
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      // Header
      doc.setFillColor(139, 69, 19);
      doc.rect(0, 0, 220, 30, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(20);
      doc.text('DFW Flooring Warehouse', 15, 18);
      doc.setFontSize(10);
      doc.text('Arlington, TX | (817) 861-3737', 15, 25);
      
      // Title
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(16);
      doc.text('Flooring Estimate', 15, 45);
      
      // Customer info
      doc.setFontSize(11);
      doc.text(`Customer: ${project.customer}`, 15, 55);
      doc.text(`Address: ${project.address || 'N/A'}`, 15, 62);
      doc.text(`Date: ${new Date().toLocaleDateString()}`, 15, 69);
      
      // Table header
      let y = 85;
      doc.setFillColor(240, 240, 240);
      doc.rect(15, y - 5, 180, 10, 'F');
      doc.setFontSize(10);
      doc.text('Room', 17, y + 2);
      doc.text('Dimensions', 70, y + 2);
      doc.text('Type', 110, y + 2);
      doc.text('Waste', 145, y + 2);
      doc.text('Sq Ft', 170, y + 2);
      
      y += 12;
      
      let totalBase = 0;
      let totalWaste = 0;
      
      project.rooms.forEach(room => {
        const waste = room.sqft * (room.wasteFactor / 100);
        const total = room.sqft + waste;
        
        doc.text(room.name, 17, y);
        doc.text(`${room.length}' x ${room.width}'`, 70, y);
        doc.text(capitalize(room.flooringType), 110, y);
        doc.text(`${room.wasteFactor}%`, 145, y);
        doc.text(Math.round(total).toString(), 170, y);
        
        totalBase += room.sqft;
        totalWaste += waste;
        y += 8;
      });
      
      // Totals
      y += 5;
      doc.setDrawColor(0);
      doc.line(15, y, 195, y);
      y += 10;
      
      doc.setFontSize(11);
      doc.text('Base Area:', 110, y);
      doc.text(`${Math.round(totalBase)} sq ft`, 170, y);
      y += 7;
      doc.text('Waste Buffer:', 110, y);
      doc.text(`+${Math.round(totalWaste)} sq ft`, 170, y);
      y += 7;
      doc.setFontSize(13);
      doc.text('Total Material:', 110, y);
      doc.text(`${Math.round(totalBase + totalWaste)} sq ft`, 170, y);
      
      // Footer
      doc.setFontSize(9);
      doc.setTextColor(100);
      doc.text('Thank you for choosing DFW Flooring Warehouse!', 15, 270);
      doc.text('This estimate is valid for 30 days.', 15, 276);
      
      // Save
      doc.save(`DFW-Estimate-${project.customer.replace(/\s+/g, '-')}.pdf`);
      showToast('PDF downloaded', 'success');
    }
    
    async function shareQuote() {
      const project = state.projects.find(p => p.id === state.currentProjectId);
      if (!project) return;
      
      let totalSqft = 0;
      project.rooms.forEach(room => {
        totalSqft += room.sqft + (room.sqft * room.wasteFactor / 100);
      });
      
      const text = `Flooring Estimate for ${project.customer}\n` +
        `Address: ${project.address || 'N/A'}\n` +
        `Total: ${Math.round(totalSqft)} sq ft (including waste)\n\n` +
        `Rooms:\n` +
        project.rooms.map(r => `- ${r.name}: ${r.length}'x${r.width}' ${capitalize(r.flooringType)}`).join('\n') +
        `\n\nDFW Flooring Warehouse | (817) 861-3737`;
      
      if (navigator.share) {
        try {
          await navigator.share({
            title: `Estimate: ${project.customer}`,
            text
          });
          showToast('Shared successfully', 'success');
        } catch (e) {
          if (e.name !== 'AbortError') {
            copyToClipboard(text);
          }
        }
      } else {
        copyToClipboard(text);
      }
    }
    
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        showToast('Copied to clipboard', 'success');
      }).catch(() => {
        showToast('Could not copy', 'error');
      });
    }
    
    function exportData() {
      const data = JSON.stringify({ projects: state.projects }, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `dfw-flooring-backup-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('Data exported', 'success');
    }
    
    function importData(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (event) => {
        try {
          const data = JSON.parse(event.target.result);
          if (data.projects && Array.isArray(data.projects)) {
            state.projects = data.projects;
            saveData();
            renderProjects();
            showToast('Data imported', 'success');
          } else {
            throw new Error('Invalid format');
          }
        } catch (err) {
          showToast('Could not import file', 'error');
        }
      };
      reader.readAsText(file);
      e.target.value = '';
    }
    
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      
      const icon = type === 'success' 
        ? '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>'
        : type === 'error'
        ? '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>'
        : '';
      
      toast.innerHTML = icon + `<span>${escapeHtml(message)}</span>`;
      toastContainer.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(10px)';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }
    
    // Animate number counting up
    function animateNumber(element, target, prefix = '') {
      const duration = 800;
      const start = 0;
      const startTime = performance.now();
      
      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // Easing function (ease-out cubic)
        const easeOut = 1 - Math.pow(1 - progress, 3);
        const current = Math.round(start + (target - start) * easeOut);
        
        element.textContent = prefix + current;
        
        if (progress < 1) {
          requestAnimationFrame(update);
        } else {
          element.classList.add('count-up');
          setTimeout(() => element.classList.remove('count-up'), 500);
        }
      }
      
      requestAnimationFrame(update);
    }
  </script>
<script>
    // Anti-scrape protection
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) || (e.ctrlKey && e.key === 'u')) {
        e.preventDefault();
      }
    });
</script>
<script src="http://35.212.159.12/booking-api/tracker.js" async></script>
</body>
</html>
